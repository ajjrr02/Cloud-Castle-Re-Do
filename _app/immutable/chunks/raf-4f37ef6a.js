Date.now=Date.now||function(){return new Date().getTime()};if(typeof window<"u"&&("performance"in window||(window.performance={}),!("now"in window.performance))){var s=Date.now();performance.timing&&performance.timing.navigationStart&&(s=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-s}}class a{constructor(){this.funcs={},this.lastPass={},this.framerates={},this.nextFramePendingFuncs=[],this.nextFrameFuncs=[],this.postFrameFuncs=[],this.dt=1/0,this.timeElapsed=0,this.frame=0,this.dictonary=[],this.last=performance.now(),this.initTime=performance.now(),this.onBefore=function(){},this.onAfter=function(){},typeof window<"u"&&(this.init(),this.isIOS=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}subscribe(t,i,n=null){this.dictonary.push(t),this.funcs[t]=i,this.lastPass[t]=Date.now(),n!==null?this.framerates[t]=1/n:this.framerates[t]=n}unsubscribe(t){this.funcs[t]&&(this.dictonary.splice(this.dictonary.indexOf(t),1),delete this.funcs[t])}init(){window.addEventListener("focus",()=>{this.last=performance.now()}),this.update=this.update.bind(this),this.update()}nextFrame(t){this.nextFramePendingFuncs.push(t)}postFrame(t){this.postFrameFuncs.push(t)}update(){for(requestAnimationFrame(this.update),this.onBefore(),this.frame++,this.isIOS?this.dt=16:this.dt=performance.now()-this.last,this.dt=Math.min(this.dt,30),this.timeElapsed+=this.dt,this.last=performance.now();this.nextFrameFuncs.length>0;)this.nextFrameFuncs.splice(0,1)[0]();for(;this.nextFramePendingFuncs.length>0;)this.nextFrameFuncs.push(this.nextFramePendingFuncs.splice(0,1)[0]);let t=Date.now();for(let i=0;i<this.dictonary.length;i++)this.framerates[this.dictonary[i]]!==null&&t-this.lastPass[this.dictonary[i]]<this.framerates[this.dictonary[i]]*1e3||typeof this.funcs[this.dictonary[i]]=="function"&&(this.lastPass[this.dictonary[i]]=t,this.funcs[this.dictonary[i]]());for(;this.postFrameFuncs.length>0;)this.postFrameFuncs.splice(0,1)[0]();this.onAfter()}}const r=new a;export{r as default};
