var fg=Object.defineProperty;var vg=(n,e,t)=>e in n?fg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var fe=(n,e,t)=>(vg(n,typeof e!="symbol"?e+"":e,t),t);import{d as qu,o as Vd,g as ji}from"./index-d954d85d.js";import{E as ya,c as xr,m as gt,l as In,G as Mh,a as wl,C as Bh}from"./_layout-e7795dba.js";import ui from"./raf-4f37ef6a.js";function Wd(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in n)){const r=Object.getOwnPropertyDescriptor(i,s);r&&Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function Ph(n){let e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function mu(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function gg(n,e,t,i){return n[0]=e,n[1]=t,n[2]=i,n}function Ih(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Rh(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function _g(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function bg(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function Al(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function xg(n,e){let t=e[0]-n[0],i=e[1]-n[1],s=e[2]-n[2];return Math.sqrt(t*t+i*i+s*s)}function yg(n,e){let t=e[0]-n[0],i=e[1]-n[1],s=e[2]-n[2];return t*t+i*i+s*s}function Oh(n){let e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function Cg(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Sg(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function fu(n,e){let t=e[0],i=e[1],s=e[2],r=t*t+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function jd(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Fh(n,e,t){let i=e[0],s=e[1],r=e[2],o=t[0],c=t[1],p=t[2];return n[0]=s*p-r*c,n[1]=r*o-i*p,n[2]=i*c-s*o,n}function wg(n,e,t,i){let s=e[0],r=e[1],o=e[2];return n[0]=s+i*(t[0]-s),n[1]=r+i*(t[1]-r),n[2]=o+i*(t[2]-o),n}function Ag(n,e,t){let i=e[0],s=e[1],r=e[2],o=t[3]*i+t[7]*s+t[11]*r+t[15];return o=o||1,n[0]=(t[0]*i+t[4]*s+t[8]*r+t[12])/o,n[1]=(t[1]*i+t[5]*s+t[9]*r+t[13])/o,n[2]=(t[2]*i+t[6]*s+t[10]*r+t[14])/o,n}function Eg(n,e,t){let i=e[0],s=e[1],r=e[2],o=t[3]*i+t[7]*s+t[11]*r+t[15];return o=o||1,n[0]=(t[0]*i+t[4]*s+t[8]*r)/o,n[1]=(t[1]*i+t[5]*s+t[9]*r)/o,n[2]=(t[2]*i+t[6]*s+t[10]*r)/o,n}function Tg(n,e,t){let i=e[0],s=e[1],r=e[2],o=t[0],c=t[1],p=t[2],m=t[3],_=c*r-p*s,v=p*i-o*r,g=o*s-c*i,C=c*g-p*v,S=p*_-o*g,E=o*v-c*_,T=m*2;return _*=T,v*=T,g*=T,C*=2,S*=2,E*=2,n[0]=i+_+C,n[1]=s+v+S,n[2]=r+g+E,n}const Mg=function(){const n=[0,0,0],e=[0,0,0];return function(t,i){mu(n,t),mu(e,i),fu(n,n),fu(e,e);let s=jd(n,e);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();function Bg(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}class q extends Array{constructor(e=0,t=e,i=e){return super(e,t,i),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,t=e,i=e){return e.length?this.copy(e):(gg(this,e,t,i),this)}copy(e){return mu(this,e),this}add(e,t){return t?Ih(this,e,t):Ih(this,this,e),this}sub(e,t){return t?Rh(this,e,t):Rh(this,this,e),this}multiply(e){return e.length?_g(this,this,e):Al(this,this,e),this}divide(e){return e.length?bg(this,this,e):Al(this,this,1/e),this}inverse(e=this){return Sg(this,e),this}len(){return Ph(this)}distance(e){return e?xg(this,e):Ph(this)}squaredLen(){return Oh(this)}squaredDistance(e){return e?yg(this,e):Oh(this)}negate(e=this){return Cg(this,e),this}cross(e,t){return t?Fh(this,e,t):Fh(this,this,e),this}scale(e){return Al(this,this,e),this}normalize(){return fu(this,this),this}dot(e){return jd(this,e)}equals(e){return Bg(this,e)}applyMatrix4(e){return Ag(this,this,e),this}scaleRotateMatrix4(e){return Eg(this,this,e),this}applyQuaternion(e){return Tg(this,this,e),this}angle(e){return Mg(this,e)}lerp(e,t){return wg(this,this,e,t),this}clone(){return new q(this[0],this[1],this[2])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}transformDirection(e){const t=this[0],i=this[1],s=this[2];return this[0]=e[0]*t+e[4]*i+e[8]*s,this[1]=e[1]*t+e[5]*i+e[9]*s,this[2]=e[2]*t+e[6]*i+e[10]*s,this.normalize()}}var Pg=1e-6,Ze=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function Kd(){var n=new Ze(9);return Ze!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ut(){var n=new Ze(16);return Ze!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Ig(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Rg(n,e,t){var i=e[0],s=e[1],r=e[2],o=e[3],c=e[4],p=e[5],m=e[6],_=e[7],v=e[8],g=e[9],C=e[10],S=e[11],E=e[12],T=e[13],M=e[14],W=e[15],B=t[0],O=t[1],L=t[2],H=t[3];return n[0]=B*i+O*c+L*v+H*E,n[1]=B*s+O*p+L*g+H*T,n[2]=B*r+O*m+L*C+H*M,n[3]=B*o+O*_+L*S+H*W,B=t[4],O=t[5],L=t[6],H=t[7],n[4]=B*i+O*c+L*v+H*E,n[5]=B*s+O*p+L*g+H*T,n[6]=B*r+O*m+L*C+H*M,n[7]=B*o+O*_+L*S+H*W,B=t[8],O=t[9],L=t[10],H=t[11],n[8]=B*i+O*c+L*v+H*E,n[9]=B*s+O*p+L*g+H*T,n[10]=B*r+O*m+L*C+H*M,n[11]=B*o+O*_+L*S+H*W,B=t[12],O=t[13],L=t[14],H=t[15],n[12]=B*i+O*c+L*v+H*E,n[13]=B*s+O*p+L*g+H*T,n[14]=B*r+O*m+L*C+H*M,n[15]=B*o+O*_+L*S+H*W,n}function lr(n,e,t,i){var s=e[0],r=e[1],o=e[2],c=e[3],p=s+s,m=r+r,_=o+o,v=s*p,g=s*m,C=s*_,S=r*m,E=r*_,T=o*_,M=c*p,W=c*m,B=c*_,O=i[0],L=i[1],H=i[2];return n[0]=(1-(S+T))*O,n[1]=(g+B)*O,n[2]=(C-W)*O,n[3]=0,n[4]=(g-B)*L,n[5]=(1-(v+T))*L,n[6]=(E+M)*L,n[7]=0,n[8]=(C+W)*H,n[9]=(E-M)*H,n[10]=(1-(v+S))*H,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}var Dh=Rg;function _t(){var n=new Ze(3);return Ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ur(n){var e=new Ze(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Og(n){var e=n[0],t=n[1],i=n[2];return Math.hypot(e,t,i)}function Ge(n,e,t){var i=new Ze(3);return i[0]=n,i[1]=e,i[2]=t,i}function Xe(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Jd(n,e,t,i){return n[0]=e,n[1]=t,n[2]=i,n}function Ki(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function vu(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function ta(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function ua(n,e){var t=e[0],i=e[1],s=e[2],r=t*t+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function Fg(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ai(n,e,t){var i=e[0],s=e[1],r=e[2],o=t[0],c=t[1],p=t[2];return n[0]=s*p-r*c,n[1]=r*o-i*p,n[2]=i*c-s*o,n}function Dg(n,e,t){var i=e[0],s=e[1],r=e[2],o=t[3]*i+t[7]*s+t[11]*r+t[15];return o=o||1,n[0]=(t[0]*i+t[4]*s+t[8]*r+t[12])/o,n[1]=(t[1]*i+t[5]*s+t[9]*r+t[13])/o,n[2]=(t[2]*i+t[6]*s+t[10]*r+t[14])/o,n}function Lg(n,e,t){var i=t[0],s=t[1],r=t[2],o=t[3],c=e[0],p=e[1],m=e[2],_=s*m-r*p,v=r*c-i*m,g=i*p-s*c,C=s*g-r*v,S=r*_-i*g,E=i*v-s*_,T=o*2;return _*=T,v*=T,g*=T,C*=2,S*=2,E*=2,n[0]=c+_+C,n[1]=p+v+S,n[2]=m+g+E,n}var yr=vu,Ng=Og;(function(){var n=_t();return function(e,t,i,s,r,o){var c,p;for(t||(t=3),i||(i=0),s?p=Math.min(s*t+i,e.length):p=e.length,c=i;c<p;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],r(n,n,o),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2];return e}})();function kg(){var n=new Ze(4);return Ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function zg(n,e){var t=e[0],i=e[1],s=e[2],r=e[3],o=t*t+i*i+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=i*o,n[2]=s*o,n[3]=r*o,n}(function(){var n=kg();return function(e,t,i,s,r,o){var c,p;for(t||(t=4),i||(i=0),s?p=Math.min(s*t+i,e.length):p=e.length,c=i;c<p;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],n[3]=e[c+3],r(n,n,o),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2],e[c+3]=n[3];return e}})();function on(){var n=new Ze(4);return Ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ug(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Hg(n,e,t){t=t*.5;var i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function gu(n,e,t){t*=.5;var i=e[0],s=e[1],r=e[2],o=e[3],c=Math.sin(t),p=Math.cos(t);return n[0]=i*p+o*c,n[1]=s*p+r*c,n[2]=r*p-s*c,n[3]=o*p-i*c,n}function _u(n,e,t){t*=.5;var i=e[0],s=e[1],r=e[2],o=e[3],c=Math.sin(t),p=Math.cos(t);return n[0]=i*p-r*c,n[1]=s*p+o*c,n[2]=r*p+i*c,n[3]=o*p-s*c,n}function bu(n,e,t){t*=.5;var i=e[0],s=e[1],r=e[2],o=e[3],c=Math.sin(t),p=Math.cos(t);return n[0]=i*p+s*c,n[1]=s*p-i*c,n[2]=r*p+o*c,n[3]=o*p-r*c,n}function El(n,e,t,i){var s=e[0],r=e[1],o=e[2],c=e[3],p=t[0],m=t[1],_=t[2],v=t[3],g,C,S,E,T;return C=s*p+r*m+o*_+c*v,C<0&&(C=-C,p=-p,m=-m,_=-_,v=-v),1-C>Pg?(g=Math.acos(C),S=Math.sin(g),E=Math.sin((1-i)*g)/S,T=Math.sin(i*g)/S):(E=1-i,T=i),n[0]=E*s+T*p,n[1]=E*r+T*m,n[2]=E*o+T*_,n[3]=E*c+T*v,n}function $d(n,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var r=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[r*3+r]-e[o*3+o]+1),n[s]=.5*i,i=.5/i,n[3]=(e[r*3+o]-e[o*3+r])*i,n[r]=(e[r*3+s]+e[s*3+r])*i,n[o]=(e[o*3+s]+e[s*3+o])*i}return n}var qd=zg;(function(){var n=_t(),e=Ge(1,0,0),t=Ge(0,1,0);return function(i,s,r){var o=Fg(s,r);return o<-.999999?(ai(n,e,s),Ng(n)<1e-6&&ai(n,t,s),ua(n,n),Hg(i,n,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(ai(n,s,r),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+o,qd(i,i))}})();(function(){var n=on(),e=on();return function(t,i,s,r,o,c){return El(n,i,o,c),El(e,s,r,c),El(t,n,e,2*c*(1-c)),t}})();(function(){var n=Kd();return function(e,t,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],qd(e,$d(e,n))}})();function Xd(){var n=new Ze(2);return Ze!=Float32Array&&(n[0]=0,n[1]=0),n}function Zn(n,e){var t=new Ze(2);return t[0]=n,t[1]=e,t}function Gg(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function Vg(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function Wg(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}var jg=Vg;(function(){var n=Xd();return function(e,t,i,s,r,o){var c,p;for(t||(t=2),i||(i=0),s?p=Math.min(s*t+i,e.length):p=e.length,c=i;c<p;c+=t)n[0]=e[c],n[1]=e[c+1],r(n,n,o),e[c]=n[0],e[c+1]=n[1];return e}})();const Kr=Kd(),cr=new Float32Array(Kr.buffer,0*4,3),Kg=new Float32Array(Kr.buffer,3*4,3),Di=new Float32Array(Kr.buffer,6*4,3),Jg=Ge(0,1,0),Tl=on(),Tn=_t();class Xu{constructor(e=!1){return this.parent=null,this.children=[],this.position=Ge(0,0,0),this.positionDamped=Ge(0,0,0),this.scale=Ge(1,1,1),this.rotation=Ge(0,0,0),this.rotationDamped=Ge(0,0,0),this.quaternion=on(),this.matrix=ut(),this.lmatrix=ut(),this.damped=!1,this.dampedRot=!1,this.damping=.03,this.rotDamping=.03,this.lookAtNode=null,this.needUpdate=!0,this.forceUpdate=!1,this.manualRot=!1,this.isCamera=e,ui.nextFrame(()=>{this.getMatrix()}),this}setPosition(e,t,i){this.needUpdate=!0,this.position[0]=e,this.position[1]=t,this.position[2]=i}setRotation(e,t,i){this.needUpdate=!0,this.rotation[0]=e,this.rotation[1]=t,this.rotation[2]=i}setScale(e){this.needUpdate=!0,this.scale[0]=e,this.scale[1]=e,this.scale[2]=e}activateDamping(e){this.positionDamped=ur(this.position),this.damped=!0,this.damping=e,this.needUpdate=!0,this.getMatrix()}registerNodeToLookAt(e){this.lookAtNode=e,this.needUpdate=!0}lookAt(e){this.damped?vu(Di,this.positionDamped,e):vu(Di,this.position,e),ua(Di,Di),ai(cr,Jg,Di),ua(cr,cr),ai(Kg,Di,cr),$d(Tl,Kr),this.damped?lr(this.matrix,Tl,this.positionDamped,this.scale):lr(this.matrix,Tl,this.position,this.scale),this.parent!==null&&Dh(this.matrix,this.parent.getMatrix(),this.matrix),this.needUpdate=!1}getMatrix(){return!this.forceUpdate&&!this.needUpdate&&!this.damped&&this.lookAtNode==null?this.matrix:(Ig(this.matrix),this.manualRot==!1&&(this.quaternion=on(),this.dampedRot?(yr(Tn,this.rotation,this.rotationDamped),ta(Tn,Tn,this.rotDamping),Ki(this.rotationDamped,this.rotationDamped,Tn),_u(this.quaternion,this.quaternion,this.rotationDamped[1]),gu(this.quaternion,this.quaternion,this.rotationDamped[0]),bu(this.quaternion,this.quaternion,this.rotationDamped[2])):(_u(this.quaternion,this.quaternion,this.rotation[1]),gu(this.quaternion,this.quaternion,this.rotation[0]),bu(this.quaternion,this.quaternion,this.rotation[2]))),this.damped?(yr(Tn,this.position,this.positionDamped),ta(Tn,Tn,this.damping),Ki(this.positionDamped,this.positionDamped,Tn),lr(this.matrix,this.quaternion,this.positionDamped,this.scale)):lr(this.matrix,this.quaternion,this.position,this.scale),this.parent!==null&&Dh(this.matrix,this.parent.getMatrix(),this.matrix),this.lookAtNode!==null&&(this.lookAtNode.getMatrix(),this.lookAtNode.damped?this.lookAt(this.lookAtNode.positionDamped):this.lookAt(this.lookAtNode.position),ui.postFrame(()=>{this.needUpdate=!0})),this.needUpdate=!1,this.matrix)}getChildByName(e){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.name&&i.name===e)return i}}addChildNode(e){this.children.push(e),e.parent=this}fromPositionRotationScale(e,t,i){return this.position=ur(e),this.scale=ur(i),this.rotation=ur(t),this}}class $g{constructor(e,t){this.mobile=typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1,this.dpr=t.dpr,this.width=e.offsetWidth*this.dpr,this.height=e.offsetHeight*this.dpr,this.container=e,this.active=!1,this.time=0,this.dt=0,this.passes=[],t!==null?(this.manager=t,this.canvas=this.manager.canvas,this.gl=this.manager.gl):this.catchContext(),this.inTransition=!1,this.root=new Xu,this._emitter={},ya(this._emitter),this.on=this._emitter.on.bind(this._emitter),window.addEventListener("resize",()=>{setTimeout(this.onResize.bind(this),100)},{passive:!1}),this.manager.on("resize",this.onResize.bind(this))}getNode(e){for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].name==e)return this.nodes[t]}getMesh(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name==e)return this.meshes[t]}getMeshes(e){let t=[];for(let i=0;i<this.meshes.length;i++)this.meshes[i].name==e&&t.push(this.meshes[i]);return t}getParentInNodeTree(e,t){for(const i in e)if(Object.hasOwnProperty.call(e,i)){const s=e[i];if(s.childrenIds.indexOf(t)>-1)return s.transform}}catchContext(){if(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.maxWidth=this.container.offsetWidth+"px",this.canvas.style.maxHeight=this.container.offsetHeight+"px",this.container.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl",{}),this.gl===void 0)return;let e=this.gl.getExtension("OES_vertex_array_object");e&&(this.gl.createVertexArray=function(){return e.createVertexArrayOES()},this.gl.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},this.gl.bindVertexArray=function(t){e.bindVertexArrayOES(t)},this.gl.isVertexArray=function(t){return e.isVertexArrayOES(t)}),this.gl.getExtension("OES_standard_derivatives"),this.gl.getExtension("EXT_shader_texture_lod"),this.gl.getExtension("OES_texture_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("OES_texture_half_float"),this.gl.getExtension("OES_texture_half_float_linear"),this.gl.getExtension("EXT_color_buffer_half_float")}resize(){for(let e=0;e<this.passes.length;e++)this.passes[e].onResize()}onResize(){this.inTransition&&this.mobile||(this.dpr=this.manager.dpr,this.width=this.container.offsetWidth*this.dpr,this.height=this.container.offsetHeight*this.dpr,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.maxWidth=this.container.offsetWidth+"px",this.canvas.style.maxHeight=this.container.offsetHeight+"px",this.gl.viewport(0,0,this.width,this.height),this.resize&&this.resize())}}const Lh=new Uint8Array(4);function Nh(n){return(n&n-1)===0}let qg=1;class be{constructor(e,{image:t,target:i=e.TEXTURE_2D,type:s=e.UNSIGNED_BYTE,format:r=e.RGBA,internalFormat:o=r,rt:c=null,depth:p=!1,pass:m=null,wrapS:_=e.CLAMP_TO_EDGE,wrapT:v=e.CLAMP_TO_EDGE,generateMipmaps:g=!0,minFilter:C=g?e.NEAREST_MIPMAP_LINEAR:e.LINEAR,magFilter:S=e.LINEAR,premultiplyAlpha:E=!1,unpackAlignment:T=4,flipY:M=i==e.TEXTURE_2D,anisotropy:W=0,level:B=0,width:O,height:L=O}={}){this.gl=e,this.id=qg++,this.image=t,this.target=i,this.type=s,this.format=r,this.rt=c,this.depth=p,this.pass=m,this.internalFormat=o,this.minFilter=C,this.magFilter=S,this.wrapS=_,this.wrapT=v,this.generateMipmaps=g,this.premultiplyAlpha=E,this.unpackAlignment=T,this.flipY=M,this.anisotropy=Math.min(W,this.gl.renderer.parameters.maxAnisotropy),this.level=B,this.width=O,this.height=L,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.rt!==null?this.depth?this.gl.bindTexture(this.target,this.rt.getDepthTexture()):this.gl.bindTexture(this.target,this.rt.getTexture()):this.pass!==null?this.gl.bindTexture(this.target,this.pass.getTexture()):this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id}update(e=0){const t=!(this.image===this.store.image&&!this.needsUpdate);if((t||this.glState.textureUnits[e]!==this.id)&&(this.gl.renderer.activeTexture(e),this.bind()),!!t){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let i=0;i<6;i++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.level,this.internalFormat,this.format,this.type,this.image[i]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let i=0;i<this.image.length;i++)this.gl.compressedTexImage2D(this.target,i,this.internalFormat,this.image[i].width,this.image[i].height,0,this.image[i].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!Nh(this.image.width)||!Nh(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let i=0;i<6;i++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Lh);else this.width?this.rt===null&&this.pass===null&&this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.rt===null&&this.pass===null&&this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Lh);this.store.image=this.image}}dispose(){this.texture&&(this.gl.deleteTexture(this.texture),delete this.texture)}}let Ml,Bl=0;class Xg{constructor(e){Ml||(Ml=this.getSupportedFormat()),this.onMessage=this.onMessage.bind(this),this.queue=new Map,this.initWorker(e)}getSupportedFormat(){const e=document.createElement("canvas").getContext("webgl");return e.getExtension("WEBGL_compressed_texture_etc")?"etc2":e.getExtension("WEBGL_compressed_texture_astc")?"astc":e.getExtension("EXT_texture_compression_bptc")?"bptc":e.getExtension("WEBGL_compressed_texture_s3tc")?"s3tc":e.getExtension("WEBGL_compressed_texture_etc1")?"etc1":!!e.getExtension("WEBGL_compressed_texture_pvrtc")||!!e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc")?"pvrtc":"none"}initWorker(e){this.worker=new Worker(e),this.worker.onmessage=this.onMessage}onMessage({data:e}){const{id:t,error:i,image:s}=e;if(i){console.log(i,t);return}const r=this.queue.get(t);this.queue.delete(t),s.isBasis=!0,r(s)}parseTexture(e){Bl++,this.worker.postMessage({id:Bl,buffer:e,supportedFormat:Ml});let t;const i=new Promise(s=>t=s);return this.queue.set(Bl,t),i}}const Yg=()=>{const n=window.matchMedia("(pointer:coarse)");return!!(n&&n.matches)},Qg=window.navigator.userAgent;navigator.userAgent.indexOf("Firefox")>-1;!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;/constructor/i.test(window.HTMLElement)||function(n){return n.toString()==="[object SafariRemoteNotification]"}(!window.safari||typeof safari<"u"&&safari.pushNotification);window.chrome&&(window.chrome.webstore||window.chrome.runtime);const at=Yg(),Yd=Qg.match(/(iPad)/)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,Zg=at&&document.documentElement.clientHeight>document.documentElement.clientWidth&&document.documentElement.clientWidth<768,e_=!at&&!Yd;function t_(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}t_();class n_{constructor(e){this.scene=e,this.gl=e.gl,this.textures={},this.currentUnit=0;let t=this.gl;this.isCompressedSupport=!1;const i={astcSupported:!!t.renderer.getExtension("WEBGL_compressed_texture_astc"),etc1Supported:!!t.renderer.getExtension("WEBGL_compressed_texture_etc1"),etc2Supported:!!t.renderer.getExtension("WEBGL_compressed_texture_etc"),dxtSupported:!!t.renderer.getExtension("WEBGL_compressed_texture_s3tc"),bptcSupported:!!t.renderer.getExtension("EXT_texture_compression_bptc"),pvrtcSupported:!!t.renderer.getExtension("WEBGL_compressed_texture_pvrtc")||!!t.renderer.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc")};for(const[s,r]of Object.entries(i))r&&(this.isCompressedSupport=!0);this.basisManager=new Xg("/vendors/basis/BasisWorker.js")}load(e,t,i){let s=i.indexOf("compressed")>-1,r=i.indexOf("transparent")>-1,o=i.filter(v=>{if(v.indexOf("lodTarget")!==-1)return!0})[0];o=o!==void 0?o.replace("lodTarget=",""):null,at&&(o=this.getSmallerLod(o));let c=o!==null,p=e.replace(/^.*[\\\/]/,""),m=e.replace(p,""),_=e;if(c&&(_=`${m}${o}/${p}${r?".png":".jpg"}`),s&&this.isCompressedSupport)return c?_=`${m}${o}/${p}.ktx2`:_=`${m}${p.replace(/\.[^/.]+$/,"")}.ktx2`,this.textures[t]={options:i},new Promise(g=>{fetch(_).then(C=>{C.arrayBuffer().then(S=>{this.basisManager.parseTexture(S).then(E=>{const T=this.initCompressedTexture(E,i);this.textures[t].texture=T,this.textures[t].unit=this.currentUnit,T.update(),this.currentUnit++,g(T)})})})});{let v=new Image;v.crossOrigin="anonymous";const g=new Promise(C=>{v.onload=()=>{let S=this.initTexture(v,i);this.textures[t].texture=S,this.textures[t].unit=this.currentUnit,this.currentUnit++,C(S)}});return v.src=_,this.textures[t]={img:v,options:i},g}}initCompressedTexture(e,t){const i=this.gl,s=new be(i,{generateMipmaps:t.indexOf("mipmap")>-1,internalFormat:e.internalFormat});return s.image=e,s.flipY=t.indexOf("flipY")>-1,s.wrapS=t.indexOf("mirror")>-1?i.MIRRORED_REPEAT:i.CLAMP_TO_EDGE,s.wrapT=t.indexOf("mirror")>-1?i.MIRRORED_REPEAT:i.CLAMP_TO_EDGE,s.wrapS=t.indexOf("repeat")>-1?i.REPEAT:s.wrapS,s.wrapT=t.indexOf("repeat")>-1?i.REPEAT:s.wrapT,s.wrapS=t.indexOf("clamp")>-1?i.CLAMP_TO_EDGE:s.wrapS,s.wrapT=t.indexOf("clamp")>-1?i.CLAMP_TO_EDGE:s.wrapT,s.minFilter=t.indexOf("nearest")>-1?i.NEAREST:s.minFilter,s.magFilter=t.indexOf("nearest")>-1?i.NEAREST:s.magFilter,s.needsUpdate=!0,s}initTexture(e,t){const i=this.gl,s=new be(i,{generateMipmaps:t.indexOf("mipmap")>-1,flipY:t.indexOf("flipY")>-1});return s.image=e,s.flipY=t.indexOf("flipY")>-1,s.wrapS=t.indexOf("mirror")>-1?i.MIRRORED_REPEAT:i.CLAMP_TO_EDGE,s.wrapT=t.indexOf("mirror")>-1?i.MIRRORED_REPEAT:i.CLAMP_TO_EDGE,s.wrapS=t.indexOf("repeat")>-1?i.REPEAT:s.wrapS,s.wrapT=t.indexOf("repeat")>-1?i.REPEAT:s.wrapT,s.wrapS=t.indexOf("clamp")>-1?i.CLAMP_TO_EDGE:s.wrapS,s.wrapT=t.indexOf("clamp")>-1?i.CLAMP_TO_EDGE:s.wrapT,s.minFilter=t.indexOf("nearest")>-1?i.NEAREST:s.minFilter,s.magFilter=t.indexOf("nearest")>-1?i.NEAREST:s.magFilter,s}disposeTexture(e){this.textures[e]&&this.textures[e].texture&&this.textures[e].texture.dispose()}getSmallerLod(e){let t=e;switch(e){case"2048":t="1024";break;case"1024":t="512";break;case"512":t="256";break;default:t=e;break}return t}get(e){if(this.textures[e])return this.textures[e]}getTexture(e){if(this.textures[e])return this.textures[e].texture}getImage(e){return this.textures[e]?this.textures[e].img:null}isTextureRegistered(e){return!!this.textures[e]}}const _e={main:{brdfLUT:{url:"./glxp/brdfLUT.png",options:["clamp"]},env_diffuse:{url:"./glxp/environment/diffuse.png",options:["repeat"]},env_default:{url:"./glxp/environment/oberer_kuhberg.jpg",options:["repeat"]},flameParticle:{url:"./glxp/particles/flame.png",options:[]},gradientParticle:{url:"./glxp/particles/gradient.png",options:[]},background:{url:"./glxp/textures/background/2048/background.jpg.webp",options:["flipY"]},background_mobile:{url:"./glxp/textures/background/1024/background_mobile.jpg.webp",options:["flipY"]},background_gallery:{url:"./images/bg-rocks.webp",options:["flipY"]},cloud1:{url:"./glxp/textures/clouds/cloud1.png",options:["transparent","lodTarget=256"]},cloud2:{url:"./glxp/textures/clouds/cloud2.png",options:["transparent","lodTarget=256"]},cloud3:{url:"./glxp/textures/clouds/cloud3.png",options:["transparent","lodTarget=256"]},cloud4:{url:"./glxp/textures/clouds/cloud4.png",options:["transparent","lodTarget=256"]},cloud5:{url:"./glxp/textures/clouds/cloud5.png",options:["transparent","lodTarget=256"]},cloud6:{url:"./glxp/textures/clouds/cloud6.png",options:["transparent","lodTarget=256"]},fbm1:{url:"./glxp/textures/fbm/fbm1.png",options:["repeat","lodTarget=256"]},battlearena_title:{url:"./glxp/textures/texts/battlearena_title.png",options:["flipY"]},creatures_title:{url:"./glxp/textures/texts/creatures_title.png",options:["flipY"]},gameplay_title:{url:"./glxp/textures/texts/gameplay_title.png",options:["flipY"]},lore_title:{url:"./glxp/textures/texts/lore_title.png",options:["flipY"]},team_title:{url:"./glxp/textures/texts/team_title.png",options:["flipY"]},asteroid_BaseColor:{url:"./glxp/textures/asteroid/floating_island1_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},asteroid_ORM:{url:"./glxp/textures/asteroid/floating_island1_ORM.png",options:["repeat","lodTarget=256","compressed"]},asteroid_Normal:{url:"./glxp/textures/asteroid/floating_island1_Normal.png",options:["repeat","lodTarget=1024"]},floating_island1_BaseColor:{url:"./glxp/textures/floating_island/floating_island_01_BaseColor.png",options:["repeat","compressed","lodTarget=1024"]},floating_island1_Emissive:{url:"./glxp/textures/floating_island/floating_island_01_Emissive.png",options:["repeat","compressed","lodTarget=256"]},floating_island1_ORM:{url:"./glxp/textures/floating_island/floating_island_01_OcclusionRoughnessMetallic.png",options:["repeat","compressed","lodTarget=256"]},floating_island1_Normal:{url:"./glxp/textures/floating_island/floating_island_01_Normal.png",options:["repeat","mipmap","lodTarget=1024"]},Cave_and_ground1_BaseColor:{url:"./glxp/textures/creature_island/Cave_and_ground1_BaseColor.png",options:["repeat","compressed","lodTarget=1024"]},Cave_and_ground1_ORM:{url:"./glxp/textures/creature_island/Cave_and_ground1_ORM.png",options:["repeat","compressed","lodTarget=256"]},Cave_and_ground1_Normal:{url:"./glxp/textures/creature_island/1024/Cave_and_ground1_Normal.png.webp",options:["repeat","mipmap"]},Cave_and_ground1_Shadow:{url:"./glxp/textures/creature_island/Cave_and_ground1_shadow.png",options:["repeat","compressed","lodTarget=256"]},Decorative_elements_BaseColor:{url:"./glxp/textures/creature_island/Decorative_elements_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},Decorative_elements_alpha:{url:"./glxp/textures/creature_island/Decorative_elements_alpha.jpg",options:["repeat","compressed","lodTarget=256"]},Decorative_elements_MetallicRoughness:{url:"./glxp/textures/creature_island/Decorative_elements_MetallicRoughness.png",options:["repeat","mipmap","lodTarget=512"]},Decorative_elements_Normal:{url:"./glxp/textures/creature_island/512/Decorative_elements_Normal.png.webp",options:["repeat","mipmap"]},Decorative_elements_shadow:{url:"./glxp/textures/creature_island/Decorative_elements_shadow.png",options:["repeat","compressed","lodTarget=256"]},Decorative_elements_Weights_Center:{url:"./glxp/textures/creature_island/Creature_Island_Decorative_elements_Weights_Center.png",options:["compressed","lodTarget=512"]},Decorative_elements_Weights_Left:{url:"./glxp/textures/creature_island/Creature_Island_Decorative_elements_Weights_Left.png",options:["compressed","lodTarget=512"]},Decorative_elements_Weights_Right:{url:"./glxp/textures/creature_island/Creature_Island_Decorative_elements_Weights_Right.png",options:["compressed","lodTarget=512"]},Dragon1_BaseColor:{url:"./glxp/textures/creature_island/Dragon1_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},Dragon1_ORM:{url:"./glxp/textures/creature_island/Dragon1_ORM.png",options:["repeat","compressed","lodTarget=256"]},Dragon1_Normal:{url:"./glxp/textures/creature_island/1024/Dragon1_Normal.png.webp",options:["repeat","mipmap"]},Dragon1_shadow:{url:"./glxp/textures/creature_island/Dragon1_shadow.png",options:["repeat","compressed","lodTarget=256"]},creatures_island_shadow:{url:"./glxp/textures/creature_island/creature_island_shadow.png",options:["repeat","compressed","lodTarget=256"]},lore_BaseColor:{url:"./glxp/textures/lore_island/2048/Lore_Island_BaseColor_opaque.webp",options:["repeat"]},lore_ORM:{url:"./glxp/textures/lore_island/Lore_Island_ORM.png",options:["repeat","compressed","lodTarget=256"]},lore_Normal:{url:"./glxp/textures/lore_island/1024/Lore_Island_Normal.png.webp",options:["repeat","mipmap"]},lore_Shadow:{url:"./glxp/textures/lore_island/Lore_Island_shadow.png",options:["repeat","compressed","lodTarget=256"]},lore_island_shadow:{url:"./glxp/textures/lore_island/Lore_Island_island_Shadow.png",options:["repeat","compressed","lodTarget=256"]},team_01_BaseColor:{url:"./glxp/textures/team_island/Team_Island_01_BaseColor.png",options:["repeat","compressed","lodTarget=512"]},team_01_ORM:{url:"./glxp/textures/team_island/Team_Island_01_ORM.png",options:["repeat","compressed","lodTarget=256"]},team_01_Normal:{url:"./glxp/textures/team_island/1024/Team_Island_01_Normal.png.webp",options:["repeat","mipmap"]},team_01_shadow:{url:"./glxp/textures/team_island/Team_Island_01_shadow.png",options:["repeat","compressed","lodTarget=256"]},team_02_BaseColor:{url:"./glxp/textures/team_island/Team_Island_02_BaseColor.png",options:["repeat","compressed","lodTarget=1024"]},team_02_ORM:{url:"./glxp/textures/team_island/Team_Island_02_ORM.png",options:["repeat","compressed","lodTarget=256"]},team_02_Normal:{url:"./glxp/textures/team_island/1024/Team_Island_02_Normal.png.webp",options:["repeat","mipmap"]},team_02_shadow:{url:"./glxp/textures/team_island/Team_Island_02_shadow.png",options:["repeat","compressed","lodTarget=256"]},team_island_shadow:{url:"./glxp/textures/team_island/team_island_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_creature1_BaseColor:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Creature_01_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},gameplay_creature1_ORM:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Creature_01_ORM.png",options:["repeat","compressed","lodTarget=256"]},gameplay_creature1_Normal:{url:"./glxp/textures/gameplay_island/1024/Gameplay_Island_01_Creature_01_Normal.png.webp",options:["repeat","mipmap"]},gameplay_creature1_shadow:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Creature_01_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_creature2_BaseColor:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Creature_02_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},gameplay_creature2_ORM:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Creature_02_ORM.png",options:["repeat","compressed","lodTarget=256"]},gameplay_creature2_Normal:{url:"./glxp/textures/gameplay_island/1024/Gameplay_Island_01_Creature_02_Normal.png.webp",options:["repeat","mipmap"]},gameplay_creature2_shadow:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Creature_02_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_dragon_BaseColor:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Dragon_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},gameplay_dragon_ORM:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Dragon_ORM.png",options:["repeat","compressed","lodTarget=256"]},gameplay_dragon_Normal:{url:"./glxp/textures/gameplay_island/1024/Gameplay_Island_01_Dragon_Normal.png.webp",options:["repeat","mipmap"]},gameplay_dragon_shadow:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Dragon_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_table_BaseColor:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Table_Pieces_01_BaseColor.png",options:["repeat","lodTarget=256","compressed"]},gameplay_table_alpha:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Table_Pieces_01_alpha.jpg",options:["repeat","lodTarget=256","compressed"]},gameplay_table_ORM:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Table_Pieces_01_ORM.png",options:["repeat","compressed","lodTarget=256"]},gameplay_table_Normal:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Table_Pieces_01_Normal.png",options:["repeat","mipmap","lodTarget=512"]},gameplay_table_shadow:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Table_Pieces_01_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_wizard_BaseColor:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Wizard_BaseColor.png",options:["repeat","compressed","lodTarget=1024"]},gameplay_wizard_ORM:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Wizard_ORM.png",options:["repeat","lodTarget=256"]},gameplay_wizard_Normal:{url:"./glxp/textures/gameplay_island/256/Gameplay_Island_01_Gameplay_Island_Wizard_Normal.png.webp",options:["repeat","mipmap"]},gameplay_wizard_shadow:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Gameplay_Island_Wizard_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_torch_BaseColor:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Torch_01_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},gameplay_torch_ORM:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Torch_01_ORM.png",options:["repeat","lodTarget=256"]},gameplay_torch_Normal:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Torch_01_Normal.png",options:["repeat","mipmap","lodTarget=256"]},gameplay_torch_Emissive:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Torch_01_Emissive.png",options:["repeat","compressed","lodTarget=256"]},gameplay_torch_shadow:{url:"./glxp/textures/gameplay_island/Gameplay_Island_01_Torch_01_shadow.png",options:["repeat","compressed","lodTarget=256"]},gameplay_island_shadow:{url:"./glxp/textures/gameplay_island/gameplay_island_shadow.png",options:["repeat","compressed","lodTarget=256"]},battlearena_decorative_Weights:{url:"./glxp/textures/battlearena_island/Decorative_elements_Weights.png",options:["compressed","lodTarget=512"]},battlearena_stadium_BaseColor:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Stadium_01_BaseColor.png",options:["repeat","compressed","lodTarget=1024"]},battlearena_stadium_ORM:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Stadium_01_ORM.png",options:["repeat","lodTarget=256","compressed"]},battlearena_stadium_Normal:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Stadium_01_Normal.png",options:["repeat","mipmap","lodTarget=512"]},battlearena_stadium_shadow:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Stadium_01_shadow.png",options:["repeat","lodTarget=256","compressed"]},battlearena_decorative_BaseColor:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Decorative_elements_BaseColor.png",options:["repeat","compressed","lodTarget=256"]},battlearena_decorative_alpha:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Decorative_elements_alpha.jpg",options:["repeat","compressed","lodTarget=256"]},battlearena_decorative_ORM:{url:"./glxp/textures/battlearena_island/Battle_Arena_01_Decorative_elements_ORM.png",options:["repeat","lodTarget=512","mipmap"]},battlearena_decorative_Normal:{url:"./glxp/textures/battlearena_island/256/Battle_Arena_01_Decorative_elements_Normal.png.webp",options:["repeat","mipmap"]},battlearena_decorative_shadow:{url:"./glxp/textures/battlearena_island/battlearena_decorative_elements_shadow.png",options:["repeat","lodTarget=256","compressed"]},battlearena_island_shadow:{url:"./glxp/textures/battlearena_island/battlearena_island_shadow.png",options:["repeat","lodTarget=256","compressed"]},battlearena_creature1_shadow:{url:"./glxp/textures/battlearena_island/battlearena_creature1_shadow.png",options:["repeat","lodTarget=256","compressed"]},battlearena_creature2_shadow:{url:"./glxp/textures/battlearena_island/battlearena_creature2_shadow.png",options:["repeat","lodTarget=256","compressed"]},Rock_COL:{url:"./glxp/textures/intro/Rock_COL_VAR1_HIRES.jpg",options:["repeat","compressed","lodTarget=2048"]},Rock_ORM:{url:"./glxp/textures/intro/Rock_ORM.png",options:["repeat","compressed","lodTarget=1024"]},Rock_NRM:{url:"./glxp/textures/intro/Rock_NRM_HIRES.jpg",options:["repeat","compressed","lodTarget=2048"]},title:{url:"./glxp/textures/intro/title.png",options:["transparent","lodTarget=512"]},title_glow:{url:"./glxp/textures/intro/title_glow.png",options:["flipY","transparent","lodTarget=256"]}},audio:{},mp3:{},materials:{Exemple:{albedoColor:"#ffffff",albedoMap:"foo",metallicRoughnessTexture:"foo",emissiveTexture:"foo",emissiveFactor:"#FFFFFF",emissiveColor:"#ff2613",emissivePower:2.5,occlusionTexture:"foo",normalTexture:"foo",IBL:1,NormalScale:1,MetalicFactor:1e-5,RoughnessFactor:1,OcclusionFactor:1,UvScale:1},asteroid:{albedoColor:"#ffffff",albedoMap:"asteroid_BaseColor",ORMTexture:"asteroid_ORM",normalTexture:"asteroid_Normal",IBL:2},cloud:{albedoColor:"#ffffff",albedoMap:"cloud1",fbmTexture:"fbm1",IBL:5},creatures_floating_island:{albedoColor:"#ffffff",albedoMap:"floating_island1_BaseColor",ORMTexture:"floating_island1_ORM",normalTexture:"floating_island1_Normal",emissiveTexture:"floating_island1_Emissive",shadowTexture:"creatures_island_shadow",emissiveColor:"#E54D40",emissivePower:2,IBL:2},gameplay_floating_island:{albedoColor:"#ffffff",albedoMap:"floating_island1_BaseColor",ORMTexture:"floating_island1_ORM",normalTexture:"floating_island1_Normal",emissiveTexture:"floating_island1_Emissive",shadowTexture:"gameplay_island_shadow",emissiveColor:"#EBFF7F",emissivePower:2,IBL:2},battlearena_floating_island:{albedoColor:"#ffffff",albedoMap:"floating_island1_BaseColor",ORMTexture:"floating_island1_ORM",normalTexture:"floating_island1_Normal",emissiveTexture:"floating_island1_Emissive",shadowTexture:"battlearena_island_shadow",emissiveColor:"#B5E1FF",emissivePower:2,IBL:2},team_floating_island:{albedoColor:"#ffffff",albedoMap:"floating_island1_BaseColor",ORMTexture:"floating_island1_ORM",normalTexture:"floating_island1_Normal",emissiveTexture:"floating_island1_Emissive",shadowTexture:"team_island_shadow",emissiveColor:"#E8B361",emissivePower:2,IBL:2},lore_floating_island:{albedoColor:"#ffffff",albedoMap:"floating_island1_BaseColor",ORMTexture:"floating_island1_ORM",normalTexture:"floating_island1_Normal",emissiveTexture:"floating_island1_Emissive",shadowTexture:"lore_island_shadow",emissiveColor:"#FF6D34",emissivePower:1,IBL:2},cave_and_ground1:{albedoColor:"#ffffff",albedoMap:"Cave_and_ground1_BaseColor",ORMTexture:"Cave_and_ground1_ORM",normalTexture:"Cave_and_ground1_Normal",shadowTexture:"Cave_and_ground1_Shadow",IBL:3.4,RoughnessFactor:1.25,MetalicFactor:.3},creatures_decorative_elements:{albedoColor:"#ffffff",albedoMap:"Decorative_elements_BaseColor",metallicRoughnessTexture:"Decorative_elements_MetallicRoughness",normalTexture:"Decorative_elements_Normal",shadowTexture:"Decorative_elements_shadow"},creatures_decorative_elements_tapestry_center:{albedoColor:"#ffffff",albedoMap:"Decorative_elements_BaseColor",metallicRoughnessTexture:"Decorative_elements_MetallicRoughness",normalTexture:"Decorative_elements_Normal",weightsTexture:"Decorative_elements_Weights_Center",shadowTexture:"Decorative_elements_shadow",alphaTexture:"Decorative_elements_alpha"},creatures_decorative_elements_tapestry_left:{albedoColor:"#ffffff",albedoMap:"Decorative_elements_BaseColor",metallicRoughnessTexture:"Decorative_elements_MetallicRoughness",normalTexture:"Decorative_elements_Normal",weightsTexture:"Decorative_elements_Weights_Left",shadowTexture:"Decorative_elements_shadow",alphaTexture:"Decorative_elements_alpha"},creatures_decorative_elements_tapestry_right:{albedoColor:"#ffffff",albedoMap:"Decorative_elements_BaseColor",metallicRoughnessTexture:"Decorative_elements_MetallicRoughness",normalTexture:"Decorative_elements_Normal",weightsTexture:"Decorative_elements_Weights_Right",shadowTexture:"Decorative_elements_shadow",alphaTexture:"Decorative_elements_alpha"},creatures_dragon:{albedoColor:"#ffffff",albedoMap:"Dragon1_BaseColor",ORMTexture:"Dragon1_ORM",normalTexture:"Dragon1_Normal",shadowTexture:"Dragon1_shadow"},lore_Island_01:{albedoColor:"#ffffff",albedoMap:"lore_BaseColor",ORMTexture:"lore_ORM",normalTexture:"lore_Normal",shadowTexture:"lore_Shadow",emissivePower:2,IBL:2},lore_flag1:{albedoColor:"#ffffff",albedoMap:"lore_BaseColor",ORMTexture:"lore_ORM",normalTexture:"lore_Normal",shadowTexture:"lore_Shadow",IBL:2},lore_flag2:{albedoColor:"#ffffff",albedoMap:"lore_BaseColor",ORMTexture:"lore_ORM",normalTexture:"lore_Normal",shadowTexture:"lore_Shadow",IBL:2},team_Island_01:{albedoColor:"#ffffff",albedoMap:"team_01_BaseColor",ORMTexture:"team_01_ORM",normalTexture:"team_01_Normal",shadowTexture:"team_01_shadow"},team_Island_02:{albedoColor:"#ffffff",albedoMap:"team_02_BaseColor",ORMTexture:"team_02_ORM",normalTexture:"team_02_Normal",shadowTexture:"team_02_shadow"},gameplay_table_pieces:{albedoColor:"#ffffff",albedoMap:"gameplay_table_BaseColor",ORMTexture:"gameplay_table_ORM",normalTexture:"gameplay_table_Normal",shadowTexture:"gameplay_table_shadow",alphaTexture:"gameplay_table_alpha"},gameplay_dragon:{albedoColor:"#ffffff",albedoMap:"gameplay_dragon_BaseColor",ORMTexture:"gameplay_dragon_ORM",normalTexture:"gameplay_dragon_Normal",shadowTexture:"gameplay_dragon_shadow"},gameplay_torch:{albedoColor:"#ffffff",albedoMap:"gameplay_torch_BaseColor",ORMTexture:"gameplay_torch_ORM",normalTexture:"gameplay_torch_Normal",emissiveTexture:"gameplay_torch_Emissive",shadowTexture:"gameplay_torch_shadow",emissivePower:1.5,emissiveColor:"#FF8400"},gameplay_wizard:{albedoColor:"#ffffff",albedoMap:"gameplay_wizard_BaseColor",ORMTexture:"gameplay_wizard_ORM",normalTexture:"gameplay_wizard_Normal",shadowTexture:"gameplay_wizard_shadow"},gameplay_creature_01:{albedoColor:"#ffffff",albedoMap:"gameplay_creature1_BaseColor",ORMTexture:"gameplay_creature1_ORM",normalTexture:"gameplay_creature1_Normal",shadowTexture:"gameplay_creature1_shadow"},gameplay_creature_02:{albedoColor:"#ffffff",albedoMap:"gameplay_creature2_BaseColor",ORMTexture:"gameplay_creature2_ORM",normalTexture:"gameplay_creature2_Normal",shadowTexture:"gameplay_creature2_shadow"},battlearena_stadium:{albedoColor:"#ffffff",albedoMap:"battlearena_stadium_BaseColor",ORMTexture:"battlearena_stadium_ORM",normalTexture:"battlearena_stadium_Normal",shadowTexture:"battlearena_stadium_shadow"},battlearena_decorative_elements:{albedoColor:"#ffffff",albedoMap:"battlearena_decorative_BaseColor",ORMTexture:"battlearena_decorative_ORM",normalTexture:"battlearena_decorative_Normal",shadowTexture:"battlearena_island_shadow"},battlearena_tapestry_center:{albedoColor:"#ffffff",albedoMap:"battlearena_decorative_BaseColor",ORMTexture:"battlearena_decorative_ORM",normalTexture:"battlearena_decorative_Normal",shadowTexture:"battlearena_island_shadow",alphaTexture:"battlearena_decorative_alpha"},battlearena_tapestry_left:{albedoColor:"#ffffff",albedoMap:"battlearena_decorative_BaseColor",ORMTexture:"battlearena_decorative_ORM",normalTexture:"battlearena_decorative_Normal",shadowTexture:"battlearena_island_shadow",alphaTexture:"battlearena_decorative_alpha"},battlearena_tapestry_right:{albedoColor:"#ffffff",albedoMap:"battlearena_decorative_BaseColor",ORMTexture:"battlearena_decorative_ORM",normalTexture:"battlearena_decorative_Normal",weightsTexture:"battlearena_decorative_Weights",shadowTexture:"battlearena_island_shadow",alphaTexture:"battlearena_decorative_alpha"},battlearena_creature_01:{albedoColor:"#ffffff",albedoMap:"gameplay_creature1_BaseColor",ORMTexture:"gameplay_creature1_ORM",normalTexture:"gameplay_creature1_Normal",shadowTexture:"battlearena_creature1_shadow",OcclusionFactor:0},battlearena_creature_02:{albedoColor:"#ffffff",albedoMap:"gameplay_creature2_BaseColor",ORMTexture:"gameplay_creature2_ORM",normalTexture:"gameplay_creature2_Normal",shadowTexture:"battlearena_creature2_shadow",OcclusionFactor:0},Rock:{albedoColor:"#ffffff",albedoMap:"Rock_COL",normalTexture:"Rock_NRM",ORMTexture:"Rock_ORM"},Title:{albedoColor:"#ffffff",albedoMap:"title"}}};function hr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qd={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function(){function t(i,s,r){function o(m,_){if(!s[m]){if(!i[m]){var v=typeof hr=="function"&&hr;if(!_&&v)return v(m,!0);if(c)return c(m,!0);var g=new Error("Cannot find module '"+m+"'");throw g.code="MODULE_NOT_FOUND",g}var C=s[m]={exports:{}};i[m][0].call(C.exports,function(S){var E=i[m][1][S];return o(E||S)},C,C.exports,t,i,s,r)}return s[m].exports}for(var c=typeof hr=="function"&&hr,p=0;p<r.length;p++)o(r[p]);return o}return t}()({1:[function(t,i,s){/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var r=t("fs"),o=t("path"),c=t("./utils"),p=!1,m=t("../package.json").version,_="<",v=">",g="%",C="locals",S="ejs",E="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",T=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],M=T.concat("cache"),W=/^\uFEFF/,B=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;s.cache=c.cache,s.fileLoader=r.readFileSync,s.localsName=C,s.promiseImpl=new Function("return this;")().Promise,s.resolveInclude=function(D,z,F){var V=o.dirname,j=o.extname,ue=o.resolve,Ie=ue(F?z:V(z),D),ke=j(D);return ke||(Ie+=".ejs"),Ie};function O(D,z){var F;if(z.some(function(V){return F=s.resolveInclude(D,V,!0),r.existsSync(F)}))return F}function L(D,z){var F,V,j=z.views,ue=/^[A-Za-z]+:\\|^\//.exec(D);if(ue&&ue.length)D=D.replace(/^\/*/,""),Array.isArray(z.root)?F=O(D,z.root):F=s.resolveInclude(D,z.root||"/",!0);else if(z.filename&&(V=s.resolveInclude(D,z.filename),r.existsSync(V)&&(F=V)),!F&&Array.isArray(j)&&(F=O(D,j)),!F&&typeof z.includer!="function")throw new Error('Could not find the include file "'+z.escapeFunction(D)+'"');return F}function H(D,z){var F,V=D.filename,j=arguments.length>1;if(D.cache){if(!V)throw new Error("cache option requires a filename");if(F=s.cache.get(V),F)return F;j||(z=N(V).toString().replace(W,""))}else if(!j){if(!V)throw new Error("Internal EJS error: no file name or template provided");z=N(V).toString().replace(W,"")}return F=s.compile(z,D),D.cache&&s.cache.set(V,F),F}function G(D,z,F){var V;if(F){try{V=H(D)(z)}catch(j){return F(j)}F(null,V)}else{if(typeof s.promiseImpl=="function")return new s.promiseImpl(function(j,ue){try{V=H(D)(z),j(V)}catch(Ie){ue(Ie)}});throw new Error("Please provide a callback function")}}function N(D){return s.fileLoader(D)}function U(D,z){var F=c.shallowCopy(c.createNullProtoObjWherePossible(),z);if(F.filename=L(D,F),typeof z.includer=="function"){var V=z.includer(D,F.filename);if(V&&(V.filename&&(F.filename=V.filename),V.template))return H(F,V.template)}return H(F)}function J(D,z,F,V,j){var ue=z.split(`
`),Ie=Math.max(V-3,0),ke=Math.min(ue.length,V+3),Be=j(F),pt=ue.slice(Ie,ke).map(function(ae,xe){var Jt=xe+Ie+1;return(Jt==V?" >> ":"    ")+Jt+"| "+ae}).join(`
`);throw D.path=Be,D.message=(Be||"ejs")+":"+V+`
`+pt+`

`+D.message,D}function Q(D){return D.replace(/;(\s*$)/,"$1")}s.compile=function(z,F){var V;return F&&F.scope&&(p||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),p=!0),F.context||(F.context=F.scope),delete F.scope),V=new Y(z,F),V.compile()},s.render=function(D,z,F){var V=z||c.createNullProtoObjWherePossible(),j=F||c.createNullProtoObjWherePossible();return arguments.length==2&&c.shallowCopyFromList(j,V,T),H(j,D)(V)},s.renderFile=function(){var D=Array.prototype.slice.call(arguments),z=D.shift(),F,V={filename:z},j,ue;return typeof arguments[arguments.length-1]=="function"&&(F=D.pop()),D.length?(j=D.shift(),D.length?c.shallowCopy(V,D.pop()):(j.settings&&(j.settings.views&&(V.views=j.settings.views),j.settings["view cache"]&&(V.cache=!0),ue=j.settings["view options"],ue&&c.shallowCopy(V,ue)),c.shallowCopyFromList(V,j,M)),V.filename=z):j=c.createNullProtoObjWherePossible(),G(V,j,F)},s.Template=Y,s.clearCache=function(){s.cache.reset()};function Y(D,z){z=z||c.createNullProtoObjWherePossible();var F=c.createNullProtoObjWherePossible();this.templateText=D,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",F.client=z.client||!1,F.escapeFunction=z.escape||z.escapeFunction||c.escapeXML,F.compileDebug=z.compileDebug!==!1,F.debug=!!z.debug,F.filename=z.filename,F.openDelimiter=z.openDelimiter||s.openDelimiter||_,F.closeDelimiter=z.closeDelimiter||s.closeDelimiter||v,F.delimiter=z.delimiter||s.delimiter||g,F.strict=z.strict||!1,F.context=z.context,F.cache=z.cache||!1,F.rmWhitespace=z.rmWhitespace,F.root=z.root,F.includer=z.includer,F.outputFunctionName=z.outputFunctionName,F.localsName=z.localsName||s.localsName||C,F.views=z.views,F.async=z.async,F.destructuredLocals=z.destructuredLocals,F.legacyInclude=typeof z.legacyInclude<"u"?!!z.legacyInclude:!0,F.strict?F._with=!1:F._with=typeof z._with<"u"?z._with:!0,this.opts=F,this.regex=this.createRegex()}Y.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},Y.prototype={createRegex:function(){var D=E,z=c.escapeRegExpChars(this.opts.delimiter),F=c.escapeRegExpChars(this.opts.openDelimiter),V=c.escapeRegExpChars(this.opts.closeDelimiter);return D=D.replace(/%/g,z).replace(/</g,F).replace(/>/g,V),new RegExp(D)},compile:function(){var D,z,F=this.opts,V="",j="",ue=F.escapeFunction,Ie,ke=F.filename?JSON.stringify(F.filename):"undefined";if(!this.source){if(this.generateSource(),V+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,F.outputFunctionName){if(!B.test(F.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");V+="  var "+F.outputFunctionName+` = __append;
`}if(F.localsName&&!B.test(F.localsName))throw new Error("localsName is not a valid JS identifier.");if(F.destructuredLocals&&F.destructuredLocals.length){for(var Be="  var __locals = ("+F.localsName+` || {}),
`,pt=0;pt<F.destructuredLocals.length;pt++){var ae=F.destructuredLocals[pt];if(!B.test(ae))throw new Error("destructuredLocals["+pt+"] is not a valid JS identifier.");pt>0&&(Be+=`,
  `),Be+=ae+" = __locals."+ae}V+=Be+`;
`}F._with!==!1&&(V+="  with ("+F.localsName+` || {}) {
`,j+=`  }
`),j+=`  return __output;
`,this.source=V+this.source+j}F.compileDebug?D=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+ke+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`:D=this.source,F.client&&(D="escapeFn = escapeFn || "+ue.toString()+`;
`+D,F.compileDebug&&(D="rethrow = rethrow || "+J.toString()+`;
`+D)),F.strict&&(D=`"use strict";
`+D),F.debug&&console.log(D),F.compileDebug&&F.filename&&(D=D+`
//# sourceURL=`+ke+`
`);try{if(F.async)try{Ie=new Function("return (async function(){}).constructor;")()}catch(ze){throw ze instanceof SyntaxError?new Error("This environment does not support async/await"):ze}else Ie=Function;z=new Ie(F.localsName+", escapeFn, include, rethrow",D)}catch(ze){throw ze instanceof SyntaxError&&(F.filename&&(ze.message+=" in "+F.filename),ze.message+=` while compiling ejs

`,ze.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,ze.message+="https://github.com/RyanZim/EJS-Lint",F.async||(ze.message+=`
`,ze.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),ze}var xe=F.client?z:function(Nn){var dt=function(tt,kt){var zt=c.shallowCopy(c.createNullProtoObjWherePossible(),Nn);return kt&&(zt=c.shallowCopy(zt,kt)),U(tt,F)(zt)};return z.apply(F.context,[Nn||c.createNullProtoObjWherePossible(),ue,dt,J])};if(F.filename&&typeof Object.defineProperty=="function"){var Jt=F.filename,bi=o.basename(Jt,o.extname(Jt));try{Object.defineProperty(xe,"name",{value:bi,writable:!1,enumerable:!1,configurable:!0})}catch{}}return xe},generateSource:function(){var D=this.opts;D.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var z=this,F=this.parseTemplateText(),V=this.opts.delimiter,j=this.opts.openDelimiter,ue=this.opts.closeDelimiter;F&&F.length&&F.forEach(function(Ie,ke){var Be;if(Ie.indexOf(j+V)===0&&Ie.indexOf(j+V+V)!==0&&(Be=F[ke+2],!(Be==V+ue||Be=="-"+V+ue||Be=="_"+V+ue)))throw new Error('Could not find matching close tag for "'+Ie+'".');z.scanLine(Ie)})},parseTemplateText:function(){for(var D=this.templateText,z=this.regex,F=z.exec(D),V=[],j;F;)j=F.index,j!==0&&(V.push(D.substring(0,j)),D=D.slice(j)),V.push(F[0]),D=D.slice(F[0].length),F=z.exec(D);return D&&V.push(D),V},_addOutput:function(D){if(this.truncate&&(D=D.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!D)return D;D=D.replace(/\\/g,"\\\\"),D=D.replace(/\n/g,"\\n"),D=D.replace(/\r/g,"\\r"),D=D.replace(/"/g,'\\"'),this.source+='    ; __append("'+D+`")
`},scanLine:function(D){var z=this,F=this.opts.delimiter,V=this.opts.openDelimiter,j=this.opts.closeDelimiter,ue=0;switch(ue=D.split(`
`).length-1,D){case V+F:case V+F+"_":this.mode=Y.modes.EVAL;break;case V+F+"=":this.mode=Y.modes.ESCAPED;break;case V+F+"-":this.mode=Y.modes.RAW;break;case V+F+"#":this.mode=Y.modes.COMMENT;break;case V+F+F:this.mode=Y.modes.LITERAL,this.source+='    ; __append("'+D.replace(V+F+F,V+F)+`")
`;break;case F+F+j:this.mode=Y.modes.LITERAL,this.source+='    ; __append("'+D.replace(F+F+j,F+j)+`")
`;break;case F+j:case"-"+F+j:case"_"+F+j:this.mode==Y.modes.LITERAL&&this._addOutput(D),this.mode=null,this.truncate=D.indexOf("-")===0||D.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case Y.modes.EVAL:case Y.modes.ESCAPED:case Y.modes.RAW:D.lastIndexOf("//")>D.lastIndexOf(`
`)&&(D+=`
`)}switch(this.mode){case Y.modes.EVAL:this.source+="    ; "+D+`
`;break;case Y.modes.ESCAPED:this.source+="    ; __append(escapeFn("+Q(D)+`))
`;break;case Y.modes.RAW:this.source+="    ; __append("+Q(D)+`)
`;break;case Y.modes.COMMENT:break;case Y.modes.LITERAL:this._addOutput(D);break}}else this._addOutput(D)}z.opts.compileDebug&&ue&&(this.currentLine+=ue,this.source+="    ; __line = "+this.currentLine+`
`)}},s.escapeXML=c.escapeXML,s.__express=s.renderFile,s.VERSION=m,s.name=S,typeof window<"u"&&(window.ejs=s)},{"../package.json":6,"./utils":2,fs:3,path:4}],2:[function(t,i,s){var r=/[|\\{}()[\]^$+*?.]/g,o=Object.prototype.hasOwnProperty,c=function(g,C){return o.apply(g,[C])};s.escapeRegExpChars=function(g){return g?String(g).replace(r,"\\$&"):""};var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},m=/[&<>'"]/g;function _(g){return p[g]||g}var v=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;s.escapeXML=function(g){return g==null?"":String(g).replace(m,_)},s.escapeXML.toString=function(){return Function.prototype.toString.call(this)+`;
`+v},s.shallowCopy=function(g,C){if(C=C||{},g!=null)for(var S in C)!c(C,S)||S==="__proto__"||S==="constructor"||(g[S]=C[S]);return g},s.shallowCopyFromList=function(g,C,S){if(S=S||[],C=C||{},g!=null)for(var E=0;E<S.length;E++){var T=S[E];if(typeof C[T]<"u"){if(!c(C,T)||T==="__proto__"||T==="constructor")continue;g[T]=C[T]}}return g},s.cache={_data:{},set:function(g,C){this._data[g]=C},get:function(g){return this._data[g]},remove:function(g){delete this._data[g]},reset:function(){this._data={}}},s.hyphenToCamel=function(g){return g.replace(/-[a-z]/g,function(C){return C[1].toUpperCase()})},s.createNullProtoObjWherePossible=function(){return typeof Object.create=="function"?function(){return Object.create(null)}:{__proto__:null}instanceof Object?function(){return{}}:function(){return{__proto__:null}}}()},{}],3:[function(t,i,s){},{}],4:[function(t,i,s){(function(r){function o(_,v){for(var g=0,C=_.length-1;C>=0;C--){var S=_[C];S==="."?_.splice(C,1):S===".."?(_.splice(C,1),g++):g&&(_.splice(C,1),g--)}if(v)for(;g--;g)_.unshift("..");return _}s.resolve=function(){for(var _="",v=!1,g=arguments.length-1;g>=-1&&!v;g--){var C=g>=0?arguments[g]:r.cwd();if(typeof C!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!C)continue;_=C+"/"+_,v=C.charAt(0)==="/"}return _=o(p(_.split("/"),function(S){return!!S}),!v).join("/"),(v?"/":"")+_||"."},s.normalize=function(_){var v=s.isAbsolute(_),g=m(_,-1)==="/";return _=o(p(_.split("/"),function(C){return!!C}),!v).join("/"),!_&&!v&&(_="."),_&&g&&(_+="/"),(v?"/":"")+_},s.isAbsolute=function(_){return _.charAt(0)==="/"},s.join=function(){var _=Array.prototype.slice.call(arguments,0);return s.normalize(p(_,function(v,g){if(typeof v!="string")throw new TypeError("Arguments to path.join must be strings");return v}).join("/"))},s.relative=function(_,v){_=s.resolve(_).substr(1),v=s.resolve(v).substr(1);function g(B){for(var O=0;O<B.length&&B[O]==="";O++);for(var L=B.length-1;L>=0&&B[L]==="";L--);return O>L?[]:B.slice(O,L-O+1)}for(var C=g(_.split("/")),S=g(v.split("/")),E=Math.min(C.length,S.length),T=E,M=0;M<E;M++)if(C[M]!==S[M]){T=M;break}for(var W=[],M=T;M<C.length;M++)W.push("..");return W=W.concat(S.slice(T)),W.join("/")},s.sep="/",s.delimiter=":",s.dirname=function(_){if(typeof _!="string"&&(_=_+""),_.length===0)return".";for(var v=_.charCodeAt(0),g=v===47,C=-1,S=!0,E=_.length-1;E>=1;--E)if(v=_.charCodeAt(E),v===47){if(!S){C=E;break}}else S=!1;return C===-1?g?"/":".":g&&C===1?"/":_.slice(0,C)};function c(_){typeof _!="string"&&(_=_+"");var v=0,g=-1,C=!0,S;for(S=_.length-1;S>=0;--S)if(_.charCodeAt(S)===47){if(!C){v=S+1;break}}else g===-1&&(C=!1,g=S+1);return g===-1?"":_.slice(v,g)}s.basename=function(_,v){var g=c(_);return v&&g.substr(-1*v.length)===v&&(g=g.substr(0,g.length-v.length)),g},s.extname=function(_){typeof _!="string"&&(_=_+"");for(var v=-1,g=0,C=-1,S=!0,E=0,T=_.length-1;T>=0;--T){var M=_.charCodeAt(T);if(M===47){if(!S){g=T+1;break}continue}C===-1&&(S=!1,C=T+1),M===46?v===-1?v=T:E!==1&&(E=1):v!==-1&&(E=-1)}return v===-1||C===-1||E===0||E===1&&v===C-1&&v===g+1?"":_.slice(v,C)};function p(_,v){if(_.filter)return _.filter(v);for(var g=[],C=0;C<_.length;C++)v(_[C],C,_)&&g.push(_[C]);return g}var m="ab".substr(-1)==="b"?function(_,v,g){return _.substr(v,g)}:function(_,v,g){return v<0&&(v=_.length+v),_.substr(v,g)}}).call(this,t("_process"))},{_process:5}],5:[function(t,i,s){var r=i.exports={},o,c;function p(){throw new Error("setTimeout has not been defined")}function m(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?o=setTimeout:o=p}catch{o=p}try{typeof clearTimeout=="function"?c=clearTimeout:c=m}catch{c=m}})();function _(O){if(o===setTimeout)return setTimeout(O,0);if((o===p||!o)&&setTimeout)return o=setTimeout,setTimeout(O,0);try{return o(O,0)}catch{try{return o.call(null,O,0)}catch{return o.call(this,O,0)}}}function v(O){if(c===clearTimeout)return clearTimeout(O);if((c===m||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(O);try{return c(O)}catch{try{return c.call(null,O)}catch{return c.call(this,O)}}}var g=[],C=!1,S,E=-1;function T(){!C||!S||(C=!1,S.length?g=S.concat(g):E=-1,g.length&&M())}function M(){if(!C){var O=_(T);C=!0;for(var L=g.length;L;){for(S=g,g=[];++E<L;)S&&S[E].run();E=-1,L=g.length}S=null,C=!1,v(O)}}r.nextTick=function(O){var L=new Array(arguments.length-1);if(arguments.length>1)for(var H=1;H<arguments.length;H++)L[H-1]=arguments[H];g.push(new W(O,L)),g.length===1&&!C&&_(M)};function W(O,L){this.fun=O,this.array=L}W.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={};function B(){}r.on=B,r.addListener=B,r.once=B,r.off=B,r.removeListener=B,r.removeAllListeners=B,r.emit=B,r.prependListener=B,r.prependOnceListener=B,r.listeners=function(O){return[]},r.binding=function(O){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(O){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],6:[function(t,i,s){i.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"3.1.7",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",license:"Apache-2.0",bin:{ejs:"./bin/cli.js"},main:"./lib/ejs.js",jsdelivr:"ejs.min.js",unpkg:"ejs.min.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{jake:"^10.8.5"},devDependencies:{browserify:"^16.5.1",eslint:"^6.8.0","git-directory-deploy":"^1.5.1",jsdoc:"^3.6.7","lru-cache":"^4.0.1",mocha:"^7.1.1","uglify-js":"^3.3.16"},engines:{node:">=0.10.0"},scripts:{test:"mocha"}}},{}]},{},[1])(1)})})(Qd);const Pl=Qd.exports;var i_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    attribute vec3 normal;
    attribute vec2 uv;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
    uniform float uTime;

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;

    #ifdef HAS_SHEEN
        varying vec3 vNormal;
    #endif

    void main(){
        vUv = uv;
        vPos = modelMatrix * vec4(position, 1.0);
        vWorldPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;

        #ifdef HAS_SHEEN
            vec3 n = normal;
            vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
        #endif

        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;
    #ifdef HAS_SHEEN
        varying vec3 vNormal;
    #endif

    uniform float uTime;
    uniform float uAlpha;

    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;
    #endif

    uniform bool isCameraFliped;

    #ifdef HAS_COLORMAP
        uniform sampler2D uTexture;
    #else 
        uniform vec3 uColor;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaTexture;
    #endif
    #ifdef HAS_FOG
        const float LOG2 = 1.442695;
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif
    #ifdef HAS_SHEEN
        uniform float uSheenDepth;
        uniform float uSheenOpacity;
        uniform vec3 uSheenColor;
        uniform vec3 uCamera;
    #endif

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment)
    {
        const vec3 W = vec3(0.2125, 0.7154, 0.0721);
        vec3 intensity = vec3(dot(rgb, W));
        return mix(intensity, rgb, adjustment);
    }

    #ifdef HAS_SHEEN
        vec3 getNormal()
        {
            return normalize(vNormal);
        }
    #endif

    void main() { 
        if(isCameraFliped && vPos.y < 0.01){ discard; }
        vec4 t;
        #ifdef HAS_COLORMAP
            t = texture2D( uTexture, vUv );
        #else 
            t = vec4(uColor, 1.);
        #endif
        #ifdef HAS_ALPHAMAP
            t.a *= texture2D( uAlphaTexture, vUv ).r * max(uExposure, 1.);
        #endif
        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            t.rgb = mix(t.rgb, uFogColor, fogAmount);
        #endif

        #ifdef HAS_SHEEN
            vec3 n = getNormal();
            vec3 v = normalize(uCamera - vPos.xyz); 
            float fresnelFactor = abs(dot(v, n));
            float sheen = pow(1.0 - fresnelFactor, uSheenDepth);
            t.rgb = mix(t.rgb, uSheenColor, sheen * uSheenOpacity);
        #endif
        
        
        #ifdef HAS_COLOR_CORRECTION
            t.rgb = czm_saturation(t.rgb, uSaturation);
            t.rgb = contrast(t.rgb, uContrast);
            t.rgb = exposure(t.rgb, uExposure);
            t.rgb = mix(t.rgb, uTint, uTintOpacity);
        #endif

        

        t.a *= uAlpha;
        gl_FragColor = vec4(t);
    } 
        
<% } %>`,s_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    
    attribute vec2 uv;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
    

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;

    void main(){
        vUv = uv;
        vPos = modelMatrix * vec4(position, 1.0);
        vWorldPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;

    uniform float uTime;
    uniform float uAlpha;

    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;
    #endif

    #ifdef HAS_FBMMAP
      uniform sampler2D uFBMSampler;
    #endif

    
    
    

    uniform bool isCameraFliped;

    #ifdef HAS_COLORMAP
        uniform sampler2D uTexture;
    #else 
        uniform vec3 uColor;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaTexture;
    #endif
    #ifdef HAS_FOG
        const float LOG2 = 1.442695;
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif

    uniform float uSpeed;
    uniform vec2 uDirection;
    uniform float uSeed;

    uniform float uFBMScale;
    uniform float uFBMMixFactor;
    uniform float uFBMAddFactor;

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment)
    {
        const vec3 W = vec3(0.2125, 0.7154, 0.0721);
        vec3 intensity = vec3(dot(rgb, W));
        return mix(intensity, rgb, adjustment);
    }

    void main() { 
        if(isCameraFliped && vPos.y < 0.01){ discard; }
        vec4 t;
        #ifdef HAS_COLORMAP
            t = texture2D( uTexture, vUv );
        #else 
            t = vec4(uColor, 1.);
        #endif
        #ifdef HAS_ALPHAMAP
            t.a *= texture2D( uAlphaTexture, vUv ).r * max(uExposure, 1.);
        #endif
        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            t.rgb = mix(t.rgb, uFogColor, fogAmount);
        #endif
        
        
        #ifdef HAS_COLOR_CORRECTION
            t.rgb = czm_saturation(t.rgb, uSaturation);
            t.rgb = contrast(t.rgb, uContrast);
            t.rgb = exposure(t.rgb, uExposure);
            t.rgb = mix(t.rgb, uTint, uTintOpacity);
        #endif

        
        #ifdef HAS_FBMMAP
            vec2 scrollingUv = vUv * uFBMScale + vec2(uDirection.x * uTime * uSpeed, uDirection.y * uTime * uSpeed) * .02;
            vec4 fbmTexel = texture2D(uFBMSampler, scrollingUv);

            
            

            
            
            

            

            
            
                
                
            

            t.rgb = clamp(t.rgb + vec3(fbmTexel.r) * uFBMAddFactor, vec3(0., 0., 0.), vec3(1., 1., 1.));
            t.a = clamp(t.a * fbmTexel.r * uFBMMixFactor, 0., 1.);
        #endif

        
        t.a *= smoothstep(1., .97, fogAmount);

        t.a *= uAlpha;
        gl_FragColor = t;

        
        
        
        
    } 
        
<% } %>`,a_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    attribute vec3 normal;
    attribute vec2 uv;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
    uniform float uTime;

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;

    
    
    

    void main(){
        vUv = uv;
        vPos = modelMatrix * vec4(position, 1.0);
        vWorldPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;

        
        
        
        

        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;
    
    
    

    uniform float uTime;
    uniform float uAlpha;

    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;
    #endif

    uniform bool isCameraFliped;

    #ifdef HAS_COLORMAP
        uniform sampler2D uTexture;
    #else 
        uniform vec3 uColorTop;
        uniform vec3 uColorBottom;
        uniform float uGradientRatio;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaTexture;
    #endif
    #ifdef HAS_FOG
        const float LOG2 = 1.442695;
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif
    
    
    
    
    
    

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment)
    {
        const vec3 W = vec3(0.2125, 0.7154, 0.0721);
        vec3 intensity = vec3(dot(rgb, W));
        return mix(intensity, rgb, adjustment);
    }

    
    
    
    
    
    

    void main() { 
        if(isCameraFliped && vPos.y < 0.01){ discard; }

        vec4 t = vec4(1.);
        #ifdef HAS_COLORMAP
            t = texture2D( uTexture, vUv );
        #else 
            t.rgb = mix(uColorBottom, uColorTop, vUv.y * uGradientRatio);
        #endif
        #ifdef HAS_ALPHAMAP
            t.a *= texture2D( uAlphaTexture, vUv ).r * max(uExposure, 1.);
        #endif
        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            t.rgb = mix(t.rgb, uFogColor, fogAmount);
        #endif

        
        
        
        
        
        
        
        
        
        #ifdef HAS_COLOR_CORRECTION
            t.rgb = czm_saturation(t.rgb, uSaturation);
            t.rgb = contrast(t.rgb, uContrast);
            t.rgb = exposure(t.rgb, uExposure);
            t.rgb = mix(t.rgb, uTint, uTintOpacity);
        #endif

        

        t.a *= uAlpha;
        gl_FragColor = vec4(t);
    } 
        
<% } %>`,r_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    
    attribute vec2 uv;

    varying vec2 vUv;

    void main(){
        vUv = uv;
        gl_Position = vec4(position, 0.5);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;

    uniform float uAlpha;
    uniform vec2 uRez;
    uniform float uAspectRatio;
    uniform float uTextureAspectRatio;
    uniform float uZoom;
    uniform vec3 uCameraPosition;
    uniform vec2 uCameraAmplitude;

    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;
    #endif

    #ifdef HAS_COLORMAP
        uniform sampler2D uTextureDesktop;
        uniform sampler2D uTextureMobile;
        uniform float uDeviceTexturesMix;
    #else 
        uniform vec3 uColor;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaTexture;
    #endif

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment) {
        const vec3 W = vec3(0.2125, 0.7154, 0.0721);
        vec3 intensity = vec3(dot(rgb, W));
        return mix(intensity, rgb, adjustment);
    }

    void main() {

        vec2 arUv = gl_FragCoord.xy / max(uRez.x, uRez.y*uTextureAspectRatio);
        arUv.y *= uTextureAspectRatio;
        arUv.x += max(0., (uTextureAspectRatio - uAspectRatio) * 0.5) * 1.;

        arUv *= uZoom;
        arUv += (1. - uZoom) / 2.;

        arUv.x += (-uCameraPosition.x) * uCameraAmplitude.x;
        arUv.y += uCameraPosition.y * uCameraAmplitude.y;

        vec4 t;
        #ifdef HAS_COLORMAP
            t = mix(texture2D( uTextureDesktop, arUv ), texture2D( uTextureMobile, arUv ), uDeviceTexturesMix);

        #else 
            t = vec4(uColor, 1.);
        #endif
        #ifdef HAS_ALPHAMAP
            t.a *= texture2D( uAlphaTexture, arUv ).r * max(uExposure, 1.);
        #endif

        
        #ifdef HAS_COLOR_CORRECTION
            t.rgb = czm_saturation(t.rgb, uSaturation);
            t.rgb = contrast(t.rgb, uContrast);
            t.rgb = exposure(t.rgb, uExposure);
            t.rgb = mix(t.rgb, uTint, uTintOpacity);
        #endif

        
        
        

        t.a *= uAlpha;
        gl_FragColor = vec4(t);
    } 
        
<% } %>`,o_=`<% if (vert) { %>

   precision highp float;

    attribute vec3 position;
    attribute vec2 uv;

    varying vec2 vUv;

    void main(void) {
        vUv = uv;
        gl_Position = vec4(position, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float;

    uniform sampler2D uTexture;
    uniform sampler2D uBloom;
    uniform sampler2D uNoise;
    varying vec2 vUv;

    uniform vec2 uRez;
    uniform vec2 uMouse;
    uniform float uTime;
    uniform float uHueShift;
    uniform float uVignette;
    uniform float uNoiseOpacity;
    uniform float uChromaticAberations;
    uniform float uGamma;
    uniform float uExposure;
    uniform float uBloomOpacity;
    uniform float uContrast;
    uniform float uKonami;
    uniform float uVignetteStrength;
    uniform float uTransitionToBlackFactor;

    
    uniform sampler2D uSpritesheetTexture;
    uniform sampler2D uTransitionTexture;
    uniform vec4 uSpritesheetOffset;
    uniform vec2 uTransitionTextureSize;

    
    uniform float uBlurStrength;
    uniform float uBlurRadius;

    
    uniform float uMoodVignetteRadialStrength;
    uniform float uMoodVignetteMiddleStrength;

    
    uniform vec3 uLayer4ColorTop;
    uniform vec3 uLayer4ColorBottom;
    uniform float uLayer4Opacity;

    
    uniform vec3 uLayer3ColorTop;
    uniform vec3 uLayer3ColorBottom;
    uniform float uLayer3Opacity;

    
    uniform vec3 uLayer2ColorTop;
    uniform vec3 uLayer2ColorBottom;
    uniform float uLayer2Opacity;

    
    uniform vec3 uLayer1Color;
    uniform float uLayer1Opacity;

    const int nsamples = 10;

    <%= commons.allBlendModes %>

    vec3 linearToneMapping(vec3 color)
    {
        float exposure = 1.;
        color = clamp(exposure * color, 0., 1.);
        color = pow(color, vec3(1. / uGamma));
        return color;
    }

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    float random (in vec2 st) {
        return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
    }

    vec3 hueShift(vec3 color, float hue)
    {
        const vec3 k = vec3(0.57735, 0.57735, 0.57735);
        float cosAngle = cos(hue);
        return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
    }

    void main() {

        vec2 uv = vUv;
        vec4 color;

        float maxDistort = uChromaticAberations * .1;
        float scalar = 1.0 * maxDistort;
        vec4 colourScalar = vec4(700.0, 560.0, 490.0, 1.0);	
        colourScalar /= max(max(colourScalar.x, colourScalar.y), colourScalar.z);
        colourScalar /= 100.;
        colourScalar *= scalar;

        color.r += texture2D(uTexture, uv + colourScalar.r).r;
        color.g += texture2D(uTexture, uv + -colourScalar.g).g;
        color.b += texture2D(uTexture, uv + colourScalar.b).b;

        vec4 bloom = texture2D(uBloom, uv);
        vec2 vgnUv = vUv;
        vgnUv *= (1.0 - vgnUv.yx);
        float vig = vgnUv.x*vgnUv.y * 15.0;
        vig = pow(vig, uVignette);

        vec2 gUv = vUv;
        

        
        vec2 center = vec2(0.5);
        float blurStart = 1.0;
        float blurWidth = uBlurStrength;

        vec2 uvBlur = gl_FragCoord.xy / uRez;
        uvBlur -= center;
        float blurRadius = smoothstep(1.-uBlurRadius, 1.0, distance(center, vUv));
        float precompute = blurRadius * blurWidth * (1.0 / float(nsamples - 1));
        
        vec4 colorBlur = color;
        for (int i = 0; i < nsamples; i++) {
            float scale = blurStart + (float(i)* precompute);
            colorBlur += texture2D(uTexture, uvBlur * scale + center);
        }
        colorBlur /= float(nsamples);
        color = colorBlur;

        
        vec2 nUv = vUv;
        nUv.x *= uRez.x/uRez.y;
        nUv.y += mod(uTime * 46.54687, 1.);
        nUv.x -= mod(uTime * 12.68655, 1.);
        color.rgb = blendScreen_21_19(color.rgb, bloom.rgb, uBloomOpacity);

        
        color.rgb = blendOverlay_9_12(color.rgb, vec3(random(vUv + mod(uTime, 1.))), uNoiseOpacity);
        color.rgb = linearToneMapping(color.rgb);
        color.rgb = contrast(color.rgb, uContrast);
        color.rgb = exposure(color.rgb, uExposure);
        color.rgb = mix(color.rgb, color.rgb * vig, uVignetteStrength);

        
        vec3 moodColor = color.rgb;

        vec3 layer4Gradient = mix(uLayer4ColorBottom, uLayer4ColorTop, vUv.y);
        moodColor = blendSoftLight_22_20(moodColor, layer4Gradient, uLayer4Opacity);

        vec3 layer3Gradient = mix(uLayer3ColorBottom, uLayer3ColorTop, vUv.y);
        moodColor = blendScreen_21_19(moodColor, layer3Gradient, uLayer3Opacity);

        vec3 layer2Gradient = mix(uLayer2ColorBottom, uLayer2ColorTop, vUv.y);
        moodColor = blendOverlay_9_12(moodColor, layer2Gradient, uLayer2Opacity);

        moodColor = blendLuminosity(moodColor, uLayer1Color, uLayer1Opacity);

        
        vec2 moodVgnUv = vUv;
        moodVgnUv *= (1.0 - moodVgnUv.yx);
        float moodVig = moodVgnUv.x * moodVgnUv.y * uMoodVignetteRadialStrength;
        moodVig += (1. - abs(vUv.x-0.5)) * uMoodVignetteMiddleStrength;
        color.rgb = mix(moodColor, color.rgb, clamp(moodVig, 0., 1.));

        
        
        float coordX = (vUv.x * (uSpritesheetOffset.y - uSpritesheetOffset.x) + uSpritesheetOffset.x);
        float coordY = (vUv.y * (uSpritesheetOffset.z - uSpritesheetOffset.w) + uSpritesheetOffset.w);
        vec2 spriteSheetUv = vec2(coordX, coordY);
        vec4 spritesheetTexel = texture2D(uSpritesheetTexture, spriteSheetUv);

        
        vec2 s = uRez; 
        vec2 i = uTransitionTextureSize; 
        float rs = s.x / s.y;
        float ri = i.x / i.y;
        vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
        vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
        vec2 backgroundUv = vUv * s / new + offset;
        vec4 transitionTexel = texture2D(uTransitionTexture, backgroundUv) * spritesheetTexel.r;
        transitionTexel.rgb *= vec3(1. - uTransitionToBlackFactor);

        
        vec3 renderedColor = color.rgb * (1.-spritesheetTexel.r);
        
        color.rgb = mix(renderedColor, transitionTexel.rgb, spritesheetTexel.r);

        color.a = 1.;

        gl_FragColor = color;
        

    }

<% } %>`,l_=`<% if (vert) { %>
    precision highp float;
    attribute vec3 aPos;
    attribute vec2 aUvs;
    varying vec2 vUv;
    void main(void) {
        vUv = aUvs;
        gl_Position = vec4(aPos, 1.0);
    }
<% } %>

<% if (passes.pass_1) { %>
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vUv;
    uniform vec2 uRez;
    uniform vec2 uDir;
    uniform vec3 uTint;
    uniform float uPower;
    uniform float uIsFirstPass;
    uniform float uThresold;
    uniform float uSimilarity;
    
    uniform float uOverdrive;

    <%= commons.blur %>

    vec2 rotate(vec2 v, float a) {
        float s = sin(a);
        float c = cos(a);
        mat2 m = mat2(c, -s, s, c);
        return m * v;
    }
    const float M_PI = 3.141592653589793;

    void main() {

        vec4 color = blur9(uTexture, vUv, uRez, uDir * uPower);
        color += blur5(uTexture, vUv, uRez, rotate(uDir, M_PI * .5) * uPower * 2.) * .05;
        color += blur5(uTexture, vUv, uRez, rotate(uDir, M_PI * 1.) * uPower * 2.) * .05;
        color += blur5(uTexture, vUv, uRez, rotate(uDir, M_PI * 1.5) * uPower * 2.) * .05;
        color += blur5(uTexture, vUv, uRez, rotate(uDir, M_PI * 2.) * uPower * 2.) * .05;

        gl_FragColor = vec4(color.rgb * color.a, color.a);
        if(uIsFirstPass > 0.5){
            float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));
            float highlights = smoothstep(uThresold, uThresold+uSimilarity, brightness);
            gl_FragColor = vec4((color.rgb * (1. + uOverdrive)) * vec3(highlights) * uTint, 1.);
        }
    }
<% } %>

<% if (frag) { %>
    precision highp float;
    uniform sampler2D uBlur;
    varying vec2 vUv;
    uniform vec2 uRez;

 <%if (defines["COLOR_CORRECTION"] >= 1) { %>
    uniform float uShift;
    uniform float uBrightness;
    uniform float uContrast;

    vec3 hueShift(vec3 color, float hue)
    {
        const vec3 k = vec3(0.57735, 0.57735, 0.57735);
        float cosAngle = cos(hue);
        return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
    }
<% } %>

    void main() {
        
        vec4 blur = texture2D( uBlur, vUv);
        gl_FragColor = blur;

        <%if (defines["TRANSPARENT"] >= 1) { %>
            
            float a = smoothstep(1., 0.2, blur.z);
            a = pow(a, 2.);
            blur.z = 0.;
            gl_FragColor = vec4(blur.rgb, a);
        <% } %>

        <%if (defines["COLOR_CORRECTION"] >= 1) { %>
            vec3 color = hueShift(gl_FragColor.rgb, uShift);
            vec3 colorContrasted = (color) * uContrast;
            vec3 bright = colorContrasted + vec3(uBrightness);
            gl_FragColor.rgb = bright;
        <% } %>

    }
<% } %>`,u_=`<% if (vert) { %>
    needES300
    precision highp float;

    in vec3 position;
    #ifdef HAS_NORMALS
        in vec3 normal;
    #endif
    
    
    
    
    
    #ifdef HAS_TANGENTS
        in vec3 tangents;
    #endif
    #ifdef HAS_UV
        in vec2 uv;
    #endif

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 normalMatrix;
    uniform mat4 projectionMatrix;

    

    out vec3 vPosition;
    out vec3 vWorldPosition;
    out vec2 vUv;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            out mat3 vTBN;
        #else
            out vec3 vNormal;
        #endif
    #endif

    void main(){

        vec3 p = position;
        vec3 n = normal;
        
        
        
        

        vec4 pos = modelMatrix * vec4(p, 1.0);
        vPosition = vec3(pos.xyz) / pos.w;
        vWorldPosition = (modelViewMatrix * vec4(p, 1.0)).xyz;

        #ifdef HAS_NORMALS
            #ifdef HAS_TANGENTS
                vec3 normalW = normalize(vec3(normalMatrix * vec4(n, 0.0)));
                vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangents.xyz, 0.0)));
                vec3 bitangentW = cross(normalW, tangentW) * tangents.w;
                vTBN = mat3(tangentW, bitangentW, normalW);
            #else 
                vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
            #endif
        #endif

        #ifdef HAS_UV
            vUv = uv;
        #else
            vUv = vec2(0.,0.);
        #endif

        gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);

    }

<% } %>

<% if (frag) { %>
    
    precision highp float; 

    uniform vec3 uLightDirection;
    uniform vec3 uLightColor;
    uniform float uUvScale;

    #ifdef USE_IBL
        uniform sampler2D uDiffuseEnvSampler;
        uniform sampler2D uSpecularEnvSampler;
        uniform sampler2D uBrdfLUT;
    #endif

    #ifdef HAS_BASECOLORMAP
        uniform sampler2D uBaseColorSampler;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaMapSampler;
    #endif
    
    
    
    
    

    #ifdef HAS_NORMALMAP
        uniform sampler2D uNormalSampler;
        uniform float uNormalScale;
    #endif

    #ifdef HAS_EMISSIVEMAP
        uniform sampler2D uEmissiveSampler;
    #endif
    #ifdef HAS_EMISSIVECOLOR
        uniform vec3 uEmissiveColor;
        uniform float uEmissivePower;
    #endif
    
    #ifdef HAS_METALROUGHNESSMAP
        uniform sampler2D uMetallicRoughnessSampler;
    #endif

    #ifdef HAS_ORM_MAP
        uniform sampler2D uOcclusionRoughnessMetallicSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_OCCLUSIONMAP
        uniform sampler2D uOcclusionSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_FOG
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif

    #ifdef HAS_SHADOW_MAP
        uniform sampler2D uShadowSampler;
        uniform float uShadowStrength;
    #endif

    
    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;

        vec3 contrast(vec3 color, float value) { return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.)); }
        vec3 exposure(vec3 color, float value) { return (1.0 + value) * color; }
        vec3 hueShift(vec3 color, float hue) {
            const vec3 k = vec3(0.57735, 0.57735, 0.57735);
            float cosAngle = cos(hue);
            return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
        }
        vec3 czm_saturation(vec3 rgb, float adjustment){
            const vec3 W = vec3(0.2125, 0.7154, 0.0721);
            vec3 intensity = vec3(dot(rgb, W));
            return mix(intensity, rgb, adjustment);
        }
    #endif

    uniform vec2 uMetallicRoughnessValues;
    uniform vec4 uBaseColorFactor;
    uniform vec3 uCamera;

    
    uniform vec4 uScaleDiffBaseMR;
    uniform vec4 uScaleFGDSpec;
    uniform vec4 uScaleIBLAmbient;

    in vec2 vUv;
    in vec3 vPosition;
    in vec3 vWorldPosition;

    out vec4 outColor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            in mat3 vTBN;
        #else
            in vec3 vNormal;
        #endif
    #endif

    struct PBRInfo
    {
        float NdotL;                  
        float NdotV;                  
        float NdotH;                  
        float LdotH;                  
        float VdotH;                  
        float perceptualRoughness;    
        float metalness;              
        vec3 reflectance0;            
        vec3 reflectance90;           
        float alphaRoughness;         
        vec3 diffuseColor;            
        vec3 specularColor;           
    };

    const float M_PI = 3.141592653589793;
    const float c_MinRoughness = 0.04;
    const vec2 invAtan = vec2(0.1591, 0.3183);
    const float LOG2 = 1.442695;

    vec4 SRGBtoLINEAR(vec4 srgbIn)
    {
        #ifdef MANUAL_SRGB
            #ifdef SRGB_FAST_APPROXIMATION
                vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
            #else 
                vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
                vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
            #endif 
                return vec4(linOut,srgbIn.w);;
        #else 
            return srgbIn;
        #endif 
    }

    vec3 getNormal()
    {
        
        #ifndef HAS_TANGENTS
            vec3 pos_dx = dFdx(vPosition);
            vec3 pos_dy = dFdy(vPosition);
            vec3 tex_dx = dFdx(vec3(vUv, 0.0));
            vec3 tex_dy = dFdy(vec3(vUv, 0.0));
            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

        #ifdef HAS_NORMALS
            vec3 ng = normalize(vNormal);
        #else
            vec3 ng = cross(pos_dx, pos_dy);
        #endif

            t = normalize(t - ng * dot(ng, t));
            vec3 b = normalize(cross(ng, t));
            mat3 tbn = mat3(t, b, ng);
        #else 
            mat3 tbn = vTBN;
        #endif

        #ifdef HAS_NORMALMAP
            vec3 n = texture(uNormalSampler, vUv * uUvScale).rgb;
            n = normalize(tbn * ((2.0 * n - 1.0) * vec3(uNormalScale, uNormalScale, 1.0)));
        #else
            
            vec3 n = normalize(tbn[2].xyz);
        #endif

        return n;
    }

    vec2 SampleSphericalMap(vec3 direction)
    {
        vec2 uv = vec2(atan(direction.z, direction.x), asin(direction.y));
        uv *= invAtan;
        uv += 0.5;
        uv.y = 1. - uv.y;
        return uv;
    }

    
    
    #ifdef USE_IBL
        vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
        {
            float mipCount = 9.0; 
            float lod = (pbrInputs.perceptualRoughness * mipCount);
            
            vec3 brdf = SRGBtoLINEAR(texture(uBrdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
            vec3 diffuseLight = SRGBtoLINEAR(texture(uDiffuseEnvSampler, SampleSphericalMap(n))).rgb;

            vec3 specularLight = SRGBtoLINEAR(texture(uSpecularEnvSampler, SampleSphericalMap(reflection))).rgb;

            vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
            vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);

            
            diffuse *= uScaleIBLAmbient.x;
            specular *= uScaleIBLAmbient.y;

            return diffuse + specular;
        }
    #endif

    
    
    vec3 diffuse(PBRInfo pbrInputs)
    {
        return pbrInputs.diffuseColor / M_PI;
    }

    
    vec3 specularReflection(PBRInfo pbrInputs)
    {
        return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
    }

    
    
    float geometricOcclusion(PBRInfo pbrInputs)
    {
        float NdotL = pbrInputs.NdotL;
        float NdotV = pbrInputs.NdotV;
        float r = pbrInputs.alphaRoughness;

        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
        return attenuationL * attenuationV;
    }

    
    
    
    float microfacetDistribution(PBRInfo pbrInputs)
    {
        float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
        float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
        return roughnessSq / (M_PI * f * f);
    }

    void main() {   

        
        
        
        float perceptualRoughness = uMetallicRoughnessValues.y;
        float metallic = uMetallicRoughnessValues.x;

        #ifdef HAS_METALROUGHNESSMAP
            
            
            vec4 mrSample = texture(uMetallicRoughnessSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
        #endif

        #ifdef HAS_ORM_MAP
            
            
            
            vec4 mrSample = texture(uOcclusionRoughnessMetallicSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
            float ao = mrSample.r;
        #endif

        perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
        metallic = clamp(metallic, 0.0, 1.0);
        
        
        float alphaRoughness = perceptualRoughness * perceptualRoughness;

        
        #ifdef HAS_BASECOLORMAP
            vec4 baseColor = SRGBtoLINEAR(texture(uBaseColorSampler, vUv * uUvScale)) * uBaseColorFactor;
        #else
            vec4 baseColor = uBaseColorFactor;
        #endif
        #ifdef HAS_ALPHAMAP
            baseColor.a *= texture(uAlphaMapSampler, vUv * uUvScale).r;
        #endif

        vec3 f0 = vec3(0.04);
        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
        diffuseColor *= 1.0 - metallic;
        vec3 specularColor = mix(f0, baseColor.rgb, metallic);

        
        float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

        
        
        float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
        vec3 specularEnvironmentR0 = specularColor.rgb;
        vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

        vec3 n = getNormal();                             
        vec3 v = normalize(uCamera - vPosition);          
        vec3 l = normalize(uLightDirection);              
        vec3 h = normalize(l+v);                          
        vec3 reflection = -normalize(reflect(v, n));

        
        
        
        

        float NdotL = clamp(dot(n, l), 0.001, 1.0);
        float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
        float NdotH = clamp(dot(n, h), 0.0, 1.0);
        float LdotH = clamp(dot(l, h), 0.0, 1.0);
        float VdotH = clamp(dot(v, h), 0.0, 1.0);

        PBRInfo pbrInputs = PBRInfo(
            NdotL,
            NdotV,
            NdotH,
            LdotH,
            VdotH,
            perceptualRoughness,
            metallic,
            specularEnvironmentR0,
            specularEnvironmentR90,
            alphaRoughness,
            diffuseColor,
            specularColor
        );

        
        vec3 F = specularReflection(pbrInputs);
        float G = geometricOcclusion(pbrInputs);
        float D = microfacetDistribution(pbrInputs);

        
        vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);
        
        vec3 color = NdotL * uLightColor * (diffuseContrib + specContrib);

        
        #ifdef USE_IBL
            color += getIBLContribution(pbrInputs, n, reflection);
        #endif

        
        #ifdef HAS_OCCLUSIONMAP
            float ao = texture(uOcclusionSampler, vUv * uUvScale).r;
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_ORM_MAP
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_EMISSIVEMAP
            vec3 emissive = SRGBtoLINEAR(texture(uEmissiveSampler, vUv * uUvScale)).rgb * uEmissiveColor;
            
        #endif

        
        
        color = mix(color, F, uScaleFGDSpec.x);
        
        
        
        color = mix(color, vec3(G), uScaleFGDSpec.y);
        color = mix(color, vec3(D), uScaleFGDSpec.z);
        color = mix(color, specContrib, uScaleFGDSpec.w);

        color = mix(color, diffuseContrib, uScaleDiffBaseMR.x);
        color = mix(color, baseColor.rgb, uScaleDiffBaseMR.y);
        color = mix(color, vec3(metallic), uScaleDiffBaseMR.z);
        color = mix(color, vec3(perceptualRoughness), uScaleDiffBaseMR.w);

        #ifdef HAS_SHADOW_MAP
            float shadow = texture(uShadowSampler, vUv * uUvScale).r;
            color = mix(color, color * shadow, uShadowStrength);
        #endif
        
        
        #ifdef HAS_COLOR_CORRECTION
            color.rgb = czm_saturation(color.rgb, uSaturation);
            color.rgb = contrast(color.rgb, uContrast);
            color.rgb = exposure(color.rgb, uExposure);
            color.rgb = mix(color.rgb, uTint, uTintOpacity);
        #endif
        
        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            color = mix(color, uFogColor, fogAmount);

            
            baseColor.a *= smoothstep(1., .97, fogAmount);
        #endif
        

        #ifdef IS_WEBGL_1
            gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    gl_FragColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    gl_FragColor.rgb = mix(gl_FragColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
        #else
            outColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    outColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    outColor.rgb = mix(outColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
        #endif

        
        
        
        
        

    } 
        
<% } %>`,c_=`<% if (vert) { %>
    needES300
    precision highp float;

    in vec3 position;
    #ifdef HAS_NORMALS
        in vec3 normal;
    #endif
    
    
    
    
    
    #ifdef HAS_TANGENTS
        in vec3 tangents;
    #endif
    #ifdef HAS_UV
        in vec2 uv;
    #endif

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 normalMatrix;
    uniform mat4 projectionMatrix;

    uniform float uTime;

    uniform float uMeshScale; 
    uniform float uClothWaveAmplitude;
    uniform float uClothWaveFrequency;

    out vec3 vPosition;
    out vec3 vWorldPosition;
    out vec2 vUv;
    out float vClothMovementOffset;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            out mat3 vTBN;
        #else
            out vec3 vNormal;
        #endif
    #endif

    void main(){

        vec3 p = position;
        vec3 n = normal;
        
        
        
        

        float finalMeshScale = uMeshScale * 10000.;
        float mappedPosition = position.x / finalMeshScale;

        float sinus = sin(6.28 * mappedPosition - uTime * uClothWaveFrequency) * uClothWaveAmplitude;
        sinus += sin(6.28 * mappedPosition - uTime * uClothWaveFrequency * .375) * uClothWaveAmplitude * .375;
        sinus += sin(6.28 * mappedPosition - uTime * uClothWaveFrequency * .1) * uClothWaveAmplitude * .1;

        vClothMovementOffset = sinus * mappedPosition * finalMeshScale;
        p.y += vClothMovementOffset;

        vec4 pos = modelMatrix * vec4(p, 1.0);
        vPosition = vec3(pos.xyz) / pos.w;
        vWorldPosition = (modelViewMatrix * vec4(p, 1.0)).xyz;

        #ifdef HAS_NORMALS
            #ifdef HAS_TANGENTS
                vec3 normalW = normalize(vec3(normalMatrix * vec4(n, 0.0)));
                vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangents.xyz, 0.0)));
                vec3 bitangentW = cross(normalW, tangentW) * tangents.w;
                vTBN = mat3(tangentW, bitangentW, normalW);
            #else 
                vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
            #endif
        #endif

        #ifdef HAS_UV
            vUv = uv;
        #else
            vUv = vec2(0.,0.);
        #endif

        gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);
    }

<% } %>

<% if (frag) { %>
    
    precision highp float; 

    uniform vec3 uLightDirection;
    uniform vec3 uLightColor;
    uniform float uUvScale;

    #ifdef USE_IBL
        uniform sampler2D uDiffuseEnvSampler;
        uniform sampler2D uSpecularEnvSampler;
        uniform sampler2D uBrdfLUT;
    #endif

    #ifdef HAS_BASECOLORMAP
        uniform sampler2D uBaseColorSampler;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaMapSampler;
    #endif
    
    
    
    
    

    #ifdef HAS_NORMALMAP
        uniform sampler2D uNormalSampler;
        uniform float uNormalScale;
    #endif

    #ifdef HAS_EMISSIVEMAP
        uniform sampler2D uEmissiveSampler;
    #endif
    #ifdef HAS_EMISSIVECOLOR
        uniform vec3 uEmissiveColor;
        uniform float uEmissivePower;
    #endif
    
    #ifdef HAS_METALROUGHNESSMAP
        uniform sampler2D uMetallicRoughnessSampler;
    #endif

    #ifdef HAS_OCCLUSIONMAP
        uniform sampler2D uOcclusionSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_FOG
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif

    #ifdef HAS_SHADOW_MAP
        uniform sampler2D uShadowSampler;
        uniform float uShadowStrength;
    #endif

    
    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;

        vec3 contrast(vec3 color, float value) { return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.)); }
        vec3 exposure(vec3 color, float value) { return (1.0 + value) * color; }
        vec3 hueShift(vec3 color, float hue) {
            const vec3 k = vec3(0.57735, 0.57735, 0.57735);
            float cosAngle = cos(hue);
            return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
        }
        vec3 czm_saturation(vec3 rgb, float adjustment){
            const vec3 W = vec3(0.2125, 0.7154, 0.0721);
            vec3 intensity = vec3(dot(rgb, W));
            return mix(intensity, rgb, adjustment);
        }
    #endif

    uniform vec2 uMetallicRoughnessValues;
    uniform vec4 uBaseColorFactor;
    uniform vec3 uCamera;

    
    uniform vec4 uScaleDiffBaseMR;
    uniform vec4 uScaleFGDSpec;
    uniform vec4 uScaleIBLAmbient;
    
    uniform float uClothWaveLighting;

    in vec2 vUv;
    in vec3 vPosition;
    in vec3 vWorldPosition;
    in float vClothMovementOffset;

    out vec4 outColor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            in mat3 vTBN;
        #else
            in vec3 vNormal;
        #endif
    #endif

    struct PBRInfo
    {
        float NdotL;                  
        float NdotV;                  
        float NdotH;                  
        float LdotH;                  
        float VdotH;                  
        float perceptualRoughness;    
        float metalness;              
        vec3 reflectance0;            
        vec3 reflectance90;           
        float alphaRoughness;         
        vec3 diffuseColor;            
        vec3 specularColor;           
    };

    const float M_PI = 3.141592653589793;
    const float c_MinRoughness = 0.04;
    const vec2 invAtan = vec2(0.1591, 0.3183);
    const float LOG2 = 1.442695;

    vec4 SRGBtoLINEAR(vec4 srgbIn)
    {
        #ifdef MANUAL_SRGB
            #ifdef SRGB_FAST_APPROXIMATION
                vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
            #else 
                vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
                vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
            #endif 
                return vec4(linOut,srgbIn.w);;
        #else 
            return srgbIn;
        #endif 
    }

    vec3 getNormal()
    {
        
        #ifndef HAS_TANGENTS
            vec3 pos_dx = dFdx(vPosition);
            vec3 pos_dy = dFdy(vPosition);
            vec3 tex_dx = dFdx(vec3(vUv, 0.0));
            vec3 tex_dy = dFdy(vec3(vUv, 0.0));
            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

        #ifdef HAS_NORMALS
            vec3 ng = normalize(vNormal);
        #else
            vec3 ng = cross(pos_dx, pos_dy);
        #endif

            t = normalize(t - ng * dot(ng, t));
            vec3 b = normalize(cross(ng, t));
            mat3 tbn = mat3(t, b, ng);
        #else 
            mat3 tbn = vTBN;
        #endif

        #ifdef HAS_NORMALMAP
            vec3 n = texture(uNormalSampler, vUv * uUvScale).rgb;
            n = normalize(tbn * ((2.0 * n - 1.0) * vec3(uNormalScale, uNormalScale, 1.0)));
        #else
            
            vec3 n = normalize(tbn[2].xyz);
        #endif

        return n;
    }

    vec2 SampleSphericalMap(vec3 direction)
    {
        vec2 uv = vec2(atan(direction.z, direction.x), asin(direction.y));
        uv *= invAtan;
        uv += 0.5;
        uv.y = 1. - uv.y;
        return uv;
    }

    
    
    #ifdef USE_IBL
        vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
        {
            float mipCount = 9.0; 
            float lod = (pbrInputs.perceptualRoughness * mipCount);
            
            vec3 brdf = SRGBtoLINEAR(texture(uBrdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
            vec3 diffuseLight = SRGBtoLINEAR(texture(uDiffuseEnvSampler, SampleSphericalMap(n))).rgb;

            vec3 specularLight = SRGBtoLINEAR(texture(uSpecularEnvSampler, SampleSphericalMap(reflection))).rgb;

            vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
            vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);

            
            diffuse *= uScaleIBLAmbient.x;
            specular *= uScaleIBLAmbient.y;

            return diffuse + specular;
        }
    #endif

    
    
    vec3 diffuse(PBRInfo pbrInputs)
    {
        return pbrInputs.diffuseColor / M_PI;
    }

    
    vec3 specularReflection(PBRInfo pbrInputs)
    {
        return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
    }

    
    
    float geometricOcclusion(PBRInfo pbrInputs)
    {
        float NdotL = pbrInputs.NdotL;
        float NdotV = pbrInputs.NdotV;
        float r = pbrInputs.alphaRoughness;

        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
        return attenuationL * attenuationV;
    }

    
    
    
    float microfacetDistribution(PBRInfo pbrInputs)
    {
        float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
        float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
        return roughnessSq / (M_PI * f * f);
    }

    void main() {   

        
        
        
        float perceptualRoughness = uMetallicRoughnessValues.y;
        float metallic = uMetallicRoughnessValues.x;

        #ifdef HAS_METALROUGHNESSMAP
            
            
            vec4 mrSample = texture(uMetallicRoughnessSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
        #endif

        perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
        metallic = clamp(metallic, 0.0, 1.0);
        
        
        float alphaRoughness = perceptualRoughness * perceptualRoughness;

        
        #ifdef HAS_BASECOLORMAP
            vec4 t = texture(uBaseColorSampler, vUv * uUvScale);
            vec4 baseColor = SRGBtoLINEAR(t) * uBaseColorFactor;

            
            float colorIsBlack = step(0.8, t.r + t.g + t.b);
            baseColor.a *= colorIsBlack;
        #else
            vec4 baseColor = uBaseColorFactor;
        #endif
        #ifdef HAS_ALPHAMAP
            baseColor.a *= texture(uAlphaMapSampler, vUv * uUvScale).r;
        #endif

        if(baseColor.a < 0.001){
            discard;
        }

        baseColor.rgb = mix(baseColor.rgb, baseColor.rgb * vec3(vClothMovementOffset), uClothWaveLighting * 0.00001);

        vec3 f0 = vec3(0.04);
        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
        diffuseColor *= 1.0 - metallic;
        vec3 specularColor = mix(f0, baseColor.rgb, metallic);

        
        float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

        
        
        float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
        vec3 specularEnvironmentR0 = specularColor.rgb;
        vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

        vec3 n = getNormal();                             
        vec3 v = normalize(uCamera - vPosition);          
        vec3 l = normalize(uLightDirection);              
        vec3 h = normalize(l+v);                          
        vec3 reflection = -normalize(reflect(v, n));

        
        
        
        

        float NdotL = clamp(dot(n, l), 0.001, 1.0);
        float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
        float NdotH = clamp(dot(n, h), 0.0, 1.0);
        float LdotH = clamp(dot(l, h), 0.0, 1.0);
        float VdotH = clamp(dot(v, h), 0.0, 1.0);

        PBRInfo pbrInputs = PBRInfo(
            NdotL,
            NdotV,
            NdotH,
            LdotH,
            VdotH,
            perceptualRoughness,
            metallic,
            specularEnvironmentR0,
            specularEnvironmentR90,
            alphaRoughness,
            diffuseColor,
            specularColor
        );

        
        vec3 F = specularReflection(pbrInputs);
        float G = geometricOcclusion(pbrInputs);
        float D = microfacetDistribution(pbrInputs);

        
        vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);
        
        vec3 color = NdotL * uLightColor * (diffuseContrib + specContrib);

        
        #ifdef USE_IBL
            color += getIBLContribution(pbrInputs, n, reflection);
        #endif

        
        #ifdef HAS_OCCLUSIONMAP
            float ao = texture(uOcclusionSampler, vUv * uUvScale).r;
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_EMISSIVEMAP
            vec3 emissive = SRGBtoLINEAR(texture(uEmissiveSampler, vUv * uUvScale)).rgb * uEmissiveColor;
            
        #endif

        
        
        color = mix(color, F, uScaleFGDSpec.x);
        
        
        
        color = mix(color, vec3(G), uScaleFGDSpec.y);
        color = mix(color, vec3(D), uScaleFGDSpec.z);
        color = mix(color, specContrib, uScaleFGDSpec.w);

        color = mix(color, diffuseContrib, uScaleDiffBaseMR.x);
        color = mix(color, baseColor.rgb, uScaleDiffBaseMR.y);
        color = mix(color, vec3(metallic), uScaleDiffBaseMR.z);
        color = mix(color, vec3(perceptualRoughness), uScaleDiffBaseMR.w);

        #ifdef HAS_SHADOW_MAP
            float shadow = texture(uShadowSampler, vUv * uUvScale).r;
            color = mix(color, color * shadow, uShadowStrength);
        #endif

        
        #ifdef HAS_COLOR_CORRECTION
            color.rgb = czm_saturation(color.rgb, uSaturation);
            color.rgb = contrast(color.rgb, uContrast);
            color.rgb = exposure(color.rgb, uExposure);
            color.rgb = mix(color.rgb, uTint, uTintOpacity);
        #endif

        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            color = mix(color, uFogColor, fogAmount);

            
            baseColor.a *= smoothstep(1., .97, fogAmount);
        #endif

        #ifdef IS_WEBGL_1
            gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    gl_FragColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    gl_FragColor.rgb = mix(gl_FragColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
        #else
            outColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    outColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    outColor.rgb = mix(outColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
        #endif

        
        
        
        
        
        
        
        
    } 
        
<% } %>`,h_=`<% if (vert) { %>
    needES300
    precision highp float;

    in vec3 position;
    #ifdef HAS_NORMALS
        in vec3 normal;
    #endif
    
    
    
    
    
    #ifdef HAS_TANGENTS
        in vec3 tangents;
    #endif
    #ifdef HAS_UV
        in vec2 uv;
    #endif

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 normalMatrix;
    uniform mat4 projectionMatrix;

    uniform float uTime;

    uniform float uMeshScale; 
    uniform float uClothWaveAmplitude;
    uniform float uClothWaveFrequency;
    uniform float uSeed;
    
    #ifdef HAS_WEIGHTSMAP
        uniform sampler2D uWeightsSampler;
    #endif

    out vec3 vPosition;
    out vec3 vWorldPosition;
    out vec2 vUv;
    out float vClothMovementOffset;
    out float vMeshScale;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            out mat3 vTBN;
        #else
            out vec3 vNormal;
        #endif
    #endif

    
    
    
    vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }

    float snoise(vec2 v){
        const vec4 C = vec4(0.211324865405187, 0.366025403784439,
                -0.577350269189626, 0.024390243902439);
        vec2 i  = floor(v + dot(v, C.yy) );
        vec2 x0 = v -   i + dot(i, C.xx);
        vec2 i1;
        i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
        vec4 x12 = x0.xyxy + C.xxzz;
        x12.xy -= i1;
        i = mod(i, 289.0);
        vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
        + i.x + vec3(0.0, i1.x, 1.0 ));
        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),
            dot(x12.zw,x12.zw)), 0.0);
        m = m*m ;
        m = m*m ;
        vec3 x = 2.0 * fract(p * C.www) - 1.0;
        vec3 h = abs(x) - 0.5;
        vec3 ox = floor(x + 0.5);
        vec3 a0 = x - ox;
        m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
        vec3 g;
        g.x  = a0.x  * x0.x  + h.x  * x0.y;
        g.yz = a0.yz * x12.xz + h.yz * x12.yw;
        return 130.0 * dot(m, g);
    }

    void main(){

        vec3 p = position;
        vec3 n = normal;
        
        
        
        

        
        #ifdef HAS_WEIGHTSMAP
            vec4 weights = texture(uWeightsSampler, uv);
        #else 
            vec4 weights = vec4(1.);
        #endif

        float finalMeshScale = uMeshScale * 10000.;
        vec3 mappedPosition = position / finalMeshScale;

        float sinus = sin(6.28 * mappedPosition.y - (uTime + uSeed) * uClothWaveFrequency) * uClothWaveAmplitude;
        sinus += sin(6.28 * mappedPosition.y - (uTime + uSeed) * uClothWaveFrequency * .75) * uClothWaveAmplitude * .75;
        sinus += sin(6.28 * mappedPosition.y - (uTime + uSeed) * uClothWaveFrequency * .25) * uClothWaveAmplitude * .25;

        float verticalClothOffset = sinus * mappedPosition.y * finalMeshScale * weights.r;
        p.z += verticalClothOffset;

        float noise = snoise(vec2(uv.x + (uTime + uSeed), uv.y) * uClothWaveFrequency * .3) * uClothWaveAmplitude * .75;
        float horizontalClothOffset = noise * mappedPosition.y * finalMeshScale * weights.r;
        p.x += horizontalClothOffset;

        vClothMovementOffset = horizontalClothOffset + verticalClothOffset;
        vMeshScale = mappedPosition.y;

        vec4 pos = modelMatrix * vec4(p, 1.0);
        vPosition = vec3(pos.xyz) / pos.w;
        vWorldPosition = (modelViewMatrix * vec4(p, 1.0)).xyz;

        #ifdef HAS_NORMALS
            #ifdef HAS_TANGENTS
                vec3 normalW = normalize(vec3(normalMatrix * vec4(n, 0.0)));
                vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangents.xyz, 0.0)));
                vec3 bitangentW = cross(normalW, tangentW) * tangents.w;
                vTBN = mat3(tangentW, bitangentW, normalW);
            #else 
                vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
            #endif
        #endif

        #ifdef HAS_UV
            vUv = uv;
        #else
            vUv = vec2(0.,0.);
        #endif

        gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);
    }

<% } %>

<% if (frag) { %>
    
    precision highp float; 

    uniform vec3 uLightDirection;
    uniform vec3 uLightColor;
    uniform float uUvScale;

    #ifdef USE_IBL
        uniform sampler2D uDiffuseEnvSampler;
        uniform sampler2D uSpecularEnvSampler;
        uniform sampler2D uBrdfLUT;
    #endif

    #ifdef HAS_BASECOLORMAP
        uniform sampler2D uBaseColorSampler;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaMapSampler;
    #endif
    
    
    
    
    

    #ifdef HAS_NORMALMAP
        uniform sampler2D uNormalSampler;
        uniform float uNormalScale;
    #endif

    #ifdef HAS_EMISSIVEMAP
        uniform sampler2D uEmissiveSampler;
    #endif
    #ifdef HAS_EMISSIVECOLOR
        uniform vec3 uEmissiveColor;
        uniform float uEmissivePower;
    #endif
    
    #ifdef HAS_METALROUGHNESSMAP
        uniform sampler2D uMetallicRoughnessSampler;
    #endif

    #ifdef HAS_OCCLUSIONMAP
        uniform sampler2D uOcclusionSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_FOG
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif

    #ifdef HAS_SHADOW_MAP
        uniform sampler2D uShadowSampler;
        uniform float uShadowStrength;
    #endif

    
    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;

        vec3 contrast(vec3 color, float value) { return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.)); }
        vec3 exposure(vec3 color, float value) { return (1.0 + value) * color; }
        vec3 hueShift(vec3 color, float hue) {
            const vec3 k = vec3(0.57735, 0.57735, 0.57735);
            float cosAngle = cos(hue);
            return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
        }
        vec3 czm_saturation(vec3 rgb, float adjustment){
            const vec3 W = vec3(0.2125, 0.7154, 0.0721);
            vec3 intensity = vec3(dot(rgb, W));
            return mix(intensity, rgb, adjustment);
        }
    #endif

    #ifdef HAS_WEIGHTSMAP
        uniform sampler2D uWeightsSampler;
    #endif

    uniform vec2 uMetallicRoughnessValues;
    uniform vec4 uBaseColorFactor;
    uniform vec3 uCamera;

    
    uniform vec4 uScaleDiffBaseMR;
    uniform vec4 uScaleFGDSpec;
    uniform vec4 uScaleIBLAmbient;
    
    uniform float uClothWaveLighting;

    in vec2 vUv;
    in vec3 vPosition;
    in vec3 vWorldPosition;
    in float vClothMovementOffset;
    in float vMeshScale;

    out vec4 outColor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            in mat3 vTBN;
        #else
            in vec3 vNormal;
        #endif
    #endif

    struct PBRInfo
    {
        float NdotL;                  
        float NdotV;                  
        float NdotH;                  
        float LdotH;                  
        float VdotH;                  
        float perceptualRoughness;    
        float metalness;              
        vec3 reflectance0;            
        vec3 reflectance90;           
        float alphaRoughness;         
        vec3 diffuseColor;            
        vec3 specularColor;           
    };

    const float M_PI = 3.141592653589793;
    const float c_MinRoughness = 0.04;
    const vec2 invAtan = vec2(0.1591, 0.3183);
    const float LOG2 = 1.442695;

    vec4 SRGBtoLINEAR(vec4 srgbIn)
    {
        #ifdef MANUAL_SRGB
            #ifdef SRGB_FAST_APPROXIMATION
                vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
            #else 
                vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
                vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
            #endif 
                return vec4(linOut,srgbIn.w);;
        #else 
            return srgbIn;
        #endif 
    }

    vec3 getNormal()
    {
        
        #ifndef HAS_TANGENTS
            vec3 pos_dx = dFdx(vPosition);
            vec3 pos_dy = dFdy(vPosition);
            vec3 tex_dx = dFdx(vec3(vUv, 0.0));
            vec3 tex_dy = dFdy(vec3(vUv, 0.0));
            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

        #ifdef HAS_NORMALS
            vec3 ng = normalize(vNormal);
        #else
            vec3 ng = cross(pos_dx, pos_dy);
        #endif

            t = normalize(t - ng * dot(ng, t));
            vec3 b = normalize(cross(ng, t));
            mat3 tbn = mat3(t, b, ng);
        #else 
            mat3 tbn = vTBN;
        #endif

        #ifdef HAS_NORMALMAP
            vec3 n = texture(uNormalSampler, vUv * uUvScale).rgb;
            n = normalize(tbn * ((2.0 * n - 1.0) * vec3(uNormalScale, uNormalScale, 1.0)));
        #else
            
            vec3 n = normalize(tbn[2].xyz);
        #endif

        return n;
    }

    vec2 SampleSphericalMap(vec3 direction)
    {
        vec2 uv = vec2(atan(direction.z, direction.x), asin(direction.y));
        uv *= invAtan;
        uv += 0.5;
        uv.y = 1. - uv.y;
        return uv;
    }

    
    
    #ifdef USE_IBL
        vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
        {
            float mipCount = 9.0; 
            float lod = (pbrInputs.perceptualRoughness * mipCount);
            
            vec3 brdf = SRGBtoLINEAR(texture(uBrdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
            vec3 diffuseLight = SRGBtoLINEAR(texture(uDiffuseEnvSampler, SampleSphericalMap(n))).rgb;

            vec3 specularLight = SRGBtoLINEAR(texture(uSpecularEnvSampler, SampleSphericalMap(reflection))).rgb;

            vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
            vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);

            
            diffuse *= uScaleIBLAmbient.x;
            specular *= uScaleIBLAmbient.y;

            return diffuse + specular;
        }
    #endif

    
    
    vec3 diffuse(PBRInfo pbrInputs)
    {
        return pbrInputs.diffuseColor / M_PI;
    }

    
    vec3 specularReflection(PBRInfo pbrInputs)
    {
        return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
    }

    
    
    float geometricOcclusion(PBRInfo pbrInputs)
    {
        float NdotL = pbrInputs.NdotL;
        float NdotV = pbrInputs.NdotV;
        float r = pbrInputs.alphaRoughness;

        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
        return attenuationL * attenuationV;
    }

    
    
    
    float microfacetDistribution(PBRInfo pbrInputs)
    {
        float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
        float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
        return roughnessSq / (M_PI * f * f);
    }

    void main() {   

        
        
        
        float perceptualRoughness = uMetallicRoughnessValues.y;
        float metallic = uMetallicRoughnessValues.x;

        #ifdef HAS_METALROUGHNESSMAP
            
            
            vec4 mrSample = texture(uMetallicRoughnessSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
        #endif

        perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
        metallic = clamp(metallic, 0.0, 1.0);
        
        
        float alphaRoughness = perceptualRoughness * perceptualRoughness;

        
        #ifdef HAS_BASECOLORMAP
            vec4 baseColor = SRGBtoLINEAR(texture(uBaseColorSampler, vUv * uUvScale)) * uBaseColorFactor;
        #else
            vec4 baseColor = uBaseColorFactor;
        #endif
        #ifdef HAS_ALPHAMAP
            baseColor.a *= texture(uAlphaMapSampler, vUv * uUvScale).r;
        #endif

        if(baseColor.a < 0.001){
            discard;
        }

        vec3 f0 = vec3(0.04);
        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
        diffuseColor *= 1.0 - metallic;
        vec3 specularColor = mix(f0, baseColor.rgb, metallic);

        
        float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

        
        
        float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
        vec3 specularEnvironmentR0 = specularColor.rgb;
        vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

        vec3 n = getNormal();                             
        vec3 v = normalize(uCamera - vPosition);          
        vec3 l = normalize(uLightDirection);              
        vec3 h = normalize(l+v);                          
        vec3 reflection = -normalize(reflect(v, n));

        
        
        
        

        float NdotL = clamp(dot(n, l), 0.001, 1.0);
        float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
        float NdotH = clamp(dot(n, h), 0.0, 1.0);
        float LdotH = clamp(dot(l, h), 0.0, 1.0);
        float VdotH = clamp(dot(v, h), 0.0, 1.0);

        PBRInfo pbrInputs = PBRInfo(
            NdotL,
            NdotV,
            NdotH,
            LdotH,
            VdotH,
            perceptualRoughness,
            metallic,
            specularEnvironmentR0,
            specularEnvironmentR90,
            alphaRoughness,
            diffuseColor,
            specularColor
        );

        
        vec3 F = specularReflection(pbrInputs);
        float G = geometricOcclusion(pbrInputs);
        float D = microfacetDistribution(pbrInputs);

        
        vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);
        
        vec3 color = NdotL * uLightColor * (diffuseContrib + specContrib);

        
        #ifdef USE_IBL
            color += getIBLContribution(pbrInputs, n, reflection);
        #endif

        
        #ifdef HAS_OCCLUSIONMAP
            float ao = texture(uOcclusionSampler, vUv * uUvScale).r;
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_EMISSIVEMAP
            vec3 emissive = SRGBtoLINEAR(texture(uEmissiveSampler, vUv * uUvScale)).rgb * uEmissiveColor;
            
        #endif

        
        
        color = mix(color, F, uScaleFGDSpec.x);
        
        
        
        color = mix(color, vec3(G), uScaleFGDSpec.y);
        color = mix(color, vec3(D), uScaleFGDSpec.z);
        color = mix(color, specContrib, uScaleFGDSpec.w);

        color = mix(color, diffuseContrib, uScaleDiffBaseMR.x);
        color = mix(color, baseColor.rgb, uScaleDiffBaseMR.y);
        color = mix(color, vec3(metallic), uScaleDiffBaseMR.z);
        color = mix(color, vec3(perceptualRoughness), uScaleDiffBaseMR.w);

        #ifdef HAS_SHADOW_MAP
            float shadow = texture(uShadowSampler, vUv * uUvScale).r;
            color = mix(color, color * shadow, uShadowStrength);
        #endif

        
        #ifdef HAS_COLOR_CORRECTION
            color.rgb = czm_saturation(color.rgb, uSaturation);
            color.rgb = contrast(color.rgb, uContrast);
            color.rgb = exposure(color.rgb, uExposure);
            color.rgb = mix(color.rgb, uTint, uTintOpacity);
        #endif

        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            color = mix(color, uFogColor, fogAmount);

            
            baseColor.a *= smoothstep(1., .97, fogAmount);
        #endif

        #ifdef IS_WEBGL_1
            gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    gl_FragColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    gl_FragColor.rgb = mix(gl_FragColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif

            gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(vClothMovementOffset), uClothWaveLighting * 0.00001);
        #else
            outColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    outColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    outColor.rgb = mix(outColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif

            outColor.rgb = mix(outColor.rgb, vec3(vClothMovementOffset), uClothWaveLighting * 0.00001);
        #endif

        
        
        
        
        
        
        
        
        
        
        
        
    } 
        
<% } %>`,p_=`<% if (vert) { %>
    needES300
    precision highp float;

    in vec3 position;
    #ifdef HAS_NORMALS
        in vec3 normal;
    #endif
    
    
    
    
    
    #ifdef HAS_TANGENTS
        in vec3 tangents;
    #endif
    #ifdef HAS_UV
        in vec2 uv;
    #endif

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 normalMatrix;
    uniform mat4 projectionMatrix;

    uniform float uTime;

    out vec3 vPosition;
    out vec3 vWorldPosition;
    out vec2 vUv;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            out mat3 vTBN;
        #else
            out vec3 vNormal;
        #endif
    #endif

    void main(){

        vec3 p = position;
        vec3 n = normal;
        
        
        
        

        vec4 pos = modelMatrix * vec4(p, 1.0);
        vPosition = vec3(pos.xyz) / pos.w;
        vWorldPosition = (modelViewMatrix * vec4(p, 1.0)).xyz;

        #ifdef HAS_NORMALS
            #ifdef HAS_TANGENTS
                vec3 normalW = normalize(vec3(normalMatrix * vec4(n, 0.0)));
                vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangents.xyz, 0.0)));
                vec3 bitangentW = cross(normalW, tangentW) * tangents.w;
                vTBN = mat3(tangentW, bitangentW, normalW);
            #else 
                vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
            #endif
        #endif

        #ifdef HAS_UV
            vUv = uv;
        #else
            vUv = vec2(0.,0.);
        #endif

        gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);

    }

<% } %>

<% if (frag) { %>
    
    precision highp float; 

    uniform vec3 uLightDirection;
    uniform vec3 uLightColor;
    uniform float uUvScale;

    #ifdef USE_IBL
        uniform sampler2D uDiffuseEnvSampler;
        uniform sampler2D uSpecularEnvSampler;
        uniform sampler2D uBrdfLUT;
    #endif

    #ifdef HAS_BASECOLORMAP
        uniform sampler2D uBaseColorSampler;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaMapSampler;
    #endif
    
    
    
    
    

    #ifdef HAS_NORMALMAP
        uniform sampler2D uNormalSampler;
        uniform float uNormalScale;
    #endif

    #ifdef HAS_EMISSIVEMAP
        uniform sampler2D uEmissiveSampler;
    #endif
    #ifdef HAS_EMISSIVECOLOR
        uniform vec3 uEmissiveColor;
        uniform float uEmissivePower;
    #endif
    
    #ifdef HAS_METALROUGHNESSMAP
        uniform sampler2D uMetallicRoughnessSampler;
    #endif

    #ifdef HAS_ORM_MAP
        uniform sampler2D uOcclusionRoughnessMetallicSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_OCCLUSIONMAP
        uniform sampler2D uOcclusionSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_FOG
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif

    #ifdef HAS_SHADOW_MAP
        uniform sampler2D uShadowSampler;
        uniform float uShadowStrength;
    #endif

    
    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;

        vec3 contrast(vec3 color, float value) { return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.)); }
        vec3 exposure(vec3 color, float value) { return (1.0 + value) * color; }
        vec3 hueShift(vec3 color, float hue) {
            const vec3 k = vec3(0.57735, 0.57735, 0.57735);
            float cosAngle = cos(hue);
            return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
        }
        vec3 czm_saturation(vec3 rgb, float adjustment){
            const vec3 W = vec3(0.2125, 0.7154, 0.0721);
            vec3 intensity = vec3(dot(rgb, W));
            return mix(intensity, rgb, adjustment);
        }
    #endif

    uniform vec2 uMetallicRoughnessValues;
    uniform vec4 uBaseColorFactor;
    uniform vec3 uCamera;

    
    uniform vec4 uScaleDiffBaseMR;
    uniform vec4 uScaleFGDSpec;
    uniform vec4 uScaleIBLAmbient;

    in vec2 vUv;
    in vec3 vPosition;
    in vec3 vWorldPosition;

    out vec4 outColor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            in mat3 vTBN;
        #else
            in vec3 vNormal;
        #endif
    #endif

    struct PBRInfo
    {
        float NdotL;                  
        float NdotV;                  
        float NdotH;                  
        float LdotH;                  
        float VdotH;                  
        float perceptualRoughness;    
        float metalness;              
        vec3 reflectance0;            
        vec3 reflectance90;           
        float alphaRoughness;         
        vec3 diffuseColor;            
        vec3 specularColor;           
    };

    const float M_PI = 3.141592653589793;
    const float c_MinRoughness = 0.04;
    const vec2 invAtan = vec2(0.1591, 0.3183);
    const float LOG2 = 1.442695;

    vec4 SRGBtoLINEAR(vec4 srgbIn)
    {
        #ifdef MANUAL_SRGB
            #ifdef SRGB_FAST_APPROXIMATION
                vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
            #else 
                vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
                vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
            #endif 
                return vec4(linOut,srgbIn.w);;
        #else 
            return srgbIn;
        #endif 
    }

    vec3 getNormal()
    {
        
        #ifndef HAS_TANGENTS
            vec3 pos_dx = dFdx(vPosition);
            vec3 pos_dy = dFdy(vPosition);
            vec3 tex_dx = dFdx(vec3(vUv, 0.0));
            vec3 tex_dy = dFdy(vec3(vUv, 0.0));
            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

        #ifdef HAS_NORMALS
            vec3 ng = normalize(vNormal);
        #else
            vec3 ng = cross(pos_dx, pos_dy);
        #endif

            t = normalize(t - ng * dot(ng, t));
            vec3 b = normalize(cross(ng, t));
            mat3 tbn = mat3(t, b, ng);
        #else 
            mat3 tbn = vTBN;
        #endif

        #ifdef HAS_NORMALMAP
            vec3 n = texture(uNormalSampler, vUv * uUvScale).rgb;
            n = normalize(tbn * ((2.0 * n - 1.0) * vec3(uNormalScale, uNormalScale, 1.0)));
        #else
            
            vec3 n = normalize(tbn[2].xyz);
        #endif

        return n;
    }

    vec2 SampleSphericalMap(vec3 direction)
    {
        vec2 uv = vec2(atan(direction.z, direction.x), asin(direction.y));
        uv *= invAtan;
        uv += 0.5;
        uv.y = 1. - uv.y;
        return uv;
    }

    
    
    #ifdef USE_IBL
        vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
        {
            float mipCount = 9.0; 
            float lod = (pbrInputs.perceptualRoughness * mipCount);
            
            vec3 brdf = SRGBtoLINEAR(texture(uBrdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
            vec3 diffuseLight = SRGBtoLINEAR(texture(uDiffuseEnvSampler, SampleSphericalMap(n))).rgb;

            vec3 specularLight = SRGBtoLINEAR(texture(uSpecularEnvSampler, SampleSphericalMap(reflection))).rgb;

            vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
            vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);

            
            diffuse *= uScaleIBLAmbient.x;
            specular *= uScaleIBLAmbient.y;

            return diffuse + specular;
        }
    #endif

    
    
    vec3 diffuse(PBRInfo pbrInputs)
    {
        return pbrInputs.diffuseColor / M_PI;
    }

    
    vec3 specularReflection(PBRInfo pbrInputs)
    {
        return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
    }

    
    
    float geometricOcclusion(PBRInfo pbrInputs)
    {
        float NdotL = pbrInputs.NdotL;
        float NdotV = pbrInputs.NdotV;
        float r = pbrInputs.alphaRoughness;

        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
        return attenuationL * attenuationV;
    }

    
    
    
    float microfacetDistribution(PBRInfo pbrInputs)
    {
        float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
        float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
        return roughnessSq / (M_PI * f * f);
    }

    void main() {   

        
        
        
        float perceptualRoughness = uMetallicRoughnessValues.y;
        float metallic = uMetallicRoughnessValues.x;

        #ifdef HAS_METALROUGHNESSMAP
            
            
            vec4 mrSample = texture(uMetallicRoughnessSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
        #endif

        #ifdef HAS_ORM_MAP
            
            
            
            vec4 mrSample = texture(uOcclusionRoughnessMetallicSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
            float ao = mrSample.r;
        #endif

        perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
        metallic = clamp(metallic, 0.0, 1.0);
        
        
        float alphaRoughness = perceptualRoughness * perceptualRoughness;

        
        #ifdef HAS_BASECOLORMAP
            vec4 baseColor = SRGBtoLINEAR(texture(uBaseColorSampler, vUv * uUvScale)) * uBaseColorFactor;
        #else
            vec4 baseColor = uBaseColorFactor;
        #endif
        #ifdef HAS_ALPHAMAP
            baseColor.a *= texture(uAlphaMapSampler, vUv * uUvScale).r;
        #endif

        vec3 f0 = vec3(0.04);
        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
        diffuseColor *= 1.0 - metallic;
        vec3 specularColor = mix(f0, baseColor.rgb, metallic);

        
        float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

        
        
        float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
        vec3 specularEnvironmentR0 = specularColor.rgb;
        vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

        vec3 n = getNormal();                             
        vec3 v = normalize(uCamera - vPosition);          
        vec3 l = normalize(uLightDirection);              
        vec3 h = normalize(l+v);                          
        vec3 reflection = -normalize(reflect(v, n));

        
        
        
        

        float NdotL = clamp(dot(n, l), 0.001, 1.0);
        float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
        float NdotH = clamp(dot(n, h), 0.0, 1.0);
        float LdotH = clamp(dot(l, h), 0.0, 1.0);
        float VdotH = clamp(dot(v, h), 0.0, 1.0);

        PBRInfo pbrInputs = PBRInfo(
            NdotL,
            NdotV,
            NdotH,
            LdotH,
            VdotH,
            perceptualRoughness,
            metallic,
            specularEnvironmentR0,
            specularEnvironmentR90,
            alphaRoughness,
            diffuseColor,
            specularColor
        );

        
        vec3 F = specularReflection(pbrInputs);
        float G = geometricOcclusion(pbrInputs);
        float D = microfacetDistribution(pbrInputs);

        
        vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);
        
        vec3 color = NdotL * uLightColor * (diffuseContrib + specContrib);

        
        #ifdef USE_IBL
            color += getIBLContribution(pbrInputs, n, reflection);
        #endif

        
        #ifdef HAS_OCCLUSIONMAP
            float ao = texture(uOcclusionSampler, vUv * uUvScale).r;
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_ORM_MAP
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_EMISSIVEMAP
            vec3 emissive = SRGBtoLINEAR(texture(uEmissiveSampler, vUv * uUvScale)).rgb * uEmissiveColor;
            
        #endif

        
        
        color = mix(color, F, uScaleFGDSpec.x);
        
        
        
        color = mix(color, vec3(G), uScaleFGDSpec.y);
        color = mix(color, vec3(D), uScaleFGDSpec.z);
        color = mix(color, specContrib, uScaleFGDSpec.w);

        color = mix(color, diffuseContrib, uScaleDiffBaseMR.x);
        color = mix(color, baseColor.rgb, uScaleDiffBaseMR.y);
        color = mix(color, vec3(metallic), uScaleDiffBaseMR.z);
        color = mix(color, vec3(perceptualRoughness), uScaleDiffBaseMR.w);

        #ifdef HAS_SHADOW_MAP
            float shadow = texture(uShadowSampler, vUv * uUvScale).r;
            color = mix(color, color * shadow, uShadowStrength);
        #endif

        
        #ifdef HAS_COLOR_CORRECTION
            color.rgb = czm_saturation(color.rgb, uSaturation);
            color.rgb = contrast(color.rgb, uContrast);
            color.rgb = exposure(color.rgb, uExposure);
            color.rgb = mix(color.rgb, uTint, uTintOpacity);
        #endif

        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            color = mix(color, uFogColor, fogAmount);

            
            baseColor.a *= smoothstep(1., .97, fogAmount);
        #endif

        #ifdef IS_WEBGL_1
            gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    gl_FragColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    gl_FragColor.rgb = mix(gl_FragColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
            #ifdef SEPARATED_EMISSIVE
            
              gl_FragColor.rgb = emissive * uEmissivePower * (1. - fogAmount);
            #endif
        #else
            outColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    outColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    outColor.rgb = vec3(1., 0., 0.);
                #endif
            #endif
            #ifdef SEPARATED_EMISSIVE
            
              outColor.rgb = emissive * uEmissivePower * (1. - fogAmount);
            #endif
        #endif

        
        
        
        
        

    } 
        
<% } %>`,d_=`<% if (vert) { %>
    needES300
    precision highp float;

    in vec3 position;
    #ifdef HAS_NORMALS
        in vec3 normal;
    #endif
    
    
    
    
    
    #ifdef HAS_TANGENTS
        in vec3 tangents;
    #endif
    #ifdef HAS_UV
        in vec2 uv;
    #endif

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 normalMatrix;
    uniform mat4 projectionMatrix;

    uniform float uTime;

    uniform float uGlowingFrequency;
    uniform float uGlowingAmplitude;

    out vec3 vPosition;
    out vec3 vWorldPosition;
    out vec2 vUv;
    out float vEmissionFactor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            out mat3 vTBN;
        #else
            out vec3 vNormal;
        #endif
    #endif

    
    
    
    vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }

    float snoise(vec2 v){
        const vec4 C = vec4(0.211324865405187, 0.366025403784439,
                -0.577350269189626, 0.024390243902439);
        vec2 i  = floor(v + dot(v, C.yy) );
        vec2 x0 = v -   i + dot(i, C.xx);
        vec2 i1;
        i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
        vec4 x12 = x0.xyxy + C.xxzz;
        x12.xy -= i1;
        i = mod(i, 289.0);
        vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
        + i.x + vec3(0.0, i1.x, 1.0 ));
        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),
            dot(x12.zw,x12.zw)), 0.0);
        m = m*m ;
        m = m*m ;
        vec3 x = 2.0 * fract(p * C.www) - 1.0;
        vec3 h = abs(x) - 0.5;
        vec3 ox = floor(x + 0.5);
        vec3 a0 = x - ox;
        m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
        vec3 g;
        g.x  = a0.x  * x0.x  + h.x  * x0.y;
        g.yz = a0.yz * x12.xz + h.yz * x12.yw;
        return 130.0 * dot(m, g);
    }

    void main(){

        vec3 p = position;
        vec3 n = normal;
        
        
        
        

        vec4 pos = modelMatrix * vec4(p, 1.0);
        vPosition = vec3(pos.xyz) / pos.w;
        vWorldPosition = (modelViewMatrix * vec4(p, 1.0)).xyz;

        #ifdef HAS_NORMALS
            #ifdef HAS_TANGENTS
                vec3 normalW = normalize(vec3(normalMatrix * vec4(n, 0.0)));
                vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangents.xyz, 0.0)));
                vec3 bitangentW = cross(normalW, tangentW) * tangents.w;
                vTBN = mat3(tangentW, bitangentW, normalW);
            #else 
                vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
            #endif
        #endif

        #ifdef HAS_UV
            vUv = uv;
        #else
            vUv = vec2(0.,0.);
        #endif

        vEmissionFactor = snoise(vec2(uv.x + uTime, uv.y) * uGlowingFrequency) * uGlowingAmplitude;
        

        
        p.x *= 1.2; 
        
        float expansion = snoise(vec2(uv.x + uTime, uv.y) * uGlowingFrequency * 2.) * uGlowingAmplitude * 55.;
        p.x += expansion;

        gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);

    }

<% } %>

<% if (frag) { %>
    
    precision highp float; 

    uniform vec3 uLightDirection;
    uniform vec3 uLightColor;
    uniform float uUvScale;

    #ifdef USE_IBL
        uniform sampler2D uDiffuseEnvSampler;
        uniform sampler2D uSpecularEnvSampler;
        uniform sampler2D uBrdfLUT;
    #endif

    #ifdef HAS_BASECOLORMAP
        uniform sampler2D uBaseColorSampler;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaMapSampler;
    #endif
    
    
    
    
    

    #ifdef HAS_NORMALMAP
        uniform sampler2D uNormalSampler;
        uniform float uNormalScale;
    #endif

    #ifdef HAS_EMISSIVEMAP
        uniform sampler2D uEmissiveSampler;
    #endif
    #ifdef HAS_EMISSIVECOLOR
        uniform vec3 uEmissiveColor;
        uniform float uEmissivePower;
    #endif
    
    #ifdef HAS_METALROUGHNESSMAP
        uniform sampler2D uMetallicRoughnessSampler;
    #endif

    #ifdef HAS_ORM_MAP
        uniform sampler2D uOcclusionRoughnessMetallicSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_OCCLUSIONMAP
        uniform sampler2D uOcclusionSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_FOG
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif

    
    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;

        vec3 contrast(vec3 color, float value) { return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.)); }
        vec3 exposure(vec3 color, float value) { return (1.0 + value) * color; }
        vec3 hueShift(vec3 color, float hue) {
            const vec3 k = vec3(0.57735, 0.57735, 0.57735);
            float cosAngle = cos(hue);
            return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
        }
        vec3 czm_saturation(vec3 rgb, float adjustment){
            const vec3 W = vec3(0.2125, 0.7154, 0.0721);
            vec3 intensity = vec3(dot(rgb, W));
            return mix(intensity, rgb, adjustment);
        }
    #endif

    uniform vec2 uMetallicRoughnessValues;
    uniform vec4 uBaseColorFactor;
    uniform vec3 uCamera;
    
    uniform float uTime;

    
    uniform vec4 uScaleDiffBaseMR;
    uniform vec4 uScaleFGDSpec;
    uniform vec4 uScaleIBLAmbient;

    in vec2 vUv;
    in vec3 vPosition;
    in vec3 vWorldPosition;
    in float vEmissionFactor;

    out vec4 outColor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            in mat3 vTBN;
        #else
            in vec3 vNormal;
        #endif
    #endif

    struct PBRInfo
    {
        float NdotL;                  
        float NdotV;                  
        float NdotH;                  
        float LdotH;                  
        float VdotH;                  
        float perceptualRoughness;    
        float metalness;              
        vec3 reflectance0;            
        vec3 reflectance90;           
        float alphaRoughness;         
        vec3 diffuseColor;            
        vec3 specularColor;           
    };

    const float M_PI = 3.141592653589793;
    const float c_MinRoughness = 0.04;
    const vec2 invAtan = vec2(0.1591, 0.3183);
    const float LOG2 = 1.442695;

    vec4 SRGBtoLINEAR(vec4 srgbIn)
    {
        #ifdef MANUAL_SRGB
            #ifdef SRGB_FAST_APPROXIMATION
                vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
            #else 
                vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
                vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
            #endif 
                return vec4(linOut,srgbIn.w);;
        #else 
            return srgbIn;
        #endif 
    }

    vec3 getNormal()
    {
        
        #ifndef HAS_TANGENTS
            vec3 pos_dx = dFdx(vPosition);
            vec3 pos_dy = dFdy(vPosition);
            vec3 tex_dx = dFdx(vec3(vUv, 0.0));
            vec3 tex_dy = dFdy(vec3(vUv, 0.0));
            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

        #ifdef HAS_NORMALS
            vec3 ng = normalize(vNormal);
        #else
            vec3 ng = cross(pos_dx, pos_dy);
        #endif

            t = normalize(t - ng * dot(ng, t));
            vec3 b = normalize(cross(ng, t));
            mat3 tbn = mat3(t, b, ng);
        #else 
            mat3 tbn = vTBN;
        #endif

        #ifdef HAS_NORMALMAP
            vec3 n = texture(uNormalSampler, vUv * uUvScale).rgb;
            n = normalize(tbn * ((2.0 * n - 1.0) * vec3(uNormalScale, uNormalScale, 1.0)));
        #else
            
            vec3 n = normalize(tbn[2].xyz);
        #endif

        return n;
    }

    vec2 SampleSphericalMap(vec3 direction)
    {
        vec2 uv = vec2(atan(direction.z, direction.x), asin(direction.y));
        uv *= invAtan;
        uv += 0.5;
        uv.y = 1. - uv.y;
        return uv;
    }

    
    
    #ifdef USE_IBL
        vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
        {
            float mipCount = 9.0; 
            float lod = (pbrInputs.perceptualRoughness * mipCount);
            
            vec3 brdf = SRGBtoLINEAR(texture(uBrdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
            vec3 diffuseLight = SRGBtoLINEAR(texture(uDiffuseEnvSampler, SampleSphericalMap(n))).rgb;

            vec3 specularLight = SRGBtoLINEAR(texture(uSpecularEnvSampler, SampleSphericalMap(reflection))).rgb;

            vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
            vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);

            
            diffuse *= uScaleIBLAmbient.x;
            specular *= uScaleIBLAmbient.y;

            return diffuse + specular;
        }
    #endif

    
    
    vec3 diffuse(PBRInfo pbrInputs)
    {
        return pbrInputs.diffuseColor / M_PI;
    }

    
    vec3 specularReflection(PBRInfo pbrInputs)
    {
        return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
    }

    
    
    float geometricOcclusion(PBRInfo pbrInputs)
    {
        float NdotL = pbrInputs.NdotL;
        float NdotV = pbrInputs.NdotV;
        float r = pbrInputs.alphaRoughness;

        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
        return attenuationL * attenuationV;
    }

    
    
    
    float microfacetDistribution(PBRInfo pbrInputs)
    {
        float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
        float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
        return roughnessSq / (M_PI * f * f);
    }

    void main() {   

        
        
        
        float perceptualRoughness = uMetallicRoughnessValues.y;
        float metallic = uMetallicRoughnessValues.x;

        #ifdef HAS_METALROUGHNESSMAP
            
            
            vec4 mrSample = texture(uMetallicRoughnessSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
        #endif

        #ifdef HAS_ORM_MAP
            
            
            
            vec4 mrSample = texture(uOcclusionRoughnessMetallicSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
            float ao = mrSample.r;
        #endif

        perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
        metallic = clamp(metallic, 0.0, 1.0);
        
        
        float alphaRoughness = perceptualRoughness * perceptualRoughness;

        
        #ifdef HAS_BASECOLORMAP
            vec4 baseColor = SRGBtoLINEAR(texture(uBaseColorSampler, vUv * uUvScale)) * uBaseColorFactor;
        #else
            vec4 baseColor = uBaseColorFactor;
        #endif
        #ifdef HAS_ALPHAMAP
            baseColor.a *= texture(uAlphaMapSampler, vUv * uUvScale).r;
        #endif

        vec3 f0 = vec3(0.04);
        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
        diffuseColor *= 1.0 - metallic;
        vec3 specularColor = mix(f0, baseColor.rgb, metallic);

        
        float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

        
        
        float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
        vec3 specularEnvironmentR0 = specularColor.rgb;
        vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

        vec3 n = getNormal();                             
        vec3 v = normalize(uCamera - vPosition);          
        vec3 l = normalize(uLightDirection);              
        vec3 h = normalize(l+v);                          
        vec3 reflection = -normalize(reflect(v, n));

        
        
        
        

        float NdotL = clamp(dot(n, l), 0.001, 1.0);
        float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
        float NdotH = clamp(dot(n, h), 0.0, 1.0);
        float LdotH = clamp(dot(l, h), 0.0, 1.0);
        float VdotH = clamp(dot(v, h), 0.0, 1.0);

        PBRInfo pbrInputs = PBRInfo(
            NdotL,
            NdotV,
            NdotH,
            LdotH,
            VdotH,
            perceptualRoughness,
            metallic,
            specularEnvironmentR0,
            specularEnvironmentR90,
            alphaRoughness,
            diffuseColor,
            specularColor
        );

        
        vec3 F = specularReflection(pbrInputs);
        float G = geometricOcclusion(pbrInputs);
        float D = microfacetDistribution(pbrInputs);

        
        vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);
        
        vec3 color = NdotL * uLightColor * (diffuseContrib + specContrib);

        
        #ifdef USE_IBL
            color += getIBLContribution(pbrInputs, n, reflection);
        #endif

        
        #ifdef HAS_OCCLUSIONMAP
            float ao = texture(uOcclusionSampler, vUv * uUvScale).r;
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_ORM_MAP
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_EMISSIVEMAP
            vec3 emissive = SRGBtoLINEAR(texture(uEmissiveSampler, vUv * uUvScale)).rgb * uEmissiveColor;

            
            float minimum = 5.5;
            float amplitude = .15;
            emissive *= vec3(vEmissionFactor + minimum) * amplitude;
            
        #endif

        
        
        color = mix(color, F, uScaleFGDSpec.x);
        
        
        
        color = mix(color, vec3(G), uScaleFGDSpec.y);
        color = mix(color, vec3(D), uScaleFGDSpec.z);
        color = mix(color, specContrib, uScaleFGDSpec.w);

        color = mix(color, diffuseContrib, uScaleDiffBaseMR.x);
        color = mix(color, baseColor.rgb, uScaleDiffBaseMR.y);
        color = mix(color, vec3(metallic), uScaleDiffBaseMR.z);
        color = mix(color, vec3(perceptualRoughness), uScaleDiffBaseMR.w);

        
        #ifdef HAS_COLOR_CORRECTION
            color.rgb = czm_saturation(color.rgb, uSaturation);
            color.rgb = contrast(color.rgb, uContrast);
            color.rgb = exposure(color.rgb, uExposure);
            color.rgb = mix(color.rgb, uTint, uTintOpacity);
        #endif

        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            color = mix(color, uFogColor, fogAmount);

            
            baseColor.a *= smoothstep(1., .97, fogAmount);
        #endif

        #ifdef IS_WEBGL_1
            gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    gl_FragColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    gl_FragColor.rgb = mix(gl_FragColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
            #ifdef SEPARATED_EMISSIVE
              
              gl_FragColor.rgb = emissive * uEmissivePower * (1. - fogAmount);
            #endif
        #else
            outColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    outColor.rgb += emissive * uEmissivePower * (1. - fogAmount);
                #else
                    outColor.rgb = vec3(1., 0., 0.);
                #endif
            #endif
            #ifdef SEPARATED_EMISSIVE
              
              outColor.rgb = emissive * uEmissivePower * (1. - fogAmount);
            #endif
        #endif

        
        
        
        
        
        
    } 
        
<% } %>`,m_=`<% if (vert) { %>
    needES300
    precision highp float;

    in vec3 position;
    in vec3 centroids;
    in vec3 seeds;

    #ifdef HAS_NORMALS
        in vec3 normal;
    #endif
    
    
    
    
    
    #ifdef HAS_TANGENTS
        in vec3 tangents;
    #endif
    #ifdef HAS_UV
        in vec2 uv;
    #endif

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 normalMatrix;
    uniform mat4 projectionMatrix;

    uniform float uTime;
    uniform float uProgress;
    uniform float uMappedIntroOffset;

    out vec3 vPosition;
    out vec3 vWorldPosition;
    out vec2 vUv;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            out mat3 vTBN;
        #else
            out vec3 vNormal;
        #endif
    #endif

    <%= commons.rotation %>
    const float M_PI = 3.141592653589793;

    float map(float value, float min1, float max1, float min2, float max2) {
        return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
    }

    void main(){

        vec3 p = position;
        vec3 n = normal;
        
        
        
        

        float progress = uProgress;
        p -= centroids;
        #ifndef IS_LETTERS
            p = rotate(p, M_PI * 4. * (seeds - .5), progress);
            n = rotate(n, M_PI * 4. * (seeds - .5), progress);
        #endif

        #ifdef IS_LETTERS
            p += centroids * (1. + vec3(0., 0., -300. * progress * -seeds.z));
        #else
            
            float xStrength = map(abs(centroids.x), 0., uMappedIntroOffset, 1.67, 1.);
            p += centroids * (1. + (vec3(xStrength, xStrength, 1.) * progress * 2.));
        #endif

        vec4 pos = modelMatrix * vec4(p, 1.0);
        vPosition = vec3(pos.xyz) / pos.w;
        vWorldPosition = (modelViewMatrix * vec4(p, 1.0)).xyz;

        #ifdef HAS_NORMALS
            #ifdef HAS_TANGENTS
                vec3 normalW = normalize(vec3(normalMatrix * vec4(n, 0.0)));
                vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangents.xyz, 0.0)));
                vec3 bitangentW = cross(normalW, tangentW) * tangents.w;
                vTBN = mat3(tangentW, bitangentW, normalW);
            #else 
                vNormal = normalize(vec3(modelMatrix * vec4(n, 0.0)));
            #endif
        #endif

        #ifdef HAS_UV
            vUv = uv;
        #else
            vUv = vec2(0.,0.);
        #endif

        gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);

    }

<% } %>

<% if (frag) { %>
    
    precision highp float; 

    uniform vec3 uLightDirection;
    uniform vec3 uLightColor;
    uniform float uUvScale;

    #ifdef USE_IBL
        uniform sampler2D uDiffuseEnvSampler;
        uniform sampler2D uSpecularEnvSampler;
        uniform sampler2D uBrdfLUT;
    #endif

    #ifdef HAS_BASECOLORMAP
        uniform sampler2D uBaseColorSampler;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaMapSampler;
    #endif
    
    
    
    
    

    #ifdef HAS_NORMALMAP
        uniform sampler2D uNormalSampler;
        uniform float uNormalScale;
    #endif

    #ifdef HAS_EMISSIVEMAP
        uniform sampler2D uEmissiveSampler;
    #endif
    #ifdef HAS_EMISSIVECOLOR
        uniform vec3 uEmissiveColor;
        uniform float uEmissivePower;
    #endif
    
    #ifdef HAS_METALROUGHNESSMAP
        uniform sampler2D uMetallicRoughnessSampler;
    #endif

    #ifdef HAS_ORM_MAP
        uniform sampler2D uOcclusionRoughnessMetallicSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_OCCLUSIONMAP
        uniform sampler2D uOcclusionSampler;
        uniform float uOcclusionStrength;
    #endif

    #ifdef HAS_FOG
        uniform vec3 uFogColor;
        uniform float uFogDensity;
    #endif

    
    #ifdef HAS_COLOR_CORRECTION
        uniform float uTintOpacity;
        uniform float uExposure;
        uniform float uContrast;
        uniform float uSaturation;
        uniform vec3 uTint;

        vec3 contrast(vec3 color, float value) { return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.)); }
        vec3 exposure(vec3 color, float value) { return (1.0 + value) * color; }
        vec3 hueShift(vec3 color, float hue) {
            const vec3 k = vec3(0.57735, 0.57735, 0.57735);
            float cosAngle = cos(hue);
            return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
        }
        vec3 czm_saturation(vec3 rgb, float adjustment){
            const vec3 W = vec3(0.2125, 0.7154, 0.0721);
            vec3 intensity = vec3(dot(rgb, W));
            return mix(intensity, rgb, adjustment);
        }
    #endif

    uniform vec2 uMetallicRoughnessValues;
    uniform vec4 uBaseColorFactor;
    uniform vec3 uCamera;

    
    uniform vec4 uScaleDiffBaseMR;
    uniform vec4 uScaleFGDSpec;
    uniform vec4 uScaleIBLAmbient;

    in vec2 vUv;
    in vec3 vPosition;
    in vec3 vWorldPosition;

    out vec4 outColor;

    #ifdef HAS_NORMALS
        #ifdef HAS_TANGENTS
            in mat3 vTBN;
        #else
            in vec3 vNormal;
        #endif
    #endif

    struct PBRInfo
    {
        float NdotL;                  
        float NdotV;                  
        float NdotH;                  
        float LdotH;                  
        float VdotH;                  
        float perceptualRoughness;    
        float metalness;              
        vec3 reflectance0;            
        vec3 reflectance90;           
        float alphaRoughness;         
        vec3 diffuseColor;            
        vec3 specularColor;           
    };

    const float M_PI = 3.141592653589793;
    const float c_MinRoughness = 0.04;
    const vec2 invAtan = vec2(0.1591, 0.3183);
    const float LOG2 = 1.442695;

    vec4 SRGBtoLINEAR(vec4 srgbIn)
    {
        #ifdef MANUAL_SRGB
            #ifdef SRGB_FAST_APPROXIMATION
                vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
            #else 
                vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
                vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
            #endif 
                return vec4(linOut,srgbIn.w);;
        #else 
            return srgbIn;
        #endif 
    }

    vec3 getNormal()
    {
        
        #ifndef HAS_TANGENTS
            vec3 pos_dx = dFdx(vPosition);
            vec3 pos_dy = dFdy(vPosition);
            vec3 tex_dx = dFdx(vec3(vUv, 0.0));
            vec3 tex_dy = dFdy(vec3(vUv, 0.0));
            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

        #ifdef HAS_NORMALS
            vec3 ng = normalize(vNormal);
        #else
            vec3 ng = cross(pos_dx, pos_dy);
        #endif

            t = normalize(t - ng * dot(ng, t));
            vec3 b = normalize(cross(ng, t));
            mat3 tbn = mat3(t, b, ng);
        #else 
            mat3 tbn = vTBN;
        #endif

        #ifdef HAS_NORMALMAP
            vec3 n = texture(uNormalSampler, vUv * uUvScale).rgb;
            n = normalize(tbn * ((2.0 * n - 1.0) * vec3(uNormalScale, uNormalScale, 1.0)));
        #else
            
            vec3 n = normalize(tbn[2].xyz);
        #endif

        return n;
    }

    vec2 SampleSphericalMap(vec3 direction)
    {
        vec2 uv = vec2(atan(direction.z, direction.x), asin(direction.y));
        uv *= invAtan;
        uv += 0.5;
        uv.y = 1. - uv.y;
        return uv;
    }

    
    
    #ifdef USE_IBL
        vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
        {
            float mipCount = 9.0; 
            float lod = (pbrInputs.perceptualRoughness * mipCount);
            
            vec3 brdf = SRGBtoLINEAR(texture(uBrdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
            vec3 diffuseLight = SRGBtoLINEAR(texture(uDiffuseEnvSampler, SampleSphericalMap(n))).rgb;

            vec3 specularLight = SRGBtoLINEAR(texture(uSpecularEnvSampler, SampleSphericalMap(reflection))).rgb;

            vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
            vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);

            
            diffuse *= uScaleIBLAmbient.x;
            specular *= uScaleIBLAmbient.y;

            return diffuse + specular;
        }
    #endif

    
    
    vec3 diffuse(PBRInfo pbrInputs)
    {
        return pbrInputs.diffuseColor / M_PI;
    }

    
    vec3 specularReflection(PBRInfo pbrInputs)
    {
        return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
    }

    
    
    float geometricOcclusion(PBRInfo pbrInputs)
    {
        float NdotL = pbrInputs.NdotL;
        float NdotV = pbrInputs.NdotV;
        float r = pbrInputs.alphaRoughness;

        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
        return attenuationL * attenuationV;
    }

    
    
    
    float microfacetDistribution(PBRInfo pbrInputs)
    {
        float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
        float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
        return roughnessSq / (M_PI * f * f);
    }

    void main() {   

        
        
        
        float perceptualRoughness = uMetallicRoughnessValues.y;
        float metallic = uMetallicRoughnessValues.x;

        #ifdef HAS_METALROUGHNESSMAP
            
            
            vec4 mrSample = texture(uMetallicRoughnessSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
        #endif

        #ifdef HAS_ORM_MAP
            
            
            
            vec4 mrSample = texture(uOcclusionRoughnessMetallicSampler, vUv * uUvScale);
            perceptualRoughness = mrSample.g * perceptualRoughness;
            metallic = mrSample.b * metallic;
            float ao = mrSample.r;
        #endif

        perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
        metallic = clamp(metallic, 0.0, 1.0);
        
        
        float alphaRoughness = perceptualRoughness * perceptualRoughness;

        
        #ifdef HAS_BASECOLORMAP
            vec4 baseColor = SRGBtoLINEAR(texture(uBaseColorSampler, vUv * uUvScale)) * uBaseColorFactor;
        #else
            vec4 baseColor = uBaseColorFactor;
        #endif
        #ifdef HAS_ALPHAMAP
            baseColor.a *= texture(uAlphaMapSampler, vUv * uUvScale).r;
        #endif

        vec3 f0 = vec3(0.04);
        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
        diffuseColor *= 1.0 - metallic;
        vec3 specularColor = mix(f0, baseColor.rgb, metallic);

        
        float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

        
        
        float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
        vec3 specularEnvironmentR0 = specularColor.rgb;
        vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

        vec3 n = getNormal();                             
        vec3 v = normalize(uCamera - vPosition);          
        vec3 l = normalize(uLightDirection);              
        vec3 h = normalize(l+v);                          
        vec3 reflection = -normalize(reflect(v, n));

        
        
        
        

        float NdotL = clamp(dot(n, l), 0.001, 1.0);
        float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
        float NdotH = clamp(dot(n, h), 0.0, 1.0);
        float LdotH = clamp(dot(l, h), 0.0, 1.0);
        float VdotH = clamp(dot(v, h), 0.0, 1.0);

        PBRInfo pbrInputs = PBRInfo(
            NdotL,
            NdotV,
            NdotH,
            LdotH,
            VdotH,
            perceptualRoughness,
            metallic,
            specularEnvironmentR0,
            specularEnvironmentR90,
            alphaRoughness,
            diffuseColor,
            specularColor
        );

        
        vec3 F = specularReflection(pbrInputs);
        float G = geometricOcclusion(pbrInputs);
        float D = microfacetDistribution(pbrInputs);

        
        vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);
        
        vec3 color = NdotL * uLightColor * (diffuseContrib + specContrib);

        
        #ifdef USE_IBL
            color += getIBLContribution(pbrInputs, n, reflection);
        #endif

        
        #ifdef HAS_OCCLUSIONMAP
            float ao = texture(uOcclusionSampler, vUv * uUvScale).r;
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_ORM_MAP
            color = mix(color, color * ao, uOcclusionStrength);
        #endif

        #ifdef HAS_EMISSIVEMAP
            vec3 emissive = SRGBtoLINEAR(texture(uEmissiveSampler, vUv * uUvScale)).rgb * uEmissiveColor;
            
        #endif

        
        
        color = mix(color, F, uScaleFGDSpec.x);
        
        
        
        color = mix(color, vec3(G), uScaleFGDSpec.y);
        color = mix(color, vec3(D), uScaleFGDSpec.z);
        color = mix(color, specContrib, uScaleFGDSpec.w);

        color = mix(color, diffuseContrib, uScaleDiffBaseMR.x);
        color = mix(color, baseColor.rgb, uScaleDiffBaseMR.y);
        color = mix(color, vec3(metallic), uScaleDiffBaseMR.z);
        color = mix(color, vec3(perceptualRoughness), uScaleDiffBaseMR.w);

        
        #ifdef HAS_COLOR_CORRECTION
            color.rgb = czm_saturation(color.rgb, uSaturation);
            color.rgb = contrast(color.rgb, uContrast);
            color.rgb = exposure(color.rgb, uExposure);
            color.rgb = mix(color.rgb, uTint, uTintOpacity);
        #endif

        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            float fogAmount = 1. - exp2(-uFogDensity * uFogDensity * fogDistance * fogDistance * LOG2);
            fogAmount = clamp(fogAmount, 0., 1.);
            color = mix(color, uFogColor, fogAmount);
        #endif

        #ifdef IS_WEBGL_1
            gl_FragColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    gl_FragColor.rgb += emissive * uEmissivePower;
                #else
                    gl_FragColor.rgb = mix(gl_FragColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                #endif
            #endif
        #else
            outColor = vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
            #ifdef HAS_EMISSIVECOLOR
                #ifdef HAS_EMISSIVEMAP
                    outColor.rgb += emissive * uEmissivePower;
                    #ifdef SEPARATED_EMISSIVE
                        outColor.rgb = emissive * uEmissivePower;
                    #endif
                #else
                    outColor.rgb = mix(outColor.rgb, uEmissiveColor * uEmissivePower, min(uEmissivePower, 1.));
                    #ifdef SEPARATED_EMISSIVE
                        outColor.rgb = uEmissiveColor * uEmissivePower;
                    #endif
                #endif
            #else
                #ifdef SEPARATED_EMISSIVE
                    outColor.rgb = vec3(0.);
                #endif
            #endif
        #endif

        

        
        
        
        
        

    } 
        
<% } %>`,f_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    attribute vec2 uv;
    

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    varying vec2 vUv;

    void main(){
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;
    uniform sampler2D uTexture;
    
    uniform vec2 uRez;
    uniform vec3 uColor;
    uniform float uOpacity;
    uniform float uFrames;
    uniform float uFrame;
    uniform float uCollums;
    uniform float uRows;

    void main() { 

        vec2 uv = vUv;
        float f = max(uFrame - 1., 0.);
        uv.x += mod(f, uCollums);
        uv.y -= floor(uRows * (f/uFrames)) + 1.;
        uv.y /= uRows;
        uv.x /= uCollums;    
        gl_FragColor = texture2D( uTexture, uv ); 

    } 
        
<% } %>`,v_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    
    attribute vec3 centroids;
    attribute vec3 seeds;
    attribute vec2 uv;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
    
    uniform float uProgress;

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;

    
    
    

    <%= commons.rotation %>

    const float M_PI = 3.141592653589793;

    void main(){
        vUv = uv;

        float p = uProgress;
        vec3 pos = position;
        pos -= centroids;

        pos = rotate(pos, M_PI * 4. * (seeds - .5), p);
        pos += centroids * ((p) * 2. + 1.);

        vPos = modelMatrix * vec4(pos, 1.0);
        vWorldPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;

        
        
        
        

        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;
    
    
    

    
    uniform float uAlpha;
    uniform float uTintOpacity;
    uniform float uExposure;
    uniform float uContrast;
    uniform float uSaturation;
    uniform vec3 uTint;

    uniform bool isCameraFliped;

    #ifdef HAS_COLORMAP
        uniform sampler2D uTexture;
    #else 
        uniform vec3 uColor;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaTexture;
    #endif
    #ifdef HAS_FOG
        const float LOG2 = 1.442695;
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif
    
    
    
    
    
    

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment)
    {
        const vec3 W = vec3(0.2125, 0.7154, 0.0721);
        vec3 intensity = vec3(dot(rgb, W));
        return mix(intensity, rgb, adjustment);
    }

    
    
    
    
    
    

    void main() { 
        if(isCameraFliped && vPos.y < 0.01){ discard; }
        vec4 t;
        #ifdef HAS_COLORMAP
            t = texture2D( uTexture, vUv );
        #else 
            t = vec4(uColor, 1.);
        #endif
        #ifdef HAS_ALPHAMAP
            t.a *= texture2D( uAlphaTexture, vUv ).r * max(uExposure, 1.);
        #endif
        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            t.rgb = mix(t.rgb, uFogColor, fogAmount);
        #endif

        
        
        
        
        
        
        
        
        
        t.rgb = czm_saturation(t.rgb, uSaturation);
        t.rgb = contrast(t.rgb, uContrast);
        t.rgb = exposure(t.rgb, uExposure);
        t.rgb = mix(t.rgb, uTint, uTintOpacity);

        

        t.a *= uAlpha;
        gl_FragColor = vec4(t);
    } 
        
<% } %>`,g_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    attribute vec3 normal;
    attribute vec3 centroids;
    attribute vec3 seeds;
    attribute vec2 uv;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
    
    uniform float uProgress;

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;

    
    
    

    <%= commons.rotation %>

    const float M_PI = 3.141592653589793;

    void main(){
        vUv = uv;

        vec3 pos = position;
        pos -= centroids;
        vec3 n = normal;

        float progress = uProgress;

        #ifndef IS_LETTERS
            pos = rotate(pos, M_PI * 4. * (seeds - .5), progress);
            n = rotate(n, M_PI * 4. * (seeds - .5), progress);
        #endif

        #ifdef IS_LETTERS
            
            vec3 animationOffset = vec3(0., seeds.x * pow(progress, 45.), -300. * progress * -seeds.z);
            pos += centroids * (1. + animationOffset);
        #else
            
            float xStrength = map(abs(centroids.x), 0., 450., 2.5, 1.);
            pos += centroids * (1. + (vec3(xStrength, xStrength, 1.) * progress * 2.));
        #endif

        vPos = modelMatrix * vec4(pos, 1.0);
        vWorldPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;

        
        
        

        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec2 vUv;
    varying vec4 vPos;
    varying vec3 vWorldPosition;
    
    
    

    
    uniform float uAlpha;
    uniform float uTintOpacity;
    uniform float uExposure;
    uniform float uContrast;
    uniform float uSaturation;
    uniform vec3 uTint;

    

    #ifdef HAS_COLORMAP
        uniform sampler2D uTexture;
    #else 
        uniform vec3 uColor;
    #endif
    #ifdef HAS_ALPHAMAP
        uniform sampler2D uAlphaTexture;
    #endif
    #ifdef HAS_FOG
        const float LOG2 = 1.442695;
        uniform vec3 uFogColor;
        
        uniform float uFogNear;
        uniform float uFogFar;
    #endif
    
    
    
    
    
    

    vec3 contrast(vec3 color, float value) {
        return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
        return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment)
    {
        const vec3 W = vec3(0.2125, 0.7154, 0.0721);
        vec3 intensity = vec3(dot(rgb, W));
        return mix(intensity, rgb, adjustment);
    }

    
    
    
    
    
    

    void main() { 
        
        vec4 t;
        #ifdef HAS_COLORMAP
            t = texture2D( uTexture, vUv );
        #else 
            t = vec4(uColor, 1.);
        #endif
        #ifdef HAS_ALPHAMAP
            t.a *= texture2D( uAlphaTexture, vUv ).r * max(uExposure, 1.);
        #endif
        #ifdef HAS_FOG
            float fogDistance = length(vWorldPosition);
            
            float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
            fogAmount = clamp(fogAmount, 0., 1.);
            t.rgb = mix(t.rgb, uFogColor, fogAmount);
        #endif

        
        
        
        
        
        
        
        
        
        t.rgb = czm_saturation(t.rgb, uSaturation);
        t.rgb = contrast(t.rgb, uContrast);
        t.rgb = exposure(t.rgb, uExposure);
        t.rgb = mix(t.rgb, uTint, uTintOpacity);

        

        t.a *= uAlpha;
        gl_FragColor = vec4(t);
    } 
        
<% } %>`,__=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    
    attribute vec3 centroids;
    attribute vec3 seeds;
    

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
    uniform float uProgress;
    uniform float uMappedIntroOffset;

    varying vec4 vPos;

    <%= commons.rotation %>

    const float M_PI = 3.141592653589793;

    float map(float value, float min1, float max1, float min2, float max2) {
        return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
    }

    void main(){
        vec3 p = position;
        p -= centroids;

        #ifndef IS_LETTERS
            p = rotate(p, M_PI * 4. * (seeds - .5), uProgress);
        #endif

        #ifdef IS_LETTERS
            p += centroids * (1. + vec3(0., 0., -300. * uProgress * -seeds.z));
        #else
            float xStrength = map(abs(centroids.x), 0., uMappedIntroOffset, 1.67, 1.);
            p += centroids * (1. + (vec3(xStrength, xStrength, 1.) * uProgress * 2.));
        #endif

        vec4 pos = vec4(p, 1.0);
        vPos = modelMatrix * pos;
        gl_Position = projectionMatrix * modelViewMatrix * pos;
    }

<% } %>

<% if (frag) { %>

    precision highp float; 

    varying vec4 vPos;
    uniform bool isCameraFliped;

    void main() { 
        if(isCameraFliped && vPos.y < 0.01){ discard; }
        gl_FragColor = vec4(0., 0., 0., 1.);
    } 
        
<% } %>`,b_=`<% if (vert) { %>
    precision highp float; 

    attribute vec3 position;
    
    
    

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    void main(){
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }

<% } %>

<% if (frag) { %>

    precision highp float;

    void main() { 
        gl_FragColor = vec4(0., 0., 0., 1.);
    }
   
<% } %>`,x_=`<% if (vert) { %>

    precision highp float;

    <%= commons.pnoise %>

    
    
    
    #define M_PI 3.1415926535897932384626433832795

    attribute vec3 position;
    attribute vec4 seeds;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    uniform vec3  uColor;
    uniform vec3  uVolumeCorner;
    uniform vec3  uVolumeSize;
    uniform vec3  uOffset;
    uniform float uPixelRatio;
    uniform float uTime;
    uniform float uTimeScale;
    uniform float speed;
    uniform float uNoiseIntensity;
    uniform float uNoiseFrequency;
    uniform float uFadeDistance;
    uniform float uParticleScale;
    uniform float uParticleOpacity;

    varying vec4  vColor;
    varying vec4  vSeeds;
    varying vec3  vWorldPosition;

    uniform float uSize;

    mat4 rotationMatrix(vec3 axis, float angle) {
        axis = normalize(axis);
        float s = sin(angle);
        float c = cos(angle);
        float oc = 1.0 - c;
        
        return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
                    oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
                    oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
                    0.0,                                0.0,                                0.0,                                1.0);
    }

    vec3 rotate(vec3 v, vec3 axis, float angle) {
        mat4 m = rotationMatrix(axis, angle);
        return (m * vec4(v, 1.0)).xyz;
    }

    void main(void) {

        vSeeds = seeds;

        
        vec3 newPosition  = position;
        vec3 displacement = vec3(
            pnoise(uNoiseFrequency * position + vec3(0., uTime * uTimeScale, 0.), vec3(101.0)) * uNoiseIntensity,
            pnoise(uNoiseFrequency * position + vec3(0., uTime * uTimeScale, 0.), vec3(202.0)) * uNoiseIntensity,
            pnoise(uNoiseFrequency * position + vec3(0., uTime * uTimeScale, 0.), vec3(303.0)) * uNoiseIntensity
        );
        newPosition += displacement;

        
        newPosition += uOffset;

        newPosition.x = mod(mod(newPosition.x, uVolumeSize.x) + uVolumeSize.y, uVolumeSize.x) + uVolumeCorner.x;
        newPosition.y = mod(mod(newPosition.y, uVolumeSize.y) + uVolumeSize.y, uVolumeSize.y) + uVolumeCorner.y;
        newPosition.z = mod(mod(newPosition.z, uVolumeSize.z) + uVolumeSize.z, uVolumeSize.z) + uVolumeCorner.z;

        
        float alphaFade = 1.0;
        vec3 distanceToLimits;
        distanceToLimits.y = min(clamp(abs(newPosition.y - uVolumeCorner.y),0.0,uFadeDistance),clamp(abs(newPosition.y - (uVolumeCorner.y + uVolumeSize.y)),0.0,uFadeDistance));
        distanceToLimits.x = min(clamp(abs(newPosition.x - uVolumeCorner.x),0.0,uFadeDistance),clamp(abs(newPosition.x - (uVolumeCorner.x + uVolumeSize.x)),0.0,uFadeDistance));
        distanceToLimits.z = min(clamp(abs(newPosition.z - uVolumeCorner.z),0.0,uFadeDistance),clamp(abs(newPosition.z - (uVolumeCorner.z + uVolumeSize.z)),0.0,uFadeDistance));
        alphaFade = min(min(distanceToLimits.x,distanceToLimits.y),distanceToLimits.z)/uFadeDistance;

        vec4 viewSpace  = modelViewMatrix * vec4(newPosition, 1.0);
        float dist = length(viewSpace);
        vColor = vec4(uColor, alphaFade * uParticleOpacity);
        vWorldPosition = viewSpace.xyz;

        gl_Position = projectionMatrix * viewSpace;
        gl_PointSize = uPixelRatio * uParticleScale;
        gl_PointSize = gl_PointSize / length(dist);
    }

<% } %>

<% if (frag) { %>

    precision highp float;

    varying vec4  vColor;
    varying vec4  vSeeds;
    varying vec3  vWorldPosition;

    uniform float uTime;
    uniform float uAlpha;
    uniform vec3 uColor1;

    uniform float uFogFactor;
    uniform vec3 uFogColor;
    uniform float uFogNear;
    uniform float uFogFar;
    uniform float uDiscRadius;
    uniform float uDiscRadius1;
    uniform float uBorderSize;
    uniform float uBorderSize1;

    void main() {
        vec2 uv = gl_PointCoord.xy;
        uv -= vec2(0.5);
        float dist = sqrt(dot(uv, uv));

        float dr = uDiscRadius * vSeeds.x;
        float t = smoothstep(dr+uBorderSize, dr-uBorderSize, dist);
        float t1 = smoothstep(uDiscRadius1 + uBorderSize1, uDiscRadius1 - uBorderSize1, dist);
        
        vec3 color = mix(vColor.xyz, uColor1, vSeeds.z);
        float a = vColor.a * (t+t1) * uAlpha;
        a *= .3 + ((sin(((uTime * 1.) + vSeeds.w) * 6.28) + 1.) * .5) * .7;
        a *= .6 + ((sin(((uTime * 2.) + vSeeds.z) * 6.28) + 1.) * .5) * .5;
        color += a;

        float fogDistance = length(vWorldPosition);
        float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
        fogAmount = clamp(fogAmount, 0., 1.) * uFogFactor;
        color = mix(color, uFogColor, fogAmount);

        
        a *= smoothstep(1., .97, fogAmount);

        gl_FragColor = vec4(color, a);
    }

<% } %>`,y_=`<% if (vert) { %>

    precision highp float;

    #define PI 3.14159265359

    <%= commons.pnoise %>

    
    
    
    #define M_PI 3.1415926535897932384626433832795

    attribute vec3 position;
    attribute vec4 seeds;

    uniform mat4 modelMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    uniform vec3  uColor;
    uniform float uPixelRatio;
    uniform float uTime;
    uniform float uTimeScale;
    uniform float uNoiseIntensity;
    uniform float uNoiseFrequency;
    uniform float uFadeDistance;
    uniform float uParticleScale;
    uniform float uParticleOpacity;

    varying vec4  vColor;
    varying vec4  vDebugColor;
    varying vec4  vSeeds;
    varying vec3  vViewspacePosition;
    varying vec4  vWorldPosition;

    mat4 rotationMatrix(vec3 axis, float angle) {
        axis = normalize(axis);
        float s = sin(angle);
        float c = cos(angle);
        float oc = 1.0 - c;
        
        return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
                    oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
                    oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
                    0.0,                                0.0,                                0.0,                                1.0);
    }

    vec3 rotate(vec3 v, vec3 axis, float angle) {
        mat4 m = rotationMatrix(axis, angle);
        return (m * vec4(v, 1.0)).xyz;
    }

    float map(float value, float min1, float max1, float min2, float max2) {
        return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
    }

    void main(void) {

        vSeeds = seeds;

        
        vec3 newPosition  = position;
        vec3 displacement = vec3(
            pnoise(uNoiseFrequency * position + vec3(0., uTime * uTimeScale, 0.), vec3(101.0)) * uNoiseIntensity,
            pnoise(uNoiseFrequency * position + vec3(0., uTime * uTimeScale, 0.), vec3(202.0)) * uNoiseIntensity,
            pnoise(uNoiseFrequency * position + vec3(0., uTime * uTimeScale, 0.), vec3(303.0)) * uNoiseIntensity
        );
        newPosition += displacement;

        vColor = vec4(uColor, uParticleOpacity);

        vec4 viewSpace  = modelViewMatrix * vec4(newPosition, 1.0);
        vViewspacePosition = viewSpace.xyz;

        gl_Position = projectionMatrix * viewSpace;
        gl_PointSize = uPixelRatio * uParticleScale;
        
        float dist = length(viewSpace);
        gl_PointSize = gl_PointSize / length(dist);

        vWorldPosition = modelMatrix * vec4(newPosition, 1.0);
    }

<% } %>

<% if (frag) { %>
    precision highp float;

    #define PI 3.14159265359

    varying vec4  vColor;
    varying vec4  vDebugColor;
    varying vec4  vSeeds;
    varying vec3  vViewspacePosition;
    varying vec4  vWorldPosition;

    uniform float uTime;
    uniform float uAlpha;
    uniform vec3 uColor1;

    uniform float uFogFactor;
    uniform vec3 uFogColor;
    uniform float uFogNear;
    uniform float uFogFar;
    uniform vec3 uParentPosition;
    uniform float uDistanceFade;
    uniform vec3 uDistanceFadeColor;
    uniform float uOpacityTimescale;

    uniform float uBorderSize;
    uniform float uDiscRadius;
    uniform float uBorderSize1;
    uniform float uDiscRadius1;

    
    
    
    

    void main() {
        vec2 uv = gl_PointCoord.xy;
        uv -= vec2(0.5);
        float dist = sqrt(dot(uv, uv));

        float dr = uDiscRadius * vSeeds.x;
        float t = smoothstep(dr+uBorderSize, dr-uBorderSize, dist);
        float t1 = smoothstep(uDiscRadius1+uBorderSize1, uDiscRadius1-uBorderSize1, dist);
        
        vec3 color = mix(vColor.xyz, uColor1, clamp(vSeeds.z, 0., 1.));
        float a = vColor.a * (t+t1) * uAlpha;
        a *= .3 + ((sin(((uTime * uOpacityTimescale * 1.) + vSeeds.w) * 6.28) + 1.) * .5) * .7;
        a *= .6 + ((sin(((uTime * uOpacityTimescale * 2.) + vSeeds.z) * 6.28) + 1.) * .5) * .5;
        color += a;

        float fogDistance = length(vViewspacePosition);
        float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);
        fogAmount = clamp(fogAmount, 0., 1.) * uFogFactor;

        

        a *= smoothstep(1., .97, fogAmount);

        
        

        
        gl_FragColor = vec4(color, a);

        
        
        
    }

<% } %>`,C_=`<% if (vert) { %>
  needES300 precision highp float;

  #define PI 3.14159265359

  in vec3 position;
  in vec2 uv;

  uniform mat4 modelViewMatrix;
  uniform mat4 projectionMatrix;
  
  uniform float uDeformFactor;

  out vec2 vUv;

  void main() {
    vUv = uv;

    vec3 offsetPosition = position;
    offsetPosition.z += sin(uv.x * PI) * uDeformFactor;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(offsetPosition, 1.0);
  }
<% } %>

<% if (frag) { %>
  needES300
  precision highp float; 

  in vec2 vUv;

  uniform sampler2D uTexture;
  uniform float uAlpha;

  #ifdef HAS_COLOR_CORRECTION
    uniform float uTintOpacity;
    uniform float uExposure;
    uniform float uContrast;
    uniform float uSaturation;
    uniform vec3 uTint;

    vec3 contrast(vec3 color, float value) {
      return clamp(0.5 + (1.0 + value) * (color - 0.5), vec3(0.), vec3(1.));
    }

    vec3 exposure(vec3 color, float value) {
      return (1.0 + value) * color;
    }

    vec3 czm_saturation(vec3 rgb, float adjustment) {
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      vec3 intensity = vec3(dot(rgb, W));
      return mix(intensity, rgb, adjustment);
    }
  #endif

  out vec4 outColor;

  void main() { 
    vec4 texel = texture(uTexture, vUv);

    
    #ifdef HAS_COLOR_CORRECTION
      texel.rgb = czm_saturation(texel.rgb, uSaturation);
      texel.rgb = contrast(texel.rgb, uContrast);
      texel.rgb = exposure(texel.rgb, uExposure);
      texel.rgb = mix(texel.rgb, uTint, uTintOpacity);
    #endif
    
    
    #ifdef IS_WEBGL_1
      gl_FragColor = vec4(texel.rgb, texel.a * uAlpha);
    #else
      outColor = vec4(texel.rgb, texel.a * uAlpha);
    #endif
  } 
<% } %>`,S_=`<% if (vert) { %>

    precision highp float;

    #define M_PI 3.1415926535897932384626433832795

    attribute vec3 position;
    attribute vec2 seeds;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    uniform float uPixelRatio;
    uniform float uParticleScale;
    uniform vec3 uVelocity;

    varying vec2  vSeeds;
    varying vec3  vWorldPosition;

    uniform float uSize;

    void main(void) {

        vSeeds = seeds;

        
        vec3 newPosition = position;
        newPosition += uVelocity;

        vec4 viewSpace = modelViewMatrix * vec4(newPosition, 1.0);
        float dist = length(viewSpace);
        vWorldPosition = viewSpace.xyz;

        gl_Position = projectionMatrix * viewSpace;
        gl_PointSize = uPixelRatio * uParticleScale;
        gl_PointSize /= length(dist);

    }

<% } %>

<% if (frag) { %>

    precision highp float;

    varying vec2  vSeeds;
    varying vec3  vWorldPosition;

    uniform float uTime;
    uniform float uOpacity;
    uniform vec3 uColor;
    uniform vec3 uColor1;
    uniform float uOpacityTimescale;

    uniform float uFogFactor;
    uniform vec3 uFogColor;
    uniform float uFogNear;
    uniform float uFogFar;

    uniform float uBorderSize;
    uniform float uDiscRadius;
    uniform float uBorderSize1;
    uniform float uDiscRadius1;

    void main() {
        vec2 uv = gl_PointCoord.xy;
        uv -= vec2(0.5);
        float dist = sqrt(dot(uv, uv));

        float dr = uDiscRadius * vSeeds.x;
        float t = smoothstep(dr+uBorderSize, dr-uBorderSize, dist);
        float t1 = smoothstep(uDiscRadius1+uBorderSize1, uDiscRadius1-uBorderSize1, dist);
        
        vec3 color = mix(uColor, uColor1, clamp(vSeeds.y, 0., 1.));
        float a = (t+t1) * uOpacity;
        a *= .3 + ((sin(((uTime * uOpacityTimescale * 1.) + vSeeds.x) * 6.28) + 1.) * .5) * .7;
        a *= .6 + ((sin(((uTime * uOpacityTimescale * 2.) + vSeeds.y) * 6.28) + 1.) * .5) * .5;
        color += a;

        
        
        
        

        
        

        gl_FragColor = vec4(color, a);
        
    }

<% } %>`,w_=`<% if (vert) { %>
  
    precision highp float; 

    attribute vec3 position;
    attribute vec2 seeds;
    attribute float distanceRadius;
    attribute float sparkFactor;

    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    
    uniform float uPixelRatio;
    uniform float uParticleScale;
    uniform vec3 uVelocity;
    uniform float uTime;
    uniform float uUpperBound;
    uniform sampler2D uFBM;
    uniform float uConeShapeFactor;
    uniform float uNoiseFrequency;
    uniform float uNoiseAmplitude;
    uniform float uSparkSize;
    uniform vec3  uOffset;

    varying float vAlpha;
    varying vec4 vDebugColor;
    varying float vDistanceRadius;
    varying float vDistanceToTop;
    varying float vSparkFactor;
    varying vec3  vViewspacePosition;

    float map(float value, float min1, float max1, float min2, float max2) {
        return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
    }

    float quadraticIn(float t) {
        return t * t;
    }

    float cubicOut(float t) {
        float f = t - 1.0;
        return f * f * f + 1.0;
    }

    
    
    vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }

    float snoise(vec2 v){
        const vec4 C = vec4(0.211324865405187, 0.366025403784439,
                -0.577350269189626, 0.024390243902439);
        vec2 i  = floor(v + dot(v, C.yy) );
        vec2 x0 = v -   i + dot(i, C.xx);
        vec2 i1;
        i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
        vec4 x12 = x0.xyxy + C.xxzz;
        x12.xy -= i1;
        i = mod(i, 289.0);
        vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
        + i.x + vec3(0.0, i1.x, 1.0 ));
        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),
            dot(x12.zw,x12.zw)), 0.0);
        m = m*m ;
        m = m*m ;
        vec3 x = 2.0 * fract(p * C.www) - 1.0;
        vec3 h = abs(x) - 0.5;
        vec3 ox = floor(x + 0.5);
        vec3 a0 = x - ox;
        m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
        vec3 g;
        g.x  = a0.x  * x0.x  + h.x  * x0.y;
        g.yz = a0.yz * x12.xz + h.yz * x12.yw;
        return 130.0 * dot(m, g);
    }

    void main(){

        vec3 newPosition = position;

        
        newPosition += uVelocity * (1. - seeds.x + 0.5);
        
        
        newPosition.y *= (1. + sparkFactor * 2.2);

        
        newPosition.y = mod(newPosition.y, uUpperBound - pow(distanceRadius, uConeShapeFactor));

        
        float distanceToTop = abs(newPosition.y - (uUpperBound - pow(distanceRadius, uConeShapeFactor)));
        float distanceToCenter = (1.6 - distanceRadius);
        
        
        float noise = snoise(vec2(seeds.y + uTime * seeds.x * uNoiseFrequency)) * uNoiseAmplitude;
        noise *= 1. - distanceToTop;
        
        noise *= (1. + sparkFactor * 1.);
        newPosition += vec3(noise, 0., 0.);

        
        float windAmount = map(newPosition.y, 0., uUpperBound, 0., 1.);
        float windAmountIn = quadraticIn(windAmount);
        newPosition.x += uOffset.x * windAmountIn;
        newPosition.y += uOffset.y * cubicOut(windAmount);
        newPosition.z += uOffset.z * windAmountIn;

        
        float bottomSpawnDistance = .1;
        vAlpha = distanceToTop * distanceToCenter;
        vSparkFactor = sparkFactor;
        vDistanceRadius = distanceRadius;
        vDistanceToTop = distanceToTop;

        vec4 viewSpace  = modelViewMatrix * vec4(newPosition, 1.0);
        float dist = length(viewSpace);

        vViewspacePosition = viewSpace.xyz;

        gl_Position = projectionMatrix * viewSpace;

        gl_PointSize = uPixelRatio * uParticleScale * distanceToTop * distanceToCenter;
        gl_PointSize /= length(dist);
        
        gl_PointSize = mix(gl_PointSize, uPixelRatio * uSparkSize * 10., sparkFactor);

        
        

    }

<% } %>

<% if (frag) { %>

    precision highp float; 
    
    uniform float uOpacity;
    uniform vec3 uCenterColor;
    uniform vec3 uOutsideColor;
    uniform vec3 uSparkColor;
    uniform float uSparkOpacity;
    uniform sampler2D uTexture;
    uniform float uFogNear;
    uniform float uFogFar;
    uniform vec3 uFogColor;
    uniform vec3 uOffset;

    varying float vAlpha;
    varying vec4 vDebugColor;
    varying float vDistanceRadius;
    varying float vSparkFactor;
    varying float vDistanceToTop;
    varying vec3 vViewspacePosition;

    void main() { 

        vec4 texel = texture2D(uTexture, gl_PointCoord);
        vec3 baseColor = mix(uCenterColor, uOutsideColor, vDistanceRadius);
        vec3 heightColor = mix(baseColor, uOutsideColor, 1.-vDistanceToTop);

        
        vec3 finalColor = mix(heightColor, uSparkColor, vSparkFactor);
        
        float baseAlpha = texel.a * vAlpha * uOpacity;
        
        float finalAlpha = mix(baseAlpha, texel.a * uOpacity * vAlpha * uSparkOpacity, vSparkFactor);

        
        float fogDistance = length(vViewspacePosition);
        float fogAmount = smoothstep(uFogNear, uFogFar, fogDistance);

        finalColor = mix(finalColor, uFogColor, fogAmount);
        finalAlpha *= smoothstep(1., .97, fogAmount);

        gl_FragColor = vec4(texel.rgb * finalColor, finalAlpha);
        
        
        

    } 
        
<% } %>`,A_=`mat4 rotationMatrix(vec3 axis, float angle) {
    axis = normalize(axis);
    float s = sin(angle);
    float c = cos(angle);
    float oc = 1.0 - c;
    
    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
                0.0,                                0.0,                                0.0,                                1.0);
}

vec3 rotate(vec3 v, vec3 axis, float angle) {
    mat4 m = rotationMatrix(axis, angle);
    return (m * vec4(v, 1.0)).xyz;
}`,E_=`vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3333333333333333) * direction;
  color += texture2D(image, uv) * 0.29411764705882354;
  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;
  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;
  return color; 
}

vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}`,T_=`float blendColorDodge_14_0(float base, float blend) {
	return (blend==1.0)?blend:min(base/(1.0-blend),1.0);
}

vec3 blendColorDodge_14_0(vec3 base, vec3 blend) {
	return vec3(blendColorDodge_14_0(base.r,blend.r),blendColorDodge_14_0(base.g,blend.g),blendColorDodge_14_0(base.b,blend.b));
}

vec3 blendColorDodge_14_0(vec3 base, vec3 blend, float opacity) {
	return (blendColorDodge_14_0(base, blend) * opacity + base * (1.0 - opacity));
}

float blendColorBurn_15_1(float base, float blend) {
	return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);
}

vec3 blendColorBurn_15_1(vec3 base, vec3 blend) {
	return vec3(blendColorBurn_15_1(base.r,blend.r),blendColorBurn_15_1(base.g,blend.g),blendColorBurn_15_1(base.b,blend.b));
}

vec3 blendColorBurn_15_1(vec3 base, vec3 blend, float opacity) {
	return (blendColorBurn_15_1(base, blend) * opacity + base * (1.0 - opacity));
}

float blendVividLight_3_2(float base, float blend) {
	return (blend<0.5)?blendColorBurn_15_1(base,(2.0*blend)):blendColorDodge_14_0(base,(2.0*(blend-0.5)));
}

vec3 blendVividLight_3_2(vec3 base, vec3 blend) {
	return vec3(blendVividLight_3_2(base.r,blend.r),blendVividLight_3_2(base.g,blend.g),blendVividLight_3_2(base.b,blend.b));
}

vec3 blendVividLight_3_2(vec3 base, vec3 blend, float opacity) {
	return (blendVividLight_3_2(base, blend) * opacity + base * (1.0 - opacity));
}

float blendHardMix_2_3(float base, float blend) {
	return (blendVividLight_3_2(base,blend)<0.5)?0.0:1.0;
}

vec3 blendHardMix_2_3(vec3 base, vec3 blend) {
	return vec3(blendHardMix_2_3(base.r,blend.r),blendHardMix_2_3(base.g,blend.g),blendHardMix_2_3(base.b,blend.b));
}

vec3 blendHardMix_2_3(vec3 base, vec3 blend, float opacity) {
	return (blendHardMix_2_3(base, blend) * opacity + base * (1.0 - opacity));
}

float blendLinearDodge_12_4(float base, float blend) {
	
	return min(base+blend,1.0);
}

vec3 blendLinearDodge_12_4(vec3 base, vec3 blend) {
	
	return min(base+blend,vec3(1.0));
}

vec3 blendLinearDodge_12_4(vec3 base, vec3 blend, float opacity) {
	return (blendLinearDodge_12_4(base, blend) * opacity + base * (1.0 - opacity));
}

float blendLinearBurn_13_5(float base, float blend) {
	
	return max(base+blend-1.0,0.0);
}

vec3 blendLinearBurn_13_5(vec3 base, vec3 blend) {
	
	return max(base+blend-vec3(1.0),vec3(0.0));
}

vec3 blendLinearBurn_13_5(vec3 base, vec3 blend, float opacity) {
	return (blendLinearBurn_13_5(base, blend) * opacity + base * (1.0 - opacity));
}

float blendLinearLight_4_6(float base, float blend) {
	return blend<0.5?blendLinearBurn_13_5(base,(2.0*blend)):blendLinearDodge_12_4(base,(2.0*(blend-0.5)));
}

vec3 blendLinearLight_4_6(vec3 base, vec3 blend) {
	return vec3(blendLinearLight_4_6(base.r,blend.r),blendLinearLight_4_6(base.g,blend.g),blendLinearLight_4_6(base.b,blend.b));
}

vec3 blendLinearLight_4_6(vec3 base, vec3 blend, float opacity) {
	return (blendLinearLight_4_6(base, blend) * opacity + base * (1.0 - opacity));
}

float blendLighten_16_7(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten_16_7(vec3 base, vec3 blend) {
	return vec3(blendLighten_16_7(base.r,blend.r),blendLighten_16_7(base.g,blend.g),blendLighten_16_7(base.b,blend.b));
}

vec3 blendLighten_16_7(vec3 base, vec3 blend, float opacity) {
	return (blendLighten_16_7(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken_17_8(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken_17_8(vec3 base, vec3 blend) {
	return vec3(blendDarken_17_8(base.r,blend.r),blendDarken_17_8(base.g,blend.g),blendDarken_17_8(base.b,blend.b));
}

vec3 blendDarken_17_8(vec3 base, vec3 blend, float opacity) {
	return (blendDarken_17_8(base, blend) * opacity + base * (1.0 - opacity));
}

float blendPinLight_5_9(float base, float blend) {
	return (blend<0.5)?blendDarken_17_8(base,(2.0*blend)):blendLighten_16_7(base,(2.0*(blend-0.5)));
}

vec3 blendPinLight_5_9(vec3 base, vec3 blend) {
	return vec3(blendPinLight_5_9(base.r,blend.r),blendPinLight_5_9(base.g,blend.g),blendPinLight_5_9(base.b,blend.b));
}

vec3 blendPinLight_5_9(vec3 base, vec3 blend, float opacity) {
	return (blendPinLight_5_9(base, blend) * opacity + base * (1.0 - opacity));
}

float blendReflect_18_10(float base, float blend) {
	return (blend==1.0)?blend:min(base*base/(1.0-blend),1.0);
}

vec3 blendReflect_18_10(vec3 base, vec3 blend) {
	return vec3(blendReflect_18_10(base.r,blend.r),blendReflect_18_10(base.g,blend.g),blendReflect_18_10(base.b,blend.b));
}

vec3 blendReflect_18_10(vec3 base, vec3 blend, float opacity) {
	return (blendReflect_18_10(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendGlow_6_11(vec3 base, vec3 blend) {
	return blendReflect_18_10(blend,base);
}

vec3 blendGlow_6_11(vec3 base, vec3 blend, float opacity) {
	return (blendGlow_6_11(base, blend) * opacity + base * (1.0 - opacity));
}

float blendOverlay_9_12(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay_9_12(vec3 base, vec3 blend) {
	return vec3(blendOverlay_9_12(base.r,blend.r),blendOverlay_9_12(base.g,blend.g),blendOverlay_9_12(base.b,blend.b));
}

vec3 blendOverlay_9_12(vec3 base, vec3 blend, float opacity) {
	return (blendOverlay_9_12(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendHardLight_7_13(vec3 base, vec3 blend) {
	return blendOverlay_9_12(blend,base);
}

vec3 blendHardLight_7_13(vec3 base, vec3 blend, float opacity) {
	return (blendHardLight_7_13(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendPhoenix_8_14(vec3 base, vec3 blend) {
	return min(base,blend)-max(base,blend)+vec3(1.0);
}

vec3 blendPhoenix_8_14(vec3 base, vec3 blend, float opacity) {
	return (blendPhoenix_8_14(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendNormal_10_15(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal_10_15(vec3 base, vec3 blend, float opacity) {
	return (blendNormal_10_15(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendNegation_11_16(vec3 base, vec3 blend) {
	return vec3(1.0)-abs(vec3(1.0)-base-blend);
}

vec3 blendNegation_11_16(vec3 base, vec3 blend, float opacity) {
	return (blendNegation_11_16(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendMultiply_19_17(vec3 base, vec3 blend) {
	return base*blend;
}

vec3 blendMultiply_19_17(vec3 base, vec3 blend, float opacity) {
	return (blendMultiply_19_17(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendAverage_20_18(vec3 base, vec3 blend) {
	return (base+blend)/2.0;
}

vec3 blendAverage_20_18(vec3 base, vec3 blend, float opacity) {
	return (blendAverage_20_18(base, blend) * opacity + base * (1.0 - opacity));
}

float blendScreen_21_19(float base, float blend) {
	return 1.0-((1.0-base)*(1.0-blend));
}

vec3 blendScreen_21_19(vec3 base, vec3 blend) {
	return vec3(blendScreen_21_19(base.r,blend.r),blendScreen_21_19(base.g,blend.g),blendScreen_21_19(base.b,blend.b));
}

vec3 blendScreen_21_19(vec3 base, vec3 blend, float opacity) {
	return (blendScreen_21_19(base, blend) * opacity + base * (1.0 - opacity));
}

float blendSoftLight_22_20(float base, float blend) {
	return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));
}

vec3 blendSoftLight_22_20(vec3 base, vec3 blend) {
	return vec3(blendSoftLight_22_20(base.r,blend.r),blendSoftLight_22_20(base.g,blend.g),blendSoftLight_22_20(base.b,blend.b));
}

vec3 blendSoftLight_22_20(vec3 base, vec3 blend, float opacity) {
	return (blendSoftLight_22_20(base, blend) * opacity + base * (1.0 - opacity));
}

float blendSubtract_23_21(float base, float blend) {
	return max(base+blend-1.0,0.0);
}

vec3 blendSubtract_23_21(vec3 base, vec3 blend) {
	return max(base+blend-vec3(1.0),vec3(0.0));
}

vec3 blendSubtract_23_21(vec3 base, vec3 blend, float opacity) {
	return (blendSubtract_23_21(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendExclusion_24_22(vec3 base, vec3 blend) {
	return base+blend-2.0*base*blend;
}

vec3 blendExclusion_24_22(vec3 base, vec3 blend, float opacity) {
	return (blendExclusion_24_22(base, blend) * opacity + base * (1.0 - opacity));
}

vec3 blendDifference_25_23(vec3 base, vec3 blend) {
	return abs(base-blend);
}

vec3 blendDifference_25_23(vec3 base, vec3 blend, float opacity) {
	return (blendDifference_25_23(base, blend) * opacity + base * (1.0 - opacity));
}

float blendAdd_26_24(float base, float blend) {
	return min(base+blend,1.0);
}

vec3 blendAdd_26_24(vec3 base, vec3 blend) {
	return min(base+blend,vec3(1.0));
}

vec3 blendAdd_26_24(vec3 base, vec3 blend, float opacity) {
	return (blendAdd_26_24(base, blend) * opacity + base * (1.0 - opacity));
}

float Color_GetLuminosity(vec3 c) {
	return 0.3*c.r + 0.59*c.g + 0.11*c.b;
}

vec3 Color_SetLuminosity(vec3 c, float lum) {
    float d = lum - Color_GetLuminosity(c);
    c.rgb += vec3(d,d,d);

	
	lum = Color_GetLuminosity(c);
    float cMin = min(c.r, min(c.g, c.b));
    float cMax = max(c.r, max(c.g, c.b));

    if(cMin < 0.)
        c = mix(vec3(lum,lum,lum), c, lum / (lum - cMin));

    if(cMax > 1.)
        c = mix(vec3(lum,lum,lum), c, (1. - lum) / (cMax - lum));

    return c;
}

vec3 blendLuminosity(vec3 base, vec3 blend) {
	return Color_SetLuminosity(base, Color_GetLuminosity(blend));
}

vec3 blendLuminosity(vec3 base, vec3 blend, float opacity) {
	return Color_SetLuminosity(base, Color_GetLuminosity(blend)) * opacity + base * (1.0 - opacity);
}

vec3 blendMode_1_25( int mode, vec3 base, vec3 blend ){
	if( mode == 1 ){
		return blendAdd_26_24( base, blend );
	}else
	if( mode == 2 ){
		return blendAverage_20_18( base, blend );
	}else
	if( mode == 3 ){
		return blendColorBurn_15_1( base, blend );
	}else
	if( mode == 4 ){
		return blendColorDodge_14_0( base, blend );
	}else
	if( mode == 5 ){
		return blendDarken_17_8( base, blend );
	}else
	if( mode == 6 ){
		return blendDifference_25_23( base, blend );
	}else
	if( mode == 7 ){
		return blendExclusion_24_22( base, blend );
	}else
	if( mode == 8 ){
		return blendGlow_6_11( base, blend );
	}else
	if( mode == 9 ){
		return blendHardLight_7_13( base, blend );
	}else
	if( mode == 10 ){
		return blendHardMix_2_3( base, blend );
	}else
	if( mode == 11 ){
		return blendLighten_16_7( base, blend );
	}else
	if( mode == 12 ){
		return blendLinearBurn_13_5( base, blend );
	}else
	if( mode == 13 ){
		return blendLinearDodge_12_4( base, blend );
	}else
	if( mode == 14 ){
		return blendLinearLight_4_6( base, blend );
	}else
	if( mode == 15 ){
		return blendMultiply_19_17( base, blend );
	}else
	if( mode == 16 ){
		return blendNegation_11_16( base, blend );
	}else
	if( mode == 17 ){
		return blendNormal_10_15( base, blend );
	}else
	if( mode == 18 ){
		return blendOverlay_9_12( base, blend );
	}else
	if( mode == 19 ){
		return blendPhoenix_8_14( base, blend );
	}else
	if( mode == 20 ){
		return blendPinLight_5_9( base, blend );
	}else
	if( mode == 21 ){
		return blendReflect_18_10( base, blend );
	}else
	if( mode == 22 ){
		return blendScreen_21_19( base, blend );
	}else
	if( mode == 23 ){
		return blendSoftLight_22_20( base, blend );
	}else
	if( mode == 24 ){
		return blendSubtract_23_21( base, blend );
	}else
	if( mode == 25 ){
		return blendVividLight_3_2( base, blend );
	}
}

vec3 blendMode_1_25( int mode, vec3 base, vec3 blend, float opacity ){
	if( mode == 1 ){
		return blendAdd_26_24( base, blend, opacity );
	}else
	if( mode == 2 ){
		return blendAverage_20_18( base, blend, opacity );
	}else
	if( mode == 3 ){
		return blendColorBurn_15_1( base, blend, opacity );
	}else
	if( mode == 4 ){
		return blendColorDodge_14_0( base, blend, opacity );
	}else
	if( mode == 5 ){
		return blendDarken_17_8( base, blend, opacity );
	}else
	if( mode == 6 ){
		return blendDifference_25_23( base, blend, opacity );
	}else
	if( mode == 7 ){
		return blendExclusion_24_22( base, blend, opacity );
	}else
	if( mode == 8 ){
		return blendGlow_6_11( base, blend, opacity );
	}else
	if( mode == 9 ){
		return blendHardLight_7_13( base, blend, opacity );
	}else
	if( mode == 10 ){
		return blendHardMix_2_3( base, blend, opacity );
	}else
	if( mode == 11 ){
		return blendLighten_16_7( base, blend, opacity );
	}else
	if( mode == 12 ){
		return blendLinearBurn_13_5( base, blend, opacity );
	}else
	if( mode == 13 ){
		return blendLinearDodge_12_4( base, blend, opacity );
	}else
	if( mode == 14 ){
		return blendLinearLight_4_6( base, blend, opacity );
	}else
	if( mode == 15 ){
		return blendMultiply_19_17( base, blend, opacity );
	}else
	if( mode == 16 ){
		return blendNegation_11_16( base, blend, opacity );
	}else
	if( mode == 17 ){
		return blendNormal_10_15( base, blend, opacity );
	}else
	if( mode == 18 ){
		return blendOverlay_9_12( base, blend, opacity );
	}else
	if( mode == 19 ){
		return blendPhoenix_8_14( base, blend, opacity );
	}else
	if( mode == 20 ){
		return blendPinLight_5_9( base, blend, opacity );
	}else
	if( mode == 21 ){
		return blendReflect_18_10( base, blend, opacity );
	}else
	if( mode == 22 ){
		return blendScreen_21_19( base, blend, opacity );
	}else
	if( mode == 23 ){
		return blendSoftLight_22_20( base, blend, opacity );
	}else
	if( mode == 24 ){
		return blendSubtract_23_21( base, blend, opacity );
	}else
	if( mode == 25 ){
		return blendVividLight_3_2( base, blend, opacity );
	}
}`,M_=`vec3 mod289(vec3 x)
{
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec4 mod289(vec4 x)
{
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec4 permute(vec4 x)
{
  return mod289(((x*34.0)+1.0)*x);
}

vec4 taylorInvSqrt(vec4 r)
{
  return 1.79284291400159 - 0.85373472095314 * r;
}

vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

float pnoise(vec3 P, vec3 rep)
{
  vec3 Pi0 = mod(floor(P), rep); 
  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); 
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); 
  vec3 Pf1 = Pf0 - vec3(1.0); 
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
  return 2.2 * n_xyz;
}`;const ce={unlit:i_,unlitCloud:s_,background:r_,standard:u_,standardFlag:c_,standardTapestry:h_,standardEmissive:p_,standardEmissiveBrazier:d_,mergedStandard:m_,mergedOcculter:__,basicOcculter:b_,lightPlane:a_,post:o_,postBlur:l_,fairyDust:x_,spritesheet:f_,mergedUnlit:v_,sphereParticles:y_,curvedPlane:C_,introParticles:S_,simplerFireParticles:w_,lettersMergedUnlit:g_,commons:{rotation:A_,blur:E_,pnoise:M_,allBlendModes:T_}};class ve{constructor(e,t=1,i={}){this.string=e,this.defines=i;let s=function(_){let v="";for(let g in _)v+="#define "+g+" "+_[g]+`
`;return v},r={},o=Pl.render(this.string,{frag:!0,vert:!1,passes:r,commons:ce.commons,defines:i}),c=Pl.render(this.string,{frag:!1,vert:!0,passes:r,commons:ce.commons,defines:i});Gd.gl;let p="";o=o.replaceAll("&lt;","<"),c=c.replaceAll("&lt;","<"),o=o.replaceAll("&gt;",">"),c=c.replaceAll("&gt;",">"),e.includes("needES300")&&(e=e.replaceAll("needES300",""),o=o.replaceAll("needES300",""),c=c.replaceAll("needES300",""),Gd.renderer.isWebgl2?p+=`#version 300 es
`:(this.defines.IS_WEBGL_1=1,p+=`#extension GL_OES_standard_derivatives : enable
`,c=c.replaceAll("texture(","texture2D("),c=c.replaceAll("in ","attribute "),c=c.replaceAll("out ","varying "),o=o.replaceAll("texture(","texture2D("),o=o.replaceAll("in ","varying "),o=o.replaceAll("out ","// ")));let m=s(this.defines);if(t>1){this.passes=[];for(let _=0;_<t-1;_++){r["pass_"+(_+1)]=!0;let v=Pl.render(this.string,{frag:!1,vert:!1,passes:r,commons:ce.commons,defines:i});v=v.replaceAll("&lt;","<"),v=v.replaceAll("&gt;",">"),this.passes.push(p+m+v),r["pass_"+(_+1)]=!1}}this.frag=p+m+o,this.vert=p+m+c}}const kh=new q;let B_=1,P_=1,zh=!1;class ht{constructor(e,t={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=t,this.id=B_++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let i in t)this.addAttribute(i,t[i])}addAttribute(e,t){if(this.attributes[e]=t,t.id=P_++,t.size=t.size||1,t.type=t.type||(t.data.constructor===Float32Array?this.gl.FLOAT:t.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),t.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,t.normalized=t.normalized||!1,t.stride=t.stride||0,t.offset=t.offset||0,t.count=t.count||(t.stride?t.data.byteLength/t.stride:t.data.length/t.size),t.divisor=t.instanced||0,t.needsUpdate=!1,t.buffer||(t.buffer=this.gl.createBuffer(),this.updateAttribute(t)),t.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==t.count*t.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,t.count*t.divisor);this.instancedCount=t.count*t.divisor}else e==="index"?this.drawRange.count=t.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,t.count))}updateAttribute(e){this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),this.gl.bufferData(e.target,e.data,this.gl.STATIC_DRAW),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((t,{name:i,type:s})=>{if(!this.attributes[i]){console.warn(`active attribute ${i} not being supplied`);return}const r=this.attributes[i];this.gl.bindBuffer(r.target,r.buffer),this.glState.boundBuffer=r.buffer;let o=1;s===35674&&(o=2),s===35675&&(o=3),s===35676&&(o=4);const c=r.size/o,p=o===1?0:o*o*o,m=o===1?0:o*o;for(let _=0;_<o;_++)this.gl.vertexAttribPointer(t+_,c,r.type,r.normalized,r.stride+p,r.offset+_*m),this.gl.enableVertexAttribArray(t+_),this.gl.renderer.vertexAttribDivisor(t+_,r.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:t=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((i,{name:s})=>{const r=this.attributes[s];r.needsUpdate&&this.updateAttribute(r)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*2,this.instancedCount):this.gl.renderer.drawArraysInstanced(t,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*2):this.gl.drawArrays(t,this.drawRange.start,this.drawRange.count)}getPosition(){const e=this.attributes.position;if(e.data)return e;if(!zh)return console.warn("No position buffer data found to compute bounds"),zh=!0}computeBoundingBox(e){e||(e=this.getPosition());const t=e.data,i=e.offset||0,s=e.stride||e.size;this.bounds||(this.bounds={min:new q,max:new q,center:new q,scale:new q,radius:1/0});const r=this.bounds.min,o=this.bounds.max,c=this.bounds.center,p=this.bounds.scale;r.set(1/0),o.set(-1/0);for(let m=i,_=t.length;m<_;m+=s){const v=t[m],g=t[m+1],C=t[m+2];r.x=Math.min(v,r.x),r.y=Math.min(g,r.y),r.z=Math.min(C,r.z),o.x=Math.max(v,o.x),o.y=Math.max(g,o.y),o.z=Math.max(C,o.z)}p.sub(o,r),c.add(r,o).divide(2)}computeBoundingSphere(e){e||(e=this.getPosition());const t=e.data,i=e.offset||0,s=e.stride||e.size;this.bounds||this.computeBoundingBox(e);let r=0;for(let o=i,c=t.length;o<c;o+=s)kh.fromArray(t,o),r=Math.max(r,this.bounds.center.squaredDistance(kh));this.bounds.radius=Math.sqrt(r)}remove(){for(let e in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[e]),delete this.VAOs[e];for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}class vi extends ht{constructor(e,{width:t=1,height:i=1,widthSegments:s=1,heightSegments:r=1,attributes:o={}}={}){const c=s,p=r,m=(c+1)*(p+1),_=c*p*6,v=new Float32Array(m*3),g=new Float32Array(m*3),C=new Float32Array(m*2),S=_>65536?new Uint32Array(_):new Uint16Array(_);vi.buildPlane(v,g,C,S,t,i,0,c,p),Object.assign(o,{position:{size:3,data:v},normal:{size:3,data:g},uv:{size:2,data:C},index:{data:S}}),super(e,o)}static buildPlane(e,t,i,s,r,o,c,p,m,_=0,v=1,g=2,C=1,S=-1,E=0,T=0){const M=E,W=r/p,B=o/m;for(let O=0;O<=m;O++){let L=O*B-o/2;for(let H=0;H<=p;H++,E++){let G=H*W-r/2;if(e[E*3+_]=G*C,e[E*3+v]=L*S,e[E*3+g]=c/2,t[E*3+_]=0,t[E*3+v]=0,t[E*3+g]=c>=0?1:-1,i[E*2]=H/p,i[E*2+1]=1-O/m,O===m||H===p)continue;let N=M+H+O*(p+1),U=M+H+(O+1)*(p+1),J=M+H+(O+1)*(p+1)+1,Q=M+H+O*(p+1)+1;s[T*6]=N,s[T*6+1]=U,s[T*6+2]=Q,s[T*6+3]=U,s[T*6+4]=J,s[T*6+5]=Q,T++}}}}var na={exports:{}};/*! Tweakpane 3.1.0 (c) 2016 cocopon, licensed under the MIT license. */(function(n,e){(function(t,i){i(e)})(qu,function(t){class i{constructor(a){const[l,d]=a.split("-"),y=l.split(".");this.major=parseInt(y[0],10),this.minor=parseInt(y[1],10),this.patch=parseInt(y[2],10),this.prerelease=d!=null?d:null}toString(){const a=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[a,this.prerelease].join("-"):a}}class s{constructor(a){this.controller_=a}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(a){this.controller_.viewProps.set("disabled",a)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(a){this.controller_.viewProps.set("hidden",a)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class r{constructor(a){this.target=a}}class o extends r{constructor(a,l,d,y){super(a),this.value=l,this.presetKey=d,this.last=y!=null?y:!0}}class c extends r{constructor(a,l,d){super(a),this.value=l,this.presetKey=d}}class p extends r{constructor(a,l){super(a),this.expanded=l}}class m extends r{constructor(a,l){super(a),this.index=l}}function _(u){return u}function v(u){return u==null}function g(u,a){if(u.length!==a.length)return!1;for(let l=0;l<u.length;l++)if(u[l]!==a[l])return!1;return!0}const C={alreadydisposed:()=>"View has been already disposed",invalidparams:u=>`Invalid parameters for '${u.name}'`,nomatchingcontroller:u=>`No matching controller for '${u.key}'`,nomatchingview:u=>`No matching view for '${JSON.stringify(u.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:u=>`Property '${u.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class S{constructor(a){var l;this.message=(l=C[a.type](a.context))!==null&&l!==void 0?l:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=a.type}static alreadyDisposed(){return new S({type:"alreadydisposed"})}static notBindable(){return new S({type:"notbindable"})}static propertyNotFound(a){return new S({type:"propertynotfound",context:{name:a}})}static shouldNeverHappen(){return new S({type:"shouldneverhappen"})}}class E{constructor(a,l,d){this.obj_=a,this.key_=l,this.presetKey_=d!=null?d:l}static isBindable(a){return!(a===null||typeof a!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(a){this.obj_[this.key_]=a}writeProperty(a,l){const d=this.read();if(!E.isBindable(d))throw S.notBindable();if(!(a in d))throw S.propertyNotFound(a);d[a]=l}}class T extends s{get label(){return this.controller_.props.get("label")}set label(a){this.controller_.props.set("label",a)}get title(){var a;return(a=this.controller_.valueController.props.get("title"))!==null&&a!==void 0?a:""}set title(a){this.controller_.valueController.props.set("title",a)}on(a,l){const d=l.bind(this);return this.controller_.valueController.emitter.on(a,()=>{d(new r(this))}),this}}class M{constructor(){this.observers_={}}on(a,l){let d=this.observers_[a];return d||(d=this.observers_[a]=[]),d.push({handler:l}),this}off(a,l){const d=this.observers_[a];return d&&(this.observers_[a]=d.filter(y=>y.handler!==l)),this}emit(a,l){const d=this.observers_[a];!d||d.forEach(y=>{y.handler(l)})}}const W="tp";function B(u){return(l,d)=>[W,"-",u,"v",l?`_${l}`:"",d?`-${d}`:""].join("")}function O(u,a){return l=>a(u(l))}function L(u){return u.rawValue}function H(u,a){u.emitter.on("change",O(L,a)),a(u.rawValue)}function G(u,a,l){H(u.value(a),l)}function N(u,a,l){l?u.classList.add(a):u.classList.remove(a)}function U(u,a){return l=>{N(u,a,l)}}function J(u,a){H(u,l=>{a.textContent=l!=null?l:""})}const Q=B("btn");class Y{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Q()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("button");d.classList.add(Q("b")),l.viewProps.bindDisabled(d),this.element.appendChild(d),this.buttonElement=d;const y=a.createElement("div");y.classList.add(Q("t")),J(l.props.value("title"),y),this.buttonElement.appendChild(y)}}class D{constructor(a,l){this.emitter=new M,this.onClick_=this.onClick_.bind(this),this.props=l.props,this.viewProps=l.viewProps,this.view=new Y(a,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class z{constructor(a,l){var d;this.constraint_=l==null?void 0:l.constraint,this.equals_=(d=l==null?void 0:l.equals)!==null&&d!==void 0?d:(y,A)=>y===A,this.emitter=new M,this.rawValue_=a}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(a){this.setRawValue(a,{forceEmit:!1,last:!0})}setRawValue(a,l){const d=l!=null?l:{forceEmit:!1,last:!0},y=this.constraint_?this.constraint_.constrain(a):a;!!this.equals_(this.rawValue_,y)&&!d.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=y,this.emitter.emit("change",{options:d,rawValue:y,sender:this}))}}class F{constructor(a){this.emitter=new M,this.value_=a}get rawValue(){return this.value_}set rawValue(a){this.setRawValue(a,{forceEmit:!1,last:!0})}setRawValue(a,l){const d=l!=null?l:{forceEmit:!1,last:!0};this.value_===a&&!d.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=a,this.emitter.emit("change",{options:d,rawValue:this.value_,sender:this}))}}function V(u,a){const l=a==null?void 0:a.constraint,d=a==null?void 0:a.equals;return!l&&!d?new F(u):new z(u,a)}class j{constructor(a){this.emitter=new M,this.valMap_=a;for(const l in this.valMap_)this.valMap_[l].emitter.on("change",()=>{this.emitter.emit("change",{key:l,sender:this})})}static createCore(a){return Object.keys(a).reduce((d,y)=>Object.assign(d,{[y]:V(a[y])}),{})}static fromObject(a){const l=this.createCore(a);return new j(l)}get(a){return this.valMap_[a].rawValue}set(a,l){this.valMap_[a].rawValue=l}value(a){return this.valMap_[a]}}function ue(u,a){const d=Object.keys(a).reduce((y,A)=>{if(y===void 0)return;const I=a[A],K=I(u[A]);return K.succeeded?Object.assign(Object.assign({},y),{[A]:K.value}):void 0},{});return d}function Ie(u,a){return u.reduce((l,d)=>{if(l===void 0)return;const y=a(d);if(!(!y.succeeded||y.value===void 0))return[...l,y.value]},[])}function ke(u){return u===null?!1:typeof u=="object"}function Be(u){return a=>l=>{if(!a&&l===void 0)return{succeeded:!1,value:void 0};if(a&&l===void 0)return{succeeded:!0,value:void 0};const d=u(l);return d!==void 0?{succeeded:!0,value:d}:{succeeded:!1,value:void 0}}}function pt(u){return{custom:a=>Be(a)(u),boolean:Be(a=>typeof a=="boolean"?a:void 0)(u),number:Be(a=>typeof a=="number"?a:void 0)(u),string:Be(a=>typeof a=="string"?a:void 0)(u),function:Be(a=>typeof a=="function"?a:void 0)(u),constant:a=>Be(l=>l===a?a:void 0)(u),raw:Be(a=>a)(u),object:a=>Be(l=>{if(!!ke(l))return ue(l,a)})(u),array:a=>Be(l=>{if(!!Array.isArray(l))return Ie(l,a)})(u)}}const ae={optional:pt(!0),required:pt(!1)};function xe(u,a){const l=ae.required.object(a)(u);return l.succeeded?l.value:void 0}function Jt(u){return u&&u.parentElement&&u.parentElement.removeChild(u),null}function bi(){return["veryfirst","first","last","verylast"]}const ze=B(""),Nn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class dt{constructor(a){this.parent_=null,this.blade=a.blade,this.view=a.view,this.viewProps=a.viewProps;const l=this.view.element;this.blade.value("positions").emitter.on("change",()=>{bi().forEach(d=>{l.classList.remove(ze(void 0,Nn[d]))}),this.blade.get("positions").forEach(d=>{l.classList.add(ze(void 0,Nn[d]))})}),this.viewProps.handleDispose(()=>{Jt(l)})}get parent(){return this.parent_}}const tt="http://www.w3.org/2000/svg";function kt(u){u.offsetHeight}function zt(u,a){const l=u.style.transition;u.style.transition="none",a(),u.style.transition=l}function hs(u){return u.ontouchstart!==void 0}function ps(){return new Function("return this")()}function so(){return ps().document}function ao(u){const a=u.ownerDocument.defaultView;return a&&"document"in a?u.getContext("2d"):null}const Oa={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function xi(u,a){const l=u.createElementNS(tt,"svg");return l.innerHTML=Oa[a],l}function ds(u,a,l){u.insertBefore(a,u.children[l])}function kn(u){u.parentElement&&u.parentElement.removeChild(u)}function Fa(u){for(;u.children.length>0;)u.removeChild(u.children[0])}function Da(u){for(;u.childNodes.length>0;)u.removeChild(u.childNodes[0])}function $t(u){return u.relatedTarget?u.relatedTarget:"explicitOriginalTarget"in u?u.explicitOriginalTarget:null}const zn=B("lbl");function ro(u,a){const l=u.createDocumentFragment();return a.split(`
`).map(y=>u.createTextNode(y)).forEach((y,A)=>{A>0&&l.appendChild(u.createElement("br")),l.appendChild(y)}),l}class ms{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(zn()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("div");d.classList.add(zn("l")),G(l.props,"label",A=>{v(A)?this.element.classList.add(zn(void 0,"nol")):(this.element.classList.remove(zn(void 0,"nol")),Da(d),d.appendChild(ro(a,A)))}),this.element.appendChild(d),this.labelElement=d;const y=a.createElement("div");y.classList.add(zn("v")),this.element.appendChild(y),this.valueElement=y}}class qt extends dt{constructor(a,l){const d=l.valueController.viewProps;super(Object.assign(Object.assign({},l),{view:new ms(a,{props:l.props,viewProps:d}),viewProps:d})),this.props=l.props,this.valueController=l.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const yi={id:"button",type:"blade",accept(u){const a=ae,l=xe(u,{title:a.required.string,view:a.required.constant("button"),label:a.optional.string});return l?{params:l}:null},controller(u){return new qt(u.document,{blade:u.blade,props:j.fromObject({label:u.params.label}),valueController:new D(u.document,{props:j.fromObject({title:u.params.title}),viewProps:u.viewProps})})},api(u){return!(u.controller instanceof qt)||!(u.controller.valueController instanceof D)?null:new T(u.controller)}};class Et extends dt{constructor(a){super(a),this.value=a.value}}function dn(){return new j({positions:V([],{equals:g})})}class Un extends j{constructor(a){super(a)}static create(a){const l={completed:!0,expanded:a,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},d=j.createCore(l);return new Un(d)}get styleExpanded(){var a;return(a=this.get("temporaryExpanded"))!==null&&a!==void 0?a:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const a=this.get("expandedHeight");return this.get("shouldFixHeight")&&!v(a)?`${a}px`:"auto"}bindExpandedClass(a,l){const d=()=>{this.styleExpanded?a.classList.add(l):a.classList.remove(l)};G(this,"expanded",d),G(this,"temporaryExpanded",d)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function oo(u,a){let l=0;return zt(a,()=>{u.set("expandedHeight",null),u.set("temporaryExpanded",!0),kt(a),l=a.clientHeight,u.set("temporaryExpanded",null),kt(a)}),l}function fs(u,a){a.style.height=u.styleHeight}function vs(u,a){u.value("expanded").emitter.on("beforechange",()=>{u.set("completed",!1),v(u.get("expandedHeight"))&&u.set("expandedHeight",oo(u,a)),u.set("shouldFixHeight",!0),kt(a)}),u.emitter.on("change",()=>{fs(u,a)}),fs(u,a),a.addEventListener("transitionend",l=>{l.propertyName==="height"&&u.cleanUpTransition()})}class gs extends s{constructor(a,l){super(a),this.rackApi_=l}}function lo(u,a){return u.addBlade(Object.assign(Object.assign({},a),{view:"button"}))}function uo(u,a){return u.addBlade(Object.assign(Object.assign({},a),{view:"folder"}))}function co(u,a){const l=a!=null?a:{};return u.addBlade(Object.assign(Object.assign({},l),{view:"separator"}))}function ho(u,a){return u.addBlade(Object.assign(Object.assign({},a),{view:"tab"}))}class _s{constructor(a){this.emitter=new M,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=a}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(a){for(const l of this.allItems())if(a(l))return l;return null}includes(a){return this.cache_.has(a)}add(a,l){if(this.includes(a))throw S.shouldNeverHappen();const d=l!==void 0?l:this.items_.length;this.items_.splice(d,0,a),this.cache_.add(a);const y=this.extract_(a);y&&(y.emitter.on("add",this.onSubListAdd_),y.emitter.on("remove",this.onSubListRemove_),y.allItems().forEach(A=>{this.cache_.add(A)})),this.emitter.emit("add",{index:d,item:a,root:this,target:this})}remove(a){const l=this.items_.indexOf(a);if(l<0)return;this.items_.splice(l,1),this.cache_.delete(a);const d=this.extract_(a);d&&(d.emitter.off("add",this.onSubListAdd_),d.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:l,item:a,root:this,target:this})}onSubListAdd_(a){this.cache_.add(a.item),this.emitter.emit("add",{index:a.index,item:a.item,root:this,target:a.target})}onSubListRemove_(a){this.cache_.delete(a.item),this.emitter.emit("remove",{index:a.index,item:a.item,root:this,target:a.target})}}class bs extends s{constructor(a){super(a),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new M,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(a){this.controller_.props.set("label",a)}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(a){const l=a.sender.target.read();this.emitter_.emit("change",{event:new o(this,l,this.controller_.binding.target.presetKey,a.options.last)})}}class nt extends qt{constructor(a,l){super(a,l),this.binding=l.binding}}class Xt extends s{constructor(a){super(a),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new M,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(a){this.controller_.props.set("label",a)}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(a){const l=a.sender.target.read();this.emitter_.emit("update",{event:new c(this,l,this.controller_.binding.target.presetKey)})}}class Ut extends qt{constructor(a,l){super(a,l),this.binding=l.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Hn(u){return u instanceof Vn?u.apiSet_:u instanceof gs?u.rackApi_.apiSet_:null}function Gn(u,a){const l=u.find(d=>d.controller_===a);if(!l)throw S.shouldNeverHappen();return l}function Ci(u,a,l){if(!E.isBindable(u))throw S.notBindable();return new E(u,a,l)}class Vn extends s{constructor(a,l){super(a),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new M,this.apiSet_=new _s(Hn),this.pool_=l;const d=this.controller_.rack;d.emitter.on("add",this.onRackAdd_),d.emitter.on("remove",this.onRackRemove_),d.emitter.on("inputchange",this.onRackInputChange_),d.emitter.on("monitorupdate",this.onRackMonitorUpdate_),d.children.forEach(y=>{this.setUpApi_(y)})}get children(){return this.controller_.rack.children.map(a=>Gn(this.apiSet_,a))}addInput(a,l,d){const y=d!=null?d:{},A=this.controller_.view.element.ownerDocument,I=this.pool_.createInput(A,Ci(a,l,y.presetKey),y),K=new bs(I);return this.add(K,y.index)}addMonitor(a,l,d){const y=d!=null?d:{},A=this.controller_.view.element.ownerDocument,I=this.pool_.createMonitor(A,Ci(a,l),y),K=new Xt(I);return this.add(K,y.index)}addFolder(a){return uo(this,a)}addButton(a){return lo(this,a)}addSeparator(a){return co(this,a)}addTab(a){return ho(this,a)}add(a,l){this.controller_.rack.add(a.controller_,l);const d=this.apiSet_.find(y=>y.controller_===a.controller_);return d&&this.apiSet_.remove(d),this.apiSet_.add(a),a}remove(a){this.controller_.rack.remove(a.controller_)}addBlade(a){const l=this.controller_.view.element.ownerDocument,d=this.pool_.createBlade(l,a),y=this.pool_.createBladeApi(d);return this.add(y,a.index)}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}setUpApi_(a){this.apiSet_.find(d=>d.controller_===a)||this.apiSet_.add(this.pool_.createBladeApi(a))}onRackAdd_(a){this.setUpApi_(a.bladeController)}onRackRemove_(a){if(a.isRoot){const l=Gn(this.apiSet_,a.bladeController);this.apiSet_.remove(l)}}onRackInputChange_(a){const l=a.bladeController;if(l instanceof nt){const d=Gn(this.apiSet_,l),y=l.binding;this.emitter_.emit("change",{event:new o(d,y.target.read(),y.target.presetKey,a.options.last)})}else if(l instanceof Et){const d=Gn(this.apiSet_,l);this.emitter_.emit("change",{event:new o(d,l.value.rawValue,void 0,a.options.last)})}}onRackMonitorUpdate_(a){if(!(a.bladeController instanceof Ut))throw S.shouldNeverHappen();const l=Gn(this.apiSet_,a.bladeController),d=a.bladeController.binding;this.emitter_.emit("update",{event:new c(l,d.target.read(),d.target.presetKey)})}}class xs extends gs{constructor(a,l){super(a,new Vn(a.rackController,l)),this.emitter_=new M,this.controller_.foldable.value("expanded").emitter.on("change",d=>{this.emitter_.emit("fold",{event:new p(this,d.sender.rawValue)})}),this.rackApi_.on("change",d=>{this.emitter_.emit("change",{event:d})}),this.rackApi_.on("update",d=>{this.emitter_.emit("update",{event:d})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(a){this.controller_.foldable.set("expanded",a)}get title(){return this.controller_.props.get("title")}set title(a){this.controller_.props.set("title",a)}get children(){return this.rackApi_.children}addInput(a,l,d){return this.rackApi_.addInput(a,l,d)}addMonitor(a,l,d){return this.rackApi_.addMonitor(a,l,d)}addFolder(a){return this.rackApi_.addFolder(a)}addButton(a){return this.rackApi_.addButton(a)}addSeparator(a){return this.rackApi_.addSeparator(a)}addTab(a){return this.rackApi_.addTab(a)}add(a,l){return this.rackApi_.add(a,l)}remove(a){this.rackApi_.remove(a)}addBlade(a){return this.rackApi_.addBlade(a)}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}}class ys extends dt{constructor(a){super({blade:a.blade,view:a.view,viewProps:a.rackController.viewProps}),this.rackController=a.rackController}}class po{constructor(a,l){const d=B(l.viewName);this.element=a.createElement("div"),this.element.classList.add(d()),l.viewProps.bindClassModifiers(this.element)}}function mo(u,a){for(let l=0;l<u.length;l++){const d=u[l];if(d instanceof nt&&d.binding===a)return d}return null}function fo(u,a){for(let l=0;l<u.length;l++){const d=u[l];if(d instanceof Ut&&d.binding===a)return d}return null}function vo(u,a){for(let l=0;l<u.length;l++){const d=u[l];if(d instanceof Et&&d.value===a)return d}return null}function Cs(u){return u instanceof Wn?u.rack:u instanceof ys?u.rackController.rack:null}function go(u){const a=Cs(u);return a?a.bcSet_:null}class _o{constructor(a){var l;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new M,this.blade_=a!=null?a:null,(l=this.blade_)===null||l===void 0||l.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new _s(go),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(a,l){a.parent&&a.parent.remove(a),a.parent_=this,this.bcSet_.add(a,l)}remove(a){a.parent_=null,this.bcSet_.remove(a)}find(a){return this.bcSet_.allItems().filter(l=>l instanceof a)}onSetAdd_(a){this.updatePositions_();const l=a.target===a.root;if(this.emitter.emit("add",{bladeController:a.item,index:a.index,isRoot:l,sender:this}),!l)return;const d=a.item;if(d.viewProps.emitter.on("change",this.onChildViewPropsChange_),d.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),d.viewProps.handleDispose(this.onChildDispose_),d instanceof nt)d.binding.emitter.on("change",this.onChildInputChange_);else if(d instanceof Ut)d.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(d instanceof Et)d.value.emitter.on("change",this.onChildValueChange_);else{const y=Cs(d);if(y){const A=y.emitter;A.on("layout",this.onDescendantLayout_),A.on("inputchange",this.onDescendantInputChange_),A.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(a){this.updatePositions_();const l=a.target===a.root;if(this.emitter.emit("remove",{bladeController:a.item,isRoot:l,sender:this}),!l)return;const d=a.item;if(d instanceof nt)d.binding.emitter.off("change",this.onChildInputChange_);else if(d instanceof Ut)d.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(d instanceof Et)d.value.emitter.off("change",this.onChildValueChange_);else{const y=Cs(d);if(y){const A=y.emitter;A.off("layout",this.onDescendantLayout_),A.off("inputchange",this.onDescendantInputChange_),A.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const a=this.bcSet_.items.filter(y=>!y.viewProps.get("hidden")),l=a[0],d=a[a.length-1];this.bcSet_.items.forEach(y=>{const A=[];y===l&&(A.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&A.push("veryfirst")),y===d&&(A.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&A.push("verylast")),y.blade.set("positions",A)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(a){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(l=>l.viewProps.get("disposed")).forEach(l=>{this.bcSet_.remove(l)})}onChildInputChange_(a){const l=mo(this.find(nt),a.sender);if(!l)throw S.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:l,options:a.options,sender:this})}onChildMonitorUpdate_(a){const l=fo(this.find(Ut),a.sender);if(!l)throw S.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:l,sender:this})}onChildValueChange_(a){const l=vo(this.find(Et),a.sender);if(!l)throw S.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:l,options:a.options,sender:this})}onDescendantLayout_(a){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(a){this.emitter.emit("inputchange",{bladeController:a.bladeController,options:a.options,sender:this})}onDescendantMonitorUpdate_(a){this.emitter.emit("monitorupdate",{bladeController:a.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Wn extends dt{constructor(a,l){super(Object.assign(Object.assign({},l),{view:new po(a,{viewName:"brk",viewProps:l.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const d=new _o(l.root?void 0:l.blade);d.emitter.on("add",this.onRackAdd_),d.emitter.on("remove",this.onRackRemove_),this.rack=d,this.viewProps.handleDispose(()=>{for(let y=this.rack.children.length-1;y>=0;y--)this.rack.children[y].viewProps.set("disposed",!0)})}onRackAdd_(a){!a.isRoot||ds(this.view.element,a.bladeController.view.element,a.index)}onRackRemove_(a){!a.isRoot||kn(a.bladeController.view.element)}}const La=B("cnt");class bo{constructor(a,l){var d;this.className_=B((d=l.viewName)!==null&&d!==void 0?d:"fld"),this.element=a.createElement("div"),this.element.classList.add(this.className_(),La()),l.viewProps.bindClassModifiers(this.element),this.foldable_=l.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),G(this.foldable_,"completed",U(this.element,this.className_(void 0,"cpl")));const y=a.createElement("button");y.classList.add(this.className_("b")),G(l.props,"title",te=>{v(te)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),l.viewProps.bindDisabled(y),this.element.appendChild(y),this.buttonElement=y;const A=a.createElement("div");A.classList.add(this.className_("t")),J(l.props.value("title"),A),this.buttonElement.appendChild(A),this.titleElement=A;const I=a.createElement("div");I.classList.add(this.className_("m")),this.buttonElement.appendChild(I);const K=l.containerElement;K.classList.add(this.className_("c")),this.element.appendChild(K),this.containerElement=K}}class Ss extends ys{constructor(a,l){var d;const y=Un.create((d=l.expanded)!==null&&d!==void 0?d:!0),A=new Wn(a,{blade:l.blade,root:l.root,viewProps:l.viewProps});super(Object.assign(Object.assign({},l),{rackController:A,view:new bo(a,{containerElement:A.view.element,foldable:y,props:l.props,viewName:l.root?"rot":void 0,viewProps:l.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=l.props,this.foldable=y,vs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const xo={id:"folder",type:"blade",accept(u){const a=ae,l=xe(u,{title:a.required.string,view:a.required.constant("folder"),expanded:a.optional.boolean});return l?{params:l}:null},controller(u){return new Ss(u.document,{blade:u.blade,expanded:u.params.expanded,props:j.fromObject({title:u.params.title}),viewProps:u.viewProps})},api(u){return u.controller instanceof Ss?new xs(u.controller,u.pool):null}};class mn extends Et{constructor(a,l){const d=l.valueController.viewProps;super(Object.assign(Object.assign({},l),{value:l.valueController.value,view:new ms(a,{props:l.props,viewProps:d}),viewProps:d})),this.props=l.props,this.valueController=l.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class ws extends s{}const Na=B("spr");class yo{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Na()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("hr");d.classList.add(Na("r")),this.element.appendChild(d)}}class ka extends dt{constructor(a,l){super(Object.assign(Object.assign({},l),{view:new yo(a,{viewProps:l.viewProps})}))}}const za={id:"separator",type:"blade",accept(u){const l=xe(u,{view:ae.required.constant("separator")});return l?{params:l}:null},controller(u){return new ka(u.document,{blade:u.blade,viewProps:u.viewProps})},api(u){return u.controller instanceof ka?new ws(u.controller):null}},Co=B("");function jn(u,a){return U(u,Co(void 0,a))}class Ht extends j{constructor(a){super(a)}static create(a){var l,d;const y=a!=null?a:{},A={disabled:(l=y.disabled)!==null&&l!==void 0?l:!1,disposed:!1,hidden:(d=y.hidden)!==null&&d!==void 0?d:!1},I=j.createCore(A);return new Ht(I)}bindClassModifiers(a){G(this,"disabled",jn(a,"disabled")),G(this,"hidden",jn(a,"hidden"))}bindDisabled(a){G(this,"disabled",l=>{a.disabled=l})}bindTabIndex(a){G(this,"disabled",l=>{a.tabIndex=l?-1:0})}handleDispose(a){this.value("disposed").emitter.on("change",l=>{l&&a()})}}const De=B("tbi");class So{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(De()),l.viewProps.bindClassModifiers(this.element),G(l.props,"selected",A=>{A?this.element.classList.add(De(void 0,"sel")):this.element.classList.remove(De(void 0,"sel"))});const d=a.createElement("button");d.classList.add(De("b")),l.viewProps.bindDisabled(d),this.element.appendChild(d),this.buttonElement=d;const y=a.createElement("div");y.classList.add(De("t")),J(l.props.value("title"),y),this.buttonElement.appendChild(y),this.titleElement=y}}class Si{constructor(a,l){this.emitter=new M,this.onClick_=this.onClick_.bind(this),this.props=l.props,this.viewProps=l.viewProps,this.view=new So(a,{props:l.props,viewProps:l.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ua{constructor(a,l){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Si(a,{props:l.itemProps,viewProps:Ht.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Wn(a,{blade:dn(),viewProps:Ht.create()}),this.props=l.props,G(this.props,"selected",d=>{this.itemController.props.set("selected",d),this.contentController.viewProps.set("hidden",!d)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class As{constructor(a,l){this.controller_=a,this.rackApi_=l}get title(){var a;return(a=this.controller_.itemController.props.get("title"))!==null&&a!==void 0?a:""}set title(a){this.controller_.itemController.props.set("title",a)}get selected(){return this.controller_.props.get("selected")}set selected(a){this.controller_.props.set("selected",a)}get children(){return this.rackApi_.children}addButton(a){return this.rackApi_.addButton(a)}addFolder(a){return this.rackApi_.addFolder(a)}addSeparator(a){return this.rackApi_.addSeparator(a)}addTab(a){return this.rackApi_.addTab(a)}add(a,l){this.rackApi_.add(a,l)}remove(a){this.rackApi_.remove(a)}addInput(a,l,d){return this.rackApi_.addInput(a,l,d)}addMonitor(a,l,d){return this.rackApi_.addMonitor(a,l,d)}addBlade(a){return this.rackApi_.addBlade(a)}}class Ha extends gs{constructor(a,l){super(a,new Vn(a.rackController,l)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new M,this.pageApiMap_=new Map,this.rackApi_.on("change",d=>{this.emitter_.emit("change",{event:d})}),this.rackApi_.on("update",d=>{this.emitter_.emit("update",{event:d})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(d=>{this.setUpPageApi_(d)})}get pages(){return this.controller_.pageSet.items.map(a=>{const l=this.pageApiMap_.get(a);if(!l)throw S.shouldNeverHappen();return l})}addPage(a){const l=this.controller_.view.element.ownerDocument,d=new Ua(l,{itemProps:j.fromObject({selected:!1,title:a.title}),props:j.fromObject({selected:!1})});this.controller_.add(d,a.index);const y=this.pageApiMap_.get(d);if(!y)throw S.shouldNeverHappen();return y}removePage(a){this.controller_.remove(a)}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}setUpPageApi_(a){const l=this.rackApi_.apiSet_.find(y=>y.controller_===a.contentController);if(!l)throw S.shouldNeverHappen();const d=new As(a,l);this.pageApiMap_.set(a,d)}onPageAdd_(a){this.setUpPageApi_(a.item)}onPageRemove_(a){if(!this.pageApiMap_.get(a.item))throw S.shouldNeverHappen();this.pageApiMap_.delete(a.item)}onSelect_(a){this.emitter_.emit("select",{event:new m(this,a.rawValue)})}}const Ga=-1;class wo{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=V(!0),this.selectedIndex=V(Ga),this.items_=[]}add(a,l){const d=l!=null?l:this.items_.length;this.items_.splice(d,0,a),a.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(a){const l=this.items_.indexOf(a);l<0||(this.items_.splice(l,1),a.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Ga,this.empty.rawValue=!0;return}const a=this.items_.findIndex(l=>l.rawValue);a<0?(this.items_.forEach((l,d)=>{l.rawValue=d===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((l,d)=>{l.rawValue=d===a}),this.selectedIndex.rawValue=a),this.empty.rawValue=!1}onItemSelectedChange_(a){if(a.rawValue){const l=this.items_.findIndex(d=>d===a.sender);this.items_.forEach((d,y)=>{d.rawValue=y===l}),this.selectedIndex.rawValue=l}else this.keepSelection_()}}const Kn=B("tab");class fn{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Kn(),La()),l.viewProps.bindClassModifiers(this.element),H(l.empty,U(this.element,Kn(void 0,"nop")));const d=a.createElement("div");d.classList.add(Kn("i")),this.element.appendChild(d),this.itemsElement=d;const y=l.contentsElement;y.classList.add(Kn("c")),this.element.appendChild(y),this.contentsElement=y}}class Jn extends ys{constructor(a,l){const d=new Wn(a,{blade:l.blade,viewProps:l.viewProps}),y=new wo;super({blade:l.blade,rackController:d,view:new fn(a,{contentsElement:d.view.element,empty:y.empty,viewProps:l.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new _s(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=y}get pageSet(){return this.pageSet_}add(a,l){this.pageSet_.add(a,l)}remove(a){this.pageSet_.remove(this.pageSet_.items[a])}onPageAdd_(a){const l=a.item;ds(this.view.itemsElement,l.itemController.view.element,a.index),this.rackController.rack.add(l.contentController,a.index),this.tab.add(l.props.value("selected"))}onPageRemove_(a){const l=a.item;kn(l.itemController.view.element),this.rackController.rack.remove(l.contentController),this.tab.remove(l.props.value("selected"))}}const Es={id:"tab",type:"blade",accept(u){const a=ae,l=xe(u,{pages:a.required.array(a.required.object({title:a.required.string})),view:a.required.constant("tab")});return!l||l.pages.length===0?null:{params:l}},controller(u){const a=new Jn(u.document,{blade:u.blade,viewProps:u.viewProps});return u.params.pages.forEach(l=>{const d=new Ua(u.document,{itemProps:j.fromObject({selected:!1,title:l.title}),props:j.fromObject({selected:!1})});a.add(d)}),a},api(u){return u.controller instanceof Jn?new Ha(u.controller,u.pool):null}};function Ao(u,a){const l=u.accept(a.params);if(!l)return null;const d=ae.optional.boolean(a.params.disabled).value,y=ae.optional.boolean(a.params.hidden).value;return u.controller({blade:dn(),document:a.document,params:Object.assign(Object.assign({},l.params),{disabled:d,hidden:y}),viewProps:Ht.create({disabled:d,hidden:y})})}class Va{constructor(){this.disabled=!1,this.emitter=new M}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ts{constructor(a,l){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=a,this.emitter=new M,this.interval_=l,this.setTimer_()}get disabled(){return this.disabled_}set disabled(a){this.disabled_=a,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const a=this.doc_.defaultView;a&&a.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const a=this.doc_.defaultView;a&&(this.timerId_=a.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Gt{constructor(a){this.constraints=a}constrain(a){return this.constraints.reduce((l,d)=>d.constrain(l),a)}}function me(u,a){if(u instanceof a)return u;if(u instanceof Gt){const l=u.constraints.reduce((d,y)=>d||(y instanceof a?y:null),null);if(l)return l}return null}class vn{constructor(a){this.options=a}constrain(a){const l=this.options;return l.length===0||l.filter(y=>y.value===a).length>0?a:l[0].value}}class mt{constructor(a){this.maxValue=a.max,this.minValue=a.min}constrain(a){let l=a;return v(this.minValue)||(l=Math.max(l,this.minValue)),v(this.maxValue)||(l=Math.min(l,this.maxValue)),l}}class We{constructor(a,l=0){this.step=a,this.origin=l}constrain(a){const l=this.origin%this.step,d=Math.round((a-l)/this.step);return l+d*this.step}}const Ms=B("lst");class Eo{constructor(a,l){this.onValueChange_=this.onValueChange_.bind(this),this.props_=l.props,this.element=a.createElement("div"),this.element.classList.add(Ms()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("select");d.classList.add(Ms("s")),G(this.props_,"options",A=>{Fa(d),A.forEach((I,K)=>{const te=a.createElement("option");te.dataset.index=String(K),te.textContent=I.text,te.value=String(I.value),d.appendChild(te)})}),l.viewProps.bindDisabled(d),this.element.appendChild(d),this.selectElement=d;const y=a.createElement("div");y.classList.add(Ms("m")),y.appendChild(xi(a,"dropdown")),this.element.appendChild(y),l.value.emitter.on("change",this.onValueChange_),this.value_=l.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Yt{constructor(a,l){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=l.props,this.value=l.value,this.viewProps=l.viewProps,this.view=new Eo(a,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(a){const d=a.currentTarget.selectedOptions.item(0);if(!d)return;const y=Number(d.dataset.index);this.value.rawValue=this.props.get("options")[y].value}}const Wa=B("pop");class To{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Wa()),l.viewProps.bindClassModifiers(this.element),H(l.shows,U(this.element,Wa(void 0,"v")))}}class Bs{constructor(a,l){this.shows=V(!1),this.viewProps=l.viewProps,this.view=new To(a,{shows:this.shows,viewProps:this.viewProps})}}const ja=B("txt");class wi{constructor(a,l){this.onChange_=this.onChange_.bind(this),this.element=a.createElement("div"),this.element.classList.add(ja()),l.viewProps.bindClassModifiers(this.element),this.props_=l.props,this.props_.emitter.on("change",this.onChange_);const d=a.createElement("input");d.classList.add(ja("i")),d.type="text",l.viewProps.bindDisabled(d),this.element.appendChild(d),this.inputElement=d,l.value.emitter.on("change",this.onChange_),this.value_=l.value,this.refresh()}refresh(){const a=this.props_.get("formatter");this.inputElement.value=a(this.value_.rawValue)}onChange_(){this.refresh()}}class $n{constructor(a,l){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=l.parser,this.props=l.props,this.value=l.value,this.viewProps=l.viewProps,this.view=new wi(a,{props:l.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(a){const d=a.currentTarget.value,y=this.parser_(d);v(y)||(this.value.rawValue=y),this.view.refresh()}}function Mo(u){return String(u)}function Ka(u){return u==="false"?!1:!!u}function Ja(u){return Mo(u)}class Bo{constructor(a){this.text=a}evaluate(){return Number(this.text)}toString(){return this.text}}const Po={"**":(u,a)=>Math.pow(u,a),"*":(u,a)=>u*a,"/":(u,a)=>u/a,"%":(u,a)=>u%a,"+":(u,a)=>u+a,"-":(u,a)=>u-a,"<<":(u,a)=>u<<a,">>":(u,a)=>u>>a,">>>":(u,a)=>u>>>a,"&":(u,a)=>u&a,"^":(u,a)=>u^a,"|":(u,a)=>u|a};class Io{constructor(a,l,d){this.left=l,this.operator=a,this.right=d}evaluate(){const a=Po[this.operator];if(!a)throw new Error(`unexpected binary operator: '${this.operator}`);return a(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ro={"+":u=>u,"-":u=>-u,"~":u=>~u};class Oo{constructor(a,l){this.operator=a,this.expression=l}evaluate(){const a=Ro[this.operator];if(!a)throw new Error(`unexpected unary operator: '${this.operator}`);return a(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Ps(u){return(a,l)=>{for(let d=0;d<u.length;d++){const y=u[d](a,l);if(y!=="")return y}return""}}function qn(u,a){var l;const d=u.substr(a).match(/^\s+/);return(l=d&&d[0])!==null&&l!==void 0?l:""}function Fo(u,a){const l=u.substr(a,1);return l.match(/^[1-9]$/)?l:""}function Xn(u,a){var l;const d=u.substr(a).match(/^[0-9]+/);return(l=d&&d[0])!==null&&l!==void 0?l:""}function Do(u,a){const l=Xn(u,a);if(l!=="")return l;const d=u.substr(a,1);if(a+=1,d!=="-"&&d!=="+")return"";const y=Xn(u,a);return y===""?"":d+y}function Ai(u,a){const l=u.substr(a,1);if(a+=1,l.toLowerCase()!=="e")return"";const d=Do(u,a);return d===""?"":l+d}function $a(u,a){const l=u.substr(a,1);if(l==="0")return l;const d=Fo(u,a);return a+=d.length,d===""?"":d+Xn(u,a)}function Lo(u,a){const l=$a(u,a);if(a+=l.length,l==="")return"";const d=u.substr(a,1);if(a+=d.length,d!==".")return"";const y=Xn(u,a);return a+=y.length,l+d+y+Ai(u,a)}function Is(u,a){const l=u.substr(a,1);if(a+=l.length,l!==".")return"";const d=Xn(u,a);return a+=d.length,d===""?"":l+d+Ai(u,a)}function No(u,a){const l=$a(u,a);return a+=l.length,l===""?"":l+Ai(u,a)}const ko=Ps([Lo,Is,No]);function zo(u,a){var l;const d=u.substr(a).match(/^[01]+/);return(l=d&&d[0])!==null&&l!==void 0?l:""}function Vt(u,a){const l=u.substr(a,2);if(a+=l.length,l.toLowerCase()!=="0b")return"";const d=zo(u,a);return d===""?"":l+d}function Uo(u,a){var l;const d=u.substr(a).match(/^[0-7]+/);return(l=d&&d[0])!==null&&l!==void 0?l:""}function Ho(u,a){const l=u.substr(a,2);if(a+=l.length,l.toLowerCase()!=="0o")return"";const d=Uo(u,a);return d===""?"":l+d}function Go(u,a){var l;const d=u.substr(a).match(/^[0-9a-f]+/i);return(l=d&&d[0])!==null&&l!==void 0?l:""}function Vo(u,a){const l=u.substr(a,2);if(a+=l.length,l.toLowerCase()!=="0x")return"";const d=Go(u,a);return d===""?"":l+d}const Wo=Ps([Vt,Ho,Vo]),qa=Ps([Wo,ko]);function jo(u,a){const l=qa(u,a);return a+=l.length,l===""?null:{evaluable:new Bo(l),cursor:a}}function Ko(u,a){const l=u.substr(a,1);if(a+=l.length,l!=="(")return null;const d=Tt(u,a);if(!d)return null;a=d.cursor,a+=qn(u,a).length;const y=u.substr(a,1);return a+=y.length,y!==")"?null:{evaluable:d.evaluable,cursor:a}}function it(u,a){var l;return(l=jo(u,a))!==null&&l!==void 0?l:Ko(u,a)}function Xa(u,a){const l=it(u,a);if(l)return l;const d=u.substr(a,1);if(a+=d.length,d!=="+"&&d!=="-"&&d!=="~")return null;const y=Xa(u,a);return y?(a=y.cursor,{cursor:a,evaluable:new Oo(d,y.evaluable)}):null}function Jo(u,a,l){l+=qn(a,l).length;const d=u.filter(y=>a.startsWith(y,l))[0];return d?(l+=d.length,l+=qn(a,l).length,{cursor:l,operator:d}):null}function Rs(u,a){return(l,d)=>{const y=u(l,d);if(!y)return null;d=y.cursor;let A=y.evaluable;for(;;){const I=Jo(a,l,d);if(!I)break;d=I.cursor;const K=u(l,d);if(!K)return null;d=K.cursor,A=new Io(I.operator,A,K.evaluable)}return A?{cursor:d,evaluable:A}:null}}const $o=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((u,a)=>Rs(u,a),Xa);function Tt(u,a){return a+=qn(u,a).length,$o(u,a)}function Ya(u){const a=Tt(u,0);return!a||a.cursor+qn(u,a.cursor).length!==u.length?null:a.evaluable}function Mt(u){var a;const l=Ya(u);return(a=l==null?void 0:l.evaluate())!==null&&a!==void 0?a:null}function Os(u){if(typeof u=="number")return u;if(typeof u=="string"){const a=Mt(u);if(!v(a))return a}return 0}function qo(u){return String(u)}function Ee(u){return a=>a.toFixed(Math.max(Math.min(u,20),0))}const Xo=Ee(0);function gn(u){return Xo(u)+"%"}function Qa(u){return String(u)}function Ei(u){return u}function Bt(u,a){for(;u.length<a;)u.push(void 0)}function Yo(u){const a=[];return Bt(a,u),V(a)}function Qo(u){const a=u.indexOf(void 0);return a<0?u:u.slice(0,a)}function Za(u,a){const l=[...Qo(u),a];return l.length>u.length?l.splice(0,l.length-u.length):Bt(l,u.length),l}function _n({primary:u,secondary:a,forward:l,backward:d}){let y=!1;function A(I){y||(y=!0,I(),y=!1)}u.emitter.on("change",I=>{A(()=>{a.setRawValue(l(u,a),I.options)})}),a.emitter.on("change",I=>{A(()=>{u.setRawValue(d(u,a),I.options)}),A(()=>{a.setRawValue(l(u,a),I.options)})}),A(()=>{a.setRawValue(l(u,a),{forceEmit:!1,last:!0})})}function je(u,a){const l=u*(a.altKey?.1:1)*(a.shiftKey?10:1);return a.upKey?+l:a.downKey?-l:0}function xt(u){return{altKey:u.altKey,downKey:u.key==="ArrowDown",shiftKey:u.shiftKey,upKey:u.key==="ArrowUp"}}function Pt(u){return{altKey:u.altKey,downKey:u.key==="ArrowLeft",shiftKey:u.shiftKey,upKey:u.key==="ArrowRight"}}function Fs(u){return u==="ArrowUp"||u==="ArrowDown"}function er(u){return Fs(u)||u==="ArrowLeft"||u==="ArrowRight"}function Ds(u,a){var l,d;const y=a.ownerDocument.defaultView,A=a.getBoundingClientRect();return{x:u.pageX-(((l=y&&y.scrollX)!==null&&l!==void 0?l:0)+A.left),y:u.pageY-(((d=y&&y.scrollY)!==null&&d!==void 0?d:0)+A.top)}}class Qt{constructor(a){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=a,this.emitter=new M,a.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),a.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),a.addEventListener("touchend",this.onTouchEnd_),a.addEventListener("mousedown",this.onMouseDown_)}computePosition_(a){const l=this.elem_.getBoundingClientRect();return{bounds:{width:l.width,height:l.height},point:a?{x:a.x,y:a.y}:null}}onMouseDown_(a){var l;a.preventDefault(),(l=a.currentTarget)===null||l===void 0||l.focus();const d=this.elem_.ownerDocument;d.addEventListener("mousemove",this.onDocumentMouseMove_),d.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:a.altKey,data:this.computePosition_(Ds(a,this.elem_)),sender:this,shiftKey:a.shiftKey})}onDocumentMouseMove_(a){this.emitter.emit("move",{altKey:a.altKey,data:this.computePosition_(Ds(a,this.elem_)),sender:this,shiftKey:a.shiftKey})}onDocumentMouseUp_(a){const l=this.elem_.ownerDocument;l.removeEventListener("mousemove",this.onDocumentMouseMove_),l.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:a.altKey,data:this.computePosition_(Ds(a,this.elem_)),sender:this,shiftKey:a.shiftKey})}onTouchStart_(a){a.preventDefault();const l=a.targetTouches.item(0),d=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:a.altKey,data:this.computePosition_(l?{x:l.clientX-d.left,y:l.clientY-d.top}:void 0),sender:this,shiftKey:a.shiftKey}),this.lastTouch_=l}onTouchMove_(a){const l=a.targetTouches.item(0),d=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:a.altKey,data:this.computePosition_(l?{x:l.clientX-d.left,y:l.clientY-d.top}:void 0),sender:this,shiftKey:a.shiftKey}),this.lastTouch_=l}onTouchEnd_(a){var l;const d=(l=a.targetTouches.item(0))!==null&&l!==void 0?l:this.lastTouch_,y=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:a.altKey,data:this.computePosition_(d?{x:d.clientX-y.left,y:d.clientY-y.top}:void 0),sender:this,shiftKey:a.shiftKey})}}function ye(u,a,l,d,y){const A=(u-a)/(l-a);return d+A*(y-d)}function tr(u){return String(u.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Oe(u,a,l){return Math.min(Math.max(u,a),l)}function nr(u,a){return(u%a+a)%a}const Ye=B("txt");class Zo{constructor(a,l){this.onChange_=this.onChange_.bind(this),this.props_=l.props,this.props_.emitter.on("change",this.onChange_),this.element=a.createElement("div"),this.element.classList.add(Ye(),Ye(void 0,"num")),l.arrayPosition&&this.element.classList.add(Ye(void 0,l.arrayPosition)),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("input");d.classList.add(Ye("i")),d.type="text",l.viewProps.bindDisabled(d),this.element.appendChild(d),this.inputElement=d,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=l.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ye()),this.inputElement.classList.add(Ye("i"));const y=a.createElement("div");y.classList.add(Ye("k")),this.element.appendChild(y),this.knobElement=y;const A=a.createElementNS(tt,"svg");A.classList.add(Ye("g")),this.knobElement.appendChild(A);const I=a.createElementNS(tt,"path");I.classList.add(Ye("gb")),A.appendChild(I),this.guideBodyElem_=I;const K=a.createElementNS(tt,"path");K.classList.add(Ye("gh")),A.appendChild(K),this.guideHeadElem_=K;const te=a.createElement("div");te.classList.add(B("tt")()),this.knobElement.appendChild(te),this.tooltipElem_=te,l.value.emitter.on("change",this.onChange_),this.value=l.value,this.refresh()}onDraggingChange_(a){if(a.rawValue===null){this.element.classList.remove(Ye(void 0,"drg"));return}this.element.classList.add(Ye(void 0,"drg"));const l=a.rawValue/this.props_.get("draggingScale"),d=l+(l>0?-1:l<0?1:0),y=Oe(-d,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${d+y},0 L${d},4 L${d+y},8`,`M ${l},-1 L${l},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${l},4`);const A=this.props_.get("formatter");this.tooltipElem_.textContent=A(this.value.rawValue),this.tooltipElem_.style.left=`${l}px`}refresh(){const a=this.props_.get("formatter");this.inputElement.value=a(this.value.rawValue)}onChange_(){this.refresh()}}class It{constructor(a,l){var d;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=l.baseStep,this.parser_=l.parser,this.props=l.props,this.sliderProps_=(d=l.sliderProps)!==null&&d!==void 0?d:null,this.value=l.value,this.viewProps=l.viewProps,this.dragging_=V(null),this.view=new Zo(a,{arrayPosition:l.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const y=new Qt(this.view.knobElement);y.emitter.on("down",this.onPointerDown_),y.emitter.on("move",this.onPointerMove_),y.emitter.on("up",this.onPointerUp_)}constrainValue_(a){var l,d;const y=(l=this.sliderProps_)===null||l===void 0?void 0:l.get("minValue"),A=(d=this.sliderProps_)===null||d===void 0?void 0:d.get("maxValue");let I=a;return y!==void 0&&(I=Math.max(I,y)),A!==void 0&&(I=Math.min(I,A)),I}onInputChange_(a){const d=a.currentTarget.value,y=this.parser_(d);v(y)||(this.value.rawValue=this.constrainValue_(y)),this.view.refresh()}onInputKeyDown_(a){const l=je(this.baseStep_,xt(a));l!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+l),{forceEmit:!1,last:!1})}onInputKeyUp_(a){je(this.baseStep_,xt(a))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(a){if(!a.point)return null;const l=a.point.x-a.bounds.width/2;return this.constrainValue_(this.originRawValue_+l*this.props.get("draggingScale"))}onPointerMove_(a){const l=this.computeDraggingValue_(a.data);l!==null&&(this.value.setRawValue(l,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(a){const l=this.computeDraggingValue_(a.data);l!==null&&(this.value.setRawValue(l,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Ls=B("sld");class ir{constructor(a,l){this.onChange_=this.onChange_.bind(this),this.props_=l.props,this.props_.emitter.on("change",this.onChange_),this.element=a.createElement("div"),this.element.classList.add(Ls()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("div");d.classList.add(Ls("t")),l.viewProps.bindTabIndex(d),this.element.appendChild(d),this.trackElement=d;const y=a.createElement("div");y.classList.add(Ls("k")),this.trackElement.appendChild(y),this.knobElement=y,l.value.emitter.on("change",this.onChange_),this.value=l.value,this.update_()}update_(){const a=Oe(ye(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${a}%`}onChange_(){this.update_()}}class el{constructor(a,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=l.baseStep,this.value=l.value,this.viewProps=l.viewProps,this.props=l.props,this.view=new ir(a,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(a,l){!a.point||this.value.setRawValue(ye(Oe(a.point.x,0,a.bounds.width),0,a.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),l)}onPointerDownOrMove_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerUp_(a){this.handlePointerEvent_(a.data,{forceEmit:!0,last:!0})}onKeyDown_(a){const l=je(this.baseStep_,Pt(a));l!==0&&this.value.setRawValue(this.value.rawValue+l,{forceEmit:!1,last:!1})}onKeyUp_(a){je(this.baseStep_,Pt(a))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ns=B("sldtxt");class st{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Ns());const d=a.createElement("div");d.classList.add(Ns("s")),this.sliderView_=l.sliderView,d.appendChild(this.sliderView_.element),this.element.appendChild(d);const y=a.createElement("div");y.classList.add(Ns("t")),this.textView_=l.textView,y.appendChild(this.textView_.element),this.element.appendChild(y)}}class Ti{constructor(a,l){this.value=l.value,this.viewProps=l.viewProps,this.sliderC_=new el(a,{baseStep:l.baseStep,props:l.sliderProps,value:l.value,viewProps:this.viewProps}),this.textC_=new It(a,{baseStep:l.baseStep,parser:l.parser,props:l.textProps,sliderProps:l.sliderProps,value:l.value,viewProps:l.viewProps}),this.view=new st(a,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function bn(u,a){u.write(a)}function xn(u){const a=ae;if(Array.isArray(u))return a.required.array(a.required.object({text:a.required.string,value:a.required.raw}))(u).value;if(typeof u=="object")return a.required.raw(u).value}function sr(u){if(u==="inline"||u==="popup")return u}function $e(u){const a=ae;return a.required.object({max:a.optional.number,min:a.optional.number,step:a.optional.number})(u).value}function ar(u){if(Array.isArray(u))return u;const a=[];return Object.keys(u).forEach(l=>{a.push({text:l,value:u[l]})}),a}function ks(u){return v(u)?null:new vn(ar(u))}function zs(u){const a=u?me(u,vn):null;return a?a.options:null}function tl(u){const a=u?me(u,We):null;return a?a.step:null}function Mi(u,a){const l=u&&me(u,We);return l?tr(l.step):Math.max(tr(a),2)}function yn(u){const a=tl(u);return a!=null?a:1}function Cn(u,a){var l;const d=u&&me(u,We),y=Math.abs((l=d==null?void 0:d.step)!==null&&l!==void 0?l:a);return y===0?.1:Math.pow(10,Math.floor(Math.log10(y))-1)}const Bi=B("ckb");class nl{constructor(a,l){this.onValueChange_=this.onValueChange_.bind(this),this.element=a.createElement("div"),this.element.classList.add(Bi()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("label");d.classList.add(Bi("l")),this.element.appendChild(d);const y=a.createElement("input");y.classList.add(Bi("i")),y.type="checkbox",d.appendChild(y),this.inputElement=y,l.viewProps.bindDisabled(this.inputElement);const A=a.createElement("div");A.classList.add(Bi("w")),d.appendChild(A);const I=xi(a,"check");A.appendChild(I),l.value.emitter.on("change",this.onValueChange_),this.value=l.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class il{constructor(a,l){this.onInputChange_=this.onInputChange_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new nl(a,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(a){const l=a.currentTarget;this.value.rawValue=l.checked}}function Yn(u){const a=[],l=ks(u.options);return l&&a.push(l),new Gt(a)}const sl={id:"input-bool",type:"input",accept:(u,a)=>{if(typeof u!="boolean")return null;const d=xe(a,{options:ae.optional.custom(xn)});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Ka,constraint:u=>Yn(u.params),writer:u=>bn},controller:u=>{var a;const l=u.document,d=u.value,y=u.constraint;return y&&me(y,vn)?new Yt(l,{props:j.fromObject({options:(a=zs(y))!==null&&a!==void 0?a:[]}),value:d,viewProps:u.viewProps}):new il(l,{value:d,viewProps:u.viewProps})}},Zt=B("col");class Us{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Zt()),l.foldable.bindExpandedClass(this.element,Zt(void 0,"expanded")),G(l.foldable,"completed",U(this.element,Zt(void 0,"cpl")));const d=a.createElement("div");d.classList.add(Zt("h")),this.element.appendChild(d);const y=a.createElement("div");y.classList.add(Zt("s")),d.appendChild(y),this.swatchElement=y;const A=a.createElement("div");if(A.classList.add(Zt("t")),d.appendChild(A),this.textElement=A,l.pickerLayout==="inline"){const I=a.createElement("div");I.classList.add(Zt("p")),this.element.appendChild(I),this.pickerElement=I}else this.pickerElement=null}}function al(u,a,l){const d=Oe(u/255,0,1),y=Oe(a/255,0,1),A=Oe(l/255,0,1),I=Math.max(d,y,A),K=Math.min(d,y,A),te=I-K;let se=0,he=0;const pe=(K+I)/2;return te!==0&&(he=te/(1-Math.abs(I+K-1)),d===I?se=(y-A)/te:y===I?se=2+(A-d)/te:se=4+(d-y)/te,se=se/6+(se<0?1:0)),[se*360,he*100,pe*100]}function Hs(u,a,l){const d=(u%360+360)%360,y=Oe(a/100,0,1),A=Oe(l/100,0,1),I=(1-Math.abs(2*A-1))*y,K=I*(1-Math.abs(d/60%2-1)),te=A-I/2;let se,he,pe;return d>=0&&d<60?[se,he,pe]=[I,K,0]:d>=60&&d<120?[se,he,pe]=[K,I,0]:d>=120&&d<180?[se,he,pe]=[0,I,K]:d>=180&&d<240?[se,he,pe]=[0,K,I]:d>=240&&d<300?[se,he,pe]=[K,0,I]:[se,he,pe]=[I,0,K],[(se+te)*255,(he+te)*255,(pe+te)*255]}function rl(u,a,l){const d=Oe(u/255,0,1),y=Oe(a/255,0,1),A=Oe(l/255,0,1),I=Math.max(d,y,A),K=Math.min(d,y,A),te=I-K;let se;te===0?se=0:I===d?se=60*(((y-A)/te%6+6)%6):I===y?se=60*((A-d)/te+2):se=60*((d-y)/te+4);const he=I===0?0:te/I,pe=I;return[se,he*100,pe*100]}function rr(u,a,l){const d=nr(u,360),y=Oe(a/100,0,1),A=Oe(l/100,0,1),I=A*y,K=I*(1-Math.abs(d/60%2-1)),te=A-I;let se,he,pe;return d>=0&&d<60?[se,he,pe]=[I,K,0]:d>=60&&d<120?[se,he,pe]=[K,I,0]:d>=120&&d<180?[se,he,pe]=[0,I,K]:d>=180&&d<240?[se,he,pe]=[0,K,I]:d>=240&&d<300?[se,he,pe]=[K,0,I]:[se,he,pe]=[I,0,K],[(se+te)*255,(he+te)*255,(pe+te)*255]}function ol(u,a,l){const d=l+a*(100-Math.abs(2*l-100))/200;return[u,d!==0?a*(100-Math.abs(2*l-100))/d:0,l+a*(100-Math.abs(2*l-100))/(2*100)]}function ll(u,a,l){const d=100-Math.abs(l*(200-a)/100-100);return[u,d!==0?a*l/d:0,l*(200-a)/(2*100)]}function b(u){return[u[0],u[1],u[2]]}function h(u,a){return[u[0],u[1],u[2],a]}const f={hsl:{hsl:(u,a,l)=>[u,a,l],hsv:ol,rgb:Hs},hsv:{hsl:ll,hsv:(u,a,l)=>[u,a,l],rgb:rr},rgb:{hsl:al,hsv:rl,rgb:(u,a,l)=>[u,a,l]}};function x(u,a){return[a==="float"?1:u==="rgb"?255:360,a==="float"?1:u==="rgb"?255:100,a==="float"?1:u==="rgb"?255:100]}function w(u,a,l){var d;const y=x(a,l);return[a==="rgb"?Oe(u[0],0,y[0]):nr(u[0],y[0]),Oe(u[1],0,y[1]),Oe(u[2],0,y[2]),Oe((d=u[3])!==null&&d!==void 0?d:1,0,1)]}function P(u,a,l,d){const y=x(a,l),A=x(a,d);return u.map((I,K)=>I/y[K]*A[K])}function k(u,a,l){const d=P(u,a.mode,a.type,"int"),y=f[a.mode][l.mode](...d);return P(y,l.mode,"int",l.type)}function X(u,a){return typeof u!="object"||v(u)?!1:a in u&&typeof u[a]=="number"}class Z{constructor(a,l,d="int"){this.mode=l,this.type=d,this.comps_=w(a,l,d)}static black(a="int"){return new Z([0,0,0],"rgb",a)}static fromObject(a,l="int"){const d="a"in a?[a.r,a.g,a.b,a.a]:[a.r,a.g,a.b];return new Z(d,"rgb",l)}static toRgbaObject(a,l="int"){return a.toRgbaObject(l)}static isRgbColorObject(a){return X(a,"r")&&X(a,"g")&&X(a,"b")}static isRgbaColorObject(a){return this.isRgbColorObject(a)&&X(a,"a")}static isColorObject(a){return this.isRgbColorObject(a)}static equals(a,l){if(a.mode!==l.mode)return!1;const d=a.comps_,y=l.comps_;for(let A=0;A<d.length;A++)if(d[A]!==y[A])return!1;return!0}getComponents(a,l="int"){return h(k(b(this.comps_),{mode:this.mode,type:this.type},{mode:a!=null?a:this.mode,type:l}),this.comps_[3])}toRgbaObject(a="int"){const l=this.getComponents("rgb",a);return{r:l[0],g:l[1],b:l[2],a:l[3]}}}const Fe=B("colp");class Rt{constructor(a,l){this.alphaViews_=null,this.element=a.createElement("div"),this.element.classList.add(Fe());const d=a.createElement("div");d.classList.add(Fe("hsv"));const y=a.createElement("div");y.classList.add(Fe("sv")),this.svPaletteView_=l.svPaletteView,y.appendChild(this.svPaletteView_.element),d.appendChild(y);const A=a.createElement("div");A.classList.add(Fe("h")),this.hPaletteView_=l.hPaletteView,A.appendChild(this.hPaletteView_.element),d.appendChild(A),this.element.appendChild(d);const I=a.createElement("div");if(I.classList.add(Fe("rgb")),this.textView_=l.textView,I.appendChild(this.textView_.element),this.element.appendChild(I),l.alphaViews){this.alphaViews_={palette:l.alphaViews.palette,text:l.alphaViews.text};const K=a.createElement("div");K.classList.add(Fe("a"));const te=a.createElement("div");te.classList.add(Fe("ap")),te.appendChild(this.alphaViews_.palette.element),K.appendChild(te);const se=a.createElement("div");se.classList.add(Fe("at")),se.appendChild(this.alphaViews_.text.element),K.appendChild(se),this.element.appendChild(K)}}get allFocusableElements(){const a=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(l=>l.inputElement)];return this.alphaViews_&&a.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),a}}function Gs(u){return u==="int"?"int":u==="float"?"float":void 0}function Vs(u){const a=ae;return xe(u,{alpha:a.optional.boolean,color:a.optional.object({alpha:a.optional.boolean,type:a.optional.custom(Gs)}),expanded:a.optional.boolean,picker:a.optional.custom(sr)})}function en(u){return u?.1:1}function Qn(u){var a;return(a=u.color)===null||a===void 0?void 0:a.type}function C0(u,a){return u.alpha===a.alpha&&u.mode===a.mode&&u.notation===a.notation&&u.type===a.type}function yt(u,a){const l=u.match(/^(.+)%$/);return Math.min(l?parseFloat(l[1])*.01*a:parseFloat(u),a)}const S0={deg:u=>u,grad:u=>u*360/400,rad:u=>u*360/(2*Math.PI),turn:u=>u*360};function Wc(u){const a=u.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!a)return parseFloat(u);const l=parseFloat(a[1]),d=a[2];return S0[d](l)}function jc(u){const a=u.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!a)return null;const l=[yt(a[1],255),yt(a[2],255),yt(a[3],255)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])?null:l}function Kc(u){return a=>{const l=jc(a);return l?new Z(l,"rgb",u):null}}function Jc(u){const a=u.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!a)return null;const l=[yt(a[1],255),yt(a[2],255),yt(a[3],255),yt(a[4],1)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])||isNaN(l[3])?null:l}function $c(u){return a=>{const l=Jc(a);return l?new Z(l,"rgb",u):null}}function qc(u){const a=u.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!a)return null;const l=[Wc(a[1]),yt(a[2],100),yt(a[3],100)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])?null:l}function Xc(u){return a=>{const l=qc(a);return l?new Z(l,"hsl",u):null}}function Yc(u){const a=u.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!a)return null;const l=[Wc(a[1]),yt(a[2],100),yt(a[3],100),yt(a[4],1)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])||isNaN(l[3])?null:l}function Qc(u){return a=>{const l=Yc(a);return l?new Z(l,"hsl",u):null}}function Zc(u){const a=u.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(a)return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)];const l=u.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:null}function w0(u){const a=Zc(u);return a?new Z(a,"rgb","int"):null}function eh(u){const a=u.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(a)return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),ye(parseInt(a[4]+a[4],16),0,255,0,1)];const l=u.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16),ye(parseInt(l[4],16),0,255,0,1)]:null}function A0(u){const a=eh(u);return a?new Z(a,"rgb","int"):null}function th(u){const a=u.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!a)return null;const l=[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3])];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])?null:l}function nh(u){return a=>{const l=th(a);return l?new Z(l,"rgb",u):null}}function ih(u){const a=u.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!a)return null;const l=[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])||isNaN(l[3])?null:l}function sh(u){return a=>{const l=ih(a);return l?new Z(l,"rgb",u):null}}const E0=[{parser:Zc,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:eh,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:jc,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Jc,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:qc,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Yc,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:th,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ih,result:{alpha:!0,mode:"rgb",notation:"object"}}];function T0(u){return E0.reduce((a,{parser:l,result:d})=>a||(l(u)?d:null),null)}function ul(u,a="int"){const l=T0(u);return l?l.notation==="hex"&&a!=="float"?Object.assign(Object.assign({},l),{type:"int"}):l.notation==="func"?Object.assign(Object.assign({},l),{type:a}):null:null}const ah={int:[w0,A0,Kc("int"),$c("int"),Xc("int"),Qc("int"),nh("int"),sh("int")],float:[Kc("float"),$c("float"),Xc("float"),Qc("float"),nh("float"),sh("float")]};function M0(u){const a=ah[u];return l=>{if(typeof l!="string")return Z.black(u);const d=a.reduce((y,A)=>y||A(l),null);return d!=null?d:Z.black(u)}}function cl(u){const a=ah[u];return l=>a.reduce((d,y)=>d||y(l),null)}function rh(u){const a=Oe(Math.floor(u),0,255).toString(16);return a.length===1?`0${a}`:a}function oh(u,a="#"){const l=b(u.getComponents("rgb")).map(rh).join("");return`${a}${l}`}function hl(u,a="#"){const l=u.getComponents("rgb"),d=[l[0],l[1],l[2],l[3]*255].map(rh).join("");return`${a}${d}`}function lh(u,a){const l=Ee(a==="float"?2:0);return`rgb(${b(u.getComponents("rgb",a)).map(y=>l(y)).join(", ")})`}function B0(u){return a=>lh(a,u)}function or(u,a){const l=Ee(2),d=Ee(a==="float"?2:0);return`rgba(${u.getComponents("rgb",a).map((A,I)=>(I===3?l:d)(A)).join(", ")})`}function P0(u){return a=>or(a,u)}function I0(u){const a=[Ee(0),gn,gn];return`hsl(${b(u.getComponents("hsl")).map((d,y)=>a[y](d)).join(", ")})`}function R0(u){const a=[Ee(0),gn,gn,Ee(2)];return`hsla(${u.getComponents("hsl").map((d,y)=>a[y](d)).join(", ")})`}function uh(u,a){const l=Ee(a==="float"?2:0),d=["r","g","b"];return`{${b(u.getComponents("rgb",a)).map((A,I)=>`${d[I]}: ${l(A)}`).join(", ")}}`}function O0(u){return a=>uh(a,u)}function ch(u,a){const l=Ee(2),d=Ee(a==="float"?2:0),y=["r","g","b","a"];return`{${u.getComponents("rgb",a).map((I,K)=>{const te=K===3?l:d;return`${y[K]}: ${te(I)}`}).join(", ")}}`}function F0(u){return a=>ch(a,u)}const D0=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:oh},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:hl},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:I0},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:R0},...["int","float"].reduce((u,a)=>[...u,{format:{alpha:!1,mode:"rgb",notation:"func",type:a},stringifier:B0(a)},{format:{alpha:!0,mode:"rgb",notation:"func",type:a},stringifier:P0(a)},{format:{alpha:!1,mode:"rgb",notation:"object",type:a},stringifier:O0(a)},{format:{alpha:!0,mode:"rgb",notation:"object",type:a},stringifier:F0(a)}],[])];function pl(u){return D0.reduce((a,l)=>a||(C0(l.format,u)?l.stringifier:null),null)}const Ws=B("apl");class L0{constructor(a,l){this.onValueChange_=this.onValueChange_.bind(this),this.value=l.value,this.value.emitter.on("change",this.onValueChange_),this.element=a.createElement("div"),this.element.classList.add(Ws()),l.viewProps.bindTabIndex(this.element);const d=a.createElement("div");d.classList.add(Ws("b")),this.element.appendChild(d);const y=a.createElement("div");y.classList.add(Ws("c")),d.appendChild(y),this.colorElem_=y;const A=a.createElement("div");A.classList.add(Ws("m")),this.element.appendChild(A),this.markerElem_=A;const I=a.createElement("div");I.classList.add(Ws("p")),this.markerElem_.appendChild(I),this.previewElem_=I,this.update_()}update_(){const a=this.value.rawValue,l=a.getComponents("rgb"),d=new Z([l[0],l[1],l[2],0],"rgb"),y=new Z([l[0],l[1],l[2],255],"rgb"),A=["to right",or(d),or(y)];this.colorElem_.style.background=`linear-gradient(${A.join(",")})`,this.previewElem_.style.backgroundColor=or(a);const I=ye(l[3],0,1,0,100);this.markerElem_.style.left=`${I}%`}onValueChange_(){this.update_()}}class N0{constructor(a,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new L0(a,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(a,l){if(!a.point)return;const d=a.point.x/a.bounds.width,y=this.value.rawValue,[A,I,K]=y.getComponents("hsv");this.value.setRawValue(new Z([A,I,K,d],"hsv"),l)}onPointerDown_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerMove_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerUp_(a){this.handlePointerEvent_(a.data,{forceEmit:!0,last:!0})}onKeyDown_(a){const l=je(en(!0),Pt(a));if(l===0)return;const d=this.value.rawValue,[y,A,I,K]=d.getComponents("hsv");this.value.setRawValue(new Z([y,A,I,K+l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(a){je(en(!0),Pt(a))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Pi=B("coltxt");function k0(u){const a=u.createElement("select"),l=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return a.appendChild(l.reduce((d,y)=>{const A=u.createElement("option");return A.textContent=y.text,A.value=y.value,d.appendChild(A),d},u.createDocumentFragment())),a}class z0{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Pi());const d=a.createElement("div");d.classList.add(Pi("m")),this.modeElem_=k0(a),this.modeElem_.classList.add(Pi("ms")),d.appendChild(this.modeSelectElement);const y=a.createElement("div");y.classList.add(Pi("mm")),y.appendChild(xi(a,"dropdown")),d.appendChild(y),this.element.appendChild(d);const A=a.createElement("div");A.classList.add(Pi("w")),this.element.appendChild(A),this.textsElem_=A,this.textViews_=l.textViews,this.applyTextViews_(),H(l.colorMode,I=>{this.modeElem_.value=I})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(a){this.textViews_=a,this.applyTextViews_()}applyTextViews_(){Fa(this.textsElem_);const a=this.element.ownerDocument;this.textViews_.forEach(l=>{const d=a.createElement("div");d.classList.add(Pi("c")),d.appendChild(l.element),this.textsElem_.appendChild(d)})}}function U0(u){return Ee(u==="float"?2:0)}function H0(u,a,l){const d=x(u,a)[l];return new mt({min:0,max:d})}function dl(u,a,l){return new It(u,{arrayPosition:l===0?"fst":l===3-1?"lst":"mid",baseStep:en(!1),parser:a.parser,props:j.fromObject({draggingScale:a.colorType==="float"?.01:1,formatter:U0(a.colorType)}),value:V(0,{constraint:H0(a.colorMode,a.colorType,l)}),viewProps:a.viewProps})}class G0{constructor(a,l){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=l.colorType,this.parser_=l.parser,this.value=l.value,this.viewProps=l.viewProps,this.colorMode=V(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(a),this.view=new z0(a,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(a){const l={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},d=[dl(a,l,0),dl(a,l,1),dl(a,l,2)];return d.forEach((y,A)=>{_n({primary:this.value,secondary:y.value,forward:I=>I.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[A],backward:(I,K)=>{const te=this.colorMode.rawValue,se=I.rawValue.getComponents(te,this.colorType_);return se[A]=K.rawValue,new Z(h(b(se),se[3]),te,this.colorType_)}})}),d}onModeSelectChange_(a){const l=a.currentTarget;this.colorMode.rawValue=l.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const ml=B("hpl");class V0{constructor(a,l){this.onValueChange_=this.onValueChange_.bind(this),this.value=l.value,this.value.emitter.on("change",this.onValueChange_),this.element=a.createElement("div"),this.element.classList.add(ml()),l.viewProps.bindTabIndex(this.element);const d=a.createElement("div");d.classList.add(ml("c")),this.element.appendChild(d);const y=a.createElement("div");y.classList.add(ml("m")),this.element.appendChild(y),this.markerElem_=y,this.update_()}update_(){const a=this.value.rawValue,[l]=a.getComponents("hsv");this.markerElem_.style.backgroundColor=lh(new Z([l,100,100],"hsv"));const d=ye(l,0,360,0,100);this.markerElem_.style.left=`${d}%`}onValueChange_(){this.update_()}}class W0{constructor(a,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new V0(a,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(a,l){if(!a.point)return;const d=ye(Oe(a.point.x,0,a.bounds.width),0,a.bounds.width,0,359),y=this.value.rawValue,[,A,I,K]=y.getComponents("hsv");this.value.setRawValue(new Z([d,A,I,K],"hsv"),l)}onPointerDown_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerMove_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerUp_(a){this.handlePointerEvent_(a.data,{forceEmit:!0,last:!0})}onKeyDown_(a){const l=je(en(!1),Pt(a));if(l===0)return;const d=this.value.rawValue,[y,A,I,K]=d.getComponents("hsv");this.value.setRawValue(new Z([y+l,A,I,K],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(a){je(en(!1),Pt(a))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const fl=B("svp"),hh=64;class j0{constructor(a,l){this.onValueChange_=this.onValueChange_.bind(this),this.value=l.value,this.value.emitter.on("change",this.onValueChange_),this.element=a.createElement("div"),this.element.classList.add(fl()),l.viewProps.bindTabIndex(this.element);const d=a.createElement("canvas");d.height=hh,d.width=hh,d.classList.add(fl("c")),this.element.appendChild(d),this.canvasElement=d;const y=a.createElement("div");y.classList.add(fl("m")),this.element.appendChild(y),this.markerElem_=y,this.update_()}update_(){const a=ao(this.canvasElement);if(!a)return;const d=this.value.rawValue.getComponents("hsv"),y=this.canvasElement.width,A=this.canvasElement.height,I=a.getImageData(0,0,y,A),K=I.data;for(let he=0;he<A;he++)for(let pe=0;pe<y;pe++){const nn=ye(pe,0,y,0,100),Ks=ye(he,0,A,100,0),Js=rr(d[0],nn,Ks),Fi=(he*y+pe)*4;K[Fi]=Js[0],K[Fi+1]=Js[1],K[Fi+2]=Js[2],K[Fi+3]=255}a.putImageData(I,0,0);const te=ye(d[1],0,100,0,100);this.markerElem_.style.left=`${te}%`;const se=ye(d[2],0,100,100,0);this.markerElem_.style.top=`${se}%`}onValueChange_(){this.update_()}}class K0{constructor(a,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new j0(a,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(a,l){if(!a.point)return;const d=ye(a.point.x,0,a.bounds.width,0,100),y=ye(a.point.y,0,a.bounds.height,100,0),[A,,,I]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Z([A,d,y,I],"hsv"),l)}onPointerDown_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerMove_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerUp_(a){this.handlePointerEvent_(a.data,{forceEmit:!0,last:!0})}onKeyDown_(a){er(a.key)&&a.preventDefault();const[l,d,y,A]=this.value.rawValue.getComponents("hsv"),I=en(!1),K=je(I,Pt(a)),te=je(I,xt(a));K===0&&te===0||this.value.setRawValue(new Z([l,d+K,y+te,A],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(a){const l=en(!1),d=je(l,Pt(a)),y=je(l,xt(a));d===0&&y===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class J0{constructor(a,l){this.value=l.value,this.viewProps=l.viewProps,this.hPaletteC_=new W0(a,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new K0(a,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=l.supportsAlpha?{palette:new N0(a,{value:this.value,viewProps:this.viewProps}),text:new It(a,{parser:Mt,baseStep:.1,props:j.fromObject({draggingScale:.01,formatter:Ee(2)}),value:V(0,{constraint:new mt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&_n({primary:this.value,secondary:this.alphaIcs_.text.value,forward:d=>d.rawValue.getComponents()[3],backward:(d,y)=>{const A=d.rawValue.getComponents();return A[3]=y.rawValue,new Z(A,d.rawValue.mode)}}),this.textC_=new G0(a,{colorType:l.colorType,parser:Mt,value:this.value,viewProps:this.viewProps}),this.view=new Rt(a,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:l.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const vl=B("colsw");class $0{constructor(a,l){this.onValueChange_=this.onValueChange_.bind(this),l.value.emitter.on("change",this.onValueChange_),this.value=l.value,this.element=a.createElement("div"),this.element.classList.add(vl()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("div");d.classList.add(vl("sw")),this.element.appendChild(d),this.swatchElem_=d;const y=a.createElement("button");y.classList.add(vl("b")),l.viewProps.bindDisabled(y),this.element.appendChild(y),this.buttonElement=y,this.update_()}update_(){const a=this.value.rawValue;this.swatchElem_.style.backgroundColor=hl(a)}onValueChange_(){this.update_()}}class q0{constructor(a,l){this.value=l.value,this.viewProps=l.viewProps,this.view=new $0(a,{value:this.value,viewProps:this.viewProps})}}class gl{constructor(a,l){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.foldable_=Un.create(l.expanded),this.swatchC_=new q0(a,{value:this.value,viewProps:this.viewProps});const d=this.swatchC_.view.buttonElement;d.addEventListener("blur",this.onButtonBlur_),d.addEventListener("click",this.onButtonClick_),this.textC_=new $n(a,{parser:l.parser,props:j.fromObject({formatter:l.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Us(a,{foldable:this.foldable_,pickerLayout:l.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=l.pickerLayout==="popup"?new Bs(a,{viewProps:this.viewProps}):null;const y=new J0(a,{colorType:l.colorType,supportsAlpha:l.supportsAlpha,value:this.value,viewProps:this.viewProps});y.view.allFocusableElements.forEach(A=>{A.addEventListener("blur",this.onPopupChildBlur_),A.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=y,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(y.view.element),_n({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:A=>A.rawValue,backward:(A,I)=>I.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),vs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(a){if(!this.popC_)return;const l=this.view.element,d=a.relatedTarget;(!d||!l.contains(d))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(a){if(!this.popC_)return;const l=this.popC_.view.element,d=$t(a);d&&l.contains(d)||d&&d===this.swatchC_.view.buttonElement&&!hs(l.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(a){this.popC_?a.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&a.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function X0(u,a){return Z.isColorObject(u)?Z.fromObject(u,a):Z.black(a)}function Y0(u){return b(u.getComponents("rgb")).reduce((a,l)=>a<<8|Math.floor(l)&255,0)}function Q0(u){return u.getComponents("rgb").reduce((a,l,d)=>{const y=Math.floor(d===3?l*255:l)&255;return a<<8|y},0)>>>0}function Z0(u){return new Z([u>>16&255,u>>8&255,u&255],"rgb")}function ev(u){return new Z([u>>24&255,u>>16&255,u>>8&255,ye(u&255,0,255,0,1)],"rgb")}function tv(u){return typeof u!="number"?Z.black():Z0(u)}function nv(u){return typeof u!="number"?Z.black():ev(u)}function iv(u){const a=pl(u);return a?(l,d)=>{bn(l,a(d))}:null}function sv(u){const a=u?Q0:Y0;return(l,d)=>{bn(l,a(d))}}function av(u,a,l){const d=a.toRgbaObject(l);u.writeProperty("r",d.r),u.writeProperty("g",d.g),u.writeProperty("b",d.b),u.writeProperty("a",d.a)}function rv(u,a,l){const d=a.toRgbaObject(l);u.writeProperty("r",d.r),u.writeProperty("g",d.g),u.writeProperty("b",d.b)}function ov(u,a){return(l,d)=>{u?av(l,d,a):rv(l,d,a)}}function _l(u){var a;return!!((u==null?void 0:u.alpha)||((a=u==null?void 0:u.color)===null||a===void 0?void 0:a.alpha))}function lv(u){return u?a=>hl(a,"0x"):a=>oh(a,"0x")}function uv(u){return"color"in u||"view"in u&&u.view==="color"}const cv={id:"input-color-number",type:"input",accept:(u,a)=>{if(typeof u!="number"||!uv(a))return null;const l=Vs(a);return l?{initialValue:u,params:l}:null},binding:{reader:u=>_l(u.params)?nv:tv,equals:Z.equals,writer:u=>sv(_l(u.params))},controller:u=>{const a=_l(u.params),l="expanded"in u.params?u.params.expanded:void 0,d="picker"in u.params?u.params.picker:void 0;return new gl(u.document,{colorType:"int",expanded:l!=null?l:!1,formatter:lv(a),parser:cl("int"),pickerLayout:d!=null?d:"popup",supportsAlpha:a,value:u.value,viewProps:u.viewProps})}};function hv(u){return Z.isRgbaColorObject(u)}function pv(u){return a=>X0(a,u)}function dv(u,a){return l=>u?ch(l,a):uh(l,a)}const mv={id:"input-color-object",type:"input",accept:(u,a)=>{if(!Z.isColorObject(u))return null;const l=Vs(a);return l?{initialValue:u,params:l}:null},binding:{reader:u=>pv(Qn(u.params)),equals:Z.equals,writer:u=>ov(hv(u.initialValue),Qn(u.params))},controller:u=>{var a;const l=Z.isRgbaColorObject(u.initialValue),d="expanded"in u.params?u.params.expanded:void 0,y="picker"in u.params?u.params.picker:void 0,A=(a=Qn(u.params))!==null&&a!==void 0?a:"int";return new gl(u.document,{colorType:A,expanded:d!=null?d:!1,formatter:dv(l,A),parser:cl(A),pickerLayout:y!=null?y:"popup",supportsAlpha:l,value:u.value,viewProps:u.viewProps})}},fv={id:"input-color-string",type:"input",accept:(u,a)=>{if(typeof u!="string"||"view"in a&&a.view==="text")return null;const l=ul(u,Qn(a));if(!l||!pl(l))return null;const y=Vs(a);return y?{initialValue:u,params:y}:null},binding:{reader:u=>{var a;return M0((a=Qn(u.params))!==null&&a!==void 0?a:"int")},equals:Z.equals,writer:u=>{const a=ul(u.initialValue,Qn(u.params));if(!a)throw S.shouldNeverHappen();const l=iv(a);if(!l)throw S.notBindable();return l}},controller:u=>{const a=ul(u.initialValue,Qn(u.params));if(!a)throw S.shouldNeverHappen();const l=pl(a);if(!l)throw S.shouldNeverHappen();const d="expanded"in u.params?u.params.expanded:void 0,y="picker"in u.params?u.params.picker:void 0;return new gl(u.document,{colorType:a.type,expanded:d!=null?d:!1,formatter:l,parser:cl(a.type),pickerLayout:y!=null?y:"popup",supportsAlpha:a.alpha,value:u.value,viewProps:u.viewProps})}};class Sn{constructor(a){this.components=a.components,this.asm_=a.assembly}constrain(a){const l=this.asm_.toComponents(a).map((d,y)=>{var A,I;return(I=(A=this.components[y])===null||A===void 0?void 0:A.constrain(d))!==null&&I!==void 0?I:d});return this.asm_.fromComponents(l)}}const ph=B("pndtxt");class vv{constructor(a,l){this.textViews=l.textViews,this.element=a.createElement("div"),this.element.classList.add(ph()),this.textViews.forEach(d=>{const y=a.createElement("div");y.classList.add(ph("a")),y.appendChild(d.element),this.element.appendChild(y)})}}function gv(u,a,l){return new It(u,{arrayPosition:l===0?"fst":l===a.axes.length-1?"lst":"mid",baseStep:a.axes[l].baseStep,parser:a.parser,props:a.axes[l].textProps,value:V(0,{constraint:a.axes[l].constraint}),viewProps:a.viewProps})}class bl{constructor(a,l){this.value=l.value,this.viewProps=l.viewProps,this.acs_=l.axes.map((d,y)=>gv(a,l,y)),this.acs_.forEach((d,y)=>{_n({primary:this.value,secondary:d.value,forward:A=>l.assembly.toComponents(A.rawValue)[y],backward:(A,I)=>{const K=l.assembly.toComponents(A.rawValue);return K[y]=I.rawValue,l.assembly.fromComponents(K)}})}),this.view=new vv(a,{textViews:this.acs_.map(d=>d.view)})}}function dh(u,a){return"step"in u&&!v(u.step)?new We(u.step,a):null}function mh(u){return"max"in u&&!v(u.max)||"min"in u&&!v(u.min)?new mt({max:u.max,min:u.min}):null}function _v(u,a){const l=[],d=dh(u,a);d&&l.push(d);const y=mh(u);y&&l.push(y);const A=ks(u.options);return A&&l.push(A),new Gt(l)}function bv(u){const a=u?me(u,mt):null;return a?[a.minValue,a.maxValue]:[void 0,void 0]}function xv(u){const[a,l]=bv(u);return[a!=null?a:0,l!=null?l:100]}const yv={id:"input-number",type:"input",accept:(u,a)=>{if(typeof u!="number")return null;const l=ae,d=xe(a,{format:l.optional.function,max:l.optional.number,min:l.optional.number,options:l.optional.custom(xn),step:l.optional.number});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Os,constraint:u=>_v(u.params,u.initialValue),writer:u=>bn},controller:u=>{var a,l;const d=u.value,y=u.constraint;if(y&&me(y,vn))return new Yt(u.document,{props:j.fromObject({options:(a=zs(y))!==null&&a!==void 0?a:[]}),value:d,viewProps:u.viewProps});const A=(l="format"in u.params?u.params.format:void 0)!==null&&l!==void 0?l:Ee(Mi(y,d.rawValue));if(y&&me(y,mt)){const[I,K]=xv(y);return new Ti(u.document,{baseStep:yn(y),parser:Mt,sliderProps:j.fromObject({maxValue:K,minValue:I}),textProps:j.fromObject({draggingScale:Cn(y,d.rawValue),formatter:A}),value:d,viewProps:u.viewProps})}return new It(u.document,{baseStep:yn(y),parser:Mt,props:j.fromObject({draggingScale:Cn(y,d.rawValue),formatter:A}),value:d,viewProps:u.viewProps})}};class wn{constructor(a=0,l=0){this.x=a,this.y=l}getComponents(){return[this.x,this.y]}static isObject(a){if(v(a))return!1;const l=a.x,d=a.y;return!(typeof l!="number"||typeof d!="number")}static equals(a,l){return a.x===l.x&&a.y===l.y}toObject(){return{x:this.x,y:this.y}}}const fh={toComponents:u=>u.getComponents(),fromComponents:u=>new wn(...u)},Ii=B("p2d");class Cv{constructor(a,l){this.element=a.createElement("div"),this.element.classList.add(Ii()),l.viewProps.bindClassModifiers(this.element),H(l.expanded,U(this.element,Ii(void 0,"expanded")));const d=a.createElement("div");d.classList.add(Ii("h")),this.element.appendChild(d);const y=a.createElement("button");y.classList.add(Ii("b")),y.appendChild(xi(a,"p2dpad")),l.viewProps.bindDisabled(y),d.appendChild(y),this.buttonElement=y;const A=a.createElement("div");if(A.classList.add(Ii("t")),d.appendChild(A),this.textElement=A,l.pickerLayout==="inline"){const I=a.createElement("div");I.classList.add(Ii("p")),this.element.appendChild(I),this.pickerElement=I}else this.pickerElement=null}}const An=B("p2dp");class Sv{constructor(a,l){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=l.invertsY,this.maxValue_=l.maxValue,this.element=a.createElement("div"),this.element.classList.add(An()),l.layout==="popup"&&this.element.classList.add(An(void 0,"p"));const d=a.createElement("div");d.classList.add(An("p")),l.viewProps.bindTabIndex(d),this.element.appendChild(d),this.padElement=d;const y=a.createElementNS(tt,"svg");y.classList.add(An("g")),this.padElement.appendChild(y),this.svgElem_=y;const A=a.createElementNS(tt,"line");A.classList.add(An("ax")),A.setAttributeNS(null,"x1","0"),A.setAttributeNS(null,"y1","50%"),A.setAttributeNS(null,"x2","100%"),A.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(A);const I=a.createElementNS(tt,"line");I.classList.add(An("ax")),I.setAttributeNS(null,"x1","50%"),I.setAttributeNS(null,"y1","0"),I.setAttributeNS(null,"x2","50%"),I.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(I);const K=a.createElementNS(tt,"line");K.classList.add(An("l")),K.setAttributeNS(null,"x1","50%"),K.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(K),this.lineElem_=K;const te=a.createElement("div");te.classList.add(An("m")),this.padElement.appendChild(te),this.markerElem_=te,l.value.emitter.on("change",this.onValueChange_),this.value=l.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[a,l]=this.value.rawValue.getComponents(),d=this.maxValue_,y=ye(a,-d,+d,0,100),A=ye(l,-d,+d,0,100),I=this.invertsY_?100-A:A;this.lineElem_.setAttributeNS(null,"x2",`${y}%`),this.lineElem_.setAttributeNS(null,"y2",`${I}%`),this.markerElem_.style.left=`${y}%`,this.markerElem_.style.top=`${I}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function vh(u,a,l){return[je(a[0],Pt(u)),je(a[1],xt(u))*(l?1:-1)]}class wv{constructor(a,l){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.baseSteps_=l.baseSteps,this.maxValue_=l.maxValue,this.invertsY_=l.invertsY,this.view=new Sv(a,{invertsY:this.invertsY_,layout:l.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(a,l){if(!a.point)return;const d=this.maxValue_,y=ye(a.point.x,0,a.bounds.width,-d,+d),A=ye(this.invertsY_?a.bounds.height-a.point.y:a.point.y,0,a.bounds.height,-d,+d);this.value.setRawValue(new wn(y,A),l)}onPointerDown_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerMove_(a){this.handlePointerEvent_(a.data,{forceEmit:!1,last:!1})}onPointerUp_(a){this.handlePointerEvent_(a.data,{forceEmit:!0,last:!0})}onPadKeyDown_(a){er(a.key)&&a.preventDefault();const[l,d]=vh(a,this.baseSteps_,this.invertsY_);l===0&&d===0||this.value.setRawValue(new wn(this.value.rawValue.x+l,this.value.rawValue.y+d),{forceEmit:!1,last:!1})}onPadKeyUp_(a){const[l,d]=vh(a,this.baseSteps_,this.invertsY_);l===0&&d===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Av{constructor(a,l){var d,y;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.foldable_=Un.create(l.expanded),this.popC_=l.pickerLayout==="popup"?new Bs(a,{viewProps:this.viewProps}):null;const A=new wv(a,{baseSteps:[l.axes[0].baseStep,l.axes[1].baseStep],invertsY:l.invertsY,layout:l.pickerLayout,maxValue:l.maxValue,value:this.value,viewProps:this.viewProps});A.view.allFocusableElements.forEach(I=>{I.addEventListener("blur",this.onPopupChildBlur_),I.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=A,this.textC_=new bl(a,{assembly:fh,axes:l.axes,parser:l.parser,value:this.value,viewProps:this.viewProps}),this.view=new Cv(a,{expanded:this.foldable_.value("expanded"),pickerLayout:l.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(d=this.view.buttonElement)===null||d===void 0||d.addEventListener("blur",this.onPadButtonBlur_),(y=this.view.buttonElement)===null||y===void 0||y.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),_n({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:I=>I.rawValue,backward:(I,K)=>K.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),vs(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(a){if(!this.popC_)return;const l=this.view.element,d=a.relatedTarget;(!d||!l.contains(d))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(a){if(!this.popC_)return;const l=this.popC_.view.element,d=$t(a);d&&l.contains(d)||d&&d===this.view.buttonElement&&!hs(l.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(a){this.popC_?a.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&a.key==="Escape"&&this.view.buttonElement.focus()}}function Ev(u){return wn.isObject(u)?new wn(u.x,u.y):new wn}function Tv(u,a){u.writeProperty("x",a.x),u.writeProperty("y",a.y)}function tn(u,a){if(!u)return;const l=[],d=dh(u,a);d&&l.push(d);const y=mh(u);return y&&l.push(y),new Gt(l)}function Mv(u,a){return new Sn({assembly:fh,components:[tn("x"in u?u.x:void 0,a.x),tn("y"in u?u.y:void 0,a.y)]})}function gh(u,a){var l,d;const y=u&&me(u,mt);if(y)return Math.max(Math.abs((l=y.minValue)!==null&&l!==void 0?l:0),Math.abs((d=y.maxValue)!==null&&d!==void 0?d:0));const A=yn(u);return Math.max(Math.abs(A)*10,Math.abs(a)*10)}function Bv(u,a){const l=a instanceof Sn?a.components[0]:void 0,d=a instanceof Sn?a.components[1]:void 0,y=gh(l,u.x),A=gh(d,u.y);return Math.max(y,A)}function _h(u,a){return{baseStep:yn(a),constraint:a,textProps:j.fromObject({draggingScale:Cn(a,u),formatter:Ee(Mi(a,u))})}}function Pv(u){if(!("y"in u))return!1;const a=u.y;return a&&"inverted"in a?!!a.inverted:!1}const Iv={id:"input-point2d",type:"input",accept:(u,a)=>{if(!wn.isObject(u))return null;const l=ae,d=xe(a,{expanded:l.optional.boolean,picker:l.optional.custom(sr),x:l.optional.custom($e),y:l.optional.object({inverted:l.optional.boolean,max:l.optional.number,min:l.optional.number,step:l.optional.number})});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Ev,constraint:u=>Mv(u.params,u.initialValue),equals:wn.equals,writer:u=>Tv},controller:u=>{const a=u.document,l=u.value,d=u.constraint;if(!(d instanceof Sn))throw S.shouldNeverHappen();const y="expanded"in u.params?u.params.expanded:void 0,A="picker"in u.params?u.params.picker:void 0;return new Av(a,{axes:[_h(l.rawValue.x,d.components[0]),_h(l.rawValue.y,d.components[1])],expanded:y!=null?y:!1,invertsY:Pv(u.params),maxValue:Bv(l.rawValue,d),parser:Mt,pickerLayout:A!=null?A:"popup",value:l,viewProps:u.viewProps})}};class Ri{constructor(a=0,l=0,d=0){this.x=a,this.y=l,this.z=d}getComponents(){return[this.x,this.y,this.z]}static isObject(a){if(v(a))return!1;const l=a.x,d=a.y,y=a.z;return!(typeof l!="number"||typeof d!="number"||typeof y!="number")}static equals(a,l){return a.x===l.x&&a.y===l.y&&a.z===l.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const bh={toComponents:u=>u.getComponents(),fromComponents:u=>new Ri(...u)};function Rv(u){return Ri.isObject(u)?new Ri(u.x,u.y,u.z):new Ri}function Ov(u,a){u.writeProperty("x",a.x),u.writeProperty("y",a.y),u.writeProperty("z",a.z)}function Fv(u,a){return new Sn({assembly:bh,components:[tn("x"in u?u.x:void 0,a.x),tn("y"in u?u.y:void 0,a.y),tn("z"in u?u.z:void 0,a.z)]})}function xl(u,a){return{baseStep:yn(a),constraint:a,textProps:j.fromObject({draggingScale:Cn(a,u),formatter:Ee(Mi(a,u))})}}const Dv={id:"input-point3d",type:"input",accept:(u,a)=>{if(!Ri.isObject(u))return null;const l=ae,d=xe(a,{x:l.optional.custom($e),y:l.optional.custom($e),z:l.optional.custom($e)});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Rv,constraint:u=>Fv(u.params,u.initialValue),equals:Ri.equals,writer:u=>Ov},controller:u=>{const a=u.value,l=u.constraint;if(!(l instanceof Sn))throw S.shouldNeverHappen();return new bl(u.document,{assembly:bh,axes:[xl(a.rawValue.x,l.components[0]),xl(a.rawValue.y,l.components[1]),xl(a.rawValue.z,l.components[2])],parser:Mt,value:a,viewProps:u.viewProps})}};class Oi{constructor(a=0,l=0,d=0,y=0){this.x=a,this.y=l,this.z=d,this.w=y}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(a){if(v(a))return!1;const l=a.x,d=a.y,y=a.z,A=a.w;return!(typeof l!="number"||typeof d!="number"||typeof y!="number"||typeof A!="number")}static equals(a,l){return a.x===l.x&&a.y===l.y&&a.z===l.z&&a.w===l.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const xh={toComponents:u=>u.getComponents(),fromComponents:u=>new Oi(...u)};function Lv(u){return Oi.isObject(u)?new Oi(u.x,u.y,u.z,u.w):new Oi}function Nv(u,a){u.writeProperty("x",a.x),u.writeProperty("y",a.y),u.writeProperty("z",a.z),u.writeProperty("w",a.w)}function kv(u,a){return new Sn({assembly:xh,components:[tn("x"in u?u.x:void 0,a.x),tn("y"in u?u.y:void 0,a.y),tn("z"in u?u.z:void 0,a.z),tn("w"in u?u.w:void 0,a.w)]})}function zv(u,a){return{baseStep:yn(a),constraint:a,textProps:j.fromObject({draggingScale:Cn(a,u),formatter:Ee(Mi(a,u))})}}const Uv={id:"input-point4d",type:"input",accept:(u,a)=>{if(!Oi.isObject(u))return null;const l=ae,d=xe(a,{x:l.optional.custom($e),y:l.optional.custom($e),z:l.optional.custom($e),w:l.optional.custom($e)});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Lv,constraint:u=>kv(u.params,u.initialValue),equals:Oi.equals,writer:u=>Nv},controller:u=>{const a=u.value,l=u.constraint;if(!(l instanceof Sn))throw S.shouldNeverHappen();return new bl(u.document,{assembly:xh,axes:a.rawValue.getComponents().map((d,y)=>zv(d,l.components[y])),parser:Mt,value:a,viewProps:u.viewProps})}};function Hv(u){const a=[],l=ks(u.options);return l&&a.push(l),new Gt(a)}const Gv={id:"input-string",type:"input",accept:(u,a)=>{if(typeof u!="string")return null;const d=xe(a,{options:ae.optional.custom(xn)});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Qa,constraint:u=>Hv(u.params),writer:u=>bn},controller:u=>{var a;const l=u.document,d=u.value,y=u.constraint;return y&&me(y,vn)?new Yt(l,{props:j.fromObject({options:(a=zs(y))!==null&&a!==void 0?a:[]}),value:d,viewProps:u.viewProps}):new $n(l,{parser:A=>A,props:j.fromObject({formatter:Ei}),value:d,viewProps:u.viewProps})}},js={monitor:{defaultInterval:200,defaultLineCount:3}},yh=B("mll");class Vv{constructor(a,l){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=l.formatter,this.element=a.createElement("div"),this.element.classList.add(yh()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("textarea");d.classList.add(yh("i")),d.style.height=`calc(var(--bld-us) * ${l.lineCount})`,d.readOnly=!0,l.viewProps.bindDisabled(d),this.element.appendChild(d),this.textareaElem_=d,l.value.emitter.on("change",this.onValueUpdate_),this.value=l.value,this.update_()}update_(){const a=this.textareaElem_,l=a.scrollTop===a.scrollHeight-a.clientHeight,d=[];this.value.rawValue.forEach(y=>{y!==void 0&&d.push(this.formatter_(y))}),a.textContent=d.join(`
`),l&&(a.scrollTop=a.scrollHeight)}onValueUpdate_(){this.update_()}}class yl{constructor(a,l){this.value=l.value,this.viewProps=l.viewProps,this.view=new Vv(a,{formatter:l.formatter,lineCount:l.lineCount,value:this.value,viewProps:this.viewProps})}}const Ch=B("sgl");class Wv{constructor(a,l){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=l.formatter,this.element=a.createElement("div"),this.element.classList.add(Ch()),l.viewProps.bindClassModifiers(this.element);const d=a.createElement("input");d.classList.add(Ch("i")),d.readOnly=!0,d.type="text",l.viewProps.bindDisabled(d),this.element.appendChild(d),this.inputElement=d,l.value.emitter.on("change",this.onValueUpdate_),this.value=l.value,this.update_()}update_(){const a=this.value.rawValue,l=a[a.length-1];this.inputElement.value=l!==void 0?this.formatter_(l):""}onValueUpdate_(){this.update_()}}class Cl{constructor(a,l){this.value=l.value,this.viewProps=l.viewProps,this.view=new Wv(a,{formatter:l.formatter,value:this.value,viewProps:this.viewProps})}}const jv={id:"monitor-bool",type:"monitor",accept:(u,a)=>{if(typeof u!="boolean")return null;const d=xe(a,{lineCount:ae.optional.number});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Ka},controller:u=>{var a;return u.value.rawValue.length===1?new Cl(u.document,{formatter:Ja,value:u.value,viewProps:u.viewProps}):new yl(u.document,{formatter:Ja,lineCount:(a=u.params.lineCount)!==null&&a!==void 0?a:js.monitor.defaultLineCount,value:u.value,viewProps:u.viewProps})}},En=B("grl");class Kv{constructor(a,l){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=a.createElement("div"),this.element.classList.add(En()),l.viewProps.bindClassModifiers(this.element),this.formatter_=l.formatter,this.props_=l.props,this.cursor_=l.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const d=a.createElementNS(tt,"svg");d.classList.add(En("g")),d.style.height=`calc(var(--bld-us) * ${l.lineCount})`,this.element.appendChild(d),this.svgElem_=d;const y=a.createElementNS(tt,"polyline");this.svgElem_.appendChild(y),this.lineElem_=y;const A=a.createElement("div");A.classList.add(En("t"),B("tt")()),this.element.appendChild(A),this.tooltipElem_=A,l.value.emitter.on("change",this.onValueUpdate_),this.value=l.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const a=this.svgElem_.getBoundingClientRect(),l=this.value.rawValue.length-1,d=this.props_.get("minValue"),y=this.props_.get("maxValue"),A=[];this.value.rawValue.forEach((he,pe)=>{if(he===void 0)return;const nn=ye(pe,0,l,0,a.width),Ks=ye(he,d,y,a.height,0);A.push([nn,Ks].join(","))}),this.lineElem_.setAttributeNS(null,"points",A.join(" "));const I=this.tooltipElem_,K=this.value.rawValue[this.cursor_.rawValue];if(K===void 0){I.classList.remove(En("t","a"));return}const te=ye(this.cursor_.rawValue,0,l,0,a.width),se=ye(K,d,y,a.height,0);I.style.left=`${te}px`,I.style.top=`${se}px`,I.textContent=`${this.formatter_(K)}`,I.classList.contains(En("t","a"))||(I.classList.add(En("t","a"),En("t","in")),kt(I),I.classList.remove(En("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Jv{constructor(a,l){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=l.props,this.value=l.value,this.viewProps=l.viewProps,this.cursor_=V(-1),this.view=new Kv(a,{cursor:this.cursor_,formatter:l.formatter,lineCount:l.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!hs(a))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const d=new Qt(this.view.element);d.emitter.on("down",this.onGraphPointerDown_),d.emitter.on("move",this.onGraphPointerMove_),d.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(a){const l=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(ye(a.offsetX,0,l.width,0,this.value.rawValue.length))}onGraphPointerDown_(a){this.onGraphPointerMove_(a)}onGraphPointerMove_(a){if(!a.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ye(a.data.point.x,0,a.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Sl(u){return"format"in u&&!v(u.format)?u.format:Ee(2)}function $v(u){var a;return u.value.rawValue.length===1?new Cl(u.document,{formatter:Sl(u.params),value:u.value,viewProps:u.viewProps}):new yl(u.document,{formatter:Sl(u.params),lineCount:(a=u.params.lineCount)!==null&&a!==void 0?a:js.monitor.defaultLineCount,value:u.value,viewProps:u.viewProps})}function qv(u){var a,l,d;return new Jv(u.document,{formatter:Sl(u.params),lineCount:(a=u.params.lineCount)!==null&&a!==void 0?a:js.monitor.defaultLineCount,props:j.fromObject({maxValue:(l="max"in u.params?u.params.max:null)!==null&&l!==void 0?l:100,minValue:(d="min"in u.params?u.params.min:null)!==null&&d!==void 0?d:0}),value:u.value,viewProps:u.viewProps})}function Sh(u){return"view"in u&&u.view==="graph"}const Xv={id:"monitor-number",type:"monitor",accept:(u,a)=>{if(typeof u!="number")return null;const l=ae,d=xe(a,{format:l.optional.function,lineCount:l.optional.number,max:l.optional.number,min:l.optional.number,view:l.optional.string});return d?{initialValue:u,params:d}:null},binding:{defaultBufferSize:u=>Sh(u)?64:1,reader:u=>Os},controller:u=>Sh(u.params)?qv(u):$v(u)},Yv={id:"monitor-string",type:"monitor",accept:(u,a)=>{if(typeof u!="string")return null;const l=ae,d=xe(a,{lineCount:l.optional.number,multiline:l.optional.boolean});return d?{initialValue:u,params:d}:null},binding:{reader:u=>Qa},controller:u=>{var a;const l=u.value;return l.rawValue.length>1||"multiline"in u.params&&u.params.multiline?new yl(u.document,{formatter:Ei,lineCount:(a=u.params.lineCount)!==null&&a!==void 0?a:js.monitor.defaultLineCount,value:l,viewProps:u.viewProps}):new Cl(u.document,{formatter:Ei,value:l,viewProps:u.viewProps})}};class Qv{constructor(a){this.onValueChange_=this.onValueChange_.bind(this),this.reader=a.reader,this.writer=a.writer,this.emitter=new M,this.value=a.value,this.value.emitter.on("change",this.onValueChange_),this.target=a.target,this.read()}read(){const a=this.target.read();a!==void 0&&(this.value.rawValue=this.reader(a))}write_(a){this.writer(this.target,a)}onValueChange_(a){this.write_(a.rawValue),this.emitter.emit("change",{options:a.options,rawValue:a.rawValue,sender:this})}}function Zv(u,a){const l=u.accept(a.target.read(),a.params);if(v(l))return null;const d=ae,y={target:a.target,initialValue:l.initialValue,params:l.params},A=u.binding.reader(y),I=u.binding.constraint?u.binding.constraint(y):void 0,K=V(A(l.initialValue),{constraint:I,equals:u.binding.equals}),te=new Qv({reader:A,target:a.target,value:K,writer:u.binding.writer(y)}),se=d.optional.boolean(a.params.disabled).value,he=d.optional.boolean(a.params.hidden).value,pe=u.controller({constraint:I,document:a.document,initialValue:l.initialValue,params:l.params,value:te.value,viewProps:Ht.create({disabled:se,hidden:he})}),nn=d.optional.string(a.params.label).value;return new nt(a.document,{binding:te,blade:dn(),props:j.fromObject({label:nn!=null?nn:a.target.key}),valueController:pe})}class eg{constructor(a){this.onTick_=this.onTick_.bind(this),this.reader_=a.reader,this.target=a.target,this.emitter=new M,this.value=a.value,this.ticker=a.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const a=this.target.read();if(a===void 0)return;const l=this.value.rawValue,d=this.reader_(a);this.value.rawValue=Za(l,d),this.emitter.emit("update",{rawValue:d,sender:this})}onTick_(a){this.read()}}function tg(u,a){return a===0?new Va:new Ts(u,a!=null?a:js.monitor.defaultInterval)}function ng(u,a){var l,d,y;const A=ae,I=u.accept(a.target.read(),a.params);if(v(I))return null;const K={target:a.target,initialValue:I.initialValue,params:I.params},te=u.binding.reader(K),se=(d=(l=A.optional.number(a.params.bufferSize).value)!==null&&l!==void 0?l:u.binding.defaultBufferSize&&u.binding.defaultBufferSize(I.params))!==null&&d!==void 0?d:1,he=A.optional.number(a.params.interval).value,pe=new eg({reader:te,target:a.target,ticker:tg(a.document,he),value:Yo(se)}),nn=A.optional.boolean(a.params.disabled).value,Ks=A.optional.boolean(a.params.hidden).value,Js=u.controller({document:a.document,params:I.params,value:pe.value,viewProps:Ht.create({disabled:nn,hidden:Ks})}),Fi=(y=A.optional.string(a.params.label).value)!==null&&y!==void 0?y:a.target.key;return new Ut(a.document,{binding:pe,blade:dn(),props:j.fromObject({label:Fi}),valueController:Js})}class ig{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(a){a.type==="blade"?this.pluginsMap_.blades.unshift(a):a.type==="input"?this.pluginsMap_.inputs.unshift(a):a.type==="monitor"&&this.pluginsMap_.monitors.unshift(a)}createInput(a,l,d){const y=l.read();if(v(y))throw new S({context:{key:l.key},type:"nomatchingcontroller"});const A=this.pluginsMap_.inputs.reduce((I,K)=>I!=null?I:Zv(K,{document:a,target:l,params:d}),null);if(A)return A;throw new S({context:{key:l.key},type:"nomatchingcontroller"})}createMonitor(a,l,d){const y=this.pluginsMap_.monitors.reduce((A,I)=>A!=null?A:ng(I,{document:a,params:d,target:l}),null);if(y)return y;throw new S({context:{key:l.key},type:"nomatchingcontroller"})}createBlade(a,l){const d=this.pluginsMap_.blades.reduce((y,A)=>y!=null?y:Ao(A,{document:a,params:l}),null);if(!d)throw new S({type:"nomatchingview",context:{params:l}});return d}createBladeApi(a){if(a instanceof nt)return new bs(a);if(a instanceof Ut)return new Xt(a);if(a instanceof Wn)return new Vn(a,this);const l=this.pluginsMap_.blades.reduce((d,y)=>d!=null?d:y.api({controller:a,pool:this}),null);if(!l)throw S.shouldNeverHappen();return l}}function sg(){const u=new ig;return[Iv,Dv,Uv,Gv,yv,fv,mv,cv,sl,jv,Yv,Xv,yi,xo,za,Es].forEach(a=>{u.register(a)}),u}class wh extends s{constructor(a){super(a),this.emitter_=new M,this.controller_.valueController.value.emitter.on("change",l=>{this.emitter_.emit("change",{event:new o(this,l.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(a){this.controller_.props.set("label",a)}get options(){return this.controller_.valueController.props.get("options")}set options(a){this.controller_.valueController.props.set("options",a)}get value(){return this.controller_.valueController.value.rawValue}set value(a){this.controller_.valueController.value.rawValue=a}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}}class Ah extends s{constructor(a){super(a),this.emitter_=new M,this.controller_.valueController.value.emitter.on("change",l=>{this.emitter_.emit("change",{event:new o(this,l.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(a){this.controller_.props.set("label",a)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(a){this.controller_.valueController.sliderController.props.set("maxValue",a)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(a){this.controller_.valueController.sliderController.props.set("minValue",a)}get value(){return this.controller_.valueController.value.rawValue}set value(a){this.controller_.valueController.value.rawValue=a}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}}class Eh extends s{constructor(a){super(a),this.emitter_=new M,this.controller_.valueController.value.emitter.on("change",l=>{this.emitter_.emit("change",{event:new o(this,l.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(a){this.controller_.props.set("label",a)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(a){this.controller_.valueController.props.set("formatter",a)}get value(){return this.controller_.valueController.value.rawValue}set value(a){this.controller_.valueController.value.rawValue=a}on(a,l){const d=l.bind(this);return this.emitter_.on(a,y=>{d(y.event)}),this}}const ag=function(){return{id:"list",type:"blade",accept(u){const a=ae,l=xe(u,{options:a.required.custom(xn),value:a.required.raw,view:a.required.constant("list"),label:a.optional.string});return l?{params:l}:null},controller(u){const a=new Yt(u.document,{props:j.fromObject({options:ar(u.params.options)}),value:V(u.params.value),viewProps:u.viewProps});return new mn(u.document,{blade:u.blade,props:j.fromObject({label:u.params.label}),valueController:a})},api(u){return!(u.controller instanceof mn)||!(u.controller.valueController instanceof Yt)?null:new wh(u.controller)}}}();function rg(u){return u.reduce((a,l)=>Object.assign(a,{[l.presetKey]:l.read()}),{})}function og(u,a){u.forEach(l=>{const d=a[l.presetKey];d!==void 0&&l.write(d)})}class lg extends xs{constructor(a,l){super(a,l)}get element(){return this.controller_.view.element}importPreset(a){const l=this.controller_.rackController.rack.find(nt).map(d=>d.binding.target);og(l,a),this.refresh()}exportPreset(){const a=this.controller_.rackController.rack.find(nt).map(l=>l.binding.target);return rg(a)}refresh(){this.controller_.rackController.rack.find(nt).forEach(a=>{a.binding.read()}),this.controller_.rackController.rack.find(Ut).forEach(a=>{a.binding.read()})}}class ug extends Ss{constructor(a,l){super(a,{expanded:l.expanded,blade:l.blade,props:l.props,root:!0,viewProps:l.viewProps})}}const cg={id:"slider",type:"blade",accept(u){const a=ae,l=xe(u,{max:a.required.number,min:a.required.number,view:a.required.constant("slider"),format:a.optional.function,label:a.optional.string,value:a.optional.number});return l?{params:l}:null},controller(u){var a,l;const d=(a=u.params.value)!==null&&a!==void 0?a:0,y=new Ti(u.document,{baseStep:1,parser:Mt,sliderProps:j.fromObject({maxValue:u.params.max,minValue:u.params.min}),textProps:j.fromObject({draggingScale:Cn(void 0,d),formatter:(l=u.params.format)!==null&&l!==void 0?l:qo}),value:V(d),viewProps:u.viewProps});return new mn(u.document,{blade:u.blade,props:j.fromObject({label:u.params.label}),valueController:y})},api(u){return!(u.controller instanceof mn)||!(u.controller.valueController instanceof Ti)?null:new Ah(u.controller)}},hg=function(){return{id:"text",type:"blade",accept(u){const a=ae,l=xe(u,{parse:a.required.function,value:a.required.raw,view:a.required.constant("text"),format:a.optional.function,label:a.optional.string});return l?{params:l}:null},controller(u){var a;const l=new $n(u.document,{parser:u.params.parse,props:j.fromObject({formatter:(a=u.params.format)!==null&&a!==void 0?a:d=>String(d)}),value:V(u.params.value),viewProps:u.viewProps});return new mn(u.document,{blade:u.blade,props:j.fromObject({label:u.params.label}),valueController:l})},api(u){return!(u.controller instanceof mn)||!(u.controller.valueController instanceof $n)?null:new Eh(u.controller)}}}();function pg(u){const a=u.createElement("div");return a.classList.add(B("dfw")()),u.body&&u.body.appendChild(a),a}function Th(u,a,l){if(u.querySelector(`style[data-tp-style=${a}]`))return;const d=u.createElement("style");d.dataset.tpStyle=a,d.textContent=l,u.head.appendChild(d)}class dg extends lg{constructor(a){var l,d;const y=a!=null?a:{},A=(l=y.document)!==null&&l!==void 0?l:so(),I=sg(),K=new ug(A,{expanded:y.expanded,blade:dn(),props:j.fromObject({title:y.title}),viewProps:Ht.create()});super(K,I),this.pool_=I,this.containerElem_=(d=y.container)!==null&&d!==void 0?d:pg(A),this.containerElem_.appendChild(this.element),this.doc_=A,this.usesDefaultWrapper_=!y.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw S.alreadyDisposed();return this.doc_}dispose(){const a=this.containerElem_;if(!a)throw S.alreadyDisposed();if(this.usesDefaultWrapper_){const l=a.parentElement;l&&l.removeChild(a)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(a){("plugin"in a?[a.plugin]:"plugins"in a?a.plugins:[]).forEach(d=>{this.pool_.register(d),this.embedPluginStyle_(d)})}embedPluginStyle_(a){a.css&&Th(this.document,`plugin-${a.id}`,a.css)}setUpDefaultPlugins_(){Th(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(a=>{this.embedPluginStyle_(a)}),this.registerPlugin({plugins:[cg,ag,Es,hg]})}}const mg=new i("3.1.0");t.BladeApi=s,t.ButtonApi=T,t.FolderApi=xs,t.InputBindingApi=bs,t.ListApi=wh,t.MonitorBindingApi=Xt,t.Pane=dg,t.SeparatorApi=ws,t.SliderApi=Ah,t.TabApi=Ha,t.TabPageApi=As,t.TextApi=Eh,t.TpChangeEvent=o,t.VERSION=mg,Object.defineProperty(t,"__esModule",{value:!0})})})(na,na.exports);var Cr={exports:{}};(function(n,e){(function(t,i){i(e)})(qu,function(t){class i{constructor(h){this.controller_=h}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(h){this.controller_.viewProps.set("disabled",h)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(h){this.controller_.viewProps.set("hidden",h)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class s{constructor(h){this.target=h}}class r extends s{constructor(h,f,x,w){super(h),this.value=f,this.presetKey=x,this.last=w!=null?w:!0}}function o(b){return b}function c(b){return b==null}const p={alreadydisposed:()=>"View has been already disposed",invalidparams:b=>`Invalid parameters for '${b.name}'`,nomatchingcontroller:b=>`No matching controller for '${b.key}'`,nomatchingview:b=>`No matching view for '${JSON.stringify(b.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:b=>`Property '${b.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class m{constructor(h){var f;this.message=(f=p[h.type](h.context))!==null&&f!==void 0?f:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=h.type}static alreadyDisposed(){return new m({type:"alreadydisposed"})}static notBindable(){return new m({type:"notbindable"})}static propertyNotFound(h){return new m({type:"propertynotfound",context:{name:h}})}static shouldNeverHappen(){return new m({type:"shouldneverhappen"})}}class _{constructor(){this.observers_={}}on(h,f){let x=this.observers_[h];return x||(x=this.observers_[h]=[]),x.push({handler:f}),this}off(h,f){const x=this.observers_[h];return x&&(this.observers_[h]=x.filter(w=>w.handler!==f)),this}emit(h,f){const x=this.observers_[h];!x||x.forEach(w=>{w.handler(f)})}}const v="tp";function g(b){return(f,x)=>[v,"-",b,"v",f?`_${f}`:"",x?`-${x}`:""].join("")}function C(b,h){return f=>h(b(f))}function S(b){return b.rawValue}function E(b,h){b.emitter.on("change",C(S,h)),h(b.rawValue)}function T(b,h,f){E(b.value(h),f)}function M(b,h,f){f?b.classList.add(h):b.classList.remove(h)}function W(b,h){return f=>{M(b,h,f)}}function B(b,h){E(b,f=>{h.textContent=f!=null?f:""})}const O=g("btn");class L{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(O()),f.viewProps.bindClassModifiers(this.element);const x=h.createElement("button");x.classList.add(O("b")),f.viewProps.bindDisabled(x),this.element.appendChild(x),this.buttonElement=x;const w=h.createElement("div");w.classList.add(O("t")),B(f.props.value("title"),w),this.buttonElement.appendChild(w)}}class H{constructor(h,f){this.emitter=new _,this.onClick_=this.onClick_.bind(this),this.props=f.props,this.viewProps=f.viewProps,this.view=new L(h,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class G{constructor(h,f){var x;this.constraint_=f==null?void 0:f.constraint,this.equals_=(x=f==null?void 0:f.equals)!==null&&x!==void 0?x:(w,P)=>w===P,this.emitter=new _,this.rawValue_=h}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(h){this.setRawValue(h,{forceEmit:!1,last:!0})}setRawValue(h,f){const x=f!=null?f:{forceEmit:!1,last:!0},w=this.constraint_?this.constraint_.constrain(h):h;!!this.equals_(this.rawValue_,w)&&!x.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=w,this.emitter.emit("change",{options:x,rawValue:w,sender:this}))}}class N{constructor(h){this.emitter=new _,this.value_=h}get rawValue(){return this.value_}set rawValue(h){this.setRawValue(h,{forceEmit:!1,last:!0})}setRawValue(h,f){const x=f!=null?f:{forceEmit:!1,last:!0};this.value_===h&&!x.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=h,this.emitter.emit("change",{options:x,rawValue:this.value_,sender:this}))}}function U(b,h){const f=h==null?void 0:h.constraint,x=h==null?void 0:h.equals;return!f&&!x?new N(b):new G(b,h)}class J{constructor(h){this.emitter=new _,this.valMap_=h;for(const f in this.valMap_)this.valMap_[f].emitter.on("change",()=>{this.emitter.emit("change",{key:f,sender:this})})}static createCore(h){return Object.keys(h).reduce((x,w)=>Object.assign(x,{[w]:U(h[w])}),{})}static fromObject(h){const f=this.createCore(h);return new J(f)}get(h){return this.valMap_[h].rawValue}set(h,f){this.valMap_[h].rawValue=f}value(h){return this.valMap_[h]}}function Q(b,h){const x=Object.keys(h).reduce((w,P)=>{if(w===void 0)return;const k=h[P],X=k(b[P]);return X.succeeded?Object.assign(Object.assign({},w),{[P]:X.value}):void 0},{});return x}function Y(b,h){return b.reduce((f,x)=>{if(f===void 0)return;const w=h(x);if(!(!w.succeeded||w.value===void 0))return[...f,w.value]},[])}function D(b){return b===null?!1:typeof b=="object"}function z(b){return h=>f=>{if(!h&&f===void 0)return{succeeded:!1,value:void 0};if(h&&f===void 0)return{succeeded:!0,value:void 0};const x=b(f);return x!==void 0?{succeeded:!0,value:x}:{succeeded:!1,value:void 0}}}function F(b){return{custom:h=>z(h)(b),boolean:z(h=>typeof h=="boolean"?h:void 0)(b),number:z(h=>typeof h=="number"?h:void 0)(b),string:z(h=>typeof h=="string"?h:void 0)(b),function:z(h=>typeof h=="function"?h:void 0)(b),constant:h=>z(f=>f===h?h:void 0)(b),raw:z(h=>h)(b),object:h=>z(f=>{if(!!D(f))return Q(f,h)})(b),array:h=>z(f=>{if(!!Array.isArray(f))return Y(f,h)})(b)}}const V={optional:F(!0),required:F(!1)};function j(b,h){const f=V.required.object(h)(b);return f.succeeded?f.value:void 0}function ue(b){return b&&b.parentElement&&b.parentElement.removeChild(b),null}function Ie(){return["veryfirst","first","last","verylast"]}const ke=g(""),Be={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class pt{constructor(h){this.parent_=null,this.blade=h.blade,this.view=h.view,this.viewProps=h.viewProps;const f=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Ie().forEach(x=>{f.classList.remove(ke(void 0,Be[x]))}),this.blade.get("positions").forEach(x=>{f.classList.add(ke(void 0,Be[x]))})}),this.viewProps.handleDispose(()=>{ue(f)})}get parent(){return this.parent_}}const ae="http://www.w3.org/2000/svg";function xe(b){b.offsetHeight}function Jt(b,h){const f=b.style.transition;b.style.transition="none",h(),b.style.transition=f}function bi(b){return b.ontouchstart!==void 0}function ze(b){for(;b.childNodes.length>0;)b.removeChild(b.childNodes[0])}function Nn(b){return b.relatedTarget?b.relatedTarget:"explicitOriginalTarget"in b?b.explicitOriginalTarget:null}const dt=g("lbl");function tt(b,h){const f=b.createDocumentFragment();return h.split(`
`).map(w=>b.createTextNode(w)).forEach((w,P)=>{P>0&&f.appendChild(b.createElement("br")),f.appendChild(w)}),f}class kt{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(dt()),f.viewProps.bindClassModifiers(this.element);const x=h.createElement("div");x.classList.add(dt("l")),T(f.props,"label",P=>{c(P)?this.element.classList.add(dt(void 0,"nol")):(this.element.classList.remove(dt(void 0,"nol")),ze(x),x.appendChild(tt(h,P)))}),this.element.appendChild(x),this.labelElement=x;const w=h.createElement("div");w.classList.add(dt("v")),this.element.appendChild(w),this.valueElement=w}}class zt extends pt{constructor(h,f){const x=f.valueController.viewProps;super(Object.assign(Object.assign({},f),{view:new kt(h,{props:f.props,viewProps:x}),viewProps:x})),this.props=f.props,this.valueController=f.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class hs extends pt{constructor(h){super(h),this.value=h.value}}class ps extends J{constructor(h){super(h)}static create(h){const f={completed:!0,expanded:h,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},x=J.createCore(f);return new ps(x)}get styleExpanded(){var h;return(h=this.get("temporaryExpanded"))!==null&&h!==void 0?h:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const h=this.get("expandedHeight");return this.get("shouldFixHeight")&&!c(h)?`${h}px`:"auto"}bindExpandedClass(h,f){const x=()=>{this.styleExpanded?h.classList.add(f):h.classList.remove(f)};T(this,"expanded",x),T(this,"temporaryExpanded",x)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function so(b){return ps.create(b)}function ao(b,h){let f=0;return Jt(h,()=>{b.set("expandedHeight",null),b.set("temporaryExpanded",!0),xe(h),f=h.clientHeight,b.set("temporaryExpanded",null),xe(h)}),f}function Oa(b,h){h.style.height=b.styleHeight}function xi(b,h){b.value("expanded").emitter.on("beforechange",()=>{b.set("completed",!1),c(b.get("expandedHeight"))&&b.set("expandedHeight",ao(b,h)),b.set("shouldFixHeight",!0),xe(h)}),b.emitter.on("change",()=>{Oa(b,h)}),Oa(b,h),h.addEventListener("transitionend",f=>{f.propertyName==="height"&&b.cleanUpTransition()})}class ds{constructor(h,f){const x=g(f.viewName);this.element=h.createElement("div"),this.element.classList.add(x()),f.viewProps.bindClassModifiers(this.element)}}class kn extends hs{constructor(h,f){const x=f.valueController.viewProps;super(Object.assign(Object.assign({},f),{value:f.valueController.value,view:new kt(h,{props:f.props,viewProps:x}),viewProps:x})),this.props=f.props,this.valueController=f.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Fa=g("");function Da(b,h){return W(b,Fa(void 0,h))}class $t extends J{constructor(h){super(h)}static create(h){var f,x;const w=h!=null?h:{},P={disabled:(f=w.disabled)!==null&&f!==void 0?f:!1,disposed:!1,hidden:(x=w.hidden)!==null&&x!==void 0?x:!1},k=J.createCore(P);return new $t(k)}bindClassModifiers(h){T(this,"disabled",Da(h,"disabled")),T(this,"hidden",Da(h,"hidden"))}bindDisabled(h){T(this,"disabled",f=>{h.disabled=f})}bindTabIndex(h){T(this,"disabled",f=>{h.tabIndex=f?-1:0})}handleDispose(h){this.value("disposed").emitter.on("change",f=>{f&&h()})}}class zn{constructor(){this.disabled=!1,this.emitter=new _}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class ro{constructor(h,f){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=h,this.emitter=new _,this.interval_=f,this.setTimer_()}get disabled(){return this.disabled_}set disabled(h){this.disabled_=h,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const h=this.doc_.defaultView;h&&h.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const h=this.doc_.defaultView;h&&(this.timerId_=h.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ms{constructor(h){this.constraints=h}constrain(h){return this.constraints.reduce((f,x)=>x.constrain(f),h)}}function qt(b,h){if(b instanceof h)return b;if(b instanceof ms){const f=b.constraints.reduce((x,w)=>x||(w instanceof h?w:null),null);if(f)return f}return null}class yi{constructor(h){this.maxValue=h.max,this.minValue=h.min}constrain(h){let f=h;return c(this.minValue)||(f=Math.max(f,this.minValue)),c(this.maxValue)||(f=Math.min(f,this.maxValue)),f}}class Et{constructor(h,f=0){this.step=h,this.origin=f}constrain(h){const f=this.origin%this.step,x=Math.round((h-f)/this.step);return f+x*this.step}}const dn=g("pop");class Un{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(dn()),f.viewProps.bindClassModifiers(this.element),E(f.shows,W(this.element,dn(void 0,"v")))}}class oo{constructor(h,f){this.shows=U(!1),this.viewProps=f.viewProps,this.view=new Un(h,{shows:this.shows,viewProps:this.viewProps})}}const fs=g("txt");class vs{constructor(h,f){this.onChange_=this.onChange_.bind(this),this.element=h.createElement("div"),this.element.classList.add(fs()),f.viewProps.bindClassModifiers(this.element),this.props_=f.props,this.props_.emitter.on("change",this.onChange_);const x=h.createElement("input");x.classList.add(fs("i")),x.type="text",f.viewProps.bindDisabled(x),this.element.appendChild(x),this.inputElement=x,f.value.emitter.on("change",this.onChange_),this.value_=f.value,this.refresh()}refresh(){const h=this.props_.get("formatter");this.inputElement.value=h(this.value_.rawValue)}onChange_(){this.refresh()}}class gs{constructor(h,f){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=f.parser,this.props=f.props,this.value=f.value,this.viewProps=f.viewProps,this.view=new vs(h,{props:f.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(h){const x=h.currentTarget.value,w=this.parser_(x);c(w)||(this.value.rawValue=w),this.view.refresh()}}function lo(b){return b==="false"?!1:!!b}class uo{constructor(h){this.text=h}evaluate(){return Number(this.text)}toString(){return this.text}}const co={"**":(b,h)=>Math.pow(b,h),"*":(b,h)=>b*h,"/":(b,h)=>b/h,"%":(b,h)=>b%h,"+":(b,h)=>b+h,"-":(b,h)=>b-h,"<<":(b,h)=>b<<h,">>":(b,h)=>b>>h,">>>":(b,h)=>b>>>h,"&":(b,h)=>b&h,"^":(b,h)=>b^h,"|":(b,h)=>b|h};class ho{constructor(h,f,x){this.left=f,this.operator=h,this.right=x}evaluate(){const h=co[this.operator];if(!h)throw new Error(`unexpected binary operator: '${this.operator}`);return h(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const _s={"+":b=>b,"-":b=>-b,"~":b=>~b};class bs{constructor(h,f){this.operator=h,this.expression=f}evaluate(){const h=_s[this.operator];if(!h)throw new Error(`unexpected unary operator: '${this.operator}`);return h(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function nt(b){return(h,f)=>{for(let x=0;x<b.length;x++){const w=b[x](h,f);if(w!=="")return w}return""}}function Xt(b,h){var f;const x=b.substr(h).match(/^\s+/);return(f=x&&x[0])!==null&&f!==void 0?f:""}function Ut(b,h){const f=b.substr(h,1);return f.match(/^[1-9]$/)?f:""}function Hn(b,h){var f;const x=b.substr(h).match(/^[0-9]+/);return(f=x&&x[0])!==null&&f!==void 0?f:""}function Gn(b,h){const f=Hn(b,h);if(f!=="")return f;const x=b.substr(h,1);if(h+=1,x!=="-"&&x!=="+")return"";const w=Hn(b,h);return w===""?"":x+w}function Ci(b,h){const f=b.substr(h,1);if(h+=1,f.toLowerCase()!=="e")return"";const x=Gn(b,h);return x===""?"":f+x}function Vn(b,h){const f=b.substr(h,1);if(f==="0")return f;const x=Ut(b,h);return h+=x.length,x===""?"":x+Hn(b,h)}function xs(b,h){const f=Vn(b,h);if(h+=f.length,f==="")return"";const x=b.substr(h,1);if(h+=x.length,x!==".")return"";const w=Hn(b,h);return h+=w.length,f+x+w+Ci(b,h)}function ys(b,h){const f=b.substr(h,1);if(h+=f.length,f!==".")return"";const x=Hn(b,h);return h+=x.length,x===""?"":f+x+Ci(b,h)}function po(b,h){const f=Vn(b,h);return h+=f.length,f===""?"":f+Ci(b,h)}const mo=nt([xs,ys,po]);function fo(b,h){var f;const x=b.substr(h).match(/^[01]+/);return(f=x&&x[0])!==null&&f!==void 0?f:""}function vo(b,h){const f=b.substr(h,2);if(h+=f.length,f.toLowerCase()!=="0b")return"";const x=fo(b,h);return x===""?"":f+x}function Cs(b,h){var f;const x=b.substr(h).match(/^[0-7]+/);return(f=x&&x[0])!==null&&f!==void 0?f:""}function go(b,h){const f=b.substr(h,2);if(h+=f.length,f.toLowerCase()!=="0o")return"";const x=Cs(b,h);return x===""?"":f+x}function _o(b,h){var f;const x=b.substr(h).match(/^[0-9a-f]+/i);return(f=x&&x[0])!==null&&f!==void 0?f:""}function Wn(b,h){const f=b.substr(h,2);if(h+=f.length,f.toLowerCase()!=="0x")return"";const x=_o(b,h);return x===""?"":f+x}const La=nt([vo,go,Wn]),bo=nt([La,mo]);function Ss(b,h){const f=bo(b,h);return h+=f.length,f===""?null:{evaluable:new uo(f),cursor:h}}function xo(b,h){const f=b.substr(h,1);if(h+=f.length,f!=="(")return null;const x=za(b,h);if(!x)return null;h=x.cursor,h+=Xt(b,h).length;const w=b.substr(h,1);return h+=w.length,w!==")"?null:{evaluable:x.evaluable,cursor:h}}function mn(b,h){var f;return(f=Ss(b,h))!==null&&f!==void 0?f:xo(b,h)}function ws(b,h){const f=mn(b,h);if(f)return f;const x=b.substr(h,1);if(h+=x.length,x!=="+"&&x!=="-"&&x!=="~")return null;const w=ws(b,h);return w?(h=w.cursor,{cursor:h,evaluable:new bs(x,w.evaluable)}):null}function Na(b,h,f){f+=Xt(h,f).length;const x=b.filter(w=>h.startsWith(w,f))[0];return x?(f+=x.length,f+=Xt(h,f).length,{cursor:f,operator:x}):null}function yo(b,h){return(f,x)=>{const w=b(f,x);if(!w)return null;x=w.cursor;let P=w.evaluable;for(;;){const k=Na(h,f,x);if(!k)break;x=k.cursor;const X=b(f,x);if(!X)return null;x=X.cursor,P=new ho(k.operator,P,X.evaluable)}return P?{cursor:x,evaluable:P}:null}}const ka=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((b,h)=>yo(b,h),ws);function za(b,h){return h+=Xt(b,h).length,ka(b,h)}function Co(b){const h=za(b,0);return!h||h.cursor+Xt(b,h.cursor).length!==b.length?null:h.evaluable}function jn(b){var h;const f=Co(b);return(h=f==null?void 0:f.evaluate())!==null&&h!==void 0?h:null}function Ht(b){if(typeof b=="number")return b;if(typeof b=="string"){const h=jn(b);if(!c(h))return h}return 0}function De(b){return h=>h.toFixed(Math.max(Math.min(b,20),0))}const So=De(0);function Si(b){return So(b)+"%"}function Ua(b){return String(b)}function As(b,h){for(;b.length<h;)b.push(void 0)}function Ha(b){const h=[];return As(h,b),U(h)}function Ga(b){const h=b.indexOf(void 0);return h<0?b:b.slice(0,h)}function wo(b,h){const f=[...Ga(b),h];return f.length>b.length?f.splice(0,f.length-b.length):As(f,b.length),f}function Kn({primary:b,secondary:h,forward:f,backward:x}){let w=!1;function P(k){w||(w=!0,k(),w=!1)}b.emitter.on("change",k=>{P(()=>{h.setRawValue(f(b,h),k.options)})}),h.emitter.on("change",k=>{P(()=>{b.setRawValue(x(b,h),k.options)}),P(()=>{h.setRawValue(f(b,h),k.options)})}),P(()=>{h.setRawValue(f(b,h),{forceEmit:!1,last:!0})})}function fn(b,h){const f=b*(h.altKey?.1:1)*(h.shiftKey?10:1);return h.upKey?+f:h.downKey?-f:0}function Jn(b){return{altKey:b.altKey,downKey:b.key==="ArrowDown",shiftKey:b.shiftKey,upKey:b.key==="ArrowUp"}}function Es(b){return{altKey:b.altKey,downKey:b.key==="ArrowLeft",shiftKey:b.shiftKey,upKey:b.key==="ArrowRight"}}function Ao(b){return b==="ArrowUp"||b==="ArrowDown"}function Va(b){return Ao(b)||b==="ArrowLeft"||b==="ArrowRight"}function Ts(b,h){var f,x;const w=h.ownerDocument.defaultView,P=h.getBoundingClientRect();return{x:b.pageX-(((f=w&&w.scrollX)!==null&&f!==void 0?f:0)+P.left),y:b.pageY-(((x=w&&w.scrollY)!==null&&x!==void 0?x:0)+P.top)}}class Gt{constructor(h){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=h,this.emitter=new _,h.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),h.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),h.addEventListener("touchend",this.onTouchEnd_),h.addEventListener("mousedown",this.onMouseDown_)}computePosition_(h){const f=this.elem_.getBoundingClientRect();return{bounds:{width:f.width,height:f.height},point:h?{x:h.x,y:h.y}:null}}onMouseDown_(h){var f;h.preventDefault(),(f=h.currentTarget)===null||f===void 0||f.focus();const x=this.elem_.ownerDocument;x.addEventListener("mousemove",this.onDocumentMouseMove_),x.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:h.altKey,data:this.computePosition_(Ts(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onDocumentMouseMove_(h){this.emitter.emit("move",{altKey:h.altKey,data:this.computePosition_(Ts(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onDocumentMouseUp_(h){const f=this.elem_.ownerDocument;f.removeEventListener("mousemove",this.onDocumentMouseMove_),f.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:h.altKey,data:this.computePosition_(Ts(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onTouchStart_(h){h.preventDefault();const f=h.targetTouches.item(0),x=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:h.altKey,data:this.computePosition_(f?{x:f.clientX-x.left,y:f.clientY-x.top}:void 0),sender:this,shiftKey:h.shiftKey}),this.lastTouch_=f}onTouchMove_(h){const f=h.targetTouches.item(0),x=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:h.altKey,data:this.computePosition_(f?{x:f.clientX-x.left,y:f.clientY-x.top}:void 0),sender:this,shiftKey:h.shiftKey}),this.lastTouch_=f}onTouchEnd_(h){var f;const x=(f=h.targetTouches.item(0))!==null&&f!==void 0?f:this.lastTouch_,w=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:h.altKey,data:this.computePosition_(x?{x:x.clientX-w.left,y:x.clientY-w.top}:void 0),sender:this,shiftKey:h.shiftKey})}}function me(b,h,f,x,w){const P=(b-h)/(f-h);return x+P*(w-x)}function vn(b){return String(b.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function mt(b,h,f){return Math.min(Math.max(b,h),f)}const We=g("txt");class Ms{constructor(h,f){this.onChange_=this.onChange_.bind(this),this.props_=f.props,this.props_.emitter.on("change",this.onChange_),this.element=h.createElement("div"),this.element.classList.add(We(),We(void 0,"num")),f.arrayPosition&&this.element.classList.add(We(void 0,f.arrayPosition)),f.viewProps.bindClassModifiers(this.element);const x=h.createElement("input");x.classList.add(We("i")),x.type="text",f.viewProps.bindDisabled(x),this.element.appendChild(x),this.inputElement=x,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=f.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(We()),this.inputElement.classList.add(We("i"));const w=h.createElement("div");w.classList.add(We("k")),this.element.appendChild(w),this.knobElement=w;const P=h.createElementNS(ae,"svg");P.classList.add(We("g")),this.knobElement.appendChild(P);const k=h.createElementNS(ae,"path");k.classList.add(We("gb")),P.appendChild(k),this.guideBodyElem_=k;const X=h.createElementNS(ae,"path");X.classList.add(We("gh")),P.appendChild(X),this.guideHeadElem_=X;const Z=h.createElement("div");Z.classList.add(g("tt")()),this.knobElement.appendChild(Z),this.tooltipElem_=Z,f.value.emitter.on("change",this.onChange_),this.value=f.value,this.refresh()}onDraggingChange_(h){if(h.rawValue===null){this.element.classList.remove(We(void 0,"drg"));return}this.element.classList.add(We(void 0,"drg"));const f=h.rawValue/this.props_.get("draggingScale"),x=f+(f>0?-1:f<0?1:0),w=mt(-x,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${x+w},0 L${x},4 L${x+w},8`,`M ${f},-1 L${f},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${f},4`);const P=this.props_.get("formatter");this.tooltipElem_.textContent=P(this.value.rawValue),this.tooltipElem_.style.left=`${f}px`}refresh(){const h=this.props_.get("formatter");this.inputElement.value=h(this.value.rawValue)}onChange_(){this.refresh()}}class Eo{constructor(h,f){var x;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=f.baseStep,this.parser_=f.parser,this.props=f.props,this.sliderProps_=(x=f.sliderProps)!==null&&x!==void 0?x:null,this.value=f.value,this.viewProps=f.viewProps,this.dragging_=U(null),this.view=new Ms(h,{arrayPosition:f.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const w=new Gt(this.view.knobElement);w.emitter.on("down",this.onPointerDown_),w.emitter.on("move",this.onPointerMove_),w.emitter.on("up",this.onPointerUp_)}constrainValue_(h){var f,x;const w=(f=this.sliderProps_)===null||f===void 0?void 0:f.get("minValue"),P=(x=this.sliderProps_)===null||x===void 0?void 0:x.get("maxValue");let k=h;return w!==void 0&&(k=Math.max(k,w)),P!==void 0&&(k=Math.min(k,P)),k}onInputChange_(h){const x=h.currentTarget.value,w=this.parser_(x);c(w)||(this.value.rawValue=this.constrainValue_(w)),this.view.refresh()}onInputKeyDown_(h){const f=fn(this.baseStep_,Jn(h));f!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+f),{forceEmit:!1,last:!1})}onInputKeyUp_(h){fn(this.baseStep_,Jn(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(h){if(!h.point)return null;const f=h.point.x-h.bounds.width/2;return this.constrainValue_(this.originRawValue_+f*this.props.get("draggingScale"))}onPointerMove_(h){const f=this.computeDraggingValue_(h.data);f!==null&&(this.value.setRawValue(f,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(h){const f=this.computeDraggingValue_(h.data);f!==null&&(this.value.setRawValue(f,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function Yt(b,h){b.write(h)}function Wa(b){const h=b?qt(b,Et):null;return h?h.step:null}function To(b,h){const f=b&&qt(b,Et);return f?vn(f.step):Math.max(vn(h),2)}function Bs(b){const h=Wa(b);return h!=null?h:1}function ja(b,h){var f;const x=b&&qt(b,Et),w=Math.abs((f=x==null?void 0:x.step)!==null&&f!==void 0?f:h);return w===0?.1:Math.pow(10,Math.floor(Math.log10(w))-1)}function wi(b){return[b[0],b[1],b[2]]}function $n(b){const h=mt(Math.floor(b),0,255).toString(16);return h.length===1?`0${h}`:h}function Mo(b,h="#"){const f=wi(b.getComponents("rgb")).map($n).join("");return`${h}${f}`}function Ka(b,h="#"){const f=b.getComponents("rgb"),x=[f[0],f[1],f[2],f[3]*255].map($n).join("");return`${h}${x}`}function Ja(b,h){const f=De(h==="float"?2:0);return`rgb(${wi(b.getComponents("rgb",h)).map(w=>f(w)).join(", ")})`}function Bo(b){return h=>Ja(h,b)}function Po(b,h){const f=De(2),x=De(h==="float"?2:0);return`rgba(${b.getComponents("rgb",h).map((P,k)=>(k===3?f:x)(P)).join(", ")})`}function Io(b){return h=>Po(h,b)}function Ro(b){const h=[De(0),Si,Si];return`hsl(${wi(b.getComponents("hsl")).map((x,w)=>h[w](x)).join(", ")})`}function Oo(b){const h=[De(0),Si,Si,De(2)];return`hsla(${b.getComponents("hsl").map((x,w)=>h[w](x)).join(", ")})`}function Ps(b,h){const f=De(h==="float"?2:0),x=["r","g","b"];return`{${wi(b.getComponents("rgb",h)).map((P,k)=>`${x[k]}: ${f(P)}`).join(", ")}}`}function qn(b){return h=>Ps(h,b)}function Fo(b,h){const f=De(2),x=De(h==="float"?2:0),w=["r","g","b","a"];return`{${b.getComponents("rgb",h).map((k,X)=>{const Z=X===3?f:x;return`${w[X]}: ${Z(k)}`}).join(", ")}}`}function Xn(b){return h=>Fo(h,b)}[...["int","float"].reduce((b,h)=>[...b,{format:{alpha:!1,mode:"rgb",notation:"func",type:h},stringifier:Bo(h)},{format:{alpha:!0,mode:"rgb",notation:"func",type:h},stringifier:Io(h)},{format:{alpha:!1,mode:"rgb",notation:"object",type:h},stringifier:qn(h)},{format:{alpha:!0,mode:"rgb",notation:"object",type:h},stringifier:Xn(h)}],[])];class Do{constructor(h){this.components=h.components,this.asm_=h.assembly}constrain(h){const f=this.asm_.toComponents(h).map((x,w)=>{var P,k;return(k=(P=this.components[w])===null||P===void 0?void 0:P.constrain(x))!==null&&k!==void 0?k:x});return this.asm_.fromComponents(f)}}const Ai=g("pndtxt");class $a{constructor(h,f){this.textViews=f.textViews,this.element=h.createElement("div"),this.element.classList.add(Ai()),this.textViews.forEach(x=>{const w=h.createElement("div");w.classList.add(Ai("a")),w.appendChild(x.element),this.element.appendChild(w)})}}function Lo(b,h,f){return new Eo(b,{arrayPosition:f===0?"fst":f===h.axes.length-1?"lst":"mid",baseStep:h.axes[f].baseStep,parser:h.parser,props:h.axes[f].textProps,value:U(0,{constraint:h.axes[f].constraint}),viewProps:h.viewProps})}class Is{constructor(h,f){this.value=f.value,this.viewProps=f.viewProps,this.acs_=f.axes.map((x,w)=>Lo(h,f,w)),this.acs_.forEach((x,w)=>{Kn({primary:this.value,secondary:x.value,forward:P=>f.assembly.toComponents(P.rawValue)[w],backward:(P,k)=>{const X=f.assembly.toComponents(P.rawValue);return X[w]=k.rawValue,f.assembly.fromComponents(X)}})}),this.view=new $a(h,{textViews:this.acs_.map(x=>x.view)})}}function No(b,h){return"step"in b&&!c(b.step)?new Et(b.step,h):null}function ko(b){return"max"in b&&!c(b.max)||"min"in b&&!c(b.min)?new yi({max:b.max,min:b.min}):null}const zo={monitor:{defaultInterval:200,defaultLineCount:3}},Vt=g("grl");class Uo{constructor(h,f){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=h.createElement("div"),this.element.classList.add(Vt()),f.viewProps.bindClassModifiers(this.element),this.formatter_=f.formatter,this.props_=f.props,this.cursor_=f.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const x=h.createElementNS(ae,"svg");x.classList.add(Vt("g")),x.style.height=`calc(var(--bld-us) * ${f.lineCount})`,this.element.appendChild(x),this.svgElem_=x;const w=h.createElementNS(ae,"polyline");this.svgElem_.appendChild(w),this.lineElem_=w;const P=h.createElement("div");P.classList.add(Vt("t"),g("tt")()),this.element.appendChild(P),this.tooltipElem_=P,f.value.emitter.on("change",this.onValueUpdate_),this.value=f.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const h=this.svgElem_.getBoundingClientRect(),f=this.value.rawValue.length-1,x=this.props_.get("minValue"),w=this.props_.get("maxValue"),P=[];this.value.rawValue.forEach((Rt,Gs)=>{if(Rt===void 0)return;const Vs=me(Gs,0,f,0,h.width),en=me(Rt,x,w,h.height,0);P.push([Vs,en].join(","))}),this.lineElem_.setAttributeNS(null,"points",P.join(" "));const k=this.tooltipElem_,X=this.value.rawValue[this.cursor_.rawValue];if(X===void 0){k.classList.remove(Vt("t","a"));return}const Z=me(this.cursor_.rawValue,0,f,0,h.width),Fe=me(X,x,w,h.height,0);k.style.left=`${Z}px`,k.style.top=`${Fe}px`,k.textContent=`${this.formatter_(X)}`,k.classList.contains(Vt("t","a"))||(k.classList.add(Vt("t","a"),Vt("t","in")),xe(k),k.classList.remove(Vt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ho{constructor(h,f){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=f.props,this.value=f.value,this.viewProps=f.viewProps,this.cursor_=U(-1),this.view=new Uo(h,{cursor:this.cursor_,formatter:f.formatter,lineCount:f.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!bi(h))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const x=new Gt(this.view.element);x.emitter.on("down",this.onGraphPointerDown_),x.emitter.on("move",this.onGraphPointerMove_),x.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(h){const f=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(me(h.offsetX,0,f.width,0,this.value.rawValue.length))}onGraphPointerDown_(h){this.onGraphPointerMove_(h)}onGraphPointerMove_(h){if(!h.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(me(h.data.point.x,0,h.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}class Go{constructor(h){this.controller_=h}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(h){this.controller_.viewProps.set("disabled",h)}get title(){var h;return(h=this.controller_.props.get("title"))!==null&&h!==void 0?h:""}set title(h){this.controller_.props.set("title",h)}on(h,f){const x=f.bind(this);return this.controller_.emitter.on(h,()=>{x(new s(this))}),this}}class Vo extends s{constructor(h,f,x){super(h),this.cell=f,this.index=x}}class Wo extends i{constructor(h){super(h),this.cellToApiMap_=new Map,this.emitter_=new _;const f=this.controller_.valueController;f.cellControllers.forEach((x,w)=>{const P=new Go(x);this.cellToApiMap_.set(x,P),x.emitter.on("click",()=>{const k=w%f.size[0],X=Math.floor(w/f.size[0]);this.emitter_.emit("click",{event:new Vo(this,P,[k,X])})})})}cell(h,f){const x=this.controller_.valueController,w=x.cellControllers[f*x.size[0]+h];return this.cellToApiMap_.get(w)}on(h,f){const x=f.bind(this);return this.emitter_.on(h,w=>{x(w.event)}),this}}class qa{constructor(h,f){this.size=f.size;const[x,w]=this.size,P=[];for(let k=0;k<w;k++)for(let X=0;X<x;X++){const Z=new H(h,{props:J.fromObject(Object.assign({},f.cellConfig(X,k))),viewProps:$t.create()});P.push(Z)}this.cellCs_=P,this.viewProps=$t.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(k=>{k.viewProps.set("disposed",!0)})}),this.view=new ds(h,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${x}, 1fr)`,this.cellCs_.forEach(k=>{this.view.element.appendChild(k.view.element)})}get cellControllers(){return this.cellCs_}}const jo={id:"buttongrid",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(b){const h=V,f=j(b,{cells:h.required.function,size:h.required.array(h.required.number),view:h.required.constant("buttongrid"),label:h.optional.string});return f?{params:f}:null},controller(b){return new zt(b.document,{blade:b.blade,props:J.fromObject({label:b.params.label}),valueController:new qa(b.document,{cellConfig:b.params.cells,size:b.params.size})})},api(b){return!(b.controller instanceof zt)||!(b.controller.valueController instanceof qa)?null:new Wo(b.controller)}};class Ko extends i{get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,f){const x=f.bind(this);return this.controller_.valueController.value.emitter.on(h,w=>{x(new r(this,w.rawValue,void 0,w.options.last))}),this}}function it(b,h,f){return b*(1-f)+h*f}const Xa=20,Jo=.001,Rs=100;function $o(b,h){let f=.25,x=.5,w=-1;for(let P=0;P<Xa;P++){const[k,X]=b.curve(x);if(x+=f*(k<h?1:-1),w=X,f*=.5,Math.abs(h-k)<Jo)break}return w}class Tt{constructor(h=0,f=0,x=1,w=1){this.cache_=[],this.comps_=[h,f,x,w]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(h){return c(h)||!Array.isArray(h)?!1:typeof h[0]=="number"&&typeof h[1]=="number"&&typeof h[2]=="number"&&typeof h[3]=="number"}static equals(h,f){return h.x1===f.x1&&h.y1===f.y1&&h.x2===f.x2&&h.y2===f.y2}curve(h){const f=it(0,this.x1,h),x=it(0,this.y1,h),w=it(this.x1,this.x2,h),P=it(this.y1,this.y2,h),k=it(this.x2,1,h),X=it(this.y2,1,h),Z=it(f,w,h),Fe=it(x,P,h),Rt=it(w,k,h),Gs=it(P,X,h);return[it(Z,Rt,h),it(Fe,Gs,h)]}y(h){if(this.cache_.length===0){const f=[];for(let x=0;x<Rs;x++)f.push($o(this,me(x,0,Rs-1,0,1)));this.cache_=f}return this.cache_[Math.round(me(mt(h,0,1),0,1,0,Rs-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const Ya={toComponents:b=>b.toObject(),fromComponents:b=>new Tt(...b)};function Mt(b){const h=De(2);return`cubic-bezier(${b.toObject().map(x=>h(x)).join(", ")})`}const Os=[0,.5,.5,1];function qo(b){const h=b.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!h)return new Tt(...Os);const f=[h[1],h[2],h[3],h[4]].reduce((x,w)=>{if(!x)return null;const P=Number(w);return isNaN(P)?null:[...x,P]},[]);return new Tt(...f!=null?f:Os)}const Ee=g("cbz");class Xo{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(Ee()),f.viewProps.bindClassModifiers(this.element),f.foldable.bindExpandedClass(this.element,Ee(void 0,"expanded")),T(f.foldable,"completed",W(this.element,Ee(void 0,"cpl")));const x=h.createElement("div");x.classList.add(Ee("h")),this.element.appendChild(x);const w=h.createElement("button");w.classList.add(Ee("b")),f.viewProps.bindDisabled(w);const P=h.createElementNS(ae,"svg");P.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',w.appendChild(P),x.appendChild(w),this.buttonElement=w;const k=h.createElement("div");if(k.classList.add(Ee("t")),x.appendChild(k),this.textElement=k,f.pickerLayout==="inline"){const X=h.createElement("div");X.classList.add(Ee("p")),this.element.appendChild(X),this.pickerElement=X}else this.pickerElement=null}}const gn=g("cbzp");class Qa{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(gn()),f.viewProps.bindClassModifiers(this.element);const x=h.createElement("div");x.classList.add(gn("g")),this.element.appendChild(x),this.graphElement=x;const w=h.createElement("div");w.classList.add(gn("t")),this.element.appendChild(w),this.textElement=w}}function Ei(b,h){const f=new MutationObserver(w=>{for(const P of w)P.type==="childList"&&P.addedNodes.forEach(k=>{!k.contains(k)||(h(),f.disconnect())})}),x=b.ownerDocument;f.observe(x.body,{attributes:!0,childList:!0,subtree:!0})}const Bt=g("cbzg");function Yo(b,h){return f=>h(b(f))}class Qo{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(Bt()),f.viewProps.bindClassModifiers(this.element),f.viewProps.bindTabIndex(this.element);const x=h.createElement("div");x.classList.add(Bt("p")),this.element.appendChild(x),this.previewElement=x;const w=h.createElementNS(ae,"svg");w.classList.add(Bt("g")),this.element.appendChild(w),this.svgElem_=w;const P=h.createElementNS(ae,"path");P.classList.add(Bt("u")),this.svgElem_.appendChild(P),this.guideElem_=P;const k=h.createElementNS(ae,"polyline");k.classList.add(Bt("l")),this.svgElem_.appendChild(k),this.lineElem_=k,this.handleElems_=[h.createElement("div"),h.createElement("div")],this.handleElems_.forEach(X=>{X.classList.add(Bt("h")),this.element.appendChild(X)}),this.vectorElems_=[h.createElementNS(ae,"line"),h.createElementNS(ae,"line")],this.vectorElems_.forEach(X=>{X.classList.add(Bt("v")),this.svgElem_.appendChild(X)}),this.value_=f.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=f.selection,this.handleElems_.forEach((X,Z)=>{E(this.sel_,Yo(Fe=>Fe===Z,W(X,Bt("h","sel"))))}),Ei(this.element,()=>{this.refresh()})}getVertMargin_(h){return h*.25}valueToPosition(h,f){const x=this.element.getBoundingClientRect(),w=x.width,P=x.height,k=this.getVertMargin_(P);return{x:me(h,0,1,0,w),y:me(f,0,1,P-k,k)}}positionToValue(h,f){const x=this.element.getBoundingClientRect(),w=x.width,P=x.height,k=this.getVertMargin_(P);return{x:mt(me(h,0,w,0,1),0,1),y:me(f,P-k,k,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(P=>{const k=this.valueToPosition(0,P),X=this.valueToPosition(1,P);return[`M ${k.x},${k.y}`,`L ${X.x},${X.y}`].join(" ")}).join(" "));const h=this.value_.rawValue,f=[];let x=0;for(;;){const P=this.valueToPosition(...h.curve(x));if(f.push([P.x,P.y].join(",")),x>=1)break;x=Math.min(x+.05,1)}this.lineElem_.setAttributeNS(null,"points",f.join(" "));const w=h.toObject();[0,1].forEach(P=>{const k=this.valueToPosition(P,P),X=this.valueToPosition(w[P*2],w[P*2+1]),Z=this.vectorElems_[P];Z.setAttributeNS(null,"x1",String(k.x)),Z.setAttributeNS(null,"y1",String(k.y)),Z.setAttributeNS(null,"x2",String(X.x)),Z.setAttributeNS(null,"y2",String(X.y));const Fe=this.handleElems_[P];Fe.style.left=`${X.x}px`,Fe.style.top=`${X.y}px`})}onValueChange_(){this.refresh()}}const Za=24,_n=400,je=1e3,xt=g("cbzprv");class Pt{constructor(h,f){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=h.createElement("div"),this.element.classList.add(xt()),f.viewProps.bindClassModifiers(this.element);const x=h.createElementNS(ae,"svg");x.classList.add(xt("g")),this.element.appendChild(x),this.svgElem_=x;const w=h.createElementNS(ae,"path");w.classList.add(xt("t")),this.svgElem_.appendChild(w),this.ticksElem_=w;const P=h.createElement("div");P.classList.add(xt("m")),this.element.appendChild(P),this.markerElem_=P,this.value_=f.value,this.value_.emitter.on("change",this.onValueChange_),f.viewProps.handleDispose(this.onDispose_),Ei(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(xt("m","a")),this.startTime_=new Date().getTime()+_n,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(xt("m","a"))}onDispose_(){this.stop()}updateMarker_(h){const f=this.value_.rawValue.y(mt(h,0,1));this.markerElem_.style.left=`${f*100}%`}refresh(){const h=this.svgElem_.getBoundingClientRect(),f=h.width,x=h.height,w=[],P=this.value_.rawValue;for(let k=0;k<Za;k++){const X=me(k,0,Za-1,0,1),Z=me(P.y(X),0,1,0,f);w.push(`M ${Z},0 v${x}`)}this.ticksElem_.setAttributeNS(null,"d",w.join(" "))}onTimer_(){if(this.startTime_===null)return;const h=new Date().getTime()-this.startTime_,f=h/je;this.updateMarker_(f),h>je+_n&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Fs(b,h,f,x){const w=f-b,P=x-h;return Math.sqrt(w*w+P*P)}function er(b,h,f,x){const w=Fs(b,h,f,x),P=Math.atan2(x-h,f-b),k=Math.round(P/(Math.PI/4))*Math.PI/4;return{x:b+Math.cos(k)*w,y:h+Math.sin(k)*w}}class Ds{constructor(h,f){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=f.baseStep,this.value=f.value,this.sel_=U(0),this.viewProps=f.viewProps,this.view=new Qo(h,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new Pt(h,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",w=>{w.stopImmediatePropagation(),w.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const x=new Gt(this.view.element);x.emitter.on("down",this.onPointerDown_),x.emitter.on("move",this.onPointerMove_),x.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(h,f,x){const w=this.sel_.rawValue,P=this.value.rawValue.toObject(),k=this.view.positionToValue(h.x,h.y),X=f?er(w,w,k.x,k.y):k;P[w*2]=X.x,P[w*2+1]=X.y,this.value.setRawValue(new Tt(...P),x)}onPointerDown_(h){const f=h.data;if(!f.point)return;const x=this.value.rawValue,w=this.view.valueToPosition(x.x1,x.y1),P=Fs(f.point.x,f.point.y,w.x,w.y),k=this.view.valueToPosition(x.x2,x.y2),X=Fs(f.point.x,f.point.y,k.x,k.y);this.sel_.rawValue=P<=X?0:1,this.updateValue_(f.point,h.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(h){const f=h.data;!f.point||this.updateValue_(f.point,h.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(h){const f=h.data;!f.point||this.updateValue_(f.point,h.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(h){Va(h.key)&&h.preventDefault();const f=this.sel_.rawValue,x=this.value.rawValue.toObject();x[f*2]+=fn(this.baseStep_,Es(h)),x[f*2+1]+=fn(this.baseStep_,Jn(h)),this.value.setRawValue(new Tt(...x),{forceEmit:!1,last:!1})}onKeyUp_(h){Va(h.key)&&h.preventDefault();const f=fn(this.baseStep_,Es(h)),x=fn(this.baseStep_,Jn(h));f===0&&x===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Qt{constructor(h,f){this.value=f.value,this.viewProps=f.viewProps,this.view=new Qa(h,{viewProps:this.viewProps}),this.gc_=new Ds(h,{baseStep:f.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const x=Object.assign(Object.assign({},f.axis),{constraint:new yi({max:1,min:0})}),w=Object.assign(Object.assign({},f.axis),{constraint:void 0});this.tc_=new Is(h,{assembly:Ya,axes:[x,w,x,w],parser:jn,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(h=>h.inputElement)]}refresh(){this.gc_.refresh()}}class ye{constructor(h,f){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=f.value,this.viewProps=f.viewProps,this.foldable_=so(f.expanded),this.view=new Xo(h,{foldable:this.foldable_,pickerLayout:f.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new gs(h,{parser:qo,props:J.fromObject({formatter:Mt}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=f.pickerLayout==="popup"?new oo(h,{viewProps:this.viewProps}):null;const x=new Qt(h,{axis:f.axis,value:this.value,viewProps:this.viewProps});x.allFocusableElements.forEach(w=>{w.addEventListener("blur",this.onPopupChildBlur_),w.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=x,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),E(this.popC_.shows,w=>{w&&x.refresh()}),Kn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:w=>w.rawValue,backward:(w,P)=>P.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),xi(this.foldable_,this.view.pickerElement))}onButtonBlur_(h){if(!this.popC_)return;const f=h.relatedTarget;(!f||!this.popC_.view.element.contains(f))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(h){if(!this.popC_)return;const f=this.popC_.view.element,x=Nn(h);x&&f.contains(x)||x&&x===this.view.buttonElement&&!bi(f.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(h){!this.popC_||h.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function tr(){return new Do({assembly:Ya,components:[0,1,2,3].map(b=>b%2===0?new yi({min:0,max:1}):void 0)})}const Oe={id:"cubic-bezier",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(b){const h=V,f=j(b,{value:h.required.array(h.required.number),view:h.required.constant("cubicbezier"),expanded:h.optional.boolean,label:h.optional.string,picker:h.optional.custom(x=>x==="inline"||x==="popup"?x:void 0)});return f?{params:f}:null},controller(b){var h,f;const x=new Tt(...b.params.value),w=U(x,{constraint:tr(),equals:Tt.equals}),P=new ye(b.document,{axis:{baseStep:.1,textProps:J.fromObject({draggingScale:.01,formatter:De(2)})},expanded:(h=b.params.expanded)!==null&&h!==void 0?h:!1,pickerLayout:(f=b.params.picker)!==null&&f!==void 0?f:"popup",value:w,viewProps:b.viewProps});return new kn(b.document,{blade:b.blade,props:J.fromObject({label:b.params.label}),valueController:P})},api(b){return!(b.controller instanceof kn)||!(b.controller.valueController instanceof ye)?null:new Ko(b.controller)}};class nr extends i{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const Ye=20;class Zo{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(h){this.start_=h.getTime()}calculateFps_(h){if(this.timestamps_.length===0)return null;const f=this.timestamps_[0];return 1e3*(this.frameCount_-f.frameCount)/(h-f.time)}compactTimestamps_(){if(this.timestamps_.length<=Ye)return;const h=this.timestamps_.length-Ye;this.timestamps_.splice(0,h);const f=this.timestamps_[0].frameCount;this.timestamps_.forEach(x=>{x.frameCount-=f}),this.frameCount_-=f}end(h){if(this.start_===null)return;const f=h.getTime();this.duration_=f-this.start_,this.start_=null,this.fps_=this.calculateFps_(f),this.timestamps_.push({frameCount:this.frameCount_,time:f}),++this.frameCount_,this.compactTimestamps_()}}const It=g("fps");class Ls{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(It()),f.viewProps.bindClassModifiers(this.element),this.graphElement=h.createElement("div"),this.graphElement.classList.add(It("g")),this.element.appendChild(this.graphElement);const x=h.createElement("div");x.classList.add(It("l")),this.element.appendChild(x);const w=h.createElement("span");w.classList.add(It("v")),w.textContent="--",x.appendChild(w),this.valueElement=w;const P=h.createElement("span");P.classList.add(It("u")),P.textContent="FPS",x.appendChild(P)}}class ir{constructor(h,f){this.stopwatch_=new Zo,this.onTick_=this.onTick_.bind(this),this.ticker_=f.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=f.value,this.viewProps=f.viewProps,this.view=new Ls(h,{viewProps:this.viewProps}),this.graphC_=new Ho(h,{formatter:De(0),lineCount:f.lineCount,props:J.fromObject({maxValue:f.maxValue,minValue:f.minValue}),value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const h=this.stopwatch_.fps;if(h!==null){const f=this.value_.rawValue;this.value_.rawValue=wo(f,h),this.view.valueElement.textContent=h.toFixed(0)}}}function el(b,h){return h===0?new zn:new ro(b,h!=null?h:zo.monitor.defaultInterval)}const Ns={id:"fpsgraph",type:"blade",accept(b){const h=V,f=j(b,{view:h.required.constant("fpsgraph"),interval:h.optional.number,label:h.optional.string,lineCount:h.optional.number,max:h.optional.number,min:h.optional.number});return f?{params:f}:null},controller(b){var h,f,x,w;const P=(h=b.params.interval)!==null&&h!==void 0?h:500;return new zt(b.document,{blade:b.blade,props:J.fromObject({label:b.params.label}),valueController:new ir(b.document,{lineCount:(f=b.params.lineCount)!==null&&f!==void 0?f:2,maxValue:(x=b.params.max)!==null&&x!==void 0?x:90,minValue:(w=b.params.min)!==null&&w!==void 0?w:0,ticker:el(b.document,P),value:Ha(80),viewProps:b.viewProps})})},api(b){return!(b.controller instanceof zt)||!(b.controller.valueController instanceof ir)?null:new nr(b.controller)}};class st{constructor(h,f){this.min=h,this.max=f}static isObject(h){if(typeof h!="object"||h===null)return!1;const f=h.min,x=h.max;return!(typeof f!="number"||typeof x!="number")}static equals(h,f){return h.min===f.min&&h.max===f.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const Ti={fromComponents:b=>new st(b[0],b[1]),toComponents:b=>[b.min,b.max]};class bn{constructor(h){this.edge=h}constrain(h){var f,x,w,P,k,X,Z,Fe;if(h.min<=h.max)return new st((x=(f=this.edge)===null||f===void 0?void 0:f.constrain(h.min))!==null&&x!==void 0?x:h.min,(P=(w=this.edge)===null||w===void 0?void 0:w.constrain(h.max))!==null&&P!==void 0?P:h.max);const Rt=(h.min+h.max)/2;return new st((X=(k=this.edge)===null||k===void 0?void 0:k.constrain(Rt))!==null&&X!==void 0?X:Rt,(Fe=(Z=this.edge)===null||Z===void 0?void 0:Z.constrain(Rt))!==null&&Fe!==void 0?Fe:Rt)}}const xn=g("rsltxt");class sr{constructor(h,f){this.sliderView_=f.sliderView,this.textView_=f.textView,this.element=h.createElement("div"),this.element.classList.add(xn());const x=h.createElement("div");x.classList.add(xn("s")),x.appendChild(this.sliderView_.element),this.element.appendChild(x);const w=h.createElement("div");w.classList.add(xn("t")),w.appendChild(this.textView_.element),this.element.appendChild(w)}}const $e=g("rsl");class ar{constructor(h,f){this.maxValue_=f.maxValue,this.minValue_=f.minValue,this.element=h.createElement("div"),this.element.classList.add($e()),f.viewProps.bindClassModifiers(this.element),this.value_=f.value,this.value_.emitter.on("change",this.onValueChange_.bind(this));const x=h.createElement("div");x.classList.add($e("t")),this.element.appendChild(x),this.trackElement=x;const w=h.createElement("div");w.classList.add($e("b")),x.appendChild(w),this.barElement=w;const P=["min","max"].map(k=>{const X=h.createElement("div");return X.classList.add($e("k"),$e("k",k)),x.appendChild(X),X});this.knobElements=[P[0],P[1]],this.update()}valueToX_(h){return mt(me(h,this.minValue_,this.maxValue_,0,1),0,1)*100}update(){const h=this.value_.rawValue;h.length===0?this.element.classList.add($e(void 0,"zero")):this.element.classList.remove($e(void 0,"zero"));const f=[this.valueToX_(h.min),this.valueToX_(h.max)];this.barElement.style.left=`${f[0]}%`,this.barElement.style.right=`${100-f[1]}%`,this.knobElements.forEach((x,w)=>{x.style.left=`${f[w]}%`})}onValueChange_(){this.update()}}class ks{constructor(h,f){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.maxValue_=f.maxValue,this.minValue_=f.minValue,this.viewProps=f.viewProps,this.value=f.value,this.view=new ar(h,{maxValue:f.maxValue,minValue:f.minValue,value:this.value,viewProps:f.viewProps});const x=new Gt(this.view.trackElement);x.emitter.on("down",this.onPointerDown_),x.emitter.on("move",this.onPointerMove_),x.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(h){if(!h.point)return null;const f=(h.point.x+this.ofs_())/h.bounds.width;return me(f,0,1,this.minValue_,this.maxValue_)}onPointerDown_(h){if(!h.data.point)return;const f=h.data.point.x/h.data.bounds.width,x=this.value.rawValue,w=me(x.min,this.minValue_,this.maxValue_,0,1),P=me(x.max,this.minValue_,this.maxValue_,0,1);Math.abs(P-f)<=.025?this.grabbing_="max":Math.abs(w-f)<=.025?this.grabbing_="min":f>=w&&f<=P?(this.grabbing_="length",this.grabOffset_=me(f-w,0,1,0,this.maxValue_-this.minValue_)):f<w?(this.grabbing_="min",this.onPointerMove_(h)):f>P&&(this.grabbing_="max",this.onPointerMove_(h))}applyPointToValue_(h,f){const x=this.valueFromData_(h);if(x!==null){if(this.grabbing_==="min")this.value.setRawValue(new st(x,this.value.rawValue.max),f);else if(this.grabbing_==="max")this.value.setRawValue(new st(this.value.rawValue.min,x),f);else if(this.grabbing_==="length"){const w=this.value.rawValue.length;let P=x-this.grabOffset_,k=P+w;P<this.minValue_?(P=this.minValue_,k=this.minValue_+w):k>this.maxValue_&&(P=this.maxValue_-w,k=this.maxValue_),this.value.setRawValue(new st(P,k),f)}}}onPointerMove_(h){this.applyPointToValue_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.applyPointToValue_(h.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class zs{constructor(h,f){this.value=f.value,this.viewProps=f.viewProps,this.sc_=new ks(h,f);const x={baseStep:f.baseStep,constraint:f.constraint,textProps:J.fromObject({draggingScale:f.draggingScale,formatter:f.formatter})};this.tc_=new Is(h,{assembly:Ti,axes:[x,x],parser:f.parser,value:this.value,viewProps:f.viewProps}),this.view=new sr(h,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function tl(b){return st.isObject(b)?new st(b.min,b.max):new st(0,0)}function Mi(b,h){b.writeProperty("max",h.max),b.writeProperty("min",h.min)}function yn(b){const h=[],f=ko(b);f&&h.push(f);const x=No(b);return x&&h.push(x),new bn(new ms(h))}const Cn={id:"input-interval",type:"input",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept:(b,h)=>{if(!st.isObject(b))return null;const f=V,x=j(h,{format:f.optional.function,max:f.optional.number,min:f.optional.number,step:f.optional.number});return x?{initialValue:new st(b.min,b.max),params:x}:null},binding:{reader:b=>tl,constraint:b=>yn(b.params),equals:st.equals,writer:b=>Mi},controller(b){var h;const f=b.value,x=b.constraint;if(!(x instanceof bn))throw m.shouldNeverHappen();const w=(f.rawValue.min+f.rawValue.max)/2,P=(h=b.params.format)!==null&&h!==void 0?h:De(To(x.edge,w)),k=x.edge&&qt(x.edge,yi);if((k==null?void 0:k.minValue)!==void 0&&(k==null?void 0:k.maxValue)!==void 0)return new zs(b.document,{baseStep:Bs(x.edge),constraint:x.edge,draggingScale:ja(k,w),formatter:P,maxValue:k.maxValue,minValue:k.minValue,parser:jn,value:f,viewProps:b.viewProps});const X={baseStep:Bs(x.edge),constraint:x.edge,textProps:J.fromObject({draggingScale:w,formatter:P})};return new Is(b.document,{assembly:Ti,axes:[X,X],parser:jn,value:f,viewProps:b.viewProps})}};class Bi{constructor(h){this.controller_=h}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(h){this.controller_.viewProps.set("disabled",h)}get title(){var h;return(h=this.controller_.props.get("title"))!==null&&h!==void 0?h:""}set title(h){this.controller_.props.set("title",h)}}class nl extends r{constructor(h,f,x,w,P){super(h,w,P),this.cell=f,this.index=x}}class il extends i{constructor(h){super(h),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach(x=>{const w=new Bi(x);this.cellToApiMap_.set(x,w)})}get value(){return this.controller_.value}cell(h,f){const x=this.controller_.valueController,w=x.cellControllers[f*x.size[0]+h];return this.cellToApiMap_.get(w)}on(h,f){const x=f.bind(this);this.controller_.value.emitter.on(h,w=>{const P=this.controller_.valueController,k=P.findCellByValue(w.rawValue);if(!k)return;const X=this.cellToApiMap_.get(k);if(!X)return;const Z=P.cellControllers.indexOf(k);x(new nl(this,X,[Z%P.size[0],Math.floor(Z/P.size[0])],w.rawValue,void 0))})}}const Yn=g("rad");class sl{constructor(h,f){this.element=h.createElement("div"),this.element.classList.add(Yn()),f.viewProps.bindClassModifiers(this.element);const x=h.createElement("label");x.classList.add(Yn("l")),this.element.appendChild(x);const w=h.createElement("input");w.classList.add(Yn("i")),w.name=f.name,w.type="radio",f.viewProps.bindDisabled(w),x.appendChild(w),this.inputElement=w;const P=h.createElement("div");P.classList.add(Yn("b")),x.appendChild(P);const k=h.createElement("div");k.classList.add(Yn("t")),P.appendChild(k),T(f.props,"title",X=>{k.textContent=X})}}class Zt{constructor(h,f){this.props=f.props,this.viewProps=f.viewProps,this.view=new sl(h,{name:f.name,props:this.props,viewProps:this.viewProps})}}class Us{constructor(h,f){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=f.size;const[x,w]=this.size;for(let P=0;P<w;P++)for(let k=0;k<x;k++){const X=new Zt(h,{name:f.groupName,props:J.fromObject(Object.assign({},f.cellConfig(k,P))),viewProps:$t.create()});this.cellCs_.push(X),this.cellValues_.push(f.cellConfig(k,P).value)}this.value=f.value,E(this.value,P=>{const k=this.findCellByValue(P);!k||(k.view.inputElement.checked=!0)}),this.viewProps=$t.create(),this.view=new ds(h,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${x}, 1fr)`,this.cellCs_.forEach(P=>{P.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(P.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(h){const f=this.cellValues_.findIndex(x=>x===h);return f<0?null:this.cellCs_[f]}onCellInputChange_(h){const f=h.currentTarget,x=this.cellCs_.findIndex(w=>w.view.inputElement===f);x<0||(this.value.rawValue=this.cellValues_[x])}}const al=function(){return{id:"radiogrid",type:"blade",accept(b){const h=V,f=j(b,{cells:h.required.function,groupName:h.required.string,size:h.required.array(h.required.number),value:h.required.raw,view:h.required.constant("radiogrid"),label:h.optional.string});return f?{params:f}:null},controller(b){return new kn(b.document,{blade:b.blade,props:J.fromObject({label:b.params.label}),valueController:new Us(b.document,{groupName:b.params.groupName,cellConfig:b.params.cells,size:b.params.size,value:U(b.params.value)})})},api(b){return!(b.controller instanceof kn)||!(b.controller.valueController instanceof Us)?null:new il(b.controller)}}}();function Hs(b){return{id:"input-radiogrid",type:"input",accept(h,f){if(!b.isType(h))return null;const x=V,w=j(f,{cells:x.required.function,groupName:x.required.string,size:x.required.array(x.required.number),view:x.required.constant("radiogrid")});return w?{initialValue:h,params:w}:null},binding:b.binding,controller:h=>new Us(h.document,{cellConfig:h.params.cells,groupName:h.params.groupName,size:h.params.size,value:h.value})}}const rl=Hs({isType:b=>typeof b=="number",binding:{reader:b=>Ht,writer:b=>Yt}}),rr=Hs({isType:b=>typeof b=="string",binding:{reader:b=>Ua,writer:b=>Yt}}),ol=Hs({isType:b=>typeof b=="boolean",binding:{reader:b=>lo,writer:b=>Yt}}),ll=[jo,Oe,Ns,Cn,al,ol,rl,rr];t.CubicBezier=Tt,t.plugins=ll,Object.defineProperty(t,"__esModule",{value:!0})})})(Cr,Cr.exports);const I_=Vd(Cr.exports),R_=Wd({__proto__:null,default:I_},[Cr.exports]);var Sr={exports:{}};(function(n,e){(function(t,i){i(e)})(qu,function(t){function i(G){return G}const s="tp";function r(G){return(U,J)=>[s,"-",G,"v",U?`_${U}`:"",J?`-${J}`:""].join("")}function o(G,N){const J=Object.keys(N).reduce((Q,Y)=>{if(Q===void 0)return;const D=N[Y],z=D(G[Y]);return z.succeeded?Object.assign(Object.assign({},Q),{[Y]:z.value}):void 0},{});return J}function c(G,N){return G.reduce((U,J)=>{if(U===void 0)return;const Q=N(J);if(!(!Q.succeeded||Q.value===void 0))return[...U,Q.value]},[])}function p(G){return G===null?!1:typeof G=="object"}function m(G){return N=>U=>{if(!N&&U===void 0)return{succeeded:!1,value:void 0};if(N&&U===void 0)return{succeeded:!0,value:void 0};const J=G(U);return J!==void 0?{succeeded:!0,value:J}:{succeeded:!1,value:void 0}}}function _(G){return{custom:N=>m(N)(G),boolean:m(N=>typeof N=="boolean"?N:void 0)(G),number:m(N=>typeof N=="number"?N:void 0)(G),string:m(N=>typeof N=="string"?N:void 0)(G),function:m(N=>typeof N=="function"?N:void 0)(G),constant:N=>m(U=>U===N?N:void 0)(G),raw:m(N=>N)(G),object:N=>m(U=>{if(!!p(U))return o(U,N)})(G),array:N=>m(U=>{if(!!Array.isArray(U))return c(U,N)})(G)}}const v={optional:_(!0),required:_(!1)};function g(G,N){const U=v.required.object(N)(G);return U.succeeded?U.value:void 0}function C(G,N,U,J){function Q(Y){return Y instanceof U?Y:new U(function(D){D(Y)})}return new(U||(U=Promise))(function(Y,D){function z(j){try{V(J.next(j))}catch(ue){D(ue)}}function F(j){try{V(J.throw(j))}catch(ue){D(ue)}}function V(j){j.done?Y(j.value):Q(j.value).then(z,F)}V((J=J.apply(G,N||[])).next())})}function S(){const G=document.createElement("canvas");G.width=128,G.height=64;const N=G.getContext("2d");return N.fillStyle="#222",N.fillRect(0,0,G.width,G.height),N.fillStyle="#ddd",N.font="monospaced",N.textAlign="center",N.textBaseline="middle",N.fillText("No image",G.width*.5,G.height*.5),new Promise(U=>{G.toBlob(J=>{const Q=new Image;Q.src=URL.createObjectURL(J),Q.onload=()=>{U(Q)}})})}function E(G){return C(this,void 0,void 0,function*(){const N=new Image;return N.crossOrigin="anonymous",new Promise(U=>{N.src=G,N.onload=()=>{U(N)}})})}function T(G){const N=document.createElement("canvas");N.width=G.width,N.height=G.height,N.getContext("2d").drawImage(G,0,0);const J=new Image;return new Promise(Q=>{N.toBlob(Y=>{J.src=URL.createObjectURL(Y),J.onload=()=>{Q(J)}})})}const M=r("img");class W{constructor(N,U){this.element=N.createElement("div"),this.element.classList.add(M()),U.viewProps.bindClassModifiers(this.element),this.input=N.createElement("input"),this.input.classList.add(M("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",U.extensions.join(",")),this.element.appendChild(this.input),this.image_=N.createElement("img"),this.image_.classList.add(M("image")),this.image_.classList.add(M(`image_${U.imageFit}`)),this.element.classList.add(M("area_root")),this.element.appendChild(this.image_)}changeImage(N){this.image_.src=N}changeDraggingState(N){const U=this.element;N?U==null||U.classList.add(M("area_dragging")):U==null||U.classList.remove(M("area_dragging"))}}class B{constructor(N,U){this.placeholderImage=null,this.value=U.value,this.viewProps=U.viewProps,this.view=new W(N,{viewProps:this.viewProps,extensions:U.extensions,imageFit:U.imageFit}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(N){const U=(N==null?void 0:N.target).files;if(!U||!U.length)return;const J=U[0],Q=URL.createObjectURL(J);this.setValue(Q),this.updateImage(Q)}onDrop(N){return C(this,void 0,void 0,function*(){N.preventDefault();try{const{dataTransfer:U}=N,J=U==null?void 0:U.files[0];if(J){const Q=URL.createObjectURL(J);this.updateImage(Q),this.setValue(Q)}else{const Q=U==null?void 0:U.getData("url");if(!Q)throw new Error("No url");E(Q).then(Y=>C(this,void 0,void 0,function*(){const D=yield T(Y);this.updateImage(D.src),this.setValue(D)}))}}catch(U){console.error("Could not parse the dropped image",U)}finally{this.view.changeDraggingState(!1)}})}onDragOver(N){N.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(N){return C(this,void 0,void 0,function*(){if(N instanceof HTMLImageElement)T(N).then(U=>{this.updateImage(U.src)});else if(typeof N=="string"){let U="";try{if(N==="placeholder")throw new Error("placeholder");new URL(N),U=(yield E(N)).src}catch{U=(yield this.handlePlaceholderImage()).src}finally{this.updateImage(U),this.setValue(U)}}})}updateImage(N){this.view.changeImage(N)}setValue(N){return C(this,void 0,void 0,function*(){N instanceof HTMLImageElement?this.value.setRawValue(N):N?this.value.setRawValue(yield E(N)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return C(this,void 0,void 0,function*(){return this.placeholderImage||(this.placeholderImage=yield S()),this.placeholderImage})}}const O=[".jpg",".png",".gif"],H={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:grid;height:calc(var(--bld-us) * 3);overflow:hidden;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:100%;height:100%;opacity:0}.tp-imgv_image{width:100%;height:100%;position:absolute;pointer-events:none;border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:6px;opacity:0.6}",accept(G,N){if(!(G instanceof HTMLImageElement||typeof G=="string"))return null;const U=v,J=g(N,{view:U.required.constant("input-image"),acceptUrl:U.optional.boolean,imageFit:U.optional.custom(Q=>Q==="contain"||Q==="cover"?Q:void 0),extensions:U.optional.array(U.required.string)});return J?{initialValue:G,params:J}:null},binding:{reader(G){return N=>N instanceof HTMLImageElement?N.src===""?"placeholder":N.src:typeof N=="string"?N:"placeholder"},writer(G){return(N,U)=>{N.write(U)}}},controller(G){var N,U;return new B(G.document,{value:G.value,imageFit:(N=G.params.imageFit)!==null&&N!==void 0?N:"cover",viewProps:G.viewProps,extensions:(U=G.params.extensions)!==null&&U!==void 0?U:O})}};t.plugin=H,Object.defineProperty(t,"__esModule",{value:!0})})})(Sr,Sr.exports);const O_=Vd(Sr.exports),F_=Wd({__proto__:null,default:O_},[Sr.exports]);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $=function(n,e){if(!n)throw ss(e)},ss=function(n){return new Error("Firebase Database ("+Zd.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const em=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},D_=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[t++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[t++],o=n[t++],c=n[t++],p=((s&7)<<18|(r&63)<<12|(o&63)<<6|c&63)-65536;e[i++]=String.fromCharCode(55296+(p>>10)),e[i++]=String.fromCharCode(56320+(p&1023))}else{const r=n[t++],o=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Yu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,c=o?n[s+1]:0,p=s+2<n.length,m=p?n[s+2]:0,_=r>>2,v=(r&3)<<4|c>>4;let g=(c&15)<<2|m>>6,C=m&63;p||(C=64,o||(g=64)),i.push(t[_],t[v],t[g],t[C])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(em(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):D_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const m=s<n.length?t[n.charAt(s)]:64;++s;const v=s<n.length?t[n.charAt(s)]:64;if(++s,r==null||c==null||m==null||v==null)throw Error();const g=r<<2|c>>4;if(i.push(g),m!==64){const C=c<<4&240|m>>2;if(i.push(C),v!==64){const S=m<<6&192|v;i.push(S)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},tm=function(n){const e=em(n);return Yu.encodeByteArray(e,!0)},wr=function(n){return tm(n).replace(/\./g,"")},xu=function(n){try{return Yu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L_(n){return nm(void 0,n)}function nm(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!N_(t)||(n[t]=nm(n[t],e[t]));return n}function N_(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k_(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function im(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(k_())}function z_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sm(){return Zd.NODE_ADMIN===!0}function U_(){return typeof indexedDB=="object"}function H_(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var r;e(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}function G_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_=()=>G_().__FIREBASE_DEFAULTS__,W_=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},j_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&xu(n[1]);return e&&JSON.parse(e)},am=()=>{try{return V_()||W_()||j_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},K_=n=>{var e,t;return(t=(e=am())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},J_=n=>{const e=K_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},$_=()=>{var n;return(n=am())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q_(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n),c="";return[wr(JSON.stringify(t)),wr(JSON.stringify(o)),c].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X_="FirebaseError";class Ca extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=X_,Object.setPrototypeOf(this,Ca.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,rm.prototype.create)}}class rm{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?Y_(r,i):"Error",c=`${this.serviceName}: ${o} (${s}).`;return new Ca(s,c,i)}}function Y_(n,e){return n.replace(Q_,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const Q_=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ca(n){return JSON.parse(n)}function Ve(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const om=function(n){let e={},t={},i={},s="";try{const r=n.split(".");e=ca(xu(r[0])||""),t=ca(xu(r[1])||""),s=r[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},Z_=function(n){const e=om(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},eb=function(n){const e=om(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Qi(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Uh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ar(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function yu(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const r=n[s],o=e[s];if(Hh(r)&&Hh(o)){if(!yu(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function Hh(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tb(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let v=0;v<16;v++)i[v]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let v=0;v<16;v++)i[v]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let v=16;v<80;v++){const g=i[v-3]^i[v-8]^i[v-14]^i[v-16];i[v]=(g<<1|g>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],c=this.chain_[3],p=this.chain_[4],m,_;for(let v=0;v<80;v++){v<40?v<20?(m=c^r&(o^c),_=1518500249):(m=r^o^c,_=1859775393):v<60?(m=r&o|c&(r|o),_=2400959708):(m=r^o^c,_=3395469782);const g=(s<<5|s>>>27)+m+p+_+i[v]&4294967295;p=c,c=o,o=(r<<30|r>>>2)&4294967295,r=s,s=g}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+p&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const r=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<t;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function Qu(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ib=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,$(i<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},$r=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sa(n){return n&&n._delegate?n._delegate:n}class ha{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sb{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Jr;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rb(e))try{this.getOrInitializeService({instanceIdentifier:ei})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=ei){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ei){return this.instances.has(e)}getOptions(e=ei){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[r,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);i===c&&o.resolve(s)}return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(!!i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:ab(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=ei){return this.component?this.component.multipleInstances?e:ei:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ab(n){return n===ei?void 0:n}function rb(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new sb(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Me;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Me||(Me={}));const lb={debug:Me.DEBUG,verbose:Me.VERBOSE,info:Me.INFO,warn:Me.WARN,error:Me.ERROR,silent:Me.SILENT},ub=Me.INFO,cb={[Me.DEBUG]:"log",[Me.VERBOSE]:"log",[Me.INFO]:"info",[Me.WARN]:"warn",[Me.ERROR]:"error"},hb=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=cb[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class pb{constructor(e){this.name=e,this._logLevel=ub,this._logHandler=hb,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Me))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?lb[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Me.DEBUG,...e),this._logHandler(this,Me.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Me.VERBOSE,...e),this._logHandler(this,Me.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Me.INFO,...e),this._logHandler(this,Me.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Me.WARN,...e),this._logHandler(this,Me.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Me.ERROR,...e),this._logHandler(this,Me.ERROR,...e)}}const db=(n,e)=>e.some(t=>n instanceof t);let Gh,Vh;function mb(){return Gh||(Gh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fb(){return Vh||(Vh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lm=new WeakMap,Cu=new WeakMap,um=new WeakMap,Il=new WeakMap,Zu=new WeakMap;function vb(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(Rn(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&lm.set(t,n)}).catch(()=>{}),Zu.set(e,n),e}function gb(n){if(Cu.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});Cu.set(n,e)}let Su={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Cu.get(n);if(e==="objectStoreNames")return n.objectStoreNames||um.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Rn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function _b(n){Su=n(Su)}function bb(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Rl(this),e,...t);return um.set(i,e.sort?e.sort():[e]),Rn(i)}:fb().includes(n)?function(...e){return n.apply(Rl(this),e),Rn(lm.get(this))}:function(...e){return Rn(n.apply(Rl(this),e))}}function xb(n){return typeof n=="function"?bb(n):(n instanceof IDBTransaction&&gb(n),db(n,mb())?new Proxy(n,Su):n)}function Rn(n){if(n instanceof IDBRequest)return vb(n);if(Il.has(n))return Il.get(n);const e=xb(n);return e!==n&&(Il.set(n,e),Zu.set(e,n)),e}const Rl=n=>Zu.get(n);function yb(n,e,{blocked:t,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,e),c=Rn(o);return i&&o.addEventListener("upgradeneeded",p=>{i(Rn(o.result),p.oldVersion,p.newVersion,Rn(o.transaction))}),t&&o.addEventListener("blocked",()=>t()),c.then(p=>{r&&p.addEventListener("close",()=>r()),s&&p.addEventListener("versionchange",()=>s())}).catch(()=>{}),c}const Cb=["get","getKey","getAll","getAllKeys","count"],Sb=["put","add","delete","clear"],Ol=new Map;function Wh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ol.get(e))return Ol.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=Sb.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||Cb.includes(t)))return;const r=async function(o,...c){const p=this.transaction(o,s?"readwrite":"readonly");let m=p.store;return i&&(m=m.index(c.shift())),(await Promise.all([m[t](...c),s&&p.done]))[0]};return Ol.set(e,r),r}_b(n=>({...n,get:(e,t,i)=>Wh(e,t)||n.get(e,t,i),has:(e,t)=>!!Wh(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ab(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function Ab(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const wu="@firebase/app",jh="0.8.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=new pb("@firebase/app"),Eb="@firebase/app-compat",Tb="@firebase/analytics-compat",Mb="@firebase/analytics",Bb="@firebase/app-check-compat",Pb="@firebase/app-check",Ib="@firebase/auth",Rb="@firebase/auth-compat",Ob="@firebase/database",Fb="@firebase/database-compat",Db="@firebase/functions",Lb="@firebase/functions-compat",Nb="@firebase/installations",kb="@firebase/installations-compat",zb="@firebase/messaging",Ub="@firebase/messaging-compat",Hb="@firebase/performance",Gb="@firebase/performance-compat",Vb="@firebase/remote-config",Wb="@firebase/remote-config-compat",jb="@firebase/storage",Kb="@firebase/storage-compat",Jb="@firebase/firestore",$b="@firebase/firestore-compat",qb="firebase",Xb="9.12.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au="[DEFAULT]",Yb={[wu]:"fire-core",[Eb]:"fire-core-compat",[Mb]:"fire-analytics",[Tb]:"fire-analytics-compat",[Pb]:"fire-app-check",[Bb]:"fire-app-check-compat",[Ib]:"fire-auth",[Rb]:"fire-auth-compat",[Ob]:"fire-rtdb",[Fb]:"fire-rtdb-compat",[Db]:"fire-fn",[Lb]:"fire-fn-compat",[Nb]:"fire-iid",[kb]:"fire-iid-compat",[zb]:"fire-fcm",[Ub]:"fire-fcm-compat",[Hb]:"fire-perf",[Gb]:"fire-perf-compat",[Vb]:"fire-rc",[Wb]:"fire-rc-compat",[jb]:"fire-gcs",[Kb]:"fire-gcs-compat",[Jb]:"fire-fst",[$b]:"fire-fst-compat","fire-js":"fire-js",[qb]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er=new Map,Eu=new Map;function Qb(n,e){try{n.container.addComponent(e)}catch(t){ci.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Tr(n){const e=n.name;if(Eu.has(e))return ci.debug(`There were multiple attempts to register component ${e}.`),!1;Eu.set(e,n);for(const t of Er.values())Qb(t,n);return!0}function Zb(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e1={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},On=new rm("app","Firebase",e1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ha("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw On.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1=Xb;function cm(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:Au,automaticDataCollectionEnabled:!1},e),s=i.name;if(typeof s!="string"||!s)throw On.create("bad-app-name",{appName:String(s)});if(t||(t=$_()),!t)throw On.create("no-options");const r=Er.get(s);if(r){if(yu(t,r.options)&&yu(i,r.config))return r;throw On.create("duplicate-app",{appName:s})}const o=new ob(s);for(const p of Eu.values())o.addComponent(p);const c=new t1(t,i,o);return Er.set(s,c),c}function i1(n=Au){const e=Er.get(n);if(!e&&n===Au)return cm();if(!e)throw On.create("no-app",{appName:n});return e}function Ji(n,e,t){var i;let s=(i=Yb[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const c=[`Unable to register library "${s}" with version "${e}":`];r&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ci.warn(c.join(" "));return}Tr(new ha(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s1="firebase-heartbeat-database",a1=1,pa="firebase-heartbeat-store";let Fl=null;function hm(){return Fl||(Fl=yb(s1,a1,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(pa)}}}).catch(n=>{throw On.create("idb-open",{originalErrorMessage:n.message})})),Fl}async function r1(n){var e;try{return(await hm()).transaction(pa).objectStore(pa).get(pm(n))}catch(t){if(t instanceof Ca)ci.warn(t.message);else{const i=On.create("idb-get",{originalErrorMessage:(e=t)===null||e===void 0?void 0:e.message});ci.warn(i.message)}}}async function Kh(n,e){var t;try{const s=(await hm()).transaction(pa,"readwrite");return await s.objectStore(pa).put(e,pm(n)),s.done}catch(i){if(i instanceof Ca)ci.warn(i.message);else{const s=On.create("idb-set",{originalErrorMessage:(t=i)===null||t===void 0?void 0:t.message});ci.warn(s.message)}}}function pm(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1=1024,l1=30*24*60*60*1e3;class u1{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new h1(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Jh();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(s=>{const r=new Date(s.date).valueOf();return Date.now()-r<=l1}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Jh(),{heartbeatsToSend:t,unsentEntries:i}=c1(this._heartbeatsCache.heartbeats),s=wr(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Jh(){return new Date().toISOString().substring(0,10)}function c1(n,e=o1){const t=[];let i=n.slice();for(const s of n){const r=t.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),$h(t)>e){r.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),$h(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class h1{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return U_()?H_().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await r1(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Kh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Kh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function $h(n){return wr(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p1(n){Tr(new ha("platform-logger",e=>new wb(e),"PRIVATE")),Tr(new ha("heartbeat",e=>new u1(e),"PRIVATE")),Ji(wu,jh,n),Ji(wu,jh,"esm2017"),Ji("fire-js","")}p1("");var d1="firebase",m1="9.12.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ji(d1,m1,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Se;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Se||(Se={}));const f1={debug:Se.DEBUG,verbose:Se.VERBOSE,info:Se.INFO,warn:Se.WARN,error:Se.ERROR,silent:Se.SILENT},v1=Se.INFO,g1={[Se.DEBUG]:"log",[Se.VERBOSE]:"log",[Se.INFO]:"info",[Se.WARN]:"warn",[Se.ERROR]:"error"},_1=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=g1[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class b1{constructor(e){this.name=e,this._logLevel=v1,this._logHandler=_1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Se))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?f1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Se.DEBUG,...e),this._logHandler(this,Se.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Se.VERBOSE,...e),this._logHandler(this,Se.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Se.INFO,...e),this._logHandler(this,Se.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Se.WARN,...e),this._logHandler(this,Se.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Se.ERROR,...e),this._logHandler(this,Se.ERROR,...e)}}const qh="@firebase/database",Xh="0.13.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dm="";function x1(n){dm=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ve(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ca(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return hn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new y1(e)}}catch{}return new C1},ni=mm("localStorage"),Tu=mm("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $i=new b1("@firebase/database"),S1=function(){let n=1;return function(){return n++}}(),fm=function(n){const e=ib(n),t=new nb;t.update(e);const i=t.digest();return Yu.encodeByteArray(i)},wa=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=wa.apply(null,i):typeof i=="object"?e+=Ve(i):e+=i,e+=" "}return e};let ri=null,Yh=!0;const w1=function(n,e){$(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?($i.logLevel=Se.VERBOSE,ri=$i.log.bind($i),e&&Tu.set("logging_enabled",!0)):typeof n=="function"?ri=n:(ri=null,Tu.remove("logging_enabled"))},qe=function(...n){if(Yh===!0&&(Yh=!1,ri===null&&Tu.get("logging_enabled")===!0&&w1(!0)),ri){const e=wa.apply(null,n);ri(e)}},Aa=function(n){return function(...e){qe(n,...e)}},Mu=function(...n){const e="FIREBASE INTERNAL ERROR: "+wa(...n);$i.error(e)},ln=function(...n){const e=`FIREBASE FATAL ERROR: ${wa(...n)}`;throw $i.error(e),new Error(e)},lt=function(...n){const e="FIREBASE WARNING: "+wa(...n);$i.warn(e)},A1=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&lt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},vm=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},E1=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Zi="[MIN_NAME]",hi="[MAX_NAME]",as=function(n,e){if(n===e)return 0;if(n===Zi||e===hi)return-1;if(e===Zi||n===hi)return 1;{const t=Qh(n),i=Qh(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},T1=function(n,e){return n===e?0:n<e?-1:1},$s=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ve(e))},ec=function(n){if(typeof n!="object"||n===null)return Ve(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=Ve(e[i]),t+=":",t+=ec(n[e[i]]);return t+="}",t},gm=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function ct(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const _m=function(n){$(!vm(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,r,o,c,p;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(c=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=c+i,o=Math.round(n*Math.pow(2,t-c)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));const m=[];for(p=t;p;p-=1)m.push(o%2?1:0),o=Math.floor(o/2);for(p=e;p;p-=1)m.push(r%2?1:0),r=Math.floor(r/2);m.push(s?1:0),m.reverse();const _=m.join("");let v="";for(p=0;p<64;p+=8){let g=parseInt(_.substr(p,8),2).toString(16);g.length===1&&(g="0"+g),v=v+g}return v.toLowerCase()},M1=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},B1=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function P1(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const I1=new RegExp("^-?(0*)\\d{1,10}$"),R1=-2147483648,O1=2147483647,Qh=function(n){if(I1.test(n)){const e=Number(n);if(e>=R1&&e<=O1)return e}return null},rs=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw lt("Exception was thrown by user callback.",t),e},Math.floor(0))}},F1=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ia=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){lt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(qe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',lt(e)}}class qi{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}qi.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc="5",bm="v",xm="s",ym="r",Cm="f",Sm=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wm="ls",Am="p",Bu="ac",Em="websocket",Tm="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(e,t,i,s,r=!1,o="",c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ni.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ni.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function N1(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Bm(n,e,t){$(typeof e=="string","typeof type must == string"),$(typeof t=="object","typeof params must == object");let i;if(e===Em)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Tm)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);N1(n)&&(t.ns=n.namespace);const s=[];return ct(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(){this.counters_={}}incrementCounter(e,t=1){hn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return L_(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dl={},Ll={};function nc(n){const e=n.toString();return Dl[e]||(Dl[e]=new k1),Dl[e]}function z1(n,e){const t=n.toString();return Ll[t]||(Ll[t]=e()),Ll[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&rs(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh="start",H1="close",G1="pLPCommand",V1="pRTLPCB",Pm="id",Im="pw",Rm="ser",W1="cb",j1="seg",K1="ts",J1="d",$1="dframe",Om=1870,Fm=30,q1=Om-Fm,X1=25e3,Y1=3e4;class Gi{constructor(e,t,i,s,r,o,c){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Aa(e),this.stats_=nc(t),this.urlFn=p=>(this.appCheckToken&&(p[Bu]=this.appCheckToken),Bm(t,Tm,p))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new U1(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Y1)),E1(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ic((...r)=>{const[o,c,p,m,_]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Zh)this.id=c,this.password=p;else if(o===H1)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,c]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,c)},()=>{this.onClosed_()},this.urlFn);const i={};i[Zh]="t",i[Rm]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[W1]=this.scriptTagHolder.uniqueCallbackIdentifier),i[bm]=tc,this.transportSessionId&&(i[xm]=this.transportSessionId),this.lastSessionId&&(i[wm]=this.lastSessionId),this.applicationId&&(i[Am]=this.applicationId),this.appCheckToken&&(i[Bu]=this.appCheckToken),typeof location<"u"&&location.hostname&&Sm.test(location.hostname)&&(i[ym]=Cm);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Gi.forceAllow_=!0}static forceDisallow(){Gi.forceDisallow_=!0}static isAvailable(){return Gi.forceAllow_?!0:!Gi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!M1()&&!B1()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=tm(t),s=gm(i,q1);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[$1]="t",i[Pm]=e,i[Im]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ve(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ic{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=S1(),window[G1+this.uniqueCallbackIdentifier]=e,window[V1+this.uniqueCallbackIdentifier]=t,this.myIFrame=ic.createIFrame_();let r="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"){const c=document.domain;r='<script>document.domain="'+c+'";<\/script>'}const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(c){qe("frame writing exception"),c.stack&&qe(c.stack),qe(c)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||qe("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Pm]=this.myID,e[Im]=this.myPW,e[Rm]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Fm+i.length<=Om;){const o=this.pendingSegs.shift();i=i+"&"+j1+s+"="+o.seg+"&"+K1+s+"="+o.ts+"&"+J1+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(X1)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{qe("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q1=16384,Z1=45e3;let Mr=null;typeof MozWebSocket<"u"?Mr=MozWebSocket:typeof WebSocket<"u"&&(Mr=WebSocket);class Ft{constructor(e,t,i,s,r,o,c){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Aa(this.connId),this.stats_=nc(t),this.connURL=Ft.connectionURL_(t,o,c,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,r){const o={};return o[bm]=tc,typeof location<"u"&&location.hostname&&Sm.test(location.hostname)&&(o[ym]=Cm),t&&(o[xm]=t),i&&(o[wm]=i),s&&(o[Bu]=s),r&&(o[Am]=r),Bm(e,Em,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ni.set("previous_websocket_failure",!0);try{let i;sm(),this.mySock=new Mr(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Ft.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Mr!==null&&!Ft.forceDisallow_}static previouslyFailed(){return ni.isInMemoryStorage||ni.get("previous_websocket_failure")===!0}markConnectionHealthy(){ni.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=ca(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if($(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=Ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=gm(t,Q1);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Z1))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ft.responsesRequiredToBeHealthy=2;Ft.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Gi,Ft]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Ft&&Ft.isAvailable();let i=t&&!Ft.previouslyFailed();if(e.webSocketOnly&&(t||lt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ft];else{const s=this.transports_=[];for(const r of da.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);da.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}da.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex=6e4,tx=5e3,nx=10*1024,ix=100*1024,Nl="t",ep="d",sx="s",tp="r",ax="e",np="o",ip="a",sp="n",ap="p",rx="h";class ox{constructor(e,t,i,s,r,o,c,p,m,_){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=c,this.onDisconnect_=p,this.onKill_=m,this.lastSessionId=_,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Aa("c:"+this.id+":"),this.transportManager_=new da(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ia(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ix?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>nx?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Nl in e){const t=e[Nl];t===ip?this.upgradeIfSecondaryHealthy_():t===tp?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===np&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=$s("t",e),i=$s("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ap,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ip,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:sp,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=$s("t",e),i=$s("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=$s(Nl,e);if(ep in e){const i=e[ep];if(t===rx)this.onHandshake_(i);else if(t===sp){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===sx?this.onConnectionShutdown_(i):t===tp?this.onReset_(i):t===ax?Mu("Server Error: "+i):t===np?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Mu("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),tc!==i&&lt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ia(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(ex))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ia(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(tx))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ap,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ni.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e){this.allowedEvents_=e,this.listeners_={},$(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){$(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br extends Lm{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!im()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Br}getInitialEvent(e){return $(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp=32,op=768;class Ce{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function de(){return new Ce("")}function re(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Dn(n){return n.pieces_.length-n.pieceNum_}function we(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Ce(n.pieces_,e)}function Nm(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function lx(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function km(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function zm(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Ce(e,0)}function Ne(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof Ce)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new Ce(t,0)}function le(n){return n.pieceNum_>=n.pieces_.length}function rt(n,e){const t=re(n),i=re(e);if(t===null)return e;if(t===i)return rt(we(n),we(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function sc(n,e){if(Dn(n)!==Dn(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Dt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Dn(n)>Dn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class ux{constructor(e,t){this.errorPrefix_=t,this.parts_=km(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=$r(this.parts_[i]);Um(this)}}function cx(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=$r(e),Um(n)}function hx(n){const e=n.parts_.pop();n.byteLength_-=$r(e),n.parts_.length>0&&(n.byteLength_-=1)}function Um(n){if(n.byteLength_>op)throw new Error(n.errorPrefix_+"has a key path longer than "+op+" bytes ("+n.byteLength_+").");if(n.parts_.length>rp)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+rp+") or object contains a cycle "+ti(n))}function ti(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac extends Lm{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new ac}getInitialEvent(e){return $(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs=1e3,px=60*5*1e3,lp=30*1e3,dx=1.3,mx=3e4,fx="server_kill",up=3;class rn extends Dm{constructor(e,t,i,s,r,o,c,p){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=c,this.authOverride_=p,this.id=rn.nextPersistentConnectionId_++,this.log_=Aa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qs,this.maxReconnectDelay_=px,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,p&&!sm())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ac.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Br.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(Ve(r)),$(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new Jr,i={p:e._path.toString(),q:e._queryObject},s={action:"g",request:i,onComplete:o=>{const c=o.d;o.s==="ok"?t.resolve(c):t.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),$(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),$(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const c={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(o).set(r,c),this.connected_&&this.sendListen_(c)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,c=>{const p=c.d,m=c.s;rn.warnOnListenWarnings_(p,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",c),m!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(m,p))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&hn(e,"w")){const i=Qi(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();lt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||eb(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lp)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Z_(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),$(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,r){this.initConnection_();const o={p:t,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ve(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Mu("Unrecognized action received from server: "+Ve(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){$(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qs,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=qs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>mx&&(this.reconnectDelay_=qs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*dx)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+rn.nextConnectionId_++,r=this.lastSessionId;let o=!1,c=null;const p=function(){c?c.close():(o=!0,i())},m=function(v){$(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(v)};this.realtime_={close:p,sendRequest:m};const _=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[v,g]=await Promise.all([this.authTokenProvider_.getToken(_),this.appCheckTokenProvider_.getToken(_)]);o?qe("getToken() completed but was canceled"):(qe("getToken() completed. Creating connection."),this.authToken_=v&&v.accessToken,this.appCheckToken_=g&&g.token,c=new ox(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,C=>{lt(C+" ("+this.repoInfo_.toString()+")"),this.interrupt(fx)},r))}catch(v){this.log_("Failed to get token: "+v),o||(this.repoInfo_.nodeAdmin&&lt(v),p())}}}interrupt(e){qe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){qe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Uh(this.interruptReasons_)&&(this.reconnectDelay_=qs,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(r=>ec(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new Ce(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(t),r.delete(t),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){qe("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=up&&(this.reconnectDelay_=lp,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){qe("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=up&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+dm.replace(/\./g,"-")]=1,im()?e["framework.cordova"]=1:z_()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Br.getInstance().currentlyOnline();return Uh(this.interruptReasons_)&&e}}rn.nextPersistentConnectionId_=0;rn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new oe(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new oe(Zi,e),s=new oe(Zi,t);return this.compare(i,s)!==0}minPost(){return oe.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pr;class Hm extends qr{static get __EMPTY_NODE(){return pr}static set __EMPTY_NODE(e){pr=e}compare(e,t){return as(e.name,t.name)}isDefinedOn(e){throw ss("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return oe.MIN}maxPost(){return new oe(hi,pr)}makePost(e,t){return $(typeof e=="string","KeyIndex indexValue must always be a string."),new oe(e,pr)}toString(){return".key"}}const Xi=new Hm;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class He{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i!=null?i:He.RED,this.left=s!=null?s:ot.EMPTY_NODE,this.right=r!=null?r:ot.EMPTY_NODE}copy(e,t,i,s,r){return new He(e!=null?e:this.key,t!=null?t:this.value,i!=null?i:this.color,s!=null?s:this.left,r!=null?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ot.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return ot.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,He.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,He.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}He.RED=!0;He.BLACK=!1;class vx{copy(e,t,i,s,r){return this}insert(e,t,i){return new He(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ot{constructor(e,t=ot.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ot(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,He.BLACK,null,null))}remove(e){return new ot(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,He.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new dr(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new dr(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new dr(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new dr(this.root_,null,this.comparator_,!0,e)}}ot.EMPTY_NODE=new vx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gx(n,e){return as(n.name,e.name)}function rc(n,e){return as(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pu;function _x(n){Pu=n}const Gm=function(n){return typeof n=="number"?"number:"+_m(n):"string:"+n},Vm=function(n){if(n.isLeafNode()){const e=n.val();$(typeof e=="string"||typeof e=="number"||typeof e=="object"&&hn(e,".sv"),"Priority must be a string or number.")}else $(n===Pu||n.isEmpty(),"priority of unexpected type.");$(n===Pu||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cp;class Ue{constructor(e,t=Ue.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,$(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Vm(this.priorityNode_)}static set __childrenNodeConstructor(e){cp=e}static get __childrenNodeConstructor(){return cp}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ue(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ue.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return le(e)?this:re(e)===".priority"?this.priorityNode_:Ue.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ue.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=re(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:($(i!==".priority"||Dn(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Ue.__childrenNodeConstructor.EMPTY_NODE.updateChild(we(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Gm(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=_m(this.value_):e+=this.value_,this.lazyHash_=fm(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ue.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ue.__childrenNodeConstructor?-1:($(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=Ue.VALUE_TYPE_ORDER.indexOf(t),r=Ue.VALUE_TYPE_ORDER.indexOf(i);return $(s>=0,"Unknown leaf type: "+t),$(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ue.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wm,jm;function bx(n){Wm=n}function xx(n){jm=n}class yx extends qr{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?as(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return oe.MIN}maxPost(){return new oe(hi,new Ue("[PRIORITY-POST]",jm))}makePost(e,t){const i=Wm(e);return new oe(t,new Ue("[PRIORITY-POST]",i))}toString(){return".priority"}}const Re=new yx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cx=Math.log(2);class Sx{constructor(e){const t=r=>parseInt(Math.log(r)/Cx,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Pr=function(n,e,t,i){n.sort(e);const s=function(p,m){const _=m-p;let v,g;if(_===0)return null;if(_===1)return v=n[p],g=t?t(v):v,new He(g,v.node,He.BLACK,null,null);{const C=parseInt(_/2,10)+p,S=s(p,C),E=s(C+1,m);return v=n[C],g=t?t(v):v,new He(g,v.node,He.BLACK,S,E)}},r=function(p){let m=null,_=null,v=n.length;const g=function(S,E){const T=v-S,M=v;v-=S;const W=s(T+1,M),B=n[T],O=t?t(B):B;C(new He(O,B.node,E,null,W))},C=function(S){m?(m.left=S,m=S):(_=S,m=S)};for(let S=0;S<p.count;++S){const E=p.nextBitIsOne(),T=Math.pow(2,p.count-(S+1));E?g(T,He.BLACK):(g(T,He.BLACK),g(T,He.RED))}return _},o=new Sx(n.length),c=r(o);return new ot(i||e,c)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kl;const Li={};class an{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return $(Li&&Re,"ChildrenNode.ts has not been loaded"),kl=kl||new an({".priority":Li},{".priority":Re}),kl}get(e){const t=Qi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ot?t:null}hasIndex(e){return hn(this.indexSet_,e.toString())}addIndex(e,t){$(e!==Xi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(oe.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let c;s?c=Pr(i,e.getCompare()):c=Li;const p=e.toString(),m=Object.assign({},this.indexSet_);m[p]=e;const _=Object.assign({},this.indexes_);return _[p]=c,new an(_,m)}addToIndexes(e,t){const i=Ar(this.indexes_,(s,r)=>{const o=Qi(this.indexSet_,r);if($(o,"Missing index implementation for "+r),s===Li)if(o.isDefinedOn(e.node)){const c=[],p=t.getIterator(oe.Wrap);let m=p.getNext();for(;m;)m.name!==e.name&&c.push(m),m=p.getNext();return c.push(e),Pr(c,o.getCompare())}else return Li;else{const c=t.get(e.name);let p=s;return c&&(p=p.remove(new oe(e.name,c))),p.insert(e,e.node)}});return new an(i,this.indexSet_)}removeFromIndexes(e,t){const i=Ar(this.indexes_,s=>{if(s===Li)return s;{const r=t.get(e.name);return r?s.remove(new oe(e.name,r)):s}});return new an(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xs;class ne{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Vm(this.priorityNode_),this.children_.isEmpty()&&$(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Xs||(Xs=new ne(new ot(rc),null,an.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Xs}updatePriority(e){return this.children_.isEmpty()?this:new ne(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Xs:t}}getChild(e){const t=re(e);return t===null?this:this.getImmediateChild(t).getChild(we(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if($(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new oe(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?Xs:this.priorityNode_;return new ne(s,o,r)}}updateChild(e,t){const i=re(e);if(i===null)return t;{$(re(e)!==".priority"||Dn(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(we(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,r=!0;if(this.forEachChild(Re,(o,c)=>{t[o]=c.val(e),i++,r&&ne.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const c in t)o[c]=t[c];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Gm(this.getPriority().val())+":"),this.forEachChild(Re,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":fm(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new oe(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new oe(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new oe(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,oe.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,oe.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ea?-1:0}withIndex(e){if(e===Xi||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ne(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Xi||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(Re),s=t.getIterator(Re);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Xi?null:this.indexMap_.get(e.toString())}}ne.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class wx extends ne{constructor(){super(new ot(rc),ne.EMPTY_NODE,an.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ne.EMPTY_NODE}isEmpty(){return!1}}const Ea=new wx;Object.defineProperties(oe,{MIN:{value:new oe(Zi,ne.EMPTY_NODE)},MAX:{value:new oe(hi,Ea)}});Hm.__EMPTY_NODE=ne.EMPTY_NODE;Ue.__childrenNodeConstructor=ne;_x(Ea);xx(Ea);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ax=!0;function Je(n,e=null){if(n===null)return ne.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),$(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ue(t,Je(e))}if(!(n instanceof Array)&&Ax){const t=[];let i=!1;if(ct(n,(o,c)=>{if(o.substring(0,1)!=="."){const p=Je(c);p.isEmpty()||(i=i||!p.getPriority().isEmpty(),t.push(new oe(o,p)))}}),t.length===0)return ne.EMPTY_NODE;const r=Pr(t,gx,o=>o.name,rc);if(i){const o=Pr(t,Re.getCompare());return new ne(r,Je(e),new an({".priority":o},{".priority":Re}))}else return new ne(r,Je(e),an.Default)}else{let t=ne.EMPTY_NODE;return ct(n,(i,s)=>{if(hn(n,i)&&i.substring(0,1)!=="."){const r=Je(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(Je(e))}}bx(Je);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex extends qr{constructor(e){super(),this.indexPath_=e,$(!le(e)&&re(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?as(e.name,t.name):r}makePost(e,t){const i=Je(e),s=ne.EMPTY_NODE.updateChild(this.indexPath_,i);return new oe(t,s)}maxPost(){const e=ne.EMPTY_NODE.updateChild(this.indexPath_,Ea);return new oe(hi,e)}toString(){return km(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx extends qr{compare(e,t){const i=e.node.compareTo(t.node);return i===0?as(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return oe.MIN}maxPost(){return oe.MAX}makePost(e,t){const i=Je(e);return new oe(t,i)}toString(){return".value"}}const Mx=new Tx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Km(n){return{type:"value",snapshotNode:n}}function es(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ma(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function fa(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Bx(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){$(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=e.getImmediateChild(t);return c.getChild(s).equals(i.getChild(s))&&c.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(ma(t,c)):$(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?o.trackChildChange(es(t,i)):o.trackChildChange(fa(t,i,c))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(Re,(s,r)=>{t.hasChild(s)||i.trackChildChange(ma(s,r))}),t.isLeafNode()||t.forEachChild(Re,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(fa(s,r,o))}else i.trackChildChange(es(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ne.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e){this.indexedFilter_=new oc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=va.getStartPost_(e),this.endPost_=va.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,i,s,r,o){return this.matches(new oe(t,i))||(i=ne.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=ne.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ne.EMPTY_NODE);const r=this;return t.forEachChild(Re,(o,c)=>{r.matches(new oe(o,c))||(s=s.updateImmediateChild(o,ne.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(e){this.rangedFilter_=new va(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new oe(t,i))||(i=ne.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=ne.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ne.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const c=r.getNext();let p;if(this.reverse_?p=this.index_.compare(this.rangedFilter_.getStartPost(),c)<=0:p=this.index_.compare(c,this.rangedFilter_.getEndPost())<=0,p)s=s.updateImmediateChild(c.name,c.node),o++;else break}}else{s=t.withIndex(this.index_),s=s.updatePriority(ne.EMPTY_NODE);let r,o,c,p;if(this.reverse_){p=s.getReverseIterator(this.index_),r=this.rangedFilter_.getEndPost(),o=this.rangedFilter_.getStartPost();const v=this.index_.getCompare();c=(g,C)=>v(C,g)}else p=s.getIterator(this.index_),r=this.rangedFilter_.getStartPost(),o=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();let m=0,_=!1;for(;p.hasNext();){const v=p.getNext();!_&&c(r,v)<=0&&(_=!0),_&&m<this.limit_&&c(v,o)<=0?m++:s=s.updateImmediateChild(v.name,ne.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const v=this.index_.getCompare();o=(g,C)=>v(C,g)}else o=this.index_.getCompare();const c=e;$(c.numChildren()===this.limit_,"");const p=new oe(t,i),m=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),_=this.rangedFilter_.matches(p);if(c.hasChild(t)){const v=c.getImmediateChild(t);let g=s.getChildAfterChild(this.index_,m,this.reverse_);for(;g!=null&&(g.name===t||c.hasChild(g.name));)g=s.getChildAfterChild(this.index_,g,this.reverse_);const C=g==null?1:o(g,p);if(_&&!i.isEmpty()&&C>=0)return r!=null&&r.trackChildChange(fa(t,i,v)),c.updateImmediateChild(t,i);{r!=null&&r.trackChildChange(ma(t,v));const E=c.updateImmediateChild(t,ne.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(r!=null&&r.trackChildChange(es(g.name,g.node)),E.updateImmediateChild(g.name,g.node)):E}}else return i.isEmpty()?e:_&&o(m,p)>=0?(r!=null&&(r.trackChildChange(ma(m.name,m.node)),r.trackChildChange(es(t,i))),c.updateImmediateChild(t,i).updateImmediateChild(m.name,ne.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Re}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return $(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return $(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Zi}hasEnd(){return this.endSet_}getIndexEndValue(){return $(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return $(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:hi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return $(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Re}copy(){const e=new lc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ix(n){return n.loadsAllData()?new oc(n.getIndex()):n.hasLimit()?new Px(n):new va(n)}function hp(n){const e={};if(n.isDefault())return e;let t;return n.index_===Re?t="$priority":n.index_===Mx?t="$value":n.index_===Xi?t="$key":($(n.index_ instanceof Ex,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ve(t),n.startSet_&&(e.startAt=Ve(n.indexStartValue_),n.startNameSet_&&(e.startAt+=","+Ve(n.indexStartName_))),n.endSet_&&(e.endAt=Ve(n.indexEndValue_),n.endNameSet_&&(e.endAt+=","+Ve(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function pp(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_)),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_)),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Re&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir extends Dm{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Aa("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:($(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Ir.getListenId_(e,i),c={};this.listens_[o]=c;const p=hp(e._queryParams);this.restRequest_(r+".json",p,(m,_)=>{let v=_;if(m===404&&(v=null,m=null),m===null&&this.onDataUpdate_(r,v,!1,i),Qi(this.listens_,o)===c){let g;m?m===401?g="permission_denied":g="rest_error:"+m:g="ok",s(g,null)}})}unlisten(e,t){const i=Ir.getListenId_(e,t);delete this.listens_[i]}get(e){const t=hp(e._queryParams),i=e._path.toString(),s=new Jr;return this.restRequest_(i+".json",t,(r,o)=>{let c=o;r===404&&(c=null,r=null),r===null?(this.onDataUpdate_(i,c,!1,null),s.resolve(c)):s.reject(new Error(c))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+tb(t);this.log_("Sending REST request for "+o);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(i&&c.readyState===4){this.log_("REST Response for "+o+" received. status:",c.status,"response:",c.responseText);let p=null;if(c.status>=200&&c.status<300){try{p=ca(c.responseText)}catch{lt("Failed to parse JSON response for "+o+": "+c.responseText)}i(null,p)}else c.status!==401&&c.status!==404&&lt("Got unsuccessful REST response for "+o+" Status: "+c.status),i(c.status);i=null}},c.open("GET",o,!0),c.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rx{constructor(){this.rootNode_=ne.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(){return{value:null,children:new Map}}function Jm(n,e,t){if(le(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=re(e);n.children.has(i)||n.children.set(i,Rr());const s=n.children.get(i);e=we(e),Jm(s,e,t)}}function Iu(n,e,t){n.value!==null?t(e,n.value):Ox(n,(i,s)=>{const r=new Ce(e.toString()+"/"+i);Iu(s,r,t)})}function Ox(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fx{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ct(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dp=10*1e3,Dx=30*1e3,Lx=5*60*1e3;class Nx{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Fx(e);const i=dp+(Dx-dp)*Math.random();ia(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;ct(e,(s,r)=>{r>0&&hn(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),ia(this.reportStats_.bind(this),Math.floor(Math.random()*2*Lx))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Lt||(Lt={}));function $m(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function uc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function cc(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Lt.ACK_USER_WRITE,this.source=$m()}operationForChild(e){if(le(this.path)){if(this.affectedTree.value!=null)return $(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Ce(e));return new Or(de(),t,this.revert)}}else return $(re(this.path)===e,"operationForChild called for unrelated child."),new Or(we(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e,t){this.source=e,this.path=t,this.type=Lt.LISTEN_COMPLETE}operationForChild(e){return le(this.path)?new ga(this.source,de()):new ga(this.source,we(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Lt.OVERWRITE}operationForChild(e){return le(this.path)?new pi(this.source,de(),this.snap.getImmediateChild(e)):new pi(this.source,we(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Lt.MERGE}operationForChild(e){if(le(this.path)){const t=this.children.subtree(new Ce(e));return t.isEmpty()?null:t.value?new pi(this.source,de(),t.value):new _a(this.source,de(),t)}else return $(re(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new _a(this.source,we(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(le(e))return this.isFullyInitialized()&&!this.filtered_;const t=re(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function zx(n,e,t,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Bx(o.childName,o.snapshotNode))}),Ys(n,s,"child_removed",e,i,t),Ys(n,s,"child_added",e,i,t),Ys(n,s,"child_moved",r,i,t),Ys(n,s,"child_changed",e,i,t),Ys(n,s,"value",e,i,t),s}function Ys(n,e,t,i,s,r){const o=i.filter(c=>c.type===t);o.sort((c,p)=>Hx(n,c,p)),o.forEach(c=>{const p=Ux(n,c,r);s.forEach(m=>{m.respondsTo(c.type)&&e.push(m.createEvent(p,n.query_))})})}function Ux(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Hx(n,e,t){if(e.childName==null||t.childName==null)throw ss("Should only compare child_ events.");const i=new oe(e.childName,e.snapshotNode),s=new oe(t.childName,t.snapshotNode);return n.index_.compare(i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xr(n,e){return{eventCache:n,serverCache:e}}function sa(n,e,t,i){return Xr(new di(e,t,i),n.serverCache)}function qm(n,e,t,i){return Xr(n.eventCache,new di(e,t,i))}function Ru(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function mi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zl;const Gx=()=>(zl||(zl=new ot(T1)),zl);class Te{constructor(e,t=Gx()){this.value=e,this.children=t}static fromObject(e){let t=new Te(null);return ct(e,(i,s)=>{t=t.set(new Ce(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:de(),value:this.value};if(le(e))return null;{const i=re(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(we(e),t);return r!=null?{path:Ne(new Ce(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(le(e))return this;{const t=re(e),i=this.children.get(t);return i!==null?i.subtree(we(e)):new Te(null)}}set(e,t){if(le(e))return new Te(t,this.children);{const i=re(e),r=(this.children.get(i)||new Te(null)).set(we(e),t),o=this.children.insert(i,r);return new Te(this.value,o)}}remove(e){if(le(e))return this.children.isEmpty()?new Te(null):new Te(null,this.children);{const t=re(e),i=this.children.get(t);if(i){const s=i.remove(we(e));let r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new Te(null):new Te(this.value,r)}else return this}}get(e){if(le(e))return this.value;{const t=re(e),i=this.children.get(t);return i?i.get(we(e)):null}}setTree(e,t){if(le(e))return t;{const i=re(e),r=(this.children.get(i)||new Te(null)).setTree(we(e),t);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new Te(this.value,o)}}fold(e){return this.fold_(de(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(Ne(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,de(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(le(e))return null;{const r=re(e),o=this.children.get(r);return o?o.findOnPath_(we(e),Ne(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,de(),t)}foreachOnPath_(e,t,i){if(le(e))return this;{this.value&&i(t,this.value);const s=re(e),r=this.children.get(s);return r?r.foreachOnPath_(we(e),Ne(t,s),i):new Te(null)}}foreach(e){this.foreach_(de(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(Ne(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e){this.writeTree_=e}static empty(){return new Nt(new Te(null))}}function aa(n,e,t){if(le(e))return new Nt(new Te(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=rt(s,e);return r=r.updateChild(o,t),new Nt(n.writeTree_.set(s,r))}else{const s=new Te(t),r=n.writeTree_.setTree(e,s);return new Nt(r)}}}function mp(n,e,t){let i=n;return ct(t,(s,r)=>{i=aa(i,Ne(e,s),r)}),i}function fp(n,e){if(le(e))return Nt.empty();{const t=n.writeTree_.setTree(e,new Te(null));return new Nt(t)}}function Ou(n,e){return gi(n,e)!=null}function gi(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(rt(t.path,e)):null}function vp(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Re,(i,s)=>{e.push(new oe(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new oe(i,s.value))}),e}function Fn(n,e){if(le(e))return n;{const t=gi(n,e);return t!=null?new Nt(new Te(t)):new Nt(n.writeTree_.subtree(e))}}function Fu(n){return n.writeTree_.isEmpty()}function ts(n,e){return Xm(de(),n.writeTree_,e)}function Xm(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?($(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=Xm(Ne(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(Ne(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(n,e){return ef(e,n)}function Vx(n,e,t,i,s){$(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=aa(n.visibleWrites,e,t)),n.lastWriteId=i}function Wx(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function jx(n,e){const t=n.allWrites.findIndex(c=>c.writeId===e);$(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const c=n.allWrites[o];c.visible&&(o>=t&&Kx(c,i.path)?s=!1:Dt(i.path,c.path)&&(r=!0)),o--}if(s){if(r)return Jx(n),!0;if(i.snap)n.visibleWrites=fp(n.visibleWrites,i.path);else{const c=i.children;ct(c,p=>{n.visibleWrites=fp(n.visibleWrites,Ne(i.path,p))})}return!0}else return!1}function Kx(n,e){if(n.snap)return Dt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Dt(Ne(n.path,t),e))return!0;return!1}function Jx(n){n.visibleWrites=Ym(n.allWrites,$x,de()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function $x(n){return n.visible}function Ym(n,e,t){let i=Nt.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let c;if(r.snap)Dt(t,o)?(c=rt(t,o),i=aa(i,c,r.snap)):Dt(o,t)&&(c=rt(o,t),i=aa(i,de(),r.snap.getChild(c)));else if(r.children){if(Dt(t,o))c=rt(t,o),i=mp(i,c,r.children);else if(Dt(o,t))if(c=rt(o,t),le(c))i=mp(i,de(),r.children);else{const p=Qi(r.children,re(c));if(p){const m=p.getChild(we(c));i=aa(i,de(),m)}}}else throw ss("WriteRecord should have .snap or .children")}}return i}function Qm(n,e,t,i,s){if(!i&&!s){const r=gi(n.visibleWrites,e);if(r!=null)return r;{const o=Fn(n.visibleWrites,e);if(Fu(o))return t;if(t==null&&!Ou(o,de()))return null;{const c=t||ne.EMPTY_NODE;return ts(o,c)}}}else{const r=Fn(n.visibleWrites,e);if(!s&&Fu(r))return t;if(!s&&t==null&&!Ou(r,de()))return null;{const o=function(m){return(m.visible||s)&&(!i||!~i.indexOf(m.writeId))&&(Dt(m.path,e)||Dt(e,m.path))},c=Ym(n.allWrites,o,e),p=t||ne.EMPTY_NODE;return ts(c,p)}}}function qx(n,e,t){let i=ne.EMPTY_NODE;const s=gi(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Re,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=Fn(n.visibleWrites,e);return t.forEachChild(Re,(o,c)=>{const p=ts(Fn(r,new Ce(o)),c);i=i.updateImmediateChild(o,p)}),vp(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=Fn(n.visibleWrites,e);return vp(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Xx(n,e,t,i,s){$(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=Ne(e,t);if(Ou(n.visibleWrites,r))return null;{const o=Fn(n.visibleWrites,r);return Fu(o)?s.getChild(t):ts(o,s.getChild(t))}}function Yx(n,e,t,i){const s=Ne(e,t),r=gi(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){const o=Fn(n.visibleWrites,s);return ts(o,i.getNode().getImmediateChild(t))}else return null}function Qx(n,e){return gi(n.visibleWrites,e)}function Zx(n,e,t,i,s,r,o){let c;const p=Fn(n.visibleWrites,e),m=gi(p,de());if(m!=null)c=m;else if(t!=null)c=ts(p,t);else return[];if(c=c.withIndex(o),!c.isEmpty()&&!c.isLeafNode()){const _=[],v=o.getCompare(),g=r?c.getReverseIteratorFrom(i,o):c.getIteratorFrom(i,o);let C=g.getNext();for(;C&&_.length<s;)v(C,i)!==0&&_.push(C),C=g.getNext();return _}else return[]}function ey(){return{visibleWrites:Nt.empty(),allWrites:[],lastWriteId:-1}}function Fr(n,e,t,i){return Qm(n.writeTree,n.treePath,e,t,i)}function pc(n,e){return qx(n.writeTree,n.treePath,e)}function gp(n,e,t,i){return Xx(n.writeTree,n.treePath,e,t,i)}function Dr(n,e){return Qx(n.writeTree,Ne(n.treePath,e))}function ty(n,e,t,i,s,r){return Zx(n.writeTree,n.treePath,e,t,i,s,r)}function dc(n,e,t){return Yx(n.writeTree,n.treePath,e,t)}function Zm(n,e){return ef(Ne(n.treePath,e),n.writeTree)}function ef(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;$(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),$(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,fa(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,ma(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,es(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,fa(i,e.snapshotNode,s.oldSnap));else throw ss("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const tf=new iy;class mc{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new di(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return dc(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:mi(this.viewCache_),r=ty(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sy(n){return{filter:n}}function ay(n,e){$(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),$(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ry(n,e,t,i,s){const r=new ny;let o,c;if(t.type===Lt.OVERWRITE){const m=t;m.source.fromUser?o=Du(n,e,m.path,m.snap,i,s,r):($(m.source.fromServer,"Unknown source."),c=m.source.tagged||e.serverCache.isFiltered()&&!le(m.path),o=Lr(n,e,m.path,m.snap,i,s,c,r))}else if(t.type===Lt.MERGE){const m=t;m.source.fromUser?o=ly(n,e,m.path,m.children,i,s,r):($(m.source.fromServer,"Unknown source."),c=m.source.tagged||e.serverCache.isFiltered(),o=Lu(n,e,m.path,m.children,i,s,c,r))}else if(t.type===Lt.ACK_USER_WRITE){const m=t;m.revert?o=hy(n,e,m.path,i,s,r):o=uy(n,e,m.path,m.affectedTree,i,s,r)}else if(t.type===Lt.LISTEN_COMPLETE)o=cy(n,e,t.path,i,r);else throw ss("Unknown operation type: "+t.type);const p=r.getChanges();return oy(e,o,p),{viewCache:o,changes:p}}function oy(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Ru(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(Km(Ru(e)))}}function nf(n,e,t,i,s,r){const o=e.eventCache;if(Dr(i,t)!=null)return e;{let c,p;if(le(t))if($(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const m=mi(e),_=m instanceof ne?m:ne.EMPTY_NODE,v=pc(i,_);c=n.filter.updateFullNode(e.eventCache.getNode(),v,r)}else{const m=Fr(i,mi(e));c=n.filter.updateFullNode(e.eventCache.getNode(),m,r)}else{const m=re(t);if(m===".priority"){$(Dn(t)===1,"Can't have a priority with additional path components");const _=o.getNode();p=e.serverCache.getNode();const v=gp(i,t,_,p);v!=null?c=n.filter.updatePriority(_,v):c=o.getNode()}else{const _=we(t);let v;if(o.isCompleteForChild(m)){p=e.serverCache.getNode();const g=gp(i,t,o.getNode(),p);g!=null?v=o.getNode().getImmediateChild(m).updateChild(_,g):v=o.getNode().getImmediateChild(m)}else v=dc(i,m,e.serverCache);v!=null?c=n.filter.updateChild(o.getNode(),m,v,_,s,r):c=o.getNode()}}return sa(e,c,o.isFullyInitialized()||le(t),n.filter.filtersNodes())}}function Lr(n,e,t,i,s,r,o,c){const p=e.serverCache;let m;const _=o?n.filter:n.filter.getIndexedFilter();if(le(t))m=_.updateFullNode(p.getNode(),i,null);else if(_.filtersNodes()&&!p.isFiltered()){const C=p.getNode().updateChild(t,i);m=_.updateFullNode(p.getNode(),C,null)}else{const C=re(t);if(!p.isCompleteForPath(t)&&Dn(t)>1)return e;const S=we(t),T=p.getNode().getImmediateChild(C).updateChild(S,i);C===".priority"?m=_.updatePriority(p.getNode(),T):m=_.updateChild(p.getNode(),C,T,S,tf,null)}const v=qm(e,m,p.isFullyInitialized()||le(t),_.filtersNodes()),g=new mc(s,v,r);return nf(n,v,t,s,g,c)}function Du(n,e,t,i,s,r,o){const c=e.eventCache;let p,m;const _=new mc(s,e,r);if(le(t))m=n.filter.updateFullNode(e.eventCache.getNode(),i,o),p=sa(e,m,!0,n.filter.filtersNodes());else{const v=re(t);if(v===".priority")m=n.filter.updatePriority(e.eventCache.getNode(),i),p=sa(e,m,c.isFullyInitialized(),c.isFiltered());else{const g=we(t),C=c.getNode().getImmediateChild(v);let S;if(le(g))S=i;else{const E=_.getCompleteChild(v);E!=null?Nm(g)===".priority"&&E.getChild(zm(g)).isEmpty()?S=E:S=E.updateChild(g,i):S=ne.EMPTY_NODE}if(C.equals(S))p=e;else{const E=n.filter.updateChild(c.getNode(),v,S,g,_,o);p=sa(e,E,c.isFullyInitialized(),n.filter.filtersNodes())}}}return p}function _p(n,e){return n.eventCache.isCompleteForChild(e)}function ly(n,e,t,i,s,r,o){let c=e;return i.foreach((p,m)=>{const _=Ne(t,p);_p(e,re(_))&&(c=Du(n,c,_,m,s,r,o))}),i.foreach((p,m)=>{const _=Ne(t,p);_p(e,re(_))||(c=Du(n,c,_,m,s,r,o))}),c}function bp(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function Lu(n,e,t,i,s,r,o,c){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let p=e,m;le(t)?m=i:m=new Te(null).setTree(t,i);const _=e.serverCache.getNode();return m.children.inorderTraversal((v,g)=>{if(_.hasChild(v)){const C=e.serverCache.getNode().getImmediateChild(v),S=bp(n,C,g);p=Lr(n,p,new Ce(v),S,s,r,o,c)}}),m.children.inorderTraversal((v,g)=>{const C=!e.serverCache.isCompleteForChild(v)&&g.value===null;if(!_.hasChild(v)&&!C){const S=e.serverCache.getNode().getImmediateChild(v),E=bp(n,S,g);p=Lr(n,p,new Ce(v),E,s,r,o,c)}}),p}function uy(n,e,t,i,s,r,o){if(Dr(s,t)!=null)return e;const c=e.serverCache.isFiltered(),p=e.serverCache;if(i.value!=null){if(le(t)&&p.isFullyInitialized()||p.isCompleteForPath(t))return Lr(n,e,t,p.getNode().getChild(t),s,r,c,o);if(le(t)){let m=new Te(null);return p.getNode().forEachChild(Xi,(_,v)=>{m=m.set(new Ce(_),v)}),Lu(n,e,t,m,s,r,c,o)}else return e}else{let m=new Te(null);return i.foreach((_,v)=>{const g=Ne(t,_);p.isCompleteForPath(g)&&(m=m.set(_,p.getNode().getChild(g)))}),Lu(n,e,t,m,s,r,c,o)}}function cy(n,e,t,i,s){const r=e.serverCache,o=qm(e,r.getNode(),r.isFullyInitialized()||le(t),r.isFiltered());return nf(n,o,t,i,tf,s)}function hy(n,e,t,i,s,r){let o;if(Dr(i,t)!=null)return e;{const c=new mc(i,e,s),p=e.eventCache.getNode();let m;if(le(t)||re(t)===".priority"){let _;if(e.serverCache.isFullyInitialized())_=Fr(i,mi(e));else{const v=e.serverCache.getNode();$(v instanceof ne,"serverChildren would be complete if leaf node"),_=pc(i,v)}_=_,m=n.filter.updateFullNode(p,_,r)}else{const _=re(t);let v=dc(i,_,e.serverCache);v==null&&e.serverCache.isCompleteForChild(_)&&(v=p.getImmediateChild(_)),v!=null?m=n.filter.updateChild(p,_,v,we(t),c,r):e.eventCache.getNode().hasChild(_)?m=n.filter.updateChild(p,_,ne.EMPTY_NODE,we(t),c,r):m=p,m.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Fr(i,mi(e)),o.isLeafNode()&&(m=n.filter.updateFullNode(m,o,r)))}return o=e.serverCache.isFullyInitialized()||Dr(i,de())!=null,sa(e,m,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new oc(i.getIndex()),r=Ix(i);this.processor_=sy(r);const o=t.serverCache,c=t.eventCache,p=s.updateFullNode(ne.EMPTY_NODE,o.getNode(),null),m=r.updateFullNode(ne.EMPTY_NODE,c.getNode(),null),_=new di(p,o.isFullyInitialized(),s.filtersNodes()),v=new di(m,c.isFullyInitialized(),r.filtersNodes());this.viewCache_=Xr(v,_),this.eventGenerator_=new kx(this.query_)}get query(){return this.query_}}function dy(n){return n.viewCache_.serverCache.getNode()}function my(n,e){const t=mi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!le(e)&&!t.getImmediateChild(re(e)).isEmpty())?t.getChild(e):null}function xp(n){return n.eventRegistrations_.length===0}function fy(n,e){n.eventRegistrations_.push(e)}function yp(n,e,t){const i=[];if(t){$(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Cp(n,e,t,i){e.type===Lt.MERGE&&e.source.queryId!==null&&($(mi(n.viewCache_),"We should always have a full cache before handling merges"),$(Ru(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=ry(n.processor_,s,e,t,i);return ay(n.processor_,r.viewCache),$(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,sf(n,r.changes,r.viewCache.eventCache.getNode(),null)}function vy(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Re,(r,o)=>{i.push(es(r,o))}),t.isFullyInitialized()&&i.push(Km(t.getNode())),sf(n,i,t.getNode(),e)}function sf(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return zx(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nr;class gy{constructor(){this.views=new Map}}function _y(n){$(!Nr,"__referenceConstructor has already been defined"),Nr=n}function by(){return $(Nr,"Reference.ts has not been loaded"),Nr}function xy(n){return n.views.size===0}function fc(n,e,t,i){const s=e.source.queryId;if(s!==null){const r=n.views.get(s);return $(r!=null,"SyncTree gave us an op for an invalid query."),Cp(r,e,t,i)}else{let r=[];for(const o of n.views.values())r=r.concat(Cp(o,e,t,i));return r}}function yy(n,e,t,i,s){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let c=Fr(t,s?i:null),p=!1;c?p=!0:i instanceof ne?(c=pc(t,i),p=!1):(c=ne.EMPTY_NODE,p=!1);const m=Xr(new di(c,p,!1),new di(i,s,!1));return new py(e,m)}return o}function Cy(n,e,t,i,s,r){const o=yy(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),fy(o,t),vy(o,t)}function Sy(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const c=Ln(n);if(s==="default")for(const[p,m]of n.views.entries())o=o.concat(yp(m,t,i)),xp(m)&&(n.views.delete(p),m.query._queryParams.loadsAllData()||r.push(m.query));else{const p=n.views.get(s);p&&(o=o.concat(yp(p,t,i)),xp(p)&&(n.views.delete(s),p.query._queryParams.loadsAllData()||r.push(p.query)))}return c&&!Ln(n)&&r.push(new(by())(e._repo,e._path)),{removed:r,events:o}}function af(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Yi(n,e){let t=null;for(const i of n.views.values())t=t||my(i,e);return t}function rf(n,e){if(e._queryParams.loadsAllData())return Yr(n);{const i=e._queryIdentifier;return n.views.get(i)}}function of(n,e){return rf(n,e)!=null}function Ln(n){return Yr(n)!=null}function Yr(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kr;function wy(n){$(!kr,"__referenceConstructor has already been defined"),kr=n}function Ay(){return $(kr,"Reference.ts has not been loaded"),kr}let Ey=1;class Sp{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Te(null),this.pendingWriteTree_=ey(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function lf(n,e,t,i,s){return Vx(n.pendingWriteTree_,e,t,i,s),s?Ta(n,new pi($m(),e,t)):[]}function ii(n,e,t=!1){const i=Wx(n.pendingWriteTree_,e);if(jx(n.pendingWriteTree_,e)){let r=new Te(null);return i.snap!=null?r=r.set(de(),!0):ct(i.children,o=>{r=r.set(new Ce(o),!0)}),Ta(n,new Or(i.path,r,t))}else return[]}function Qr(n,e,t){return Ta(n,new pi(uc(),e,t))}function Ty(n,e,t){const i=Te.fromObject(t);return Ta(n,new _a(uc(),e,i))}function My(n,e){return Ta(n,new ga(uc(),e))}function By(n,e,t){const i=gc(n,t);if(i){const s=_c(i),r=s.path,o=s.queryId,c=rt(r,e),p=new ga(cc(o),c);return bc(n,r,p)}else return[]}function Nu(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let c=[];if(o&&(e._queryIdentifier==="default"||of(o,e))){const p=Sy(o,e,t,i);xy(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const m=p.removed;if(c=p.events,!s){const _=m.findIndex(g=>g._queryParams.loadsAllData())!==-1,v=n.syncPointTree_.findOnPath(r,(g,C)=>Ln(C));if(_&&!v){const g=n.syncPointTree_.subtree(r);if(!g.isEmpty()){const C=Ry(g);for(let S=0;S<C.length;++S){const E=C[S],T=E.query,M=hf(n,E);n.listenProvider_.startListening(ra(T),zr(n,T),M.hashFn,M.onComplete)}}}!v&&m.length>0&&!i&&(_?n.listenProvider_.stopListening(ra(e),null):m.forEach(g=>{const C=n.queryToTagMap.get(Zr(g));n.listenProvider_.stopListening(ra(g),C)}))}Oy(n,m)}return c}function Py(n,e,t,i){const s=gc(n,i);if(s!=null){const r=_c(s),o=r.path,c=r.queryId,p=rt(o,e),m=new pi(cc(c),p,t);return bc(n,o,m)}else return[]}function Iy(n,e,t,i){const s=gc(n,i);if(s){const r=_c(s),o=r.path,c=r.queryId,p=rt(o,e),m=Te.fromObject(t),_=new _a(cc(c),p,m);return bc(n,o,_)}else return[]}function wp(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(g,C)=>{const S=rt(g,s);r=r||Yi(C,S),o=o||Ln(C)});let c=n.syncPointTree_.get(s);c?(o=o||Ln(c),r=r||Yi(c,de())):(c=new gy,n.syncPointTree_=n.syncPointTree_.set(s,c));let p;r!=null?p=!0:(p=!1,r=ne.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((C,S)=>{const E=Yi(S,de());E&&(r=r.updateImmediateChild(C,E))}));const m=of(c,e);if(!m&&!e._queryParams.loadsAllData()){const g=Zr(e);$(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");const C=Fy();n.queryToTagMap.set(g,C),n.tagToQueryMap.set(C,g)}const _=hc(n.pendingWriteTree_,s);let v=Cy(c,e,t,_,r,p);if(!m&&!o&&!i){const g=rf(c,e);v=v.concat(Dy(n,e,g))}return v}function vc(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,c)=>{const p=rt(o,e),m=Yi(c,p);if(m)return m});return Qm(s,e,r,t,!0)}function Ta(n,e){return uf(e,n.syncPointTree_,null,hc(n.pendingWriteTree_,de()))}function uf(n,e,t,i){if(le(n.path))return cf(n,e,t,i);{const s=e.get(de());t==null&&s!=null&&(t=Yi(s,de()));let r=[];const o=re(n.path),c=n.operationForChild(o),p=e.children.get(o);if(p&&c){const m=t?t.getImmediateChild(o):null,_=Zm(i,o);r=r.concat(uf(c,p,m,_))}return s&&(r=r.concat(fc(s,n,i,t))),r}}function cf(n,e,t,i){const s=e.get(de());t==null&&s!=null&&(t=Yi(s,de()));let r=[];return e.children.inorderTraversal((o,c)=>{const p=t?t.getImmediateChild(o):null,m=Zm(i,o),_=n.operationForChild(o);_&&(r=r.concat(cf(_,c,p,m)))}),s&&(r=r.concat(fc(s,n,i,t))),r}function hf(n,e){const t=e.query,i=zr(n,t);return{hashFn:()=>(dy(e)||ne.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?By(n,t._path,i):My(n,t._path);{const r=P1(s,t);return Nu(n,t,null,r)}}}}function zr(n,e){const t=Zr(e);return n.queryToTagMap.get(t)}function Zr(n){return n._path.toString()+"$"+n._queryIdentifier}function gc(n,e){return n.tagToQueryMap.get(e)}function _c(n){const e=n.indexOf("$");return $(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Ce(n.substr(0,e))}}function bc(n,e,t){const i=n.syncPointTree_.get(e);$(i,"Missing sync point for query tag that we're tracking");const s=hc(n.pendingWriteTree_,e);return fc(i,t,s,null)}function Ry(n){return n.fold((e,t,i)=>{if(t&&Ln(t))return[Yr(t)];{let s=[];return t&&(s=af(t)),ct(i,(r,o)=>{s=s.concat(o)}),s}})}function ra(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ay())(n._repo,n._path):n}function Oy(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=Zr(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function Fy(){return Ey++}function Dy(n,e,t){const i=e._path,s=zr(n,e),r=hf(n,t),o=n.listenProvider_.startListening(ra(e),s,r.hashFn,r.onComplete),c=n.syncPointTree_.subtree(i);if(s)$(!Ln(c.value),"If we're adding a query, it shouldn't be shadowed");else{const p=c.fold((m,_,v)=>{if(!le(m)&&_&&Ln(_))return[Yr(_).query];{let g=[];return _&&(g=g.concat(af(_).map(C=>C.query))),ct(v,(C,S)=>{g=g.concat(S)}),g}});for(let m=0;m<p.length;++m){const _=p[m];n.listenProvider_.stopListening(ra(_),zr(n,_))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new xc(t)}node(){return this.node_}}class yc{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ne(this.path_,e);return new yc(this.syncTree_,t)}node(){return vc(this.syncTree_,this.path_)}}const Ly=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ap=function(n,e,t){if(!n||typeof n!="object")return n;if($(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Ny(n[".sv"],e,t);if(typeof n[".sv"]=="object")return ky(n[".sv"],e);$(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Ny=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:$(!1,"Unexpected server value: "+n)}},ky=function(n,e,t){n.hasOwnProperty("increment")||$(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&$(!1,"Unexpected increment value: "+i);const s=e.node();if($(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},zy=function(n,e,t,i){return Cc(e,new yc(t,n),i)},pf=function(n,e,t){return Cc(n,new xc(e),t)};function Cc(n,e,t){const i=n.getPriority().val(),s=Ap(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,c=Ap(o.getValue(),e,t);return c!==o.getValue()||s!==o.getPriority().val()?new Ue(c,Je(s)):n}else{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Ue(s))),o.forEachChild(Re,(c,p)=>{const m=Cc(p,e.getImmediateChild(c),t);m!==p&&(r=r.updateImmediateChild(c,m))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function wc(n,e){let t=e instanceof Ce?e:new Ce(e),i=n,s=re(t);for(;s!==null;){const r=Qi(i.node.children,s)||{children:{},childCount:0};i=new Sc(s,i,r),t=we(t),s=re(t)}return i}function os(n){return n.node.value}function df(n,e){n.node.value=e,ku(n)}function mf(n){return n.node.childCount>0}function Uy(n){return os(n)===void 0&&!mf(n)}function eo(n,e){ct(n.node.children,(t,i)=>{e(new Sc(t,n,i))})}function ff(n,e,t,i){t&&!i&&e(n),eo(n,s=>{ff(s,e,!0,i)}),t&&i&&e(n)}function Hy(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Ma(n){return new Ce(n.parent===null?n.name:Ma(n.parent)+"/"+n.name)}function ku(n){n.parent!==null&&Gy(n.parent,n.name,n)}function Gy(n,e,t){const i=Uy(t),s=hn(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,ku(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,ku(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy=/[\[\].#$\/\u0000-\u001F\u007F]/,Wy=/[\[\].#$\u0000-\u001F\u007F]/,Ul=10*1024*1024,vf=function(n){return typeof n=="string"&&n.length!==0&&!Vy.test(n)},gf=function(n){return typeof n=="string"&&n.length!==0&&!Wy.test(n)},jy=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),gf(n)},Ky=function(n,e,t,i){i&&e===void 0||Ac(Qu(n,"value"),e,t)},Ac=function(n,e,t){const i=t instanceof Ce?new ux(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ti(i));if(typeof e=="function")throw new Error(n+"contains a function "+ti(i)+" with contents = "+e.toString());if(vm(e))throw new Error(n+"contains "+e.toString()+" "+ti(i));if(typeof e=="string"&&e.length>Ul/3&&$r(e)>Ul)throw new Error(n+"contains a string greater than "+Ul+" utf8 bytes "+ti(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(ct(e,(o,c)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!vf(o)))throw new Error(n+" contains an invalid key ("+o+") "+ti(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);cx(i,o),Ac(n,c,i),hx(i)}),s&&r)throw new Error(n+' contains ".value" child '+ti(i)+" in addition to actual children.")}},_f=function(n,e,t,i){if(!(i&&t===void 0)&&!gf(t))throw new Error(Qu(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Jy=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),_f(n,e,t,i)},$y=function(n,e){if(re(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},qy=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!vf(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!jy(t))throw new Error(Qu(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ec(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();t!==null&&!sc(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function bf(n,e,t){Ec(n,t),xf(n,i=>sc(i,e))}function un(n,e,t){Ec(n,t),xf(n,i=>Dt(i,e)||Dt(e,i))}function xf(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const r=s.path;e(r)?(Yy(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Yy(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();ri&&qe("event: "+t.toString()),rs(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy="repo_interrupt",Zy=25;class eC{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Xy,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Rr(),this.transactionQueueTree_=new Sc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function tC(n,e,t){if(n.stats_=nc(n.repoInfo_),n.forceRestClient_||F1())n.server_=new Ir(n.repoInfo_,(i,s,r,o)=>{Ep(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Tp(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ve(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new rn(n.repoInfo_,e,(i,s,r,o)=>{Ep(n,i,s,r,o)},i=>{Tp(n,i)},i=>{iC(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=z1(n.repoInfo_,()=>new Nx(n.stats_,n.server_)),n.infoData_=new Rx,n.infoSyncTree_=new Sp({startListening:(i,s,r,o)=>{let c=[];const p=n.infoData_.getNode(i._path);return p.isEmpty()||(c=Qr(n.infoSyncTree_,i._path,p),setTimeout(()=>{o("ok")},0)),c},stopListening:()=>{}}),Mc(n,"connected",!1),n.serverSyncTree_=new Sp({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(c,p)=>{const m=o(c,p);un(n.eventQueue_,i._path,m)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function nC(n){const t=n.infoData_.getNode(new Ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Tc(n){return Ly({timestamp:nC(n)})}function Ep(n,e,t,i,s){n.dataUpdateCount++;const r=new Ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const p=Ar(t,m=>Je(m));o=Iy(n.serverSyncTree_,r,p,s)}else{const p=Je(t);o=Py(n.serverSyncTree_,r,p,s)}else if(i){const p=Ar(t,m=>Je(m));o=Ty(n.serverSyncTree_,r,p)}else{const p=Je(t);o=Qr(n.serverSyncTree_,r,p)}let c=r;o.length>0&&(c=to(n,r)),un(n.eventQueue_,c,o)}function Tp(n,e){Mc(n,"connected",e),e===!1&&aC(n)}function iC(n,e){ct(e,(t,i)=>{Mc(n,t,i)})}function Mc(n,e,t){const i=new Ce("/.info/"+e),s=Je(t);n.infoData_.updateSnapshot(i,s);const r=Qr(n.infoSyncTree_,i,s);un(n.eventQueue_,i,r)}function yf(n){return n.nextWriteId_++}function sC(n,e,t,i,s){Bc(n,"set",{path:e.toString(),value:t,priority:i});const r=Tc(n),o=Je(t,i),c=vc(n.serverSyncTree_,e),p=pf(o,c,r),m=yf(n),_=lf(n.serverSyncTree_,e,p,m,!0);Ec(n.eventQueue_,_),n.server_.put(e.toString(),o.val(!0),(g,C)=>{const S=g==="ok";S||lt("set at "+e+" failed: "+g);const E=ii(n.serverSyncTree_,m,!S);un(n.eventQueue_,e,E),lC(n,s,g,C)});const v=Ef(n,e);to(n,v),un(n.eventQueue_,v,[])}function aC(n){Bc(n,"onDisconnectEvents");const e=Tc(n),t=Rr();Iu(n.onDisconnect_,de(),(s,r)=>{const o=zy(s,r,n.serverSyncTree_,e);Jm(t,s,o)});let i=[];Iu(t,de(),(s,r)=>{i=i.concat(Qr(n.serverSyncTree_,s,r));const o=Ef(n,s);to(n,o)}),n.onDisconnect_=Rr(),un(n.eventQueue_,de(),i)}function rC(n,e,t){let i;re(e._path)===".info"?i=wp(n.infoSyncTree_,e,t):i=wp(n.serverSyncTree_,e,t),bf(n.eventQueue_,e._path,i)}function Mp(n,e,t){let i;re(e._path)===".info"?i=Nu(n.infoSyncTree_,e,t):i=Nu(n.serverSyncTree_,e,t),bf(n.eventQueue_,e._path,i)}function oC(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Qy)}function Bc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),qe(t,...e)}function lC(n,e,t,i){e&&rs(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function Cf(n,e,t){return vc(n.serverSyncTree_,e,t)||ne.EMPTY_NODE}function Pc(n,e=n.transactionQueueTree_){if(e||no(n,e),os(e)){const t=wf(n,e);$(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&uC(n,Ma(e),t)}else mf(e)&&eo(e,t=>{Pc(n,t)})}function uC(n,e,t){const i=t.map(m=>m.currentWriteId),s=Cf(n,e,i);let r=s;const o=s.hash();for(let m=0;m<t.length;m++){const _=t[m];$(_.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),_.status=1,_.retryCount++;const v=rt(e,_.path);r=r.updateChild(v,_.currentOutputSnapshotRaw)}const c=r.val(!0),p=e;n.server_.put(p.toString(),c,m=>{Bc(n,"transaction put response",{path:p.toString(),status:m});let _=[];if(m==="ok"){const v=[];for(let g=0;g<t.length;g++)t[g].status=2,_=_.concat(ii(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&v.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();no(n,wc(n.transactionQueueTree_,e)),Pc(n,n.transactionQueueTree_),un(n.eventQueue_,e,_);for(let g=0;g<v.length;g++)rs(v[g])}else{if(m==="datastale")for(let v=0;v<t.length;v++)t[v].status===3?t[v].status=4:t[v].status=0;else{lt("transaction at "+p.toString()+" failed: "+m);for(let v=0;v<t.length;v++)t[v].status=4,t[v].abortReason=m}to(n,e)}},o)}function to(n,e){const t=Sf(n,e),i=Ma(t),s=wf(n,t);return cC(n,s,i),i}function cC(n,e,t){if(e.length===0)return;const i=[];let s=[];const o=e.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<e.length;c++){const p=e[c],m=rt(t,p.path);let _=!1,v;if($(m!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),p.status===4)_=!0,v=p.abortReason,s=s.concat(ii(n.serverSyncTree_,p.currentWriteId,!0));else if(p.status===0)if(p.retryCount>=Zy)_=!0,v="maxretry",s=s.concat(ii(n.serverSyncTree_,p.currentWriteId,!0));else{const g=Cf(n,p.path,o);p.currentInputSnapshot=g;const C=e[c].update(g.val());if(C!==void 0){Ac("transaction failed: Data returned ",C,p.path);let S=Je(C);typeof C=="object"&&C!=null&&hn(C,".priority")||(S=S.updatePriority(g.getPriority()));const T=p.currentWriteId,M=Tc(n),W=pf(S,g,M);p.currentOutputSnapshotRaw=S,p.currentOutputSnapshotResolved=W,p.currentWriteId=yf(n),o.splice(o.indexOf(T),1),s=s.concat(lf(n.serverSyncTree_,p.path,W,p.currentWriteId,p.applyLocally)),s=s.concat(ii(n.serverSyncTree_,T,!0))}else _=!0,v="nodata",s=s.concat(ii(n.serverSyncTree_,p.currentWriteId,!0))}un(n.eventQueue_,t,s),s=[],_&&(e[c].status=2,function(g){setTimeout(g,Math.floor(0))}(e[c].unwatcher),e[c].onComplete&&(v==="nodata"?i.push(()=>e[c].onComplete(null,!1,e[c].currentInputSnapshot)):i.push(()=>e[c].onComplete(new Error(v),!1,null))))}no(n,n.transactionQueueTree_);for(let c=0;c<i.length;c++)rs(i[c]);Pc(n,n.transactionQueueTree_)}function Sf(n,e){let t,i=n.transactionQueueTree_;for(t=re(e);t!==null&&os(i)===void 0;)i=wc(i,t),e=we(e),t=re(e);return i}function wf(n,e){const t=[];return Af(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Af(n,e,t){const i=os(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);eo(e,s=>{Af(n,s,t)})}function no(n,e){const t=os(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,df(e,t.length>0?t:void 0)}eo(e,i=>{no(n,i)})}function Ef(n,e){const t=Ma(Sf(n,e)),i=wc(n.transactionQueueTree_,e);return Hy(i,s=>{Hl(n,s)}),Hl(n,i),ff(i,s=>{Hl(n,s)}),t}function Hl(n,e){const t=os(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?($(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):($(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ii(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?df(e,void 0):t.length=r+1,un(n.eventQueue_,Ma(e),s);for(let o=0;o<i.length;o++)rs(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hC(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function pC(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):lt(`Invalid query segment '${t}' in query '${n}'`)}return e}const Bp=function(n,e){const t=dC(n),i=t.namespace;t.domain==="firebase.com"&&ln(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&ln("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||A1();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Mm(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new Ce(t.pathString)}},dC=function(n){let e="",t="",i="",s="",r="",o=!0,c="https",p=443;if(typeof n=="string"){let m=n.indexOf("//");m>=0&&(c=n.substring(0,m-1),n=n.substring(m+2));let _=n.indexOf("/");_===-1&&(_=n.length);let v=n.indexOf("?");v===-1&&(v=n.length),e=n.substring(0,Math.min(_,v)),_<v&&(s=hC(n.substring(_,v)));const g=pC(n.substring(Math.min(n.length,v)));m=e.indexOf(":"),m>=0?(o=c==="https"||c==="wss",p=parseInt(e.substring(m+1),10)):m=e.length;const C=e.slice(0,m);if(C.toLowerCase()==="localhost")t="localhost";else if(C.split(".").length<=2)t=C;else{const S=e.indexOf(".");i=e.substring(0,S).toLowerCase(),t=e.substring(S+1),r=i}"ns"in g&&(r=g.ns)}return{host:e,port:p,domain:t,subdomain:i,secure:o,scheme:c,pathString:s,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ve(this.snapshot.exportVal())}}class Mf{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return $(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return le(this._path)?null:Nm(this._path)}get ref(){return new pn(this._repo,this._path)}get _queryIdentifier(){const e=pp(this._queryParams),t=ec(e);return t==="{}"?"default":t}get _queryObject(){return pp(this._queryParams)}isEqual(e){if(e=Sa(e),!(e instanceof Ic))return!1;const t=this._repo===e._repo,i=sc(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+lx(this._path)}}class pn extends Ic{constructor(e,t){super(e,t,new lc,!1)}get parent(){const e=zm(this._path);return e===null?null:new pn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ba{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Ce(e),i=Ur(this.ref,e);return new ba(this._node.getChild(t),i,Re)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new ba(s,Ur(this.ref,i),Re)))}hasChild(e){const t=new Ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Gl(n,e){return n=Sa(n),n._checkNotDeleted("ref"),e!==void 0?Ur(n._root,e):n._root}function Ur(n,e){return n=Sa(n),re(n._path)===null?Jy("child","path",e,!1):_f("child","path",e,!1),new pn(n._repo,Ne(n._path,e))}function fC(n,e){n=Sa(n),$y("set",n._path),Ky("set",e,n._path,!1);const t=new Jr;return sC(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class Rc{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new Tf("value",this,new ba(e.snapshotNode,new pn(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Mf(this,e,t):null}matches(e){return e instanceof Rc?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Oc{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Mf(this,e,t):null}createEvent(e,t){$(e.childName!=null,"Child events should have a childName.");const i=Ur(new pn(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Tf(e.type,this,new ba(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Oc?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function vC(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){const p=t,m=(_,v)=>{Mp(n._repo,n,c),p(_,v)};m.userCallback=t.userCallback,m.context=t.context,t=m}const o=new mC(t,r||void 0),c=e==="value"?new Rc(o):new Oc(e,o);return rC(n._repo,n,c),()=>Mp(n._repo,n,c)}function Pp(n,e,t,i){return vC(n,"value",e,t,i)}_y(pn);wy(pn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gC="FIREBASE_DATABASE_EMULATOR_HOST",zu={};let _C=!1;function bC(n,e,t,i){n.repoInfo_=new Mm(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),i&&(n.authTokenProvider_=i)}function xC(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||ln("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),qe("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Bp(r,s),c=o.repoInfo,p,m;typeof process<"u"&&process.env&&(m=process.env[gC]),m?(p=!0,r=`http://${m}?ns=${c.namespace}`,o=Bp(r,s),c=o.repoInfo):p=!o.repoInfo.secure;const _=s&&p?new qi(qi.OWNER):new L1(n.name,n.options,e);qy("Invalid Firebase Database URL",o),le(o.path)||ln("Database URL must point to the root of a Firebase Database (not including a child path).");const v=CC(c,n,_,new D1(n.name,t));return new SC(v,n)}function yC(n,e){const t=zu[e];(!t||t[n.key]!==n)&&ln(`Database ${e}(${n.repoInfo_}) has already been deleted.`),oC(n),delete t[n.key]}function CC(n,e,t,i){let s=zu[e.name];s||(s={},zu[e.name]=s);let r=s[n.toURLString()];return r&&ln("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new eC(n,_C,t,i),s[n.toURLString()]=r,r}class SC{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(tC(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new pn(this._repo,de())),this._rootInternal}_delete(){return this._rootInternal!==null&&(yC(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ln("Cannot call "+e+" on a deleted database.")}}function Vl(n=i1(),e){const t=Zb(n,"database").getImmediate({identifier:e}),i=J_("database");return i&&wC(t,...i),t}function wC(n,e,t,i={}){n=Sa(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&ln("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&ln('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new qi(qi.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:q_(i.mockUserToken,n.app.options.projectId);r=new qi(o)}bC(s,e,t,r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AC(n){x1(n1),Tr(new ha("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return xC(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Ji(qh,Xh,n),Ji(qh,Xh,"esm2017")}rn.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};rn.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};AC();const EC={PBR_CONFIG:{IBLDiffuseFactor:{value:1,params:{min:0,max:2,step:.01,label:"IBLDiffuseFactor"}},IBLSpecularFactor:{value:1,params:{min:0,max:2,step:.01,label:"IBLSpecularFactor"}},Environment:{value:"env_default",params:{options:{default:"env_default",papermill:"env_papermill",night_sky:"env_night_sky",coffe_shop:"env_coffe_shop",studio:"env_studio"},label:"Environment"}},EnvironmentDiffuse:{value:"env_diffuse",params:{options:{default:"env_diffuse"},label:"EnvironmentDiffuse"}},lightColor:{value:"#ffffff",params:{label:"lightColor"}},lightPosition:{value:{x:0,y:40,z:30},params:{x:{step:10},y:{step:10},z:{step:10},label:"lightPosition"}},emissiveColor:{value:"#000000",params:{label:"emissiveColor"}},FogColor:{value:"#1d262f",params:{label:"FogColor"}},FogColorClouds:{value:"#92979f",params:{label:"FogColorClouds"}},FogNear:{value:8.7,params:{min:0,max:50,step:.01,label:"FogNear"}},FogFar:{value:32,params:{min:0,max:50,step:.01,label:"FogFar"}},lightPower:{value:7.39,params:{min:0,max:10,step:.01,label:"lightPower"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Debug:{value:"disabled",params:{options:{disabled:"disabled",baseColor:"baseColor",metallic:"metallic",roughness:"roughness",specRef:"specRef",geomOcc:"geomOcc",mcrfctDist:"mcrfctDist",spec:"spec",mathDiff:"mathDiff"},label:"Debug"}},OverwriteEnvIBL:{value:!1,type:"bool"},EnvIBL:{value:"placeholder",type:"input-image",input:null}},"Camera Manager":{camMouseEase:{value:.018,params:{min:0,max:.1,step:.001,label:"camMouseEase"}},camMouseAmplitude:{value:.4,params:{min:0,max:1,step:.01,label:"camMouseAmplitude"}},fov:{value:40,params:{label:"fov"}}},"Global Settings":{Pause:{value:!1,type:"bool"},time_scale:{value:1.5,params:{min:0,max:3,step:.01,label:"time_scale"}},scroll_damping:{value:.05,params:{min:0,max:1,step:.01,label:"scroll_damping"}},scroll_damping_mobile:{value:.1,params:{min:0,max:1,step:.01,label:"scroll_damping_mobile"}},scroll_speed:{value:5,params:{min:0,max:10,step:.1,label:"scroll_speed"}},progress:{value:0,params:{min:0,max:1,step:.001,label:"progress"}},renderThreshold:{value:-40,params:{min:-100,max:0,step:.1,label:"renderThreshold"}},textRenderThreshold:{value:-17,params:{min:-100,max:0,step:.1,label:"textRenderThreshold"}}},"Post Processing":{BloomOpacity:{value:.49999999999999994,params:{min:0,max:1,step:.01,label:"BloomOpacity"}},NoiseOpacity:{value:0,params:{min:0,max:1,step:.01,label:"NoiseOpacity"}},Gamma:{value:1.1,params:{min:0,max:2,step:.01,label:"Gamma"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},ChromaticAberations:{value:.02,params:{min:0,max:1,step:.01,label:"ChromaticAberations"}},Vignette:{value:.8,params:{min:0,max:1,step:.01,label:"Vignette"}},VignetteStrength:{value:.9999999999999999,params:{min:0,max:1,step:.01,label:"VignetteStrength"}},BlurStrength:{value:.11,params:{min:0,max:1,step:.01,label:"BlurStrength"}},BlurRadius:{value:.65,params:{min:0,max:1,step:.01,label:"BlurRadius"}},BlurMultiplier:{value:235,params:{min:0,max:2e3,label:"BlurMultiplier"}},MoodVignetteRadialStrength:{value:10,params:{min:0,max:10,step:.01,label:"MoodVignetteRadialStrength"}},MoodVignetteMiddleStrength:{value:.15,params:{min:0,max:2,step:.01,label:"MoodVignetteMiddleStrength"}},ActiveSpritesheetOffset:{value:0,params:{min:0,max:30,step:1,label:"ActiveSpritesheetOffset"}}},Moods:{layer4Top1:{value:"#000000",params:{label:"layer4Top1"}},layer4Bottom1:{value:"#000000",params:{label:"layer4Bottom1"}},layer4Opacity1:{value:0,params:{min:0,max:1,step:.01,label:"layer4Opacity1"}},layer4Top2:{value:"#6f2201",params:{label:"layer4Top2"}},layer4Bottom2:{value:"#4c2740",params:{label:"layer4Bottom2"}},layer4Opacity2:{value:.45999999999999996,params:{min:0,max:1,step:.01,label:"layer4Opacity2"}},layer4Top3:{value:"#cca89c",params:{label:"layer4Top3"}},layer4Bottom3:{value:"#000e16",params:{label:"layer4Bottom3"}},layer4Opacity3:{value:0,params:{min:0,max:1,step:.01,label:"layer4Opacity3"}},layer4Top4:{value:"#e8e8d2",params:{label:"layer4Top4"}},layer4Bottom4:{value:"#423a34",params:{label:"layer4Bottom4"}},layer4Opacity4:{value:0,params:{min:0,max:1,step:.01,label:"layer4Opacity4"}},layer4Top5:{value:"#c1d5df",params:{label:"layer4Top5"}},layer4Bottom5:{value:"#263a62",params:{label:"layer4Bottom5"}},layer4Opacity5:{value:.24,params:{min:0,max:1,step:.01,label:"layer4Opacity5"}},layer3Top1:{value:"#080c13",params:{label:"layer3Top1"}},layer3Bottom1:{value:"#191d1f",params:{label:"layer3Bottom1"}},layer3Opacity1:{value:1,params:{min:0,max:1,step:.01,label:"layer3Opacity1"}},layer3Top2:{value:"#3f291c",params:{label:"layer3Top2"}},layer3Bottom2:{value:"#95698a",params:{label:"layer3Bottom2"}},layer3Opacity2:{value:.09,params:{min:0,max:1,step:.01,label:"layer3Opacity2"}},layer3Top3:{value:"#362016",params:{label:"layer3Top3"}},layer3Bottom3:{value:"#162536",params:{label:"layer3Bottom3"}},layer3Opacity3:{value:.6,params:{min:0,max:1,step:.01,label:"layer3Opacity3"}},layer3Top4:{value:"#313930",params:{label:"layer3Top4"}},layer3Bottom4:{value:"#4c463e",params:{label:"layer3Bottom4"}},layer3Opacity4:{value:.6,params:{min:0,max:1,step:.01,label:"layer3Opacity4"}},layer3Top5:{value:"#444c66",params:{label:"layer3Top5"}},layer3Bottom5:{value:"#454b7c",params:{label:"layer3Bottom5"}},layer3Opacity5:{value:.6,params:{min:0,max:1,step:.01,label:"layer3Opacity5"}},layer2Top1:{value:"#354852",params:{label:"layer2Top1"}},layer2Bottom1:{value:"#d2e0eb",params:{label:"layer2Bottom1"}},layer2Opacity1:{value:1,params:{min:0,max:1,step:.01,label:"layer2Opacity1"}},layer2Top2:{value:"#f8e9de",params:{label:"layer2Top2"}},layer2Bottom2:{value:"#dba7a4",params:{label:"layer2Bottom2"}},layer2Opacity2:{value:.26,params:{min:0,max:1,step:.01,label:"layer2Opacity2"}},layer2Top3:{value:"#315557",params:{label:"layer2Top3"}},layer2Bottom3:{value:"#daeef1",params:{label:"layer2Bottom3"}},layer2Opacity3:{value:.9999999999999999,params:{min:0,max:1,step:.01,label:"layer2Opacity3"}},layer2Top4:{value:"#a6af9c",params:{label:"layer2Top4"}},layer2Bottom4:{value:"#827873",params:{label:"layer2Bottom4"}},layer2Opacity4:{value:1,params:{min:0,max:1,step:.01,label:"layer2Opacity4"}},layer2Top5:{value:"#bad0db",params:{label:"layer2Top5"}},layer2Bottom5:{value:"#b9dbf1",params:{label:"layer2Bottom5"}},layer2Opacity5:{value:.8,params:{min:0,max:1,step:.01,label:"layer2Opacity5"}},layer1Color1:{value:"#000000",params:{label:"layer1Color1"}},layer1Opacity1:{value:0,params:{min:0,max:1,step:.01,label:"layer1Opacity1"}},layer1Color2:{value:"#000000",params:{label:"layer1Color2"}},layer1Opacity2:{value:6938893903907228e-33,params:{min:0,max:1,step:.01,label:"layer1Opacity2"}},layer1Color3:{value:"#000709",params:{label:"layer1Color3"}},layer1Opacity3:{value:.55,params:{min:0,max:1,step:.01,label:"layer1Opacity3"}},layer1Color4:{value:"#000000",params:{label:"layer1Color4"}},layer1Opacity4:{value:0,params:{min:0,max:1,step:.01,label:"layer1Opacity4"}},layer1Color5:{value:"#000000",params:{label:"layer1Color5"}},layer1Opacity5:{value:0,params:{min:0,max:1,step:.01,label:"layer1Opacity5"}}},Bloom:{BloomTint:{value:"#ffd77f",params:{label:"BloomTint"}},Threshold:{value:0,params:{min:0,max:1.25,step:.01,label:"Threshold"}},Blur:{value:1,params:{min:0,max:1,step:.01,label:"Blur"}},Overdrive:{value:.6,params:{min:0,max:1,step:.01,label:"Overdrive"}},Similarity:{value:0,params:{min:0,max:.2,step:.001,label:"Similarity"}}},lore_particles:{count:{value:400,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:250,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:2120,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ff9371",params:{label:"color1"}},timeScale:{value:.5019609696819467,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.75,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:299.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.2,params:{min:.001,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.39999999999999997,params:{min:.001,max:1,step:.001,label:"BorderSize1"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},lore_title_plane:{startPosition:{value:{x:0,y:-.7000000000000001,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"startPosition"}},endPosition:{value:{x:0,y:-.05000000000000001,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"endPosition"}},positionDamping:{value:.1,params:{min:0,max:1,step:.001,label:"positionDamping"}},scale:{value:.245,params:{min:0,max:1,step:.01,label:"scale"}},deformFactor:{value:.8,params:{min:0,max:20,step:.01,label:"deformFactor"}},opacity:{value:1,params:{min:0,max:1,step:.01,label:"opacity"}},rotationAngleStart:{value:.35000000000000003,params:{min:0,max:1,step:.01,label:"rotationAngleStart"}},rotationAngleEnd:{value:.11,params:{min:0,max:1,step:.01,label:"rotationAngleEnd"}},rotationRadius:{value:1,params:{label:"rotationRadius"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.19,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:1,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.7000000000000001,params:{min:0,max:2,step:.01,label:"Saturation"}}},creatures_particles:{count:{value:50,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:1140,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ff9371",params:{label:"color1"}},timeScale:{value:.5037248094505982,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.75,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:299.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.2,params:{min:.001,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.39999999999999997,params:{min:.001,max:1,step:.001,label:"BorderSize1"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},creatures_title_plane:{startPosition:{value:{x:0,y:-.67,z:.1},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"startPosition"}},endPosition:{value:{x:0,y:.38,z:.1},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"endPosition"}},positionDamping:{value:.1,params:{min:0,max:1,step:.001,label:"positionDamping"}},scale:{value:.225,params:{min:0,max:1,step:.01,label:"scale"}},deformFactor:{value:.8,params:{min:0,max:20,step:.01,label:"deformFactor"}},opacity:{value:1,params:{min:0,max:1,step:.01,label:"opacity"}},rotationAngleStart:{value:.11,params:{min:0,max:1,step:.01,label:"rotationAngleStart"}},rotationAngleEnd:{value:.42000000000000004,params:{min:0,max:1,step:.01,label:"rotationAngleEnd"}},rotationRadius:{value:1,params:{label:"rotationRadius"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.15,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:1,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.6,params:{min:0,max:2,step:.01,label:"Saturation"}}},battlearena_particles:{count:{value:65,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:820,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ff9371",params:{label:"color1"}},timeScale:{value:.49657949745719,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.75,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:299.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.2,params:{min:.001,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.39999999999999997,params:{min:.001,max:1,step:.001,label:"BorderSize1"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},battlearena_title_plane:{startPosition:{value:{x:0,y:-.5,z:.1},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"startPosition"}},endPosition:{value:{x:0,y:.35000000000000003,z:.1},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"endPosition"}},positionDamping:{value:.1,params:{min:0,max:1,step:.001,label:"positionDamping"}},scale:{value:.17500000000000002,params:{min:0,max:1,step:.01,label:"scale"}},deformFactor:{value:.75,params:{min:0,max:20,step:.01,label:"deformFactor"}},opacity:{value:1,params:{min:0,max:1,step:.01,label:"opacity"}},rotationAngleStart:{value:.32,params:{min:0,max:1,step:.01,label:"rotationAngleStart"}},rotationAngleEnd:{value:.14,params:{min:0,max:1,step:.01,label:"rotationAngleEnd"}},rotationRadius:{value:1,params:{label:"rotationRadius"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.17,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:1,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.6,params:{min:0,max:2,step:.01,label:"Saturation"}}},gameplay_particles:{count:{value:100,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:2710,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ff9371",params:{label:"color1"}},timeScale:{value:.5022444567216432,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.75,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:299.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.2,params:{min:.001,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.39999999999999997,params:{min:.001,max:1,step:.001,label:"BorderSize1"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},gameplay_title_plane:{startPosition:{value:{x:0,y:-.58,z:.13},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"startPosition"}},endPosition:{value:{x:0,y:.35000000000000003,z:.13},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"endPosition"}},positionDamping:{value:.1,params:{min:0,max:1,step:.001,label:"positionDamping"}},scale:{value:.225,params:{min:0,max:1,step:.01,label:"scale"}},deformFactor:{value:.59,params:{min:0,max:20,step:.01,label:"deformFactor"}},opacity:{value:1,params:{min:0,max:1,step:.01,label:"opacity"}},rotationAngleStart:{value:.13,params:{min:0,max:1,step:.01,label:"rotationAngleStart"}},rotationAngleEnd:{value:.39,params:{min:0,max:1,step:.01,label:"rotationAngleEnd"}},rotationRadius:{value:1,params:{label:"rotationRadius"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.2,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:1,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.6,params:{min:0,max:2,step:.01,label:"Saturation"}}},team_particles:{count:{value:100,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:2700,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ff9371",params:{label:"color1"}},timeScale:{value:.5005701802212797,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.75,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:299.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.2,params:{min:.001,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.39999999999999997,params:{min:.001,max:1,step:.001,label:"BorderSize1"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},team_title_plane:{startPosition:{value:{x:0,y:-.75,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"startPosition"}},endPosition:{value:{x:0,y:.22,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"endPosition"}},positionDamping:{value:.1,params:{min:0,max:1,step:.001,label:"positionDamping"}},scale:{value:.225,params:{min:0,max:1,step:.01,label:"scale"}},deformFactor:{value:.61,params:{min:0,max:20,step:.01,label:"deformFactor"}},opacity:{value:1,params:{min:0,max:1,step:.01,label:"opacity"}},rotationAngleStart:{value:.34,params:{min:0,max:1,step:.01,label:"rotationAngleStart"}},rotationAngleEnd:{value:.15000000000000002,params:{min:0,max:1,step:.01,label:"rotationAngleEnd"}},rotationRadius:{value:1,params:{label:"rotationRadius"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.22,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:1,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.61,params:{min:0,max:2,step:.01,label:"Saturation"}}},lore_cloud_1:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.380570906036559,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.7165617385960978,y:-1.0971859429189124},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},lore_cloud_2:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.17227797039570875,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.7205602052601041,y:-.9963240839122403},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},lore_cloud_3:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.317816911311565,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.364359962208891,y:-1.2719459208625221},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},lore_cloud_4:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.31643607882002756,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.708996047315841,y:-1.101177098560419},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},"asteroid PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"lore_floating_island PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ff6d34",params:{label:"EmissiveColor"}},EmissivePower:{value:2e-323,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"lore_Island_01 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"lore_flag1 PBR":{albedoColor:{value:"#dbd8d5",params:{label:"albedoColor"}},IBL:{value:1.35,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:.24999999999999997,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:.29999999999999993,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.78,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.5700000000000001,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:.39,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1.17,params:{min:0,max:2,step:.01,label:"Saturation"}}},lore_Flag1_cloth_flag:{meshScale:{value:.12611231355366648,params:{min:0,max:20,step:.01,label:"meshScale"}},clothWaveAmplitude:{value:.3,params:{min:0,max:4,step:.1,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:4.023359934030981,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.0335000943416355,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"lore_flag2 PBR":{albedoColor:{value:"#dbd8d5",params:{label:"albedoColor"}},IBL:{value:1.35,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:.24999999999999997,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:.29999999999999993,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.9500000000000001,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.5700000000000001,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:.39,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1.17,params:{min:0,max:2,step:.01,label:"Saturation"}}},lore_Flag2_cloth_flag:{meshScale:{value:.1325341413931375,params:{min:0,max:20,step:.01,label:"meshScale"}},clothWaveAmplitude:{value:.8539251138172622,params:{min:0,max:4,step:.1,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:3.82232729295815,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:2.4515977821815667,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"creatures_floating_island PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#e54d40",params:{label:"EmissiveColor"}},EmissivePower:{value:.7000655423501585,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},creatures_cloud_1:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.34437263498764714,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.5453756958462896,y:-1.086813433822281},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},creatures_cloud_2:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.41209506108286637,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.7900797362261194,y:-.893149188394897},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},creatures_cloud_3:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.14433273218030898,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.5292790826291225,y:-1.109845018997621},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},creatures_cloud_4:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.33825220275995,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.6129082655105966,y:-1.4874220234934825},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},creatures_cloud_5:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.3272945107576707,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.621226652294339,y:-1.2445686140430365},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},creatures_cloud_6:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.21472090906906566,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.4240189091778959,y:-1.4856622307548082},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},"creatures_dragon PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"cave_and_ground1 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:3.4,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:.29999999999999993,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1.25,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"creatures_decorative_elements PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:5.72,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.06,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"creatures_decorative_elements_tapestry_center PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},creatures_Flag_Low1_tapestry_center:{meshScale:{value:10.117700599881603,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.035026659216556545,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:3.574161115316856,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"creatures_decorative_elements_tapestry_right PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},creatures_Flag_Low3_tapestry_right:{meshScale:{value:12.200540882651245,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.005508454737291803,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:3.541914200383985,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"creatures_decorative_elements_tapestry_left PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},creatures_Flag_Low15_tapestry_left:{meshScale:{value:15.907944503692438,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.04167527500455513,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:1.8008240137805522,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"battlearena_floating_island PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#b5e1ff",params:{label:"EmissiveColor"}},EmissivePower:{value:.9999999999999996,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},battlearena_cloud_1:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.20656869463014893,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.809516154651093,y:-1.4403966939169577},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},battlearena_cloud_2:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.334441907141547,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.4191979823988836,y:-1.0016244847375129},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},"battlearena_creature_01 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:1.59,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:0,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"battlearena_stadium PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"battlearena_tapestry_right PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.51,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},battlearena_tapestry_right_mesh:{meshScale:{value:12.345718798128143,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.04265454153708682,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:4.529801081065391,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"battlearena_tapestry_left PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},battlearena_tapestry_left_mesh:{meshScale:{value:11.74646242089883,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.0008229718533119303,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:3.9706065448188133,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"battlearena_tapestry_center PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},battlearena_tapestry_center_mesh:{meshScale:{value:11.39523812447565,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.008938755619587244,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:3.300083932717893,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},battlearena_Flag_01_cloth_flag:{meshScale:{value:7.332504914588969,params:{min:0,max:20,step:.01,label:"meshScale"}},clothWaveAmplitude:{value:.4337347600451207,params:{min:0,max:4,step:.1,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:2.0726329991671513,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:.8995069405228555,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},battlearena_Flag_02_cloth_flag:{meshScale:{value:7.769652582562472,params:{min:0,max:20,step:.01,label:"meshScale"}},clothWaveAmplitude:{value:.5012514316668325,params:{min:0,max:4,step:.1,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:2.200735562258354,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:.7979427628871721,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},battlearena_Flag_03_cloth_flag:{meshScale:{value:6.880527231082768,params:{min:0,max:20,step:.01,label:"meshScale"}},clothWaveAmplitude:{value:.2616173529834589,params:{min:0,max:4,step:.1,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:3.342799175093314,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:.8369012291865267,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"gameplay_floating_island PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ebff7f",params:{label:"EmissiveColor"}},EmissivePower:{value:0,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},gameplay_cloud_1:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.3242986588889897,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.644613479031535,y:-1.2899194041332587},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},gameplay_cloud_2:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.14706286206539254,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.4522668413508955,y:-.9675010796662972},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},gameplay_cloud_3:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.3743389269534206,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.5005509806511703,y:-.8890152670603857},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},gameplay_cloud_4:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.38206508285925744,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.756141439712926,y:-1.0886660684950749},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},gameplay_cloud_5:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.4558216834094483,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.6964972795952926,y:-1.6135632893568035},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},gameplay_cloud_6:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.2782816206654516,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.6573966222152152,y:-1.154259718057482},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},"gameplay_torch PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:3.44,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ff8400",params:{label:"EmissiveColor"}},EmissivePower:{value:1.5,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.23,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},gameplay_Torch_Low_brazier:{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:3.44,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ff8400",params:{label:"EmissiveColor"}},EmissivePower:{value:1.5,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.23,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},glowingFrequency:{value:1.48003662502688,params:{min:0,max:10,step:.1,label:"glowingFrequency"}},glowingAmplitude:{value:4.885168018580624,params:{min:0,max:10,step:.1,label:"glowingAmplitude"}}},"Brazier Particles gameplay_Torch_Low_brazier":{Count:{value:150,params:{min:0,max:6e3,step:1,label:"Count"}},OutsideColor:{value:"#edb46a",params:{label:"OutsideColor"}},CenterColor:{value:"#ff6e1b",params:{label:"CenterColor"}},Opacity:{value:.52,params:{min:0,max:1,step:.01,label:"Opacity"}},Scale:{value:33,params:{min:0,max:500,step:1,label:"Scale"}},Acceleration:{value:{x:0,y:.3,z:0},params:{label:"Acceleration"}},MaxSpeed:{value:.020000000000000004,params:{min:0,max:1,step:.01,label:"MaxSpeed"}},Height:{value:1.8,params:{min:0,max:10,step:.01,label:"Height"}},ConeShapeFactor:{value:10408340855860843e-33,params:{min:0,max:3,step:.01,label:"ConeShapeFactor"}},NoiseFrequency:{value:.48,params:{min:0,max:3,step:.01,label:"NoiseFrequency"}},NoiseAmplitude:{value:.55,params:{min:0,max:3,step:.01,label:"NoiseAmplitude"}},SparkSpawnChance:{value:.15999999999999998,params:{min:0,max:1,step:.01,label:"SparkSpawnChance"}},SparkColor:{value:"#ffaf00",params:{label:"SparkColor"}},SparkSize:{value:.4,params:{min:0,max:5,step:.01,label:"SparkSize"}},SparkOpacity:{value:3.37,params:{min:0,max:10,step:.01,label:"SparkOpacity"}},TimeScale:{value:1.6300000000000001,params:{min:0,max:2,step:.01,label:"TimeScale"}},wind_X:{value:.33,params:{min:-3,max:3,step:.01,label:"wind_X"}},wind_Y:{value:.13,params:{min:-3,max:3,step:.01,label:"wind_Y"}},wind_Z:{value:.26,params:{min:-3,max:3,step:.01,label:"wind_Z"}},Gravity:{value:0,params:{min:-10,max:10,step:.01,label:"Gravity"}}},gameplay_Torch_Low1_brazier:{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:3.44,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ff8400",params:{label:"EmissiveColor"}},EmissivePower:{value:1.5,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.23,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},glowingFrequency:{value:1.1983843273288055,params:{min:0,max:10,step:.1,label:"glowingFrequency"}},glowingAmplitude:{value:5.314542944824101,params:{min:0,max:10,step:.1,label:"glowingAmplitude"}}},"Brazier Particles gameplay_Torch_Low1_brazier":{Count:{value:150,params:{min:0,max:6e3,step:1,label:"Count"}},OutsideColor:{value:"#edb46a",params:{label:"OutsideColor"}},CenterColor:{value:"#ff6e1b",params:{label:"CenterColor"}},Opacity:{value:.52,params:{min:0,max:1,step:.01,label:"Opacity"}},Scale:{value:33,params:{min:0,max:500,step:1,label:"Scale"}},Acceleration:{value:{x:0,y:.3,z:0},params:{label:"Acceleration"}},MaxSpeed:{value:.020000000000000004,params:{min:0,max:1,step:.01,label:"MaxSpeed"}},Height:{value:1.8,params:{min:0,max:10,step:.01,label:"Height"}},ConeShapeFactor:{value:10408340855860843e-33,params:{min:0,max:3,step:.01,label:"ConeShapeFactor"}},NoiseFrequency:{value:.48,params:{min:0,max:3,step:.01,label:"NoiseFrequency"}},NoiseAmplitude:{value:.55,params:{min:0,max:3,step:.01,label:"NoiseAmplitude"}},SparkSpawnChance:{value:.15999999999999998,params:{min:0,max:1,step:.01,label:"SparkSpawnChance"}},SparkColor:{value:"#ffaf00",params:{label:"SparkColor"}},SparkSize:{value:.4,params:{min:0,max:5,step:.01,label:"SparkSize"}},SparkOpacity:{value:3.37,params:{min:0,max:10,step:.01,label:"SparkOpacity"}},TimeScale:{value:1.6300000000000001,params:{min:0,max:2,step:.01,label:"TimeScale"}},wind_X:{value:.33,params:{min:-3,max:3,step:.01,label:"wind_X"}},wind_Y:{value:.13,params:{min:-3,max:3,step:.01,label:"wind_Y"}},wind_Z:{value:.26,params:{min:-3,max:3,step:.01,label:"wind_Z"}},Gravity:{value:0,params:{min:-10,max:10,step:.01,label:"Gravity"}}},"gameplay_table_pieces PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2.05,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.6,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.9,params:{min:0,max:2,step:.01,label:"Saturation"}}},"gameplay_dragon PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:1.1600000000000001,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},gameplay_Table_tapestry:{meshScale:{value:11.099218554071747,params:{min:0,max:20,step:.1,label:"meshScale"}},clothWaveAmplitude:{value:.01890179504964342,params:{min:0,max:.5,step:.01,label:"clothWaveAmplitude"}},clothWaveFrequency:{value:4.12606690990513,params:{min:0,max:10,step:.1,label:"clothWaveFrequency"}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1,label:"clothWaveLighting"}}},"gameplay_wizard PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:0,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.61,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.14,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"team_floating_island PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#e8b361",params:{label:"EmissiveColor"}},EmissivePower:{value:0,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},team_cloud_1:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.261530576494246,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.4358931991340635,y:-.951263147518683},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},team_cloud_2:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.2584269698838138,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.37084506044112,y:-1.60327413909468},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},team_cloud_3:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.3469730508698419,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.5586022873656873,y:-1.1987314971497882},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},team_cloud_4:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.2438906255811864,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.6288176372232968,y:-.9607706520833414},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},team_cloud_5:{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}},speed:{value:.3112674953480125,params:{min:0,max:4,step:.01,label:"speed"}},direction:{value:{x:-1.6920178695899664,y:-1.3180024671997161},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1},label:"direction"}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01,label:"fbmAddFactor"}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01,label:"fbmMixFactor"}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01,label:"fbmScale"}}},"team_Island_02 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:1.05,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:.8400000000000001,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.62,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.1,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"team_Island_01 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:3.01,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1.1300000000000001,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"battlearena_creature_02 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:.5,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:0,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"battlearena_decorative_elements PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:5.72,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:1,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:-.06,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"gameplay_creature_01 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:2.25,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},"gameplay_creature_02 PBR":{albedoColor:{value:"#ffffff",params:{label:"albedoColor"}},IBL:{value:1.81,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}}},islands:{zDistance:{value:-12e4,params:{min:-1e6,max:1,step:10,label:"zDistance"}},staticTimeBetweenIsland:{value:.05,params:{min:0,max:4,step:.01,label:"staticTimeBetweenIsland"}},tweenDuration:{value:4,params:{min:0,max:10,step:.01,label:"tweenDuration"}},tweenEase:{value:"power4.inOut",params:{label:"tweenEase"}},tweenEaseFirst:{value:"power4.out",params:{label:"tweenEaseFirst"}},lookAtIslandOffset:{value:{x:0,y:-.2,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lookAtIslandOffset"}},startCameraPosition:{value:{x:0,y:0},params:{x:{step:.01},y:{step:.01},label:"startCameraPosition"}}},lore:{originalPosition:{value:{x:-70,y:300,z:8800},params:{x:{step:10},y:{step:10},z:{step:10},label:"originalPosition"}},cameraPosition:{value:{x:0,y:.1},params:{x:{step:.01},y:{step:.01},label:"cameraPosition"}},fadeColor:{value:"#000000",params:{label:"fadeColor"}},lookatThreshold:{value:.3804347826086957,params:{min:0,max:1,label:"lookatThreshold"}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lookAtOffset"}},lore_asteroid_medium_02_position:{value:{x:6100,y:0,z:-3300},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_medium_02_position"}},lore_asteroid_medium_02_rotation:{value:{x:.2,y:.86,z:.5899999999999999},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_medium_02_rotation"}},lore_asteroid_medium_02_scale:{value:2,params:{label:"lore_asteroid_medium_02_scale"}},lore_asteroid_medium_03_position:{value:{x:-1500,y:-1600,z:6800},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_medium_03_position"}},lore_asteroid_medium_03_rotation:{value:{x:-.07,y:-.89,z:-.38},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_medium_03_rotation"}},lore_asteroid_medium_03_scale:{value:1,params:{label:"lore_asteroid_medium_03_scale"}},lore_asteroid_small_016_position:{value:{x:13800,y:600,z:16e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_small_016_position"}},lore_asteroid_small_016_rotation:{value:{x:-.2,y:-2.27,z:4.2},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_small_016_rotation"}},lore_asteroid_small_016_scale:{value:2.8,params:{label:"lore_asteroid_small_016_scale"}},lore_asteroid_small_02_position:{value:{x:-11400,y:-5300,z:-1100},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_small_02_position"}},lore_asteroid_small_02_rotation:{value:{x:0,y:.57,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_small_02_rotation"}},lore_asteroid_small_02_scale:{value:10.6,params:{label:"lore_asteroid_small_02_scale"}},lore_asteroid_small_01_position:{value:{x:4800,y:3800,z:-3200},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_small_01_position"}},lore_asteroid_small_01_rotation:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_small_01_rotation"}},lore_asteroid_small_01_scale:{value:2.1,params:{label:"lore_asteroid_small_01_scale"}},lore_cloud_1_position:{value:{x:-16900,y:-4400,z:900},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_1_position"}},lore_cloud_1_scale:{value:23.8,params:{label:"lore_cloud_1_scale"}},lore_cloud_2_position:{value:{x:2500,y:3100,z:-8e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_2_position"}},lore_cloud_2_scale:{value:11,params:{label:"lore_cloud_2_scale"}},lore_cloud_3_position:{value:{x:2400,y:-6100,z:4100},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_3_position"}},lore_cloud_3_scale:{value:15.3,params:{label:"lore_cloud_3_scale"}},lore_cloud_4_position:{value:{x:11200,y:-600,z:-5e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_4_position"}},lore_cloud_4_scale:{value:33.3,params:{label:"lore_cloud_4_scale"}}},creatures:{originalPosition:{value:{x:-7100,y:4100,z:12e3},params:{x:{step:10},y:{step:10},z:{step:10},label:"originalPosition"}},cameraPosition:{value:{x:-4.3,y:3.46},params:{x:{step:.01},y:{step:.01},label:"cameraPosition"}},fadeColor:{value:"#000000",params:{label:"fadeColor"}},lookatThreshold:{value:.3804347826086957,params:{min:0,max:1,label:"lookatThreshold"}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lookAtOffset"}},creatures_asteroid_medium_01_position:{value:{x:17400,y:3e3,z:8400},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_medium_01_position"}},creatures_asteroid_medium_01_rotation:{value:{x:-1.06,y:-.19,z:.84},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_medium_01_rotation"}},creatures_asteroid_medium_01_scale:{value:1.75,params:{label:"creatures_asteroid_medium_01_scale"}},creatures_asteroid_medium_02_position:{value:{x:8700,y:4900,z:-9900},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_medium_02_position"}},creatures_asteroid_medium_02_rotation:{value:{x:.67,y:-1.24,z:.31},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_medium_02_rotation"}},creatures_asteroid_medium_02_scale:{value:4.4,params:{label:"creatures_asteroid_medium_02_scale"}},creatures_asteroid_small_013_position:{value:{x:-4600,y:0,z:-10200},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_small_013_position"}},creatures_asteroid_small_013_rotation:{value:{x:.72,y:-2.75,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_small_013_rotation"}},creatures_asteroid_small_013_scale:{value:2.8,params:{label:"creatures_asteroid_small_013_scale"}},creatures_asteroid_small_08_position:{value:{x:-3900,y:-1500,z:2e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_small_08_position"}},creatures_asteroid_small_08_rotation:{value:{x:0,y:.3,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_small_08_rotation"}},creatures_asteroid_small_08_scale:{value:1.9000000000000001,params:{label:"creatures_asteroid_small_08_scale"}},creatures_asteroid_small_07_position:{value:{x:12600,y:-2400,z:5200},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_small_07_position"}},creatures_asteroid_small_07_rotation:{value:{x:.24,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_small_07_rotation"}},creatures_asteroid_small_07_scale:{value:1,params:{label:"creatures_asteroid_small_07_scale"}},creatures_asteroid_medium_03_position:{value:{x:2200,y:4900,z:-12e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_medium_03_position"}},creatures_asteroid_medium_03_rotation:{value:{x:0,y:.19,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_medium_03_rotation"}},creatures_asteroid_medium_03_scale:{value:1,params:{label:"creatures_asteroid_medium_03_scale"}},creatures_cloud_1_position:{value:{x:2300,y:1400,z:8100},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_1_position"}},creatures_cloud_1_scale:{value:6,params:{label:"creatures_cloud_1_scale"}},creatures_cloud_2_position:{value:{x:17600,y:-6100,z:4e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_2_position"}},creatures_cloud_2_scale:{value:20.700000000000003,params:{label:"creatures_cloud_2_scale"}},creatures_cloud_3_position:{value:{x:14300,y:4800,z:-3300},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_3_position"}},creatures_cloud_3_scale:{value:17.3,params:{label:"creatures_cloud_3_scale"}},creatures_cloud_4_position:{value:{x:-6100,y:6400,z:300},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_4_position"}},creatures_cloud_4_scale:{value:15.100000000000001,params:{label:"creatures_cloud_4_scale"}},creatures_cloud_5_position:{value:{x:2200,y:6500,z:7500},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_5_position"}},creatures_cloud_5_scale:{value:22.5,params:{label:"creatures_cloud_5_scale"}},creatures_cloud_6_position:{value:{x:-12100,y:-5200,z:-12800},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_6_position"}},creatures_cloud_6_scale:{value:15.3,params:{label:"creatures_cloud_6_scale"}}},battlearena:{originalPosition:{value:{x:2820,y:-1e3,z:2e4},params:{x:{step:10},y:{step:10},z:{step:10},label:"originalPosition"}},cameraPosition:{value:{x:1.76,y:.3},params:{x:{step:.01},y:{step:.01},label:"cameraPosition"}},fadeColor:{value:"#000000",params:{label:"fadeColor"}},lookatThreshold:{value:.31521739130434784,params:{min:0,max:1,label:"lookatThreshold"}},lookAtOffset:{value:{x:.03,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lookAtOffset"}},battlearena_asteroid_medium_01_position:{value:{x:-7500,y:0,z:9500},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_01_position"}},battlearena_asteroid_medium_01_rotation:{value:{x:-.48,y:-.92,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_01_rotation"}},battlearena_asteroid_medium_01_scale:{value:1.5,params:{label:"battlearena_asteroid_medium_01_scale"}},battlearena_asteroid_medium_02_position:{value:{x:-12800,y:-3400,z:9100},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_02_position"}},battlearena_asteroid_medium_02_rotation:{value:{x:-3.09,y:-2.48,z:-3.39},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_02_rotation"}},battlearena_asteroid_medium_02_scale:{value:1.881328821182251,params:{label:"battlearena_asteroid_medium_02_scale"}},battlearena_asteroid_medium_03_position:{value:{x:-19e3,y:11800,z:-18300},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_03_position"}},battlearena_asteroid_medium_03_rotation:{value:{x:-.48,y:-.92,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_03_rotation"}},battlearena_asteroid_medium_03_scale:{value:2.081328821182251,params:{label:"battlearena_asteroid_medium_03_scale"}},battlearena_asteroid_medium_04_position:{value:{x:-2500,y:-1500,z:3200},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_04_position"}},battlearena_asteroid_medium_04_rotation:{value:{x:-.98,y:-1.22,z:-2.0100000000000002},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_04_rotation"}},battlearena_asteroid_medium_04_scale:{value:1,params:{label:"battlearena_asteroid_medium_04_scale"}},battlearena_asteroid_small_012_position:{value:{x:-2700,y:-6200,z:2400},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_012_position"}},battlearena_asteroid_small_012_rotation:{value:{x:0,y:2.56,z:.49},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_012_rotation"}},battlearena_asteroid_small_012_scale:{value:3.5,params:{label:"battlearena_asteroid_small_012_scale"}},battlearena_asteroid_small_011_position:{value:{x:5500,y:0,z:-5300},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_011_position"}},battlearena_asteroid_small_011_rotation:{value:{x:.38,y:0,z:-.15},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_011_rotation"}},battlearena_asteroid_small_011_scale:{value:3.4000000000000004,params:{label:"battlearena_asteroid_small_011_scale"}},battlearena_asteroid_small_010_position:{value:{x:-2500,y:5100,z:-7800},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_010_position"}},battlearena_asteroid_small_010_rotation:{value:{x:-.67,y:.46,z:1.51},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_010_rotation"}},battlearena_asteroid_small_010_scale:{value:1.9,params:{label:"battlearena_asteroid_small_010_scale"}},battlearena_asteroid_small_09_position:{value:{x:-6500,y:1800,z:3500},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_09_position"}},battlearena_asteroid_small_09_rotation:{value:{x:-.58,y:-.43,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_09_rotation"}},battlearena_asteroid_small_09_scale:{value:2.6,params:{label:"battlearena_asteroid_small_09_scale"}},battlearena_cloud_3_position:{value:{x:0,y:0,z:0},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_cloud_3_position"}},battlearena_cloud_3_scale:{value:16,params:{label:"battlearena_cloud_3_scale"}},battlearena_cloud_1_position:{value:{x:-3400,y:-3500,z:0},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_cloud_1_position"}},battlearena_cloud_1_scale:{value:6,params:{label:"battlearena_cloud_1_scale"}},battlearena_cloud_2_position:{value:{x:6600,y:-11500,z:-14900},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_cloud_2_position"}},battlearena_cloud_2_scale:{value:12.5,params:{label:"battlearena_cloud_2_scale"}}},gameplay:{originalPosition:{value:{x:-6800,y:5490,z:18e3},params:{x:{step:10},y:{step:10},z:{step:10},label:"originalPosition"}},cameraPosition:{value:{x:-4.23,y:4.29},params:{x:{step:.01},y:{step:.01},label:"cameraPosition"}},fadeColor:{value:"#000000",params:{label:"fadeColor"}},lookatThreshold:{value:.17478260869565215,params:{min:0,max:1,label:"lookatThreshold"}},lookAtOffset:{value:{x:-.27,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lookAtOffset"}},gameplay_asteroid_small_014_position:{value:{x:6100,y:-5900,z:-5600},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_small_014_position"}},gameplay_asteroid_small_014_rotation:{value:{x:-.8200000000000001,y:-.87,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_small_014_rotation"}},gameplay_asteroid_small_014_scale:{value:3.900000000000001,params:{label:"gameplay_asteroid_small_014_scale"}},gameplay_asteroid_small_06_position:{value:{x:8800,y:2800,z:-300},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_small_06_position"}},gameplay_asteroid_small_06_rotation:{value:{x:1.01,y:-.13,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_small_06_rotation"}},gameplay_asteroid_small_06_scale:{value:1.4,params:{label:"gameplay_asteroid_small_06_scale"}},gameplay_asteroid_small_05_position:{value:{x:-7800,y:2e3,z:-12700},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_small_05_position"}},gameplay_asteroid_small_05_rotation:{value:{x:0,y:.17,z:-.59},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_small_05_rotation"}},gameplay_asteroid_small_05_scale:{value:2.3000000000000003,params:{label:"gameplay_asteroid_small_05_scale"}},gameplay_asteroid_medium_02_position:{value:{x:4300,y:-3300,z:7100},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_medium_02_position"}},gameplay_asteroid_medium_02_rotation:{value:{x:3.14,y:-.41000000000000003,z:1.28},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_medium_02_rotation"}},gameplay_asteroid_medium_02_scale:{value:2,params:{label:"gameplay_asteroid_medium_02_scale"}},gameplay_asteroid_medium_03_position:{value:{x:-20100,y:1700,z:-10400},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_medium_03_position"}},gameplay_asteroid_medium_03_rotation:{value:{x:-.79,y:-.8200000000000001,z:-.1},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_medium_03_rotation"}},gameplay_asteroid_medium_03_scale:{value:2.9712813854217535,params:{label:"gameplay_asteroid_medium_03_scale"}},gameplay_asteroid_medium_04_position:{value:{x:-4700,y:-3200,z:1400},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_medium_04_position"}},gameplay_asteroid_medium_04_rotation:{value:{x:-2.08,y:-2.87,z:.27},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_medium_04_rotation"}},gameplay_asteroid_medium_04_scale:{value:2.162669849395752,params:{label:"gameplay_asteroid_medium_04_scale"}},gameplay_cloud_1_position:{value:{x:-5900,y:-3200,z:1700},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_1_position"}},gameplay_cloud_1_scale:{value:11.95,params:{label:"gameplay_cloud_1_scale"}},gameplay_cloud_2_position:{value:{x:-7e3,y:-900,z:2100},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_2_position"}},gameplay_cloud_2_scale:{value:10.600000000000001,params:{label:"gameplay_cloud_2_scale"}},gameplay_cloud_3_position:{value:{x:-2800,y:2500,z:13e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_3_position"}},gameplay_cloud_3_scale:{value:4.7,params:{label:"gameplay_cloud_3_scale"}},gameplay_cloud_4_position:{value:{x:-1900,y:1100,z:0},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_4_position"}},gameplay_cloud_4_scale:{value:4.050000000000004,params:{label:"gameplay_cloud_4_scale"}},gameplay_cloud_5_position:{value:{x:-2900,y:-10400,z:8400},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_5_position"}},gameplay_cloud_5_scale:{value:18.65,params:{label:"gameplay_cloud_5_scale"}},gameplay_cloud_6_position:{value:{x:26e3,y:-7e3,z:-8e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_6_position"}},gameplay_cloud_6_scale:{value:30,params:{label:"gameplay_cloud_6_scale"}}},team:{originalPosition:{value:{x:2940,y:2820,z:2e4},params:{x:{step:10},y:{step:10},z:{step:10},label:"originalPosition"}},cameraPosition:{value:{x:1.9500000000000002,y:2.21},params:{x:{step:.01},y:{step:.01},label:"cameraPosition"}},fadeColor:{value:"#000000",params:{label:"fadeColor"}},lookatThreshold:{value:.07608695652173914,params:{min:0,max:1,label:"lookatThreshold"}},lookAtOffset:{value:{x:.34,y:-.4,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lookAtOffset"}},team_asteroid_small_015_position:{value:{x:-3e3,y:-900,z:1700},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_small_015_position"}},team_asteroid_small_015_rotation:{value:{x:0,y:-.1,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_small_015_rotation"}},team_asteroid_small_015_scale:{value:2,params:{label:"team_asteroid_small_015_scale"}},team_asteroid_small_04_position:{value:{x:3600,y:2700,z:4400},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_small_04_position"}},team_asteroid_small_04_rotation:{value:{x:1.23,y:-1.1500000000000001,z:1.11},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_small_04_rotation"}},team_asteroid_small_04_scale:{value:1.5,params:{label:"team_asteroid_small_04_scale"}},team_asteroid_small_03_position:{value:{x:1700,y:-600,z:7e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_small_03_position"}},team_asteroid_small_03_rotation:{value:{x:0,y:0,z:-1.17},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_small_03_rotation"}},team_asteroid_small_03_scale:{value:1,params:{label:"team_asteroid_small_03_scale"}},team_asteroid_medium_01_position:{value:{x:-5500,y:2300,z:-3300},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_medium_01_position"}},team_asteroid_medium_01_rotation:{value:{x:-.42,y:-.76,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_medium_01_rotation"}},team_asteroid_medium_01_scale:{value:1.7,params:{label:"team_asteroid_medium_01_scale"}},team_cloud_1_position:{value:{x:-5500,y:4600,z:-3200},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_1_position"}},team_cloud_1_scale:{value:14,params:{label:"team_cloud_1_scale"}},team_cloud_2_position:{value:{x:800,y:-3700,z:2e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_2_position"}},team_cloud_2_scale:{value:10,params:{label:"team_cloud_2_scale"}},team_cloud_3_position:{value:{x:-5500,y:-7400,z:5300},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_3_position"}},team_cloud_3_scale:{value:11.2,params:{label:"team_cloud_3_scale"}},team_cloud_4_position:{value:{x:5500,y:-2400,z:-3700},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_4_position"}},team_cloud_4_scale:{value:11.2,params:{label:"team_cloud_4_scale"}},team_cloud_5_position:{value:{x:16500,y:-14400,z:-11700},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_5_position"}},team_cloud_5_scale:{value:21.2,params:{label:"team_cloud_5_scale"}}},"Light Plane":{colorTop:{value:"#ffdeba",params:{label:"colorTop"}},colorBottom:{value:"#ffffff",params:{label:"colorBottom"}},opacity:{value:.29999999999999993,params:{min:0,max:1,step:.01,label:"opacity"}},gradientRatio:{value:1,params:{min:0,max:4,step:.01,label:"gradientRatio"}}},"Intro Floating Particles":{count:{value:300,params:{min:1,max:1e4,step:1,label:"count"}},color:{value:"#e29373",params:{label:"color"}},color1:{value:"#e2533f",params:{label:"color1"}},wind_X:{value:0,params:{min:-30,max:30,step:.1,label:"wind_X"}},wind_Y:{value:0,params:{min:-30,max:30,step:.1,label:"wind_Y"}},wind_Z:{value:0,params:{min:-30,max:30,step:.1,label:"wind_Z"}},TimeScale:{value:.29999999999999993,params:{min:0,max:2,step:.01,label:"TimeScale"}},Gravity:{value:20,params:{min:-100,max:100,step:.1,label:"Gravity"}},FadeDistance:{value:150,params:{min:0,max:1e3,step:1,label:"FadeDistance"}},NoiseIntensity:{value:30,params:{min:0,max:150,step:.1,label:"NoiseIntensity"}},NoiseFrequency:{value:.1,params:{min:0,max:2,step:.01,label:"NoiseFrequency"}},ParticleOpacity:{value:.75,params:{min:0,max:1,step:.01,label:"ParticleOpacity"}},ParticleScale:{value:180,params:{min:0,max:1e3,step:1,label:"ParticleScale"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.09999999999999999,params:{min:0,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.29999999999999993,params:{min:0,max:1,step:.001,label:"BorderSize1"}}},"Intro Flying Particles":{count:{value:8e3,params:{min:1,max:1e5,step:1,label:"count"}},Color:{value:"#ff5823",params:{label:"Color"}},Color1:{value:"#ff9371",params:{label:"Color1"}},Opacity:{value:.75,params:{min:0,max:1,step:.01,label:"Opacity"}},Scale:{value:180,params:{min:0,max:1e3,step:.01,label:"Scale"}},Acceleration:{value:{x:0,y:0,z:2.6},params:{x:{min:-20,max:20,step:.01},y:{min:-20,max:20,step:.01},z:{min:-20,max:20,step:.01},label:"Acceleration"}},Friction:{value:.044500000000000005,params:{min:0,max:.8,step:.01,label:"Friction"}},PositionOffset:{value:{x:0,y:0,z:0},params:{label:"PositionOffset"}},DiscRadius:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius"}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001,label:"DiscRadius1"}},BorderSize:{value:.2,params:{min:.001,max:1,step:.001,label:"BorderSize"}},BorderSize1:{value:.39999999999999997,params:{min:.001,max:1,step:.001,label:"BorderSize1"}}},"Rock PBR":{albedoColor:{value:"#6f6559",params:{label:"albedoColor"}},IBL:{value:3.44,params:{min:0,max:10,step:.01,label:"IBL"}},NormalScale:{value:1.6300000000000001,params:{min:0,max:2,step:.01,label:"NormalScale"}},MetalicFactor:{value:0,params:{min:0,max:2,step:.01,label:"MetalicFactor"}},RoughnessFactor:{value:.48000000000000004,params:{min:0,max:3,step:.01,label:"RoughnessFactor"}},EmissiveColor:{value:"#ffffff",params:{label:"EmissiveColor"}},EmissivePower:{value:1,params:{min:0,max:5,step:.01,label:"EmissivePower"}},OcclusionFactor:{value:1.6,params:{min:0,max:3,step:.01,label:"OcclusionFactor"}},ShadowFactor:{value:.63,params:{min:0,max:1,step:.01,label:"ShadowFactor"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:8,step:.1,label:"SheenDepth"}},Alpha:{value:1,params:{min:0,max:1,step:.01,label:"Alpha"}},Tint:{value:"#000000",params:{label:"Tint"}},TintOpacity:{value:.9,params:{min:0,max:1,step:.01,label:"TintOpacity"}},Exposure:{value:0,params:{min:-2,max:2,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:.9600000000000001,params:{min:0,max:2,step:.01,label:"Saturation"}}},"Title UNLIT":{Tint:{value:"#ffffff",params:{label:"Tint"}},TintOpacity:{value:0,params:{min:0,max:1,step:.01,label:"TintOpacity"}},NormalScale:{value:1,params:{min:0,max:3,step:.01,label:"NormalScale"}},Exposure:{value:0,params:{min:-2,max:3,step:.01,label:"Exposure"}},Contrast:{value:0,params:{min:-1,max:1,step:.01,label:"Contrast"}},Saturation:{value:1,params:{min:0,max:2,step:.01,label:"Saturation"}},SheenColor:{value:"#ffffff",params:{label:"SheenColor"}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01,label:"SheenOpacity"}},SheenDepth:{value:2,params:{min:1,max:10,step:.1,label:"SheenDepth"}}},Background:{zoom:{value:.23,params:{min:0,max:.99,step:.01,label:"zoom"}},movementAmplitude:{value:{x:.01,y:.005},params:{x:{min:0,max:.02,step:1e-4},y:{min:0,max:.01,step:1e-4},label:"movementAmplitude"}}},_SplinesEditorData:{camera:{name:"camera",points:[[0,0,0],[0,15,10],[15,15,-10],[0,15,-20]]},lookat:{name:"lookat",points:[[0,0,0],[0,15,10],[15,15,-10],[0,15,-20]]}}},TC={apiKey:"AIzaSyCnhID6mOlfzctfmbBtvEGlo1oBoa97Vlc",authDomain:"cloud-castles-v2.firebaseapp.com",databaseURL:"https://cloud-castles-v2-default-rtdb.firebaseio.com/",projectId:"cloud-castles-v2",storageBucket:"cloud-castles-v2.appspot.com",messagingSenderId:"685973872042",appId:"1:685973872042:web:7022de239f60b73bc3dfd3"};class MC{constructor(){this.active=this.queryDebug(),this._emitter={},ya(this._emitter),this.on=this._emitter.on.bind(this._emitter),this.init(),this.configs={},this.inputs={},this.savedConfigs={},this.folders={},this.active&&this.initNetwork()}queryDebug(e="dev"){let t=window.location.href;e=e.replace(/[[]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),s=i.exec(t);return s?decodeURIComponent(s[2].replace(/\+/g," "))==="true":!1}initNetwork(){this.networkIsOnline=!1,this.networkInputs={},this.networkParams={status:"\u{1F534} offline",name:localStorage.getItem("firebase-gui-name")||"","config-list":[]},this.networkPane=new na.exports.Pane({title:"Network",expanded:!0}),this.networkPane.hidden=!this.active||this.queryDebug("demo"),this.networkPane.containerElem_.style.right="auto",this.networkPane.containerElem_.style.left="8px",this.networkPane.containerElem_.style.top="auto",this.networkPane.containerElem_.style.bottom="8px",this.networkPane.containerElem_.style.maxWidth="400px",this.networkPane.addMonitor(this.networkParams,"status",{multiline:!1,lineCount:1}),this.networkPane.addSeparator(),this.networkInputs.list=this.networkPane.addBlade({view:"list",label:"presets",options:this.networkParams["config-list"],value:"none"}),this.networkPane.addSeparator(),this.networkInputs.sync=this.networkPane.addButton({title:"Sync"}),this.networkInputs.dump=this.networkPane.addButton({title:"Dump"}),this.networkPane.addSeparator(),this.networkInputs.name=this.networkPane.addInput(this.networkParams,"name"),this.networkInputs.save=this.networkPane.addButton({title:"Save"}),this.firebase=cm(TC),this.initNetworkEvents(),this.updateNetworkStatus(),window.dumpAsteroidConfig=()=>{this._emitter.emit("beforeSave");let e={};e.lore=this.configs.lore,e.creatures=this.configs.creatures,e.battlearena=this.configs.battlearena,e.gameplay=this.configs.gameplay,e.team=this.configs.team;for(const t in e){const i=e[t];for(const s in i)s.includes("asteroid")||delete i[s]}copy&&copy(e),console.log(e)},window.dumpCloudsConfig=()=>{this._emitter.emit("beforeSave");let e={};e.lore=this.configs.lore,e.creatures=this.configs.creatures,e.battlearena=this.configs.battlearena,e.gameplay=this.configs.gameplay,e.team=this.configs.team;for(const t in e){const i=e[t];for(const s in i)s.includes("cloud")||delete i[s]}copy&&copy(e),console.log(e)},window.dumpParticlesConfig=()=>{this._emitter.emit("beforeSave");let e={};e.lore_particles=this.configs.lore_particles,e.creatures_particles=this.configs.creatures_particles,e.battlearena_particles=this.configs.battlearena_particles,e.gameplay_particles=this.configs.gameplay_particles,e.team_particles=this.configs.team_particles,copy&&copy(e),console.log(e)},this.networkInputs.dump.on("click",()=>{this._emitter.emit("beforeSave"),this.dump()})}dump(){console.log(JSON.stringify(this.configs))}initNetworkEvents(){this.networkInputs.name.on("change",e=>{localStorage.setItem("firebase-gui-name",e.value)}),this.networkInputs.save.on("click",()=>{if(this._emitter.emit("beforeSave"),this.networkParams.name==""){alert("Please fill a name in Network GUI");return}for(const i in this.configs)if(Object.hasOwnProperty.call(this.configs,i)){const s=this.configs[i];if(this.configs[i]){const r=this.configs[i];for(const o in s)if(Object.hasOwnProperty.call(s,o)&&(s[o],r[o])){const c=r[o];c.type=="input-image"&&(c.value="placeholder")}}}const e=`${this.networkParams.name}___${new Date().toUTCString().replaceAll(",","").replaceAll(" ","-")}`;console.log("saving",e);const t=Vl();console.log(this.configs),fC(Gl(t,"configs/"+e),this.configs).then(()=>{this.refreshNetwork()})}),this.networkInputs.sync.on("click",()=>{this.refreshNetwork()})}refreshNetwork(){const e=Vl(),t=Gl(e,"configs/");Pp(t,i=>{const s=i.val();this.savedConfigs=s,this.networkParams["config-list"].length=0,this.networkParams["config-list"].push({text:"current",value:null});for(const r in s)Object.hasOwnProperty.call(s,r)&&this.networkParams["config-list"].push({text:r,value:r});this.networkInputs.list.dispose(),this.networkInputs.list=this.networkPane.addBlade({view:"list",label:"presets",index:1,options:this.networkParams["config-list"],value:"none"}),this.networkInputs.list.on("change",r=>{this.applyConfig(r.value)}),setTimeout(()=>{this.networkPane.refresh()},200)})}updateNetworkStatus(){const e=Vl(),t=Gl(e,".info/connected");Pp(t,i=>{i.val()===!0?(this.networkIsOnline=!0,console.log("GUI connected"),this.refreshNetwork(),this.networkParams.status="\u{1F7E2} online"):(this.networkIsOnline=!1,console.log("GUI not connected")),this.networkInputs.sync.disabled=!this.networkIsOnline,this.networkInputs.dump.disabled=!this.networkIsOnline,this.networkInputs.save.disabled=!this.networkIsOnline,this.networkPane.refresh()})}applyConfig(e){for(const t in this.savedConfigs[e])if(Object.hasOwnProperty.call(this.savedConfigs[e],t)){const i=this.savedConfigs[e][t];if(this.configs[t]){const s=this.configs[t];for(const r in i)if(Object.hasOwnProperty.call(i,r)){const o=i[r];if(s[r]){const c=s[r];c.value=o.value}else console.warn("no existing key",r,t,e)}}}this.pane.refresh(),this._emitter.emit("updateConfig")}applyConfigFile(e){for(const t in e)if(Object.hasOwnProperty.call(e,t)){const i=e[t];if(this.configs[t]){const s=this.configs[t];for(const r in i)if(Object.hasOwnProperty.call(i,r)){const o=i[r];if(s[r]){const c=s[r];c.value=o.value}}}}e._SplinesEditorData&&(this.configs._SplinesEditorData=e._SplinesEditorData),this.pane.refresh()}init(){this.pane=new na.exports.Pane({title:"Debug UI",expanded:!0}),this.pane.hidden=!this.active||this.queryDebug("demo"),this.scenePane=new na.exports.Pane({title:"Scene Controller",expanded:!0}),this.scenePane.hidden=!this.active,this.scenePane.containerElem_.style.right="auto",this.scenePane.containerElem_.style.left="8px",this.pane.registerPlugin(R_),this.pane.registerPlugin(F_),this.fpsGraph=this.pane.addBlade({view:"fpsgraph",label:"FPS",lineCount:2}),this.tab=this.pane.addTab({pages:[{title:"General"},{title:"Models"}]}),ui.onBefore=this.fpsGraph.begin.bind(this.fpsGraph),ui.onAfter=this.fpsGraph.end.bind(this.fpsGraph),document.head.insertAdjacentHTML("beforeend",`<style>
    :root {
      --tp-base-background-color: hsla(0, 0%, 10%, 1);
      --tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);
      --tp-button-background-color: hsla(0, 0%, 80%, 1);
      --tp-button-background-color-active: hsla(0, 0%, 100%, 1);
      --tp-button-background-color-focus: hsla(0, 0%, 95%, 1);
      --tp-button-background-color-hover: hsla(0, 0%, 85%, 1);
      --tp-button-foreground-color: hsla(0, 0%, 0%, 0.8);
      --tp-container-background-color: hsla(0, 0%, 0%, 0.3);
      --tp-container-background-color-active: hsla(0, 0%, 0%, 0.6);
      --tp-container-background-color-focus: hsla(0, 0%, 0%, 0.5);
      --tp-container-background-color-hover: hsla(0, 0%, 0%, 0.4);
      --tp-container-foreground-color: hsla(0, 0%, 100%, 0.5);
      --tp-groove-foreground-color: hsla(0, 0%, 0%, 0.2);
      --tp-input-background-color: hsla(0, 0%, 0%, 0.3);
      --tp-input-background-color-active: hsla(0, 0%, 0%, 0.6);
      --tp-input-background-color-focus: hsla(0, 0%, 0%, 0.5);
      --tp-input-background-color-hover: hsla(0, 0%, 0%, 0.4);
      --tp-input-foreground-color: hsla(0, 0%, 100%, 0.5);
      --tp-label-foreground-color: hsla(0, 0%, 100%, 0.5);
      --tp-monitor-background-color: hsla(0, 0%, 0%, 0.3);
      --tp-monitor-foreground-color: hsla(0, 0%, 100%, 0.3);
    }
    .tp-dfwv {
      width: 500px !important;
      z-index: 100;
      max-height: calc(100vh - 8px);
      overflow-y: scroll;
    }
    </style>`),this.pane.containerElem_.addEventListener("mouseover",()=>{this._emitter.emit("prevent")}),this.pane.containerElem_.addEventListener("mouseleave",()=>{this._emitter.emit("unprevent")}),this.scenePane.containerElem_.addEventListener("mouseover",()=>{this._emitter.emit("prevent")}),this.scenePane.containerElem_.addEventListener("mouseleave",()=>{this._emitter.emit("unprevent")})}onLoaded(){this.applyConfigFile(EC)}addConfig(){}addBladeScene(e,t){this.folders[t]=this.scenePane.addFolder({title:t,expanded:!0});for(const i in e)if(Object.hasOwnProperty.call(e,i)){const s=e[i];this.folders[t].addInput(s,"value",Object.assign(s.params,{label:i}))}}getGui(e){return this.folders[`${e}`]}getPBRGui(e){return this.folders[`${e} PBR`]}addBlade(e,t,i=0){return this.active?this.addBladeConfigActive(e,t,i):(this.addBladeConfigInactive(e,t,i),null)}addBladeConfigActive(e,t,i=0){this.folders[t]=this.tab.pages[i].addFolder({title:t,expanded:!1});let s={};this.inputs[t]={};for(const r in e)if(Object.hasOwnProperty.call(e,r)){const o=e[r];if(o.type=="input-image"){const c=this.folders[t].addInput(o,"value",{view:"input-image",imageFit:"contain",label:r});this.inputs[t][r]=c}else o.type=="bool"?this.folders[t].addInput(o,"value",{label:r}):(this.configs[t]=e,s[r]=this.folders[t].addInput(o,"value",Object.assign(o.params,{label:r})))}return s}addBladeConfigInactive(e,t){for(const i in e)Object.hasOwnProperty.call(e,i)&&(this.configs[t]=e);return{}}}const ie=new MC;let BC=1;const Ip={};class ge{constructor(e,{vertex:t,fragment:i,uniforms:s={},transparent:r=!1,cullFace:o=e.BACK,frontFace:c=e.CCW,depthTest:p=!0,depthWrite:m=!0,depthFunc:_=e.LESS}={}){e.canvas||console.error("gl not passed as fist argument to Program"),this.gl=e,this.uniforms=s,this.id=BC++,t||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=r,this.cullFace=o,this.frontFace=c,this.depthTest=p,this.depthWrite=m,this.depthFunc=_,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const v=e.createShader(e.VERTEX_SHADER);e.shaderSource(v,t),e.compileShader(v),ie.active&&e.getShaderInfoLog(v)!==""&&console.warn(`${e.getShaderInfoLog(v)}
Vertex Shader
${Rp(t)}`);const g=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(g,i),e.compileShader(g),ie.active&&e.getShaderInfoLog(g)!==""&&console.warn(`${e.getShaderInfoLog(g)}
Fragment Shader
${Rp(i)}`),this.program=e.createProgram(),e.attachShader(this.program,v),e.attachShader(this.program,g),e.linkProgram(this.program),ie.active&&!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(v),e.deleteShader(g),this.uniformLocations=new Map,this.attributeLocations=new Map,this.hasLocations=!1}getLocations(e){let t=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS);for(let r=0;r<t;r++){let o=e.getActiveUniform(this.program,r);this.uniformLocations.set(o,e.getUniformLocation(this.program,o.name));const c=o.name.match(/(\w+)/g);o.uniformName=c[0],c.length===3?(o.isStructArray=!0,o.structIndex=Number(c[1]),o.structProperty=c[2]):c.length===2&&isNaN(Number(c[1]))&&(o.isStruct=!0,o.structProperty=c[1])}const i=[],s=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const o=e.getActiveAttrib(this.program,r),c=e.getAttribLocation(this.program,o.name);i[c]=o.name,this.attributeLocations.set(o,c)}this.attributeOrder=i.join("")}setBlendFunc(e,t,i,s){this.blendFunc.src=e,this.blendFunc.dst=t,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=s,e&&(this.transparent=!0)}setBlendEquation(e,t){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=t}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:e=!1}={}){let t=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((s,r)=>{let o=r.uniformName,c=this.uniforms[o];if(r.isStruct&&(c=c[r.structProperty],o+=`.${r.structProperty}`),r.isStructArray&&(c=c[r.structIndex][r.structProperty],o+=`[${r.structIndex}].${r.structProperty}`),!c)return Op(`Active uniform ${o} has not been supplied`);if(c&&c.value===void 0)return Op(`${o} uniform is missing a value parameter`);if(c.value.texture)return t=t+1,c.value.update(t),Wl(this.gl,r.type,s,t);if(c.value.length&&c.value[0].texture){const p=[];return c.value.forEach(m=>{t=t+1,m.update(t),p.push(t)}),Wl(this.gl,r.type,s,p)}Wl(this.gl,r.type,s,c.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function Wl(n,e,t,i){i=i.length?PC(i):i;const s=n.renderer.state.uniformLocations.get(t);if(i.length)if(s===void 0||s.length!==i.length)n.renderer.state.uniformLocations.set(t,i.slice(0));else{if(IC(s,i))return;s.set?s.set(i):RC(s,i),n.renderer.state.uniformLocations.set(t,s)}else{if(s===i)return;n.renderer.state.uniformLocations.set(t,i)}switch(e){case 5126:return i.length?n.uniform1fv(t,i):n.uniform1f(t,i);case 35664:return n.uniform2fv(t,i);case 35665:return n.uniform3fv(t,i);case 35666:return n.uniform4fv(t,i);case 35670:case 5124:case 35678:case 35680:return i.length?n.uniform1iv(t,i):n.uniform1i(t,i);case 35671:case 35667:return n.uniform2iv(t,i);case 35672:case 35668:return n.uniform3iv(t,i);case 35673:case 35669:return n.uniform4iv(t,i);case 35674:return n.uniformMatrix2fv(t,!1,i);case 35675:return n.uniformMatrix3fv(t,!1,i);case 35676:return n.uniformMatrix4fv(t,!1,i)}}function Rp(n){let e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function PC(n){const e=n.length,t=n[0].length;if(t===void 0)return n;const i=e*t;let s=Ip[i];s||(Ip[i]=s=new Float32Array(i));for(let r=0;r<e;r++)s.set(n[r],r*t);return s}function IC(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function RC(n,e){for(let t=0,i=n.length;t<i;t++)n[t]=e[t]}let jl=0;function Op(n){jl>100||(console.warn(n),jl++,jl>100&&console.warn("More than 100 program warnings - stopping logs."))}function Bf(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Pf(n,e,t,i,s){return n[0]=e,n[1]=t,n[2]=i,n[3]=s,n}function If(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=t*t+i*i+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=i*o,n[2]=s*o,n[3]=r*o,n}function OC(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function FC(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function DC(n,e,t){t=t*.5;let i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function Fp(n,e,t){let i=e[0],s=e[1],r=e[2],o=e[3],c=t[0],p=t[1],m=t[2],_=t[3];return n[0]=i*_+o*c+s*m-r*p,n[1]=s*_+o*p+r*c-i*m,n[2]=r*_+o*m+i*p-s*c,n[3]=o*_-i*c-s*p-r*m,n}function LC(n,e,t){t*=.5;let i=e[0],s=e[1],r=e[2],o=e[3],c=Math.sin(t),p=Math.cos(t);return n[0]=i*p+o*c,n[1]=s*p+r*c,n[2]=r*p-s*c,n[3]=o*p-i*c,n}function NC(n,e,t){t*=.5;let i=e[0],s=e[1],r=e[2],o=e[3],c=Math.sin(t),p=Math.cos(t);return n[0]=i*p-r*c,n[1]=s*p+o*c,n[2]=r*p+i*c,n[3]=o*p-s*c,n}function kC(n,e,t){t*=.5;let i=e[0],s=e[1],r=e[2],o=e[3],c=Math.sin(t),p=Math.cos(t);return n[0]=i*p+s*c,n[1]=s*p-i*c,n[2]=r*p+o*c,n[3]=o*p-r*c,n}function zC(n,e,t,i){let s=e[0],r=e[1],o=e[2],c=e[3],p=t[0],m=t[1],_=t[2],v=t[3],g,C,S,E,T;return C=s*p+r*m+o*_+c*v,C<0&&(C=-C,p=-p,m=-m,_=-_,v=-v),1-C>1e-6?(g=Math.acos(C),S=Math.sin(g),E=Math.sin((1-i)*g)/S,T=Math.sin(i*g)/S):(E=1-i,T=i),n[0]=E*s+T*p,n[1]=E*r+T*m,n[2]=E*o+T*_,n[3]=E*c+T*v,n}function UC(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=t*t+i*i+s*s+r*r,c=o?1/o:0;return n[0]=-t*c,n[1]=-i*c,n[2]=-s*c,n[3]=r*c,n}function HC(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function GC(n,e){let t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);let r=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[r*3+r]-e[o*3+o]+1),n[s]=.5*i,i=.5/i,n[3]=(e[r*3+o]-e[o*3+r])*i,n[r]=(e[r*3+s]+e[s*3+r])*i,n[o]=(e[o*3+s]+e[s*3+o])*i}return n}function VC(n,e,t="YXZ"){let i=Math.sin(e[0]*.5),s=Math.cos(e[0]*.5),r=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),c=Math.sin(e[2]*.5),p=Math.cos(e[2]*.5);return t==="XYZ"?(n[0]=i*o*p+s*r*c,n[1]=s*r*p-i*o*c,n[2]=s*o*c+i*r*p,n[3]=s*o*p-i*r*c):t==="YXZ"?(n[0]=i*o*p+s*r*c,n[1]=s*r*p-i*o*c,n[2]=s*o*c-i*r*p,n[3]=s*o*p+i*r*c):t==="ZXY"?(n[0]=i*o*p-s*r*c,n[1]=s*r*p+i*o*c,n[2]=s*o*c+i*r*p,n[3]=s*o*p-i*r*c):t==="ZYX"?(n[0]=i*o*p-s*r*c,n[1]=s*r*p+i*o*c,n[2]=s*o*c-i*r*p,n[3]=s*o*p+i*r*c):t==="YZX"?(n[0]=i*o*p+s*r*c,n[1]=s*r*p+i*o*c,n[2]=s*o*c-i*r*p,n[3]=s*o*p-i*r*c):t==="XZY"&&(n[0]=i*o*p-s*r*c,n[1]=s*r*p-i*o*c,n[2]=s*o*c+i*r*p,n[3]=s*o*p+i*r*c),n}const WC=Bf,jC=Pf,KC=OC,JC=If;class $C extends Array{constructor(e=0,t=0,i=0,s=1){return super(e,t,i,s),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set w(e){this[3]=e,this.onChange()}identity(){return FC(this),this.onChange(),this}set(e,t,i,s){return e.length?this.copy(e):(jC(this,e,t,i,s),this.onChange(),this)}rotateX(e){return LC(this,this,e),this.onChange(),this}rotateY(e){return NC(this,this,e),this.onChange(),this}rotateZ(e){return kC(this,this,e),this.onChange(),this}inverse(e=this){return UC(this,e),this.onChange(),this}conjugate(e=this){return HC(this,e),this.onChange(),this}copy(e){return WC(this,e),this.onChange(),this}normalize(e=this){return JC(this,e),this.onChange(),this}multiply(e,t){return t?Fp(this,e,t):Fp(this,this,e),this.onChange(),this}dot(e){return KC(this,e)}fromMatrix3(e){return GC(this,e),this.onChange(),this}fromEuler(e){return VC(this,e,e.order),this}fromAxisAngle(e,t){return DC(this,e,t),this}slerp(e,t){return zC(this,this,e,t),this}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}}const qC=1e-6;function XC(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function YC(n,e,t,i,s,r,o,c,p,m,_,v,g,C,S,E,T){return n[0]=e,n[1]=t,n[2]=i,n[3]=s,n[4]=r,n[5]=o,n[6]=c,n[7]=p,n[8]=m,n[9]=_,n[10]=v,n[11]=g,n[12]=C,n[13]=S,n[14]=E,n[15]=T,n}function QC(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ZC(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],c=e[5],p=e[6],m=e[7],_=e[8],v=e[9],g=e[10],C=e[11],S=e[12],E=e[13],T=e[14],M=e[15],W=t*c-i*o,B=t*p-s*o,O=t*m-r*o,L=i*p-s*c,H=i*m-r*c,G=s*m-r*p,N=_*E-v*S,U=_*T-g*S,J=_*M-C*S,Q=v*T-g*E,Y=v*M-C*E,D=g*M-C*T,z=W*D-B*Y+O*Q+L*J-H*U+G*N;return z?(z=1/z,n[0]=(c*D-p*Y+m*Q)*z,n[1]=(s*Y-i*D-r*Q)*z,n[2]=(E*G-T*H+M*L)*z,n[3]=(g*H-v*G-C*L)*z,n[4]=(p*J-o*D-m*U)*z,n[5]=(t*D-s*J+r*U)*z,n[6]=(T*O-S*G-M*B)*z,n[7]=(_*G-g*O+C*B)*z,n[8]=(o*Y-c*J+m*N)*z,n[9]=(i*J-t*Y-r*N)*z,n[10]=(S*H-E*O+M*W)*z,n[11]=(v*O-_*H-C*W)*z,n[12]=(c*U-o*Q-p*N)*z,n[13]=(t*Q-i*U+s*N)*z,n[14]=(E*B-S*L-T*W)*z,n[15]=(_*L-v*B+g*W)*z,n):null}function eS(n){let e=n[0],t=n[1],i=n[2],s=n[3],r=n[4],o=n[5],c=n[6],p=n[7],m=n[8],_=n[9],v=n[10],g=n[11],C=n[12],S=n[13],E=n[14],T=n[15],M=e*o-t*r,W=e*c-i*r,B=e*p-s*r,O=t*c-i*o,L=t*p-s*o,H=i*p-s*c,G=m*S-_*C,N=m*E-v*C,U=m*T-g*C,J=_*E-v*S,Q=_*T-g*S,Y=v*T-g*E;return M*Y-W*Q+B*J+O*U-L*N+H*G}function Dp(n,e,t){let i=e[0],s=e[1],r=e[2],o=e[3],c=e[4],p=e[5],m=e[6],_=e[7],v=e[8],g=e[9],C=e[10],S=e[11],E=e[12],T=e[13],M=e[14],W=e[15],B=t[0],O=t[1],L=t[2],H=t[3];return n[0]=B*i+O*c+L*v+H*E,n[1]=B*s+O*p+L*g+H*T,n[2]=B*r+O*m+L*C+H*M,n[3]=B*o+O*_+L*S+H*W,B=t[4],O=t[5],L=t[6],H=t[7],n[4]=B*i+O*c+L*v+H*E,n[5]=B*s+O*p+L*g+H*T,n[6]=B*r+O*m+L*C+H*M,n[7]=B*o+O*_+L*S+H*W,B=t[8],O=t[9],L=t[10],H=t[11],n[8]=B*i+O*c+L*v+H*E,n[9]=B*s+O*p+L*g+H*T,n[10]=B*r+O*m+L*C+H*M,n[11]=B*o+O*_+L*S+H*W,B=t[12],O=t[13],L=t[14],H=t[15],n[12]=B*i+O*c+L*v+H*E,n[13]=B*s+O*p+L*g+H*T,n[14]=B*r+O*m+L*C+H*M,n[15]=B*o+O*_+L*S+H*W,n}function tS(n,e,t){let i=t[0],s=t[1],r=t[2],o,c,p,m,_,v,g,C,S,E,T,M;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*r+e[12],n[13]=e[1]*i+e[5]*s+e[9]*r+e[13],n[14]=e[2]*i+e[6]*s+e[10]*r+e[14],n[15]=e[3]*i+e[7]*s+e[11]*r+e[15]):(o=e[0],c=e[1],p=e[2],m=e[3],_=e[4],v=e[5],g=e[6],C=e[7],S=e[8],E=e[9],T=e[10],M=e[11],n[0]=o,n[1]=c,n[2]=p,n[3]=m,n[4]=_,n[5]=v,n[6]=g,n[7]=C,n[8]=S,n[9]=E,n[10]=T,n[11]=M,n[12]=o*i+_*s+S*r+e[12],n[13]=c*i+v*s+E*r+e[13],n[14]=p*i+g*s+T*r+e[14],n[15]=m*i+C*s+M*r+e[15]),n}function nS(n,e,t){let i=t[0],s=t[1],r=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*r,n[9]=e[9]*r,n[10]=e[10]*r,n[11]=e[11]*r,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function iS(n,e,t,i){let s=i[0],r=i[1],o=i[2],c=Math.hypot(s,r,o),p,m,_,v,g,C,S,E,T,M,W,B,O,L,H,G,N,U,J,Q,Y,D,z,F;return Math.abs(c)<qC?null:(c=1/c,s*=c,r*=c,o*=c,p=Math.sin(t),m=Math.cos(t),_=1-m,v=e[0],g=e[1],C=e[2],S=e[3],E=e[4],T=e[5],M=e[6],W=e[7],B=e[8],O=e[9],L=e[10],H=e[11],G=s*s*_+m,N=r*s*_+o*p,U=o*s*_-r*p,J=s*r*_-o*p,Q=r*r*_+m,Y=o*r*_+s*p,D=s*o*_+r*p,z=r*o*_-s*p,F=o*o*_+m,n[0]=v*G+E*N+B*U,n[1]=g*G+T*N+O*U,n[2]=C*G+M*N+L*U,n[3]=S*G+W*N+H*U,n[4]=v*J+E*Q+B*Y,n[5]=g*J+T*Q+O*Y,n[6]=C*J+M*Q+L*Y,n[7]=S*J+W*Q+H*Y,n[8]=v*D+E*z+B*F,n[9]=g*D+T*z+O*F,n[10]=C*D+M*z+L*F,n[11]=S*D+W*z+H*F,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function sS(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function Rf(n,e){let t=e[0],i=e[1],s=e[2],r=e[4],o=e[5],c=e[6],p=e[8],m=e[9],_=e[10];return n[0]=Math.hypot(t,i,s),n[1]=Math.hypot(r,o,c),n[2]=Math.hypot(p,m,_),n}function aS(n){let e=n[0],t=n[1],i=n[2],s=n[4],r=n[5],o=n[6],c=n[8],p=n[9],m=n[10];const _=e*e+t*t+i*i,v=s*s+r*r+o*o,g=c*c+p*p+m*m;return Math.sqrt(Math.max(_,v,g))}const rS=function(){const n=[0,0,0];return function(e,t){let i=n;Rf(i,t);let s=1/i[0],r=1/i[1],o=1/i[2],c=t[0]*s,p=t[1]*r,m=t[2]*o,_=t[4]*s,v=t[5]*r,g=t[6]*o,C=t[8]*s,S=t[9]*r,E=t[10]*o,T=c+v+E,M=0;return T>0?(M=Math.sqrt(T+1)*2,e[3]=.25*M,e[0]=(g-S)/M,e[1]=(C-m)/M,e[2]=(p-_)/M):c>v&&c>E?(M=Math.sqrt(1+c-v-E)*2,e[3]=(g-S)/M,e[0]=.25*M,e[1]=(p+_)/M,e[2]=(C+m)/M):v>E?(M=Math.sqrt(1+v-c-E)*2,e[3]=(C-m)/M,e[0]=(p+_)/M,e[1]=.25*M,e[2]=(g+S)/M):(M=Math.sqrt(1+E-c-v)*2,e[3]=(p-_)/M,e[0]=(C+m)/M,e[1]=(g+S)/M,e[2]=.25*M),e}}();function oS(n,e,t,i){let s=e[0],r=e[1],o=e[2],c=e[3],p=s+s,m=r+r,_=o+o,v=s*p,g=s*m,C=s*_,S=r*m,E=r*_,T=o*_,M=c*p,W=c*m,B=c*_,O=i[0],L=i[1],H=i[2];return n[0]=(1-(S+T))*O,n[1]=(g+B)*O,n[2]=(C-W)*O,n[3]=0,n[4]=(g-B)*L,n[5]=(1-(v+T))*L,n[6]=(E+M)*L,n[7]=0,n[8]=(C+W)*H,n[9]=(E-M)*H,n[10]=(1-(v+S))*H,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function lS(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=t+t,c=i+i,p=s+s,m=t*o,_=i*o,v=i*c,g=s*o,C=s*c,S=s*p,E=r*o,T=r*c,M=r*p;return n[0]=1-v-S,n[1]=_+M,n[2]=g-T,n[3]=0,n[4]=_-M,n[5]=1-m-S,n[6]=C+E,n[7]=0,n[8]=g+T,n[9]=C-E,n[10]=1-m-v,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function uS(n,e,t,i,s){let r=1/Math.tan(e/2),o=1/(i-s);return n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(s+i)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*s*i*o,n[15]=0,n}function cS(n,e,t,i,s,r,o){let c=1/(e-t),p=1/(i-s),m=1/(r-o);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*m,n[11]=0,n[12]=(e+t)*c,n[13]=(s+i)*p,n[14]=(o+r)*m,n[15]=1,n}function hS(n,e,t,i){let s=e[0],r=e[1],o=e[2],c=i[0],p=i[1],m=i[2],_=s-t[0],v=r-t[1],g=o-t[2],C=_*_+v*v+g*g;C===0?g=1:(C=1/Math.sqrt(C),_*=C,v*=C,g*=C);let S=p*g-m*v,E=m*_-c*g,T=c*v-p*_;return C=S*S+E*E+T*T,C===0&&(m?c+=1e-6:p?m+=1e-6:p+=1e-6,S=p*g-m*v,E=m*_-c*g,T=c*v-p*_,C=S*S+E*E+T*T),C=1/Math.sqrt(C),S*=C,E*=C,T*=C,n[0]=S,n[1]=E,n[2]=T,n[3]=0,n[4]=v*T-g*E,n[5]=g*S-_*T,n[6]=_*E-v*S,n[7]=0,n[8]=_,n[9]=v,n[10]=g,n[11]=0,n[12]=s,n[13]=r,n[14]=o,n[15]=1,n}class jt extends Array{constructor(e=1,t=0,i=0,s=0,r=0,o=1,c=0,p=0,m=0,_=0,v=1,g=0,C=0,S=0,E=0,T=1){return super(e,t,i,s,r,o,c,p,m,_,v,g,C,S,E,T),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,t,i,s,r,o,c,p,m,_,v,g,C,S,E,T){return e.length?this.copy(e):(YC(this,e,t,i,s,r,o,c,p,m,_,v,g,C,S,E,T),this)}translate(e,t=this){return tS(this,t,e),this}rotate(e,t,i=this){return iS(this,i,e,t),this}scale(e,t=this){return nS(this,t,typeof e=="number"?[e,e,e]:e),this}multiply(e,t){return t?Dp(this,e,t):Dp(this,this,e),this}identity(){return QC(this),this}copy(e){return XC(this,e),this}fromPerspective({fov:e,aspect:t,near:i,far:s}={}){return uS(this,e,t,i,s),this}fromOrthogonal({left:e,right:t,bottom:i,top:s,near:r,far:o}){return cS(this,e,t,i,s,r,o),this}fromQuaternion(e){return lS(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return ZC(this,e),this}compose(e,t,i){return oS(this,e,t,i),this}getRotation(e){return rS(e,this),this}getTranslation(e){return sS(e,this),this}getScaling(e){return Rf(e,this),this}getMaxScaleOnAxis(){return aS(this)}lookAt(e,t,i){return hS(this,e,t,i),this}determinant(){return eS(this)}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this[4]=e[t+4],this[5]=e[t+5],this[6]=e[t+6],this[7]=e[t+7],this[8]=e[t+8],this[9]=e[t+9],this[10]=e[t+10],this[11]=e[t+11],this[12]=e[t+12],this[13]=e[t+13],this[14]=e[t+14],this[15]=e[t+15],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e[t+4]=this[4],e[t+5]=this[5],e[t+6]=this[6],e[t+7]=this[7],e[t+8]=this[8],e[t+9]=this[9],e[t+10]=this[10],e[t+11]=this[11],e[t+12]=this[12],e[t+13]=this[13],e[t+14]=this[14],e[t+15]=this[15],e}}function pS(n,e,t="YXZ"){return t==="XYZ"?(n[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(n[0]=Math.atan2(-e[9],e[10]),n[2]=Math.atan2(-e[4],e[0])):(n[0]=Math.atan2(e[6],e[5]),n[2]=0)):t==="YXZ"?(n[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(n[1]=Math.atan2(e[8],e[10]),n[2]=Math.atan2(e[1],e[5])):(n[1]=Math.atan2(-e[2],e[0]),n[2]=0)):t==="ZXY"?(n[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(n[1]=Math.atan2(-e[2],e[10]),n[2]=Math.atan2(-e[4],e[5])):(n[1]=0,n[2]=Math.atan2(e[1],e[0]))):t==="ZYX"?(n[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(n[0]=Math.atan2(e[6],e[10]),n[2]=Math.atan2(e[1],e[0])):(n[0]=0,n[2]=Math.atan2(-e[4],e[5]))):t==="YZX"?(n[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(n[0]=Math.atan2(-e[9],e[5]),n[1]=Math.atan2(-e[2],e[0])):(n[0]=0,n[1]=Math.atan2(e[8],e[10]))):t==="XZY"&&(n[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(n[0]=Math.atan2(e[6],e[5]),n[1]=Math.atan2(e[8],e[0])):(n[0]=Math.atan2(-e[9],e[10]),n[1]=0)),n}const Lp=new jt;class dS extends Array{constructor(e=0,t=e,i=e,s="YXZ"){return super(e,t,i),this.order=s,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set(e,t=e,i=e){return e.length?this.copy(e):(this[0]=e,this[1]=t,this[2]=i,this.onChange(),this)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.onChange(),this}reorder(e){return this.order=e,this.onChange(),this}fromRotationMatrix(e,t=this.order){return pS(this,e,t),this}fromQuaternion(e,t=this.order){return Lp.fromQuaternion(e),this.fromRotationMatrix(Lp,t)}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}}class Le{constructor({scale:e=1}={}){this.parent=null,this.children=[],this.visible=!0,this.castable=!0,this.matrix=new jt,this.worldMatrix=new jt,this.matrixAutoUpdate=!0,this.position=new q,this.worldPosition=new q,this.quaternion=new $C,this.scale=new q(e,e,e),this.rotation=new dS,this.up=new q(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(e,t=!0){this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,t&&e&&e.addChild(this,!1)}addChild(e,t=!0){~this.children.indexOf(e)||this.children.push(e),t&&e.setParent(this,!1)}removeChild(e,t=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),t&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0,this.worldMatrix.getTranslation(this.worldPosition));for(let t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let t=0,i=this.children.length;t<i;t++)this.children[t].traverse(e)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,t=!1){t?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}lookAtWorld(e,t=!1){const i=[this.worldMatrix[12],this.worldMatrix[13],this.worldMatrix[14]];t?this.matrix.lookAt(i,e,this.up):this.matrix.lookAt(e,i,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}function mS(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n}function fS(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=t+t,c=i+i,p=s+s,m=t*o,_=i*o,v=i*c,g=s*o,C=s*c,S=s*p,E=r*o,T=r*c,M=r*p;return n[0]=1-v-S,n[3]=_-M,n[6]=g+T,n[1]=_+M,n[4]=1-m-S,n[7]=C-E,n[2]=g-T,n[5]=C+E,n[8]=1-m-v,n}function vS(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function gS(n,e,t,i,s,r,o,c,p,m){return n[0]=e,n[1]=t,n[2]=i,n[3]=s,n[4]=r,n[5]=o,n[6]=c,n[7]=p,n[8]=m,n}function _S(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function bS(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],c=e[5],p=e[6],m=e[7],_=e[8],v=_*o-c*m,g=-_*r+c*p,C=m*r-o*p,S=t*v+i*g+s*C;return S?(S=1/S,n[0]=v*S,n[1]=(-_*i+s*m)*S,n[2]=(c*i-s*o)*S,n[3]=g*S,n[4]=(_*t-s*p)*S,n[5]=(-c*t+s*r)*S,n[6]=C*S,n[7]=(-m*t+i*p)*S,n[8]=(o*t-i*r)*S,n):null}function Np(n,e,t){let i=e[0],s=e[1],r=e[2],o=e[3],c=e[4],p=e[5],m=e[6],_=e[7],v=e[8],g=t[0],C=t[1],S=t[2],E=t[3],T=t[4],M=t[5],W=t[6],B=t[7],O=t[8];return n[0]=g*i+C*o+S*m,n[1]=g*s+C*c+S*_,n[2]=g*r+C*p+S*v,n[3]=E*i+T*o+M*m,n[4]=E*s+T*c+M*_,n[5]=E*r+T*p+M*v,n[6]=W*i+B*o+O*m,n[7]=W*s+B*c+O*_,n[8]=W*r+B*p+O*v,n}function xS(n,e,t){let i=e[0],s=e[1],r=e[2],o=e[3],c=e[4],p=e[5],m=e[6],_=e[7],v=e[8],g=t[0],C=t[1];return n[0]=i,n[1]=s,n[2]=r,n[3]=o,n[4]=c,n[5]=p,n[6]=g*i+C*o+m,n[7]=g*s+C*c+_,n[8]=g*r+C*p+v,n}function yS(n,e,t){let i=e[0],s=e[1],r=e[2],o=e[3],c=e[4],p=e[5],m=e[6],_=e[7],v=e[8],g=Math.sin(t),C=Math.cos(t);return n[0]=C*i+g*o,n[1]=C*s+g*c,n[2]=C*r+g*p,n[3]=C*o-g*i,n[4]=C*c-g*s,n[5]=C*p-g*r,n[6]=m,n[7]=_,n[8]=v,n}function CS(n,e,t){let i=t[0],s=t[1];return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function SS(n,e){let t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],c=e[5],p=e[6],m=e[7],_=e[8],v=e[9],g=e[10],C=e[11],S=e[12],E=e[13],T=e[14],M=e[15],W=t*c-i*o,B=t*p-s*o,O=t*m-r*o,L=i*p-s*c,H=i*m-r*c,G=s*m-r*p,N=_*E-v*S,U=_*T-g*S,J=_*M-C*S,Q=v*T-g*E,Y=v*M-C*E,D=g*M-C*T,z=W*D-B*Y+O*Q+L*J-H*U+G*N;return z?(z=1/z,n[0]=(c*D-p*Y+m*Q)*z,n[1]=(p*J-o*D-m*U)*z,n[2]=(o*Y-c*J+m*N)*z,n[3]=(s*Y-i*D-r*Q)*z,n[4]=(t*D-s*J+r*U)*z,n[5]=(i*J-t*Y-r*N)*z,n[6]=(E*G-T*H+M*L)*z,n[7]=(T*O-S*G-M*B)*z,n[8]=(S*H-E*O+M*W)*z,n):null}class wS extends Array{constructor(e=1,t=0,i=0,s=0,r=1,o=0,c=0,p=0,m=1){return super(e,t,i,s,r,o,c,p,m),this}set(e,t,i,s,r,o,c,p,m){return e.length?this.copy(e):(gS(this,e,t,i,s,r,o,c,p,m),this)}translate(e,t=this){return xS(this,t,e),this}rotate(e,t=this){return yS(this,t,e),this}scale(e,t=this){return CS(this,t,e),this}multiply(e,t){return t?Np(this,e,t):Np(this,this,e),this}identity(){return _S(this),this}copy(e){return vS(this,e),this}fromMatrix4(e){return mS(this,e),this}fromQuaternion(e){return fS(this,e),this}fromBasis(e,t,i){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],i[0],i[1],i[2]),this}inverse(e=this){return bS(this,e),this}getNormalMatrix(e){return SS(this,e),this}}let AS=0;class Ae extends Le{constructor(e,{geometry:t,program:i,mode:s=e.TRIANGLES,frustumCulled:r=!0,renderOrder:o=0,forceRenderOrder:c=!1,transform:p=null}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=AS++,p!==null&&(this.position.copy(p.position),this.scale.copy(p.scale),this.rotation.copy(p.rotation)),this.geometry=t,this.program=i,this.mode=s,this.forceRenderOrder=c,this.frustumCulled=r,this.renderOrder=o,this.modelViewMatrix=new jt,this.normalMatrix=new wS,this.isCameraFliped=!1,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){this.program.hasLocations||(this.program.getLocations(this.gl),this.program.hasLocations=!0),this.beforeRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:e}));let t=!1;e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null},isCameraFliped:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.program.uniforms.isCameraFliped.value=e.isFliped,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix,t=e.isFliped);let i=this.program.cullFace&&this.worldMatrix.determinant()<0||t;this.program.use({flipFaces:i}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:e}))}}class Of{constructor(e,{parent:t=null,scale:i=1,blendFunc:s={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},transparent:r=!0,depthTest:o=!0,shaderId:c="unlit",depthWrite:p=!0,textureId:m=null,color:_=Ge(0,0,0),renderOrder:v=0,forceRenderOrder:g=!1,alpha:C=1}={}){this.gl=e.gl,this.scene=e,this.parent=t||e.root,this.scale=i,this.transparent=r,this.blendFunc=s,this.depthTest=o,this.depthWrite=p,this.shaderId=c,this.textureId=m,this.renderOrder=v,this.forceRenderOrder=g,this.texture=new be(this.gl),this.alpha=C,this.color=_,this.defines={},this.init()}init(){this.geometry=new vi(this.gl),this.textureId&&(this.defines.HAS_COLORMAP=!0),this.shader=new ve(ce[this.shaderId],1,this.defines),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:{uTexture:{value:this.texture},uTime:{value:this.scene.time},uAlpha:{value:this.alpha},uColor:{value:this.color},uRez:{value:[this.scene.width,this.scene.height]}}}),this.program.cullFace=!1,this.program.setBlendFunc(this.blendFunc.src,this.blendFunc.dst),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,forceRenderOrder:this.forceRenderOrder,renderOrder:this.renderOrder}),this.mesh.scale.set(this.scale,this.scale,this.scale),this.mesh.setParent(this.parent),this.mesh._entity=this}onLoaded(){this.textureId&&(this.texture=this.scene.textureLoader.getTexture(this.textureId),this.texture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.texture)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uAlpha.value=this.alpha,this.program.uniforms.uColor.value=this.color,this.program.uniforms.uRez.value=[this.scene.width,this.scene.height]}dispose(){this.mesh.setParent(null),this.geometry.remove(),this.program.remove()}}const kp={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function zp(n){n.length===4&&(n=n[0]+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e||console.warn(`Unable to convert hex string ${n} to rgb values`),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}function ES(n){return n=parseInt(n),[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]}function Up(n){return n===void 0?[0,0,0]:arguments.length===3?arguments:isNaN(n)?n[0]==="#"?zp(n):kp[n.toLowerCase()]?zp(kp[n.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0]):ES(n)}function Kl(n){var e=n.toString(16);return e.length==1?"0"+e:e}function TS(n,e,t){return"#"+Kl(n)+Kl(e)+Kl(t)}class R extends Array{constructor(e){return Array.isArray(e)?super(...e):super(...Up(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}getHex(){return TS(Math.round(this[0]*255),Math.round(this[1]*255),Math.round(this[2]*255))}getRGBA(){return[this[0],this[1],this[2],1]}set r(e){this[0]=e}set g(e){this[1]=e}set b(e){this[2]=e}set(e){return Array.isArray(e)?this.copy(e):this.copy(Up(...arguments))}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this}}class et{constructor(e,t){fe(this,"gl");fe(this,"scene");fe(this,"firstdrawResolve");this.gl=e,this.scene=t,this.firstDrawResolve=!1}getFirstDrawPromise(){const e=new Promise(t=>{this.firstDrawResolve=t});return this.scene.pendingReadyMeshes.push(this),e}drawInit(){this.mesh.visible=!0,this.scene.renderer.render({scene:this.mesh,camera:this.scene.camera,clear:!1,frustumCull:!0,sort:!1}),this.gl.finish(),this.firstdrawResolve||(this.firstdrawResolve=!0,requestAnimationFrame(()=>{this.firstDrawResolve(this)}))}}class MS extends et{constructor(e,{parent:t=null,scale:i=1,blendFunc:s={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},transparent:r=!0,depthTest:o=!0,shaderId:c="lightPlane",depthWrite:p=!0,textureId:m=null,renderOrder:_=0,forceRenderOrder:v=!1,alpha:g=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.parent=t||e.root,this.scale=i,this.transparent=r,this.blendFunc=s,this.depthTest=o,this.depthWrite=p,this.shaderId=c,this.textureId=m,this.renderOrder=_,this.forceRenderOrder=v,this.texture=new be(this.gl),this.alpha=g,this.defines={},this.config={colorTop:{value:"#ffffff",params:{}},colorBottom:{value:"#ffffff",params:{}},opacity:{value:1,params:{min:0,max:1,step:.01}},gradientRatio:{value:1,params:{min:0,max:4,step:.01}}},this.gui=ie.addBlade(this.config,"Light Plane",1),this.colorTop=new R(this.config.colorTop.value),this.colorBottom=new R(this.config.colorBottom.value),this.init()}init(){this.geometry=new vi(this.gl),this.textureId&&(this.defines.HAS_COLORMAP=!0),this.shader=new ve(ce[this.shaderId],1,this.defines),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:{uTexture:{value:this.texture},uTime:{value:this.scene.time},uAlpha:{value:this.alpha},uColorTop:{value:this.colorTop},uColorBottom:{value:this.colorBottom},uGradientRatio:{value:this.config.gradientRatio.value},uRez:{value:[this.scene.width,this.scene.height]}}}),this.program.cullFace=!1,this.program.setBlendFunc(this.blendFunc.src,this.blendFunc.dst),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,forceRenderOrder:this.forceRenderOrder,renderOrder:this.renderOrder}),this.mesh.name="light_plane_mesh",this.mesh.scale.set(this.scale,this.scale,this.scale),this.mesh.setParent(this.parent),this.mesh._entity=this}onLoaded(){this.textureId&&(this.texture=this.scene.textureLoader.getTexture(this.textureId),this.texture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.texture)}preRender(){this.mesh&&(this.colorTop.set(this.config.colorTop.value),this.colorBottom.set(this.config.colorBottom.value),this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uAlpha.value=this.alpha*this.config.opacity.value,this.program.uniforms.uColorTop.value=this.colorTop,this.program.uniforms.uColorBottom.value=this.colorBottom,this.program.uniforms.uGradientRatio.value=this.config.gradientRatio.value,this.program.uniforms.uRez.value=[this.scene.width,this.scene.height])}dispose(){this.mesh.setParent(null),this.geometry&&this.geometry.remove(),this.mesh&&delete this.mesh}}function BS(n,e){return n[0]=e[0],n[1]=e[1],n}function PS(n,e,t){return n[0]=e,n[1]=t,n}function Hp(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function Gp(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function IS(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n}function RS(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n}function Jl(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function OS(n,e){var t=e[0]-n[0],i=e[1]-n[1];return Math.sqrt(t*t+i*i)}function FS(n,e){var t=e[0]-n[0],i=e[1]-n[1];return t*t+i*i}function Vp(n){var e=n[0],t=n[1];return Math.sqrt(e*e+t*t)}function DS(n){var e=n[0],t=n[1];return e*e+t*t}function LS(n,e){return n[0]=-e[0],n[1]=-e[1],n}function NS(n,e){return n[0]=1/e[0],n[1]=1/e[1],n}function kS(n,e){var t=e[0],i=e[1],s=t*t+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=e[0]*s,n[1]=e[1]*s,n}function zS(n,e){return n[0]*e[0]+n[1]*e[1]}function Wp(n,e){return n[0]*e[1]-n[1]*e[0]}function US(n,e,t,i){var s=e[0],r=e[1];return n[0]=s+i*(t[0]-s),n[1]=r+i*(t[1]-r),n}function HS(n,e,t){var i=e[0],s=e[1];return n[0]=t[0]*i+t[3]*s+t[6],n[1]=t[1]*i+t[4]*s+t[7],n}function GS(n,e,t){let i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}function VS(n,e){return n[0]===e[0]&&n[1]===e[1]}class wt extends Array{constructor(e=0,t=e){return super(e,t),this}get x(){return this[0]}get y(){return this[1]}set x(e){this[0]=e}set y(e){this[1]=e}set(e,t=e){return e.length?this.copy(e):(PS(this,e,t),this)}copy(e){return BS(this,e),this}add(e,t){return t?Hp(this,e,t):Hp(this,this,e),this}sub(e,t){return t?Gp(this,e,t):Gp(this,this,e),this}multiply(e){return e.length?IS(this,this,e):Jl(this,this,e),this}divide(e){return e.length?RS(this,this,e):Jl(this,this,1/e),this}inverse(e=this){return NS(this,e),this}len(){return Vp(this)}distance(e){return e?OS(this,e):Vp(this)}squaredLen(){return this.squaredDistance()}squaredDistance(e){return e?FS(this,e):DS(this)}negate(e=this){return LS(this,e),this}cross(e,t){return t?Wp(e,t):Wp(this,e)}scale(e){return Jl(this,this,e),this}normalize(){return kS(this,this),this}dot(e){return zS(this,e)}equals(e){return VS(this,e)}applyMatrix3(e){return HS(this,this,e),this}applyMatrix4(e){return GS(this,this,e),this}lerp(e,t){return US(this,this,e,t),this}clone(){return new wt(this[0],this[1])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e}}const mr=new q;class WS{constructor(e,{parent:t=null,scale:i=1,blendFunc:s={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},transparent:r=!0,depthTest:o=!0,shaderId:c="unlit",textureIds:p={mobile:null,desktop:null},depthWrite:m=!0,color:_=Ge(0,0,0),renderOrder:v=0,alpha:g=1}={}){this.gl=e.gl,this.scene=e,this.parent=t||e.root,this.scale=i,this.transparent=r,this.blendFunc=s,this.depthTest=o,this.depthWrite=m,this.shaderId=c,this.textureIds=p,this.renderOrder=v,this.textureDesktop=new be(this.gl),this.textureMobile=new be(this.gl),this.alpha=g,this.color=_,this.defines={},this.config={zoom:{value:.23,params:{min:0,max:.99,step:.01}},movementAmplitude:{value:{x:.01,y:.005},params:{x:{min:0,max:.02,step:1e-4},y:{min:0,max:.01,step:1e-4}}}},this.gui=ie.addBlade(this.config,"Background",1),this.movementAmplitude=new wt(this.config.movementAmplitude.value.x,this.config.movementAmplitude.value.y),ie.active&&(this.addCustomTextureUpload("uTextureDesktop"),this.addCustomTextureUpload("uTextureMobile")),this.init()}addCustomTextureUpload(e="uTextureDesktop"){const t=document.createElement("input");t.type="file",t.classList.add("input-file"),ie.getGui("Background").addButton({title:e,label:"Upload texture",index:1}).on("click",()=>{t.click()}),t.addEventListener("change",r=>{const o=t.files[0],c=new Image;c.onload=()=>{const p=this.scene.textureLoader.initTexture(c,["flipY"]);this.program.uniforms[e].value=p,URL.revokeObjectURL(c.src)},o&&(c.src=URL.createObjectURL(o))})}init(){this.geometry=new vi(this.gl),this.textureIds.mobile&&this.textureIds.desktop&&(this.defines.HAS_COLORMAP=!0),this.shader=new ve(ce[this.shaderId],1,this.defines),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:{uTextureDesktop:{value:this.textureDesktop},uTextureMobile:{value:this.uTextureMobile},uTime:{value:this.scene.time},uAlpha:{value:this.alpha},uColor:{value:this.color},uRez:{value:[this.scene.width,this.scene.height]},uAspectRatio:{value:this.scene.width/this.scene.height},uTextureAspectRatio:{value:this.scene.width<this.scene.height?9/16:16/9},uZoom:{value:1-this.config.zoom.value},uCameraPosition:{value:new q},uCameraAmplitude:{value:this.movementAmplitude},uDeviceTexturesMix:{value:0}}}),this.program.cullFace=!1,this.program.setBlendFunc(this.blendFunc.src,this.blendFunc.dst),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,renderOrder:this.renderOrder,forceRenderOrder:!0}),this.mesh.scale.set(this.scale,this.scale,this.scale),this.mesh.setParent(this.parent),this.mesh._entity=this}onLoaded(){this.textureIds.desktop&&(this.textureDesktop=this.scene.textureLoader.getTexture(this.textureIds.desktop),this.textureDesktop.needsUpdate=!0,this.program.uniforms.uTextureDesktop.value=this.textureDesktop),this.textureIds.mobile&&(this.textureMobile=this.scene.textureLoader.getTexture(this.textureIds.mobile),this.textureMobile.needsUpdate=!0,this.program.uniforms.uTextureMobile.value=this.textureMobile),this.resize()}resize(){if(this.program){const e=this.scene.width<this.scene.height;this.program.uniforms.uTextureAspectRatio.value=e?9/16:16/9,this.program.uniforms.uDeviceTexturesMix.value=e?1:0}}preRender(){Array.isArray(this.config.movementAmplitude.value)?this.movementAmplitude.set(this.config.movementAmplitude.value[0],this.config.movementAmplitude.value[1]):this.movementAmplitude.set(this.config.movementAmplitude.value.x,this.config.movementAmplitude.value.y),this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uAlpha.value=this.alpha,this.program.uniforms.uColor.value=this.color,this.program.uniforms.uRez.value=[this.scene.width,this.scene.height],this.program.uniforms.uAspectRatio.value=this.scene.width/this.scene.height,this.program.uniforms.uZoom.value=1-this.config.zoom.value,this.program.uniforms.uCameraAmplitude.value=this.movementAmplitude,mr.copy(this.scene.cameraContainer.position),mr.x+=this.scene.camera.rotation.x*50,mr.y+=this.scene.camera.rotation.y*50,this.program.uniforms.uCameraPosition.value=mr}dispose(){this.mesh.setParent(null),this.geometry.remove(),this.program.remove()}}class jS{constructor(){this.params={},this.guis={},this._emitter={},ya(this._emitter),this.on=this._emitter.on.bind(this._emitter)}addPBRMaterial(e,t){if(this.params[e]!==void 0)return this.params[e];this.params[e]={albedoColor:{value:"#ffffff",params:{}},IBL:{value:.5,params:{min:0,max:10,step:.01}},NormalScale:{value:1,params:{min:0,max:2,step:.01}},MetalicFactor:{value:1,params:{min:0,max:2,step:.01}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01}},EmissiveColor:{value:"#ffffff",params:{}},EmissivePower:{value:1,params:{min:0,max:5,step:.01}},OcclusionFactor:{value:1,params:{min:0,max:3,step:.01}},ShadowFactor:{value:.6,params:{min:0,max:1,step:.01}},SheenColor:{value:"#ffffff",params:{}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01}},SheenDepth:{value:2,params:{min:1,max:8,step:.1}},Alpha:{value:1,params:{min:0,max:1,step:.01}},Tint:{value:"#ffffff",params:{}},TintOpacity:{value:0,params:{min:0,max:1,step:.01}},Exposure:{value:0,params:{min:-2,max:2,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},Saturation:{value:1,params:{min:0,max:2,step:.01}}},this.guis[e]=ie.addBlade(this.params[e],`${e} PBR`,t);let i=_e.materials[e];return i&&ie.active&&(i.albedoMap&&this.addTextureUpload(e,"albedoMap"),i.ORMTexture&&this.addTextureUpload(e,"ORMTexture"),i.metallicRoughnessTexture&&this.addTextureUpload(e,"metallicRoughnessTexture"),i.normalTexture&&this.addTextureUpload(e,"normalTexture"),i.emissiveTexture&&this.addTextureUpload(e,"emissiveTexture"),i.occlusionTexture&&this.addTextureUpload(e,"occlusionTexture"),i.shadowTexture&&this.addTextureUpload(e,"shadowTexture")),this.params[e]}getPBRMaterialParams(e,t){return this.params[e]!==void 0?this.params[e]:(this.params[e]={albedoColor:{value:"#ffffff",params:{}},IBL:{value:.5,params:{min:0,max:10,step:.01}},NormalScale:{value:1,params:{min:0,max:2,step:.01}},MetalicFactor:{value:.75,params:{min:0,max:2,step:.01}},RoughnessFactor:{value:.75,params:{min:0,max:3,step:.01}},EmissiveColor:{value:"#ffffff",params:{}},EmissivePower:{value:1,params:{min:0,max:5,step:.01}},OcclusionFactor:{value:1,params:{min:0,max:1,step:.01}},SheenColor:{value:"#ffffff",params:{}},SheenOpacity:{value:1,params:{min:0,max:1,step:.01}},SheenDepth:{value:2,params:{min:1,max:8,step:.1}},Alpha:{value:1,params:{min:0,max:1,step:.01}},Tint:{value:"#ffffff",params:{}},TintOpacity:{value:0,params:{min:0,max:1,step:.01}},Exposure:{value:0,params:{min:-2,max:2,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},Saturation:{value:1,params:{min:0,max:2,step:.01}}},this.params[e])}addTextureUpload(e,t="albedoMap"){const i=document.createElement("input");i.type="file",i.classList.add("input-file"),ie.getPBRGui(e).addButton({title:t,label:"Upload texture",index:1}).on("click",()=>{i.click()}),i.addEventListener("change",o=>{const c=i.files[0],p=new Image;p.onload=()=>{this._emitter.emit("texture-upload",{image:p,matName:e,title:t}),URL.revokeObjectURL(p.src)},c&&(p.src=URL.createObjectURL(c))})}addUnlitMaterial(e,t,i){return this.params[e]!==void 0?this.params[e]:(this.params[e]={Tint:{value:"#ffffff",params:{}},TintOpacity:{value:0,params:{min:0,max:1,step:.01}},Exposure:{value:0,params:{min:-2,max:3,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},Saturation:{value:1,params:{min:0,max:2,step:.01}},SheenColor:{value:"#ffffff",params:{}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01}},SheenDepth:{value:2,params:{min:1,max:10,step:.1}}},this.guis[e]=ie.addBlade(this.params[e],`${e} ${i&&i.sheen!==void 0?"FRESNEL":"UNLIT"}`,t),this.params[e])}getUnlitMaterialParams(e,t,i){return this.params[e]!==void 0?this.params[e]:(this.params[e]={Tint:{value:"#ffffff",params:{}},TintOpacity:{value:0,params:{min:0,max:1,step:.01}},Exposure:{value:0,params:{min:-2,max:3,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},Saturation:{value:1,params:{min:0,max:2,step:.01}},SheenColor:{value:"#ffffff",params:{}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01}},SheenDepth:{value:2,params:{min:1,max:10,step:.1}}},this.params[e])}getGui(e){return this.guis[e]?this.guis[e]:null}}const Qe=new jS;function KS(n){return n!=null}class JS extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,depthWrite:C=!0,renderOrder:S=0,forceRenderOrder:E=!1,separatedEmissive:T=!1,globalConfig:M=null,fog:W=!0,alpha:B=1,shaderId:O="unlit"}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=C,this.videoTexture=null,this.video=null,this.fog=W,this.renderOrder=S,this.forceRenderOrder=E,this.separatedEmissive=T,this.groupId=r,this.geom={},this.materialName=_,this.materialInfos=_,this.globalConfig=M,this.alpha=B,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.shaderId=O,this.getDataFromGltf(),this.initConfig(),this.init()}getDataFromGltf(){this.geom={options:{}};const e=this.data.primitives,t=this.node;t.rotation&&(this.transform.quaternion.x=t.rotation[0],this.transform.quaternion.y=t.rotation[1],this.transform.quaternion.z=t.rotation[2],this.transform.quaternion.w=t.rotation[3]),t.scale&&Xe(this.transform.scale,t.scale),t.translation&&Xe(this.transform.position,t.translation);for(let s=0;s<e.length;s++){var i=e[Object.keys(e)[s]];for(let r in i.attributes)switch(r){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let r in i.attributes)this.getAccessorData(i.attributes[r],r);this.getAccessorData(i.indices,"INDEX")}}getAccessorData(e,t){if(this.gltf.isDracoCompressed){const g=e.value;switch(t){case"POSITION":this.geom.vertices=g,this.geom.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}return}const i=this.gltf.accessors[e],s=this.gltf.bufferViews[i.bufferView],r=this.gltf.bin;let o=null;s&&s.byteStride&&(o=s.byteStride);const p=KS(s.byteOffset)?s.byteOffset:0,m=p+s.byteLength,_=r.slice(p,m);let v;switch(i.componentType===5126?v=new Float32Array(_):i.componentType===5123?v=new Uint16Array(_):i.componentType===5125?v=new Uint32Array(_):console.warn("no type defined for this componentType:",i.componentType),v||console.warn("no data",e,t,v),t){case"POSITION":this.geom.vertices=v,this.geom.verticesAccessor=i,this.geom.options.vertices={byteStride:o,byteOffset:0};break;case"NORMAL":this.geom.normals=v,this.geom.normalsAccessor=i,this.geom.options.normals={byteStride:o,byteOffset:12};break;case"TANGENT":this.geom.tangents=v,this.geom.tangentsAccessor=i,this.geom.options.tangents={byteStride:o,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=v,this.geom.uvsAccessor=i,this.geom.options.uvs={byteStride:o,byteOffset:24};break;case"INDEX":this.geom.indices=v,this.geom.indicesAccessor=i,this.geom.options.indices={byteStride:o,byteOffset:s.byteOffset?s.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}}initConfig(){this.config=Qe.getUnlitMaterialParams(this.materialName,this.groupId,this.materialInfos),this.gui=Qe.getGui(this.materialName);const e={speed:{value:.25+Math.random()*.1,params:{min:0,max:4,step:.01}},direction:{value:{x:-1.7+Math.random()*.3,y:-1.1-Math.random()*.3},params:{x:{max:5,min:-5,step:.1},y:{max:5,min:-5,step:.1}}},fbmAddFactor:{value:1.19,params:{min:0,max:2,step:.01}},fbmMixFactor:{value:1.58,params:{min:0,max:4,step:.01}},fbmScale:{value:.16,params:{min:0,max:1.2,step:.01}}};this.config={...this.config,...e},this.cloudDirection=new wt(this.config.direction.value.x,this.config.direction.value.y),this.gui=ie.addBlade(this.config,this.name,1)}init(){const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},index:{data:this.geom.indices}};this.geometry=new ht(this.gl,e);let t={uTime:{value:this.scene.time},uAlpha:{value:this.alpha},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position}};this.defines.HAS_COLOR_CORRECTION=1,t=Object.assign(t,{uTint:{value:new R(this.config.Tint.value)},uTintOpacity:this.config.TintOpacity,uExposure:this.config.Exposure,uContrast:this.config.Contrast,uSaturation:this.config.Saturation,uSpeed:{value:this.config.speed.value},uDirection:{value:this.cloudDirection},uFBMAddFactor:{value:this.config.fbmAddFactor.value},uFBMMixFactor:{value:this.config.fbmMixFactor.value},uFBMScale:{value:this.config.fbmScale.value}}),this.scene.textureLoader.isTextureRegistered(`${this.textureId}`)?(this.defines.HAS_COLORMAP=1,this.texture=new be(this.gl),t=Object.assign(t,{uTexture:{value:this.texture}})):t=Object.assign(t,{uColor:{value:new R(this.materialInfos.color)}}),this.scene.textureLoader.isTextureRegistered("fbm1")&&(this.defines.HAS_FBMMAP=1,this.fbmTexture=new be(this.gl),t=Object.assign(t,{uFBMSampler:{value:this.shader}})),this.scene.textureLoader.isTextureRegistered(`${this.textureId}_Opacity`)&&(this.defines.HAS_ALPHAMAP=1,this.alphaTexture=new be(this.gl),this.transparent=!0,t=Object.assign(t,{uAlphaTexture:{value:this.alphaTexture}})),this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,t=Object.assign(t,{uFogColor:{value:new R(this.globalConfig.FogColorClouds.value)},uFogNear:{value:this.globalConfig.FogNear.value},uFogFar:{value:this.globalConfig.FogFar.value}})),this.shader=new ve(ce[this.shaderId],1,this.defines),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:t}),this.materialInfos&&this.materialInfos.cullface!==void 0&&(this.materialInfos.cullface==!1?this.program.cullFace=!1:this.program.cullFace=this.gl[this.materialInfos.cullface]),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,renderOrder:this.renderOrder,forceRenderOrder:this.forceRenderOrder,transform:this.transform}),this.mesh.name=this.name,this.mesh._entity=this,this.createEmissiveMesh(),this.mesh.setParent(this.parent),this.mesh.updateMatrixWorld(!0),this.parent.updateMatrixWorld(!0)}createEmissiveMesh(){if(this.separatedEmissive)this.emissiveShader=new ve(ce[this.shaderId],1,Object.assign(this.defines,{SEPARATED_EMISSIVE:!0})),this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:this.localState.uniforms});else{this.emissiveShader=new ve(ce.basicOcculter,1,{});let e={uTime:{value:this.scene.time},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position},uColor:{value:[1,0,0]}};this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:e})}this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.mesh),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this}updateMeshScaleFromTexture(){this.texture&&this.texture.image&&(this.mesh.scale.x*=this.texture.image.width/this.texture.image.height)}onLoaded(){this.texture&&(this.texture=this.scene.textureLoader.getTexture(this.textureId),this.texture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.texture,this.updateMeshScaleFromTexture()),this.alphaTexture&&(this.alphaTexture=this.scene.textureLoader.getTexture(`${this.textureId}_Opacity`),this.alphaTexture.needsUpdate=!0,this.program.uniforms.uAlphaTexture.value=this.alphaTexture),this.fbmTexture&&(this.fbmTexture=this.scene.textureLoader.getTexture("fbm1"),this.fbmTexture.needsUpdate=!0,this.program.uniforms.uFBMSampler.value=this.fbmTexture)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uAlpha.value=this.alpha,this.program.uniforms.uTint.value=new R(this.config.Tint.value),this.defines.HAS_FOG!==void 0&&(this.program.uniforms.uFogColor.value=new R(this.globalConfig.FogColorClouds.value),this.program.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.program.uniforms.uFogFar.value=this.globalConfig.FogFar.value),this.program.uniforms.uCamera.value=this.scene.camera.position,this.video&&this.video.currentTime>0&&this.video.readyState>=this.video.HAVE_ENOUGH_DATA&&(this.videoTexture.image||(this.videoTexture.image=this.video),this.videoTexture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.videoTexture),Array.isArray(this.config.direction.value)?this.cloudDirection.set(this.config.direction.value[0],this.config.direction.value[1]):this.cloudDirection.set(this.config.direction.value.x,this.config.direction.value.y),this.program.uniforms.uSpeed.value=this.config.speed.value,this.program.uniforms.uDirection.value=this.cloudDirection,this.program.uniforms.uFBMAddFactor.value=this.config.fbmAddFactor.value,this.program.uniforms.uFBMMixFactor.value=this.config.fbmMixFactor.value,this.program.uniforms.uFBMScale.value=this.config.fbmScale.value}}_t();_t();on();on();on();const Ni=_t();class $l extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,shaderId:C="standard",depthWrite:S=!0,letters:E=!1,offsetPosition:T=[0,0,0],separatedEmissive:M=!1,renderOrder:W=0,globalConfig:B=null,fog:O=!0,progress:L=0,alpha:H=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=S,this.separatedEmissive=M,this.videoTexture=null,this.video=null,this.fog=O,this.renderOrder=W,this.progress=L,this.groupId=r,this.shaderId=C,this.geom={},this.materialName=_,this.globalConfig=B,this.alpha=H,this.offsetPosition=T,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.geomData=t,this.lastEnv=null,this.lastEnvDiffuse=null,this.isLetters=E,this.localState={uniforms:{}},this.normalMatrix=ut(),this.MVPMatrix=ut(),this.maxTextureIndex=0,this.defines={},this.defines.USE_IBL=1,this.defines.MANUAL_SRGB=1,this.defines.HAS_NORMALS=1,this.defines.HAS_UV=1,this.isLetters&&(this.defines.IS_LETTERS=!0),this.getDataFromGltf(),this.mergeGeoms(),this.initConfig(),this.initTextures(),this.cleanConfig(),this.createUniforms(),this.init()}getDataFromGltf(){this.geoms=[];for(let t=0;t<this.data.length;t++){const i=this.data[t],s=this.data[t].node,r=new Le,o={options:{}},c=i.meshData.primitives;s.rotation&&(r.quaternion.x=s.rotation[0],r.quaternion.y=s.rotation[1],r.quaternion.z=s.rotation[2],r.quaternion.w=s.rotation[3]),s.scale&&Xe(r.scale,s.scale),s.translation&&Xe(r.position,s.translation),r.position.x+=this.offsetPosition[0],r.position.y+=this.offsetPosition[1],r.position.z+=this.offsetPosition[2],o.transform=r;for(let p=0;p<c.length;p++){var e=c[Object.keys(c)[p]];for(let m in e.attributes)switch(m){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let m in e.attributes)this.getAccessorData(o,e.attributes[m],m);this.getAccessorData(o,e.indices,"INDEX")}this.geoms.push(o)}}getAccessorData(e,t,i){if(this.gltf.isDracoCompressed){const C=t.value;switch(i){case"POSITION":e.vertices=C,e.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":e.normals=C,e.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":e.tangents=C,e.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":e.uvs=C,e.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":e.indices=C,e.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+i)}return}const s=this.gltf.accessors[t],r=this.gltf.bufferViews[s.bufferView],o=this.gltf.bin;let c=null;r&&r.byteStride&&(c=r.byteStride);const m=defined(r.byteOffset)?r.byteOffset:0,_=m+r.byteLength,v=o.slice(m,_);let g;switch(s.componentType===5126?g=new Float32Array(v):s.componentType===5123?g=new Uint16Array(v):s.componentType===5125?g=new Uint32Array(v):console.warn("no type defined for this componentType:",s.componentType),g||console.warn("no data",t,i,g),i){case"POSITION":this.geom.vertices=g,this.geom.verticesAccessor=s,this.geom.options.vertices={byteStride:c,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.normalsAccessor=s,this.geom.options.normals={byteStride:c,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.tangentsAccessor=s,this.geom.options.tangents={byteStride:c,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.uvsAccessor=s,this.geom.options.uvs={byteStride:c,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.indicesAccessor=s,this.geom.options.indices={byteStride:c,byteOffset:r.byteOffset?r.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+i)}}initConfig(){this.config=Qe.addPBRMaterial(this.materialName,this.groupId),this.gui=Qe.getGui(this.materialName),this.extraConfig={mappedIntroOffset:{value:-1e8,params:{step:10}},progress:{value:0,params:{min:0,max:1}}},this.extraGui=ie.addBlade(this.extraConfig,"Intro Rock",1),this.extraGui&&this.extraGui.progress.on("change",e=>{this.progress=e.value})}cleanConfig(){!this.gui||(this.defines.HAS_NORMALMAP==null&&(this.gui.NormalScale.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&this.defines.HAS_ORM_MAP==null&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_EMISSIVECOLOR==null&&(this.gui.EmissiveColor.hidden=!0,this.gui.EmissivePower.hidden=!0),this.defines.HAS_SHEEN==null&&(this.gui.SheenColor.hidden=!0,this.gui.SheenOpacity.hidden=!0,this.gui.SheenDepth.hidden=!0))}mergeGeoms(){const e=[];let t=0;const i=[],s=[],r=[],o=[],c=[];for(let p=0;p<this.geoms.length;p++){const m=this.geoms[p];let _=0;for(let g=0;g<m.indices.length;g++){const C=m.indices[g];C>_&&(_=C),e.push(C+t)}t+=_+1;let v=[Math.random(),Math.random(),Math.random()];for(let g=0;g<m.vertices.length/3;g++)Jd(Ni,m.vertices[g*3+0],m.vertices[g*3+1],m.vertices[g*3+2]),m.transform.updateMatrix(),m.transform.updateMatrixWorld(),Dg(Ni,Ni,m.transform.matrix),i.push(m.transform.position.x),i.push(m.transform.position.y),i.push(m.transform.position.z),o.push(Ni[0]),o.push(Ni[1]),o.push(Ni[2]),s.push(v[0]),s.push(v[1]),s.push(v[2]),c.push(m.normals[g*3+0]),c.push(m.normals[g*3+1]),c.push(m.normals[g*3+2]);for(let g=0;g<m.uvs.length/2;g++)r.push(m.uvs[g*2+0]),r.push(m.uvs[g*2+1])}this.geom={vertices:new Float32Array(o),uvs:new Float32Array(r),normals:new Float32Array(c),centroids:new Float32Array(i),seeds:new Float32Array(s),indices:new Uint16Array(e)}}init(){this.environement=this.globalConfig.Environment.value,this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.lightColor=new R(this.globalConfig.lightColor.value),this.shader=new ve(ce[this.shaderId],1,this.defines);const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normals},centroids:{size:3,data:this.geom.centroids},seeds:{size:3,data:this.geom.seeds},index:{data:this.geom.indices}};if(this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,cullFace:!1,uniforms:this.localState.uniforms}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,transform:this.transform,frustumCulled:!1}),this.mesh.setParent(this.parent),this.mesh._entity=this,this.separatedEmissive){this.emissiveShader=new ve(ce.mergedOcculter,1,{});let t={uTime:{value:this.scene.time},uProgress:{value:0},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position},uColor:{value:[1,0,0]},uMappedIntroOffset:{value:this.extraConfig.mappedIntroOffset.value}};this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:t}),this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.parent),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this}}getImageInfo(e,t,i){this.localState.uniforms[i]={type:t,uri:e,textIndx:this.maxTextureIndex},this.maxTextureIndex++}initTextures(){const e=this.gl;this.gltf;let t=null;_e.materials[this.materialName]?t=_e.materials[this.materialName]:console.warn("material undefined:",this.materialName),this.config.IBL.value=t&&t.IBL?t.IBL:this.config.IBL.value,this.localState.uniforms.uDiffuseEnvSampler={type:"texture",uri:"env_diffuse",textIndx:this.maxTextureIndex},this.maxTextureIndex++,this.localState.uniforms.uSpecularEnvSampler={type:"texture",uri:"env_default",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.Alpha&&(this.config.Alpha.value=t.Alpha),this.localState.uniforms.uUvScale={type:"float1",value:t&&t.UvScale?t.UvScale:1};var i=t&&t.albedoColor?new R(t.albedoColor).getRGBA():[1,1,1,1];if(this.config.albedoColor.value=t&&t.albedoColor?t.albedoColor:new R(i).getHex(),this.localState.uniforms.uBaseColorFactor={type:"float4",value:i},t&&t.albedoMap?(this.getImageInfo(t.albedoMap,"texture","uBaseColorSampler"),this.defines.HAS_BASECOLORMAP=1):this.localState.uniforms.uBaseColorSampler&&delete this.localState.uniforms.uBaseColorSampler,t&&t.alphaTexture&&(this.getImageInfo(t.alphaTexture,"texture","uAlphaMapSampler"),this.defines.HAS_ALPHAMAP=1),this.config.MetalicFactor.value=t&&typeof t.MetalicFactor=="number"?t.MetalicFactor:this.config.MetalicFactor.value,this.config.RoughnessFactor.value=t&&typeof t.RoughnessFactor=="number"?t.RoughnessFactor:this.config.RoughnessFactor.value,this.localState.uniforms.uMetallicRoughnessValues={type:"float2",value:[this.config.MetalicFactor.value,this.config.RoughnessFactor.value]},t&&t.metallicRoughnessTexture?(this.getImageInfo(t.metallicRoughnessTexture,"texture","uMetallicRoughnessSampler",e.RGBA),this.defines.HAS_METALROUGHNESSMAP=1):this.localState.uniforms.uMetallicRoughnessSampler&&delete this.localState.uniforms.uMetallicRoughnessSampler,t&&t.ORMTexture?(this.getImageInfo(t.ORMTexture,"texture","uOcclusionRoughnessMetallicSampler",e.RGBA),this.defines.HAS_ORM_MAP=1,this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value}):this.localState.uniforms.uOcclusionRoughnessMetallicSampler&&delete this.localState.uniforms.uOcclusionRoughnessMetallicSampler,t&&t.normalTexture?(this.getImageInfo(t.normalTexture,"texture","uNormalSampler",e.RGBA),this.config.NormalScale.value=t.NormalScale?t.NormalScale:this.config.NormalScale.value,this.localState.uniforms.uNormalScale={type:"float1",value:this.config.NormalScale.value},this.defines.HAS_NORMALMAP=1):this.localState.uniforms.uNormalSampler&&delete this.localState.uniforms.uNormalSampler,this.localState.uniforms.uBrdfLUT={type:"texture",uri:"brdfLUT",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.emissiveTexture){this.getImageInfo(t.emissiveTexture,"texture","uEmissiveSampler"),this.defines.HAS_EMISSIVEMAP=1;var s=t.emissiveFactor?t.emissiveFactor:[0,0,0];this.globalConfig.emissiveColor.value=new R(s).getHex(),this.localState.uniforms.uEmissiveColor={type:"float3",value:s}}else this.localState.uniforms.uEmissiveSampler&&delete this.localState.uniforms.uEmissiveSampler;if(t&&t.emissiveColor){this.defines.HAS_EMISSIVECOLOR=1;var r=t.emissiveColor?new R(t.emissiveColor):[0,0,0];this.config.EmissivePower.value=typeof t.emissivePower=="number"?t.emissivePower:1,this.config.EmissiveColor.value=t.emissiveColor,this.localState.uniforms.uEmissiveColor={type:"float3",value:r},this.localState.uniforms.uEmissivePower={type:"float1",value:this.config.EmissivePower.value}}if(t&&t.occlusionTexture?(this.getImageInfo(t.occlusionTexture,"texture","uOcclusionSampler"),this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value},this.defines.HAS_OCCLUSIONMAP=1):this.localState.uniforms.uOcclusionSampler&&delete this.localState.uniforms.uOcclusionSampler,t&&t.sheenColor){var o=t.sheenColor?new R(t.sheenColor):[1,1,1],c=t.sheenOpacity?t.sheenOpacity:1,p=t.sheenDepth?t.sheenDepth:2;this.localState.uniforms.uSheenColor={type:"float3",value:o},this.localState.uniforms.uSheenOpacity={type:"float1",value:c},this.localState.uniforms.uSheenDepth={type:"float1",value:p},this.config.SheenColor.value=t.sheenColor,this.config.SheenOpacity.value=c,this.config.SheenDepth.value=p,this.defines.HAS_SHEEN=1}this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,this.localState.uniforms.uFogColor={type:"float3",value:new R(this.globalConfig.FogColor.value)},this.localState.uniforms.uFogNear={type:"float1",value:this.globalConfig.FogNear.value},this.localState.uniforms.uFogFar={type:"float1",value:this.globalConfig.FogFar.value})}createUniforms(){this.localState.uniforms.uTime={type:"float1",value:0},this.localState.uniforms.uAlpha={type:"float1",value:1},this.localState.uniforms.uProgress={type:"float1",value:1},this.localState.uniforms.uLightDirection={type:"float3",value:[0,.5,.5]},this.localState.uniforms.uLightColor={type:"float3",value:[1,1,1]},this.localState.uniforms.uScaleDiffBaseMR={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleFGDSpec={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleIBLAmbient={type:"float4",value:[1.5,1.5,0,0]},this.localState.uniforms.uCamera={type:"float3",value:[0,0,0]},this.defines.HAS_COLOR_CORRECTION=1,this.localState.uniforms.uTint={type:"float3",value:[1,1,1]},this.localState.uniforms.uTintOpacity={type:"float1",value:0},this.localState.uniforms.uExposure={type:"float1",value:0},this.localState.uniforms.uContrast={type:"float1",value:0},this.localState.uniforms.uSaturation={type:"float1",value:0},this.localState.uniforms.uMappedIntroOffset={type:"float1",value:this.extraConfig.mappedIntroOffset.value};for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=new be(this.gl))}onLoaded(){for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=this.scene.textureLoader.getTexture(this.localState.uniforms[e].uri),this.localState.uniforms[e].value.needsUpdate=!0)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.needsUpdate=!0,this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.lightColor.set(this.globalConfig.lightColor.value),this.localState.uniforms.uLightColor.value=[this.lightColor[0]*this.globalConfig.lightPower.value,this.lightColor[1]*this.globalConfig.lightPower.value,this.lightColor[2]*this.globalConfig.lightPower.value],this.localState.uniforms.uScaleIBLAmbient.value=[this.config.IBL.value*this.globalConfig.IBLDiffuseFactor.value,this.config.IBL.value*this.globalConfig.IBLSpecularFactor.value,0,0];const e=this.globalConfig.Debug.value;this.localState.uniforms.uScaleDiffBaseMR.value=[e=="mathDiff"?1:0,e=="baseColor"?1:0,e=="metallic"?1:0,e=="roughness"?1:0],this.localState.uniforms.uScaleFGDSpec.value=[e=="specRef"?1:0,e=="geomOcc"?1:0,e=="mcrfctDist"?1:0,e=="spec"?1:0],this.localState.uniforms.uMetallicRoughnessValues.value=[this.config.MetalicFactor.value,this.config.RoughnessFactor.value],this.localState.uniforms.uNormalScale&&(this.localState.uniforms.uNormalScale.value=this.config.NormalScale.value),this.localState.uniforms.uOcclusionStrength&&(this.localState.uniforms.uOcclusionStrength.value=this.config.OcclusionFactor.value);const t=new R(this.config.albedoColor.value);this.localState.uniforms.uBaseColorFactor.value=[t[0],t[1],t[2],this.config.Alpha.value*this.globalConfig.Alpha.value],this.localState.uniforms.uEmissiveColor&&(this.localState.uniforms.uEmissiveColor.value=new R(this.config.EmissiveColor.value)),this.localState.uniforms.uEmissivePower&&(this.localState.uniforms.uEmissivePower.value=this.config.EmissivePower.value),this.localState.uniforms.uSheenColor&&(this.localState.uniforms.uSheenOpacity.value=this.config.SheenOpacity.value,this.localState.uniforms.uSheenDepth.value=this.config.SheenDepth.value,this.localState.uniforms.uSheenColor.value=new R(this.config.SheenColor.value)),this.globalConfig.FogColor&&this.fog&&(this.localState.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.localState.uniforms.uFogFar.value=this.globalConfig.FogFar.value,this.localState.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.localState.uniforms.uCamera.value=this.scene.camera.position,this.environement=this.globalConfig.Environment.value,this.environement!==this.lastEnv&&(this.lastEnv=this.environement,this.localState.uniforms.uSpecularEnvSampler.value=this.scene.textureLoader.getTexture(this.environement),this.localState.uniforms.uSpecularEnvSampler.value.needsUpdate=!0),this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.diffuseEnvironement!==this.lastEnvDiffuse&&(this.lastEnvDiffuse=this.diffuseEnvironement,this.localState.uniforms.uDiffuseEnvSampler.value=this.scene.textureLoader.getTexture(this.diffuseEnvironement),this.localState.uniforms.uDiffuseEnvSampler.value.needsUpdate=!0),this.localState.uniforms.uTint.value=new R(this.config.Tint.value),this.localState.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.localState.uniforms.uExposure.value=this.config.Exposure.value,this.localState.uniforms.uContrast.value=this.config.Contrast.value,this.localState.uniforms.uSaturation.value=this.config.Saturation.value,this.localState.uniforms.uProgress.value=this.progress,this.separatedEmissive&&(this.emissiveProgram.uniforms.uColor.value=[0,0,0],this.emissiveProgram.uniforms.uProgress.value=this.progress,this.emissiveProgram.uniforms.uMappedIntroOffset.value=this.extraConfig.mappedIntroOffset.value),this.localState.uniforms.uMappedIntroOffset.value=this.extraConfig.mappedIntroOffset.value}dispose(){this.mesh.setParent(null),this.geometry&&this.geometry.remove(),this.mesh&&delete this.mesh,this.emissiveMesh&&delete this.emissiveMesh}}const Mn=on(),Bn=_t();class $S extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},shaderId:c="mergedUnlit",transparent:p=!1,depthTest:m=!0,depthWrite:_=!0,renderOrder:v=0,globalConfig:g=null,material:C=null,alpha:S=1,name:E="Merged Unlit",gltf:T=null,forceRenderOrder:M=!1,isLetters:W=!1,offsetPosition:B=[0,0,0]}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.parent=s||e.root,this.transparent=p,this.blendFunc=o,this.depthTest=m,this.shaderId=c,this.depthWrite=_,this.videoTexture=null,this.video=null,this.renderOrder=v,this.groupId=r,this.originalGeoms=t,this.transformedGeoms=[],this.materialInfos=C,this.globalConfig=g,this.alpha=S,this.textureId=i,this.defines={},this.name=E,this.seed=Math.random(),this.offsetPosition=B,this.gltf=T,this.forceRenderOrder=M,W&&(this.defines.IS_LETTERS=!0),this.initConfig(),this.getDataFromGltf(),this.mergeGeoms(),this.init(),this.cleanConfig()}initConfig(){this.config={Tint:{value:"#ffffff",params:{}},TintOpacity:{value:0,params:{min:0,max:1,step:.01}},NormalScale:{value:1,params:{min:0,max:3,step:.01}},Exposure:{value:0,params:{min:-2,max:3,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},Saturation:{value:1,params:{min:0,max:2,step:.01}},SheenColor:{value:"#ffffff",params:{}},SheenOpacity:{value:0,params:{min:0,max:1,step:.01}},SheenDepth:{value:2,params:{min:1,max:10,step:.1}}},this.gui=ie.addBlade(this.config,`${this.name} ${this.materialInfos&&this.materialInfos.sheen!==void 0?"FRESNEL":"UNLIT"}`,this.groupId)}cleanConfig(){!this.gui||this.defines.HAS_SHEEN==null&&(this.gui.SheenColor.hidden=!0,this.gui.SheenOpacity.hidden=!0,this.gui.SheenDepth.hidden=!0,this.gui.NormalScale.hidden=!0)}initVideoTexture(e){if(this.videoTexture!==null)return;this.videoTexture=new be(this.gl,{generateMipmaps:!1,width:1024,height:512});let t=document.createElement("video");t.crossOrigin="anonymous",t.src=e,t.loop=!0,t.muted=!0,this.video=t}getDataFromGltf(){this.transformedGeoms=[];for(let t=0;t<this.originalGeoms.length;t++){const i=this.originalGeoms[t],s=this.originalGeoms[t].node,r=new Le,o={options:{}},c=i.meshData.primitives;s.rotation&&(r.quaternion.x=s.rotation[0],r.quaternion.y=s.rotation[1],r.quaternion.z=s.rotation[2],r.quaternion.w=s.rotation[3]),s.scale&&Xe(r.scale,s.scale),s.translation&&Xe(r.position,s.translation),r.position.x+=this.offsetPosition[0],r.position.y+=this.offsetPosition[1],r.position.z+=this.offsetPosition[2],o.transform=r;for(let p=0;p<c.length;p++){var e=c[Object.keys(c)[p]];for(let m in e.attributes)switch(m){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let m in e.attributes)this.getAccessorData(o,e.attributes[m],m);this.getAccessorData(o,e.indices,"INDEX")}this.transformedGeoms.push(o)}}getAccessorData(e,t,i){if(this.gltf.isDracoCompressed){const C=t.value;switch(i){case"POSITION":e.vertices=C,e.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":e.normals=C,e.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":e.tangents=C,e.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":e.uvs=C,e.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":e.indices=C,e.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+i)}return}const s=this.gltf.accessors[t],r=this.gltf.bufferViews[s.bufferView],o=this.gltf.bin;let c=null;r&&r.byteStride&&(c=r.byteStride);const m=defined(r.byteOffset)?r.byteOffset:0,_=m+r.byteLength,v=o.slice(m,_);let g;switch(s.componentType===5126?g=new Float32Array(v):s.componentType===5123?g=new Uint16Array(v):s.componentType===5125?g=new Uint32Array(v):console.warn("no type defined for this componentType:",s.componentType),g||console.warn("no data",t,i,g),i){case"POSITION":this.geom.vertices=g,this.geom.verticesAccessor=s,this.geom.options.vertices={byteStride:c,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.normalsAccessor=s,this.geom.options.normals={byteStride:c,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.tangentsAccessor=s,this.geom.options.tangents={byteStride:c,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.uvsAccessor=s,this.geom.options.uvs={byteStride:c,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.indicesAccessor=s,this.geom.options.indices={byteStride:c,byteOffset:r.byteOffset?r.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+i)}}mergeGeoms(){const e=[];let t=0;const i=[],s=[],r=[],o=[],c=[];for(let p=0;p<this.transformedGeoms.length;p++){const m=this.transformedGeoms[p];let _=0;for(let g=0;g<m.indices.length;g++){const C=m.indices[g];C>_&&(_=C),e.push(C+t)}t+=_+1;let v=[Math.random(),Math.random(),Math.random()];for(let g=0;g<m.vertices.length/3;g++)Jd(Bn,m.vertices[g*3+0],m.vertices[g*3+1],m.vertices[g*3+2]),Ug(Mn),_u(Mn,Mn,m.transform.rotation[1]),gu(Mn,Mn,m.transform.rotation[0]),bu(Mn,Mn,m.transform.rotation[2]),Lg(Bn,Bn,Mn),Ki(Bn,Bn,m.transform.position),i.push(m.transform.position[0]),i.push(m.transform.position[1]),i.push(m.transform.position[2]),o.push(Bn[0]),o.push(Bn[1]),o.push(Bn[2]),s.push(p===10?1.75:-1.75),s.push(v[1]),s.push(v[2]),m.normals&&(c.push(m.normals[g*3+0]),c.push(m.normals[g*3+1]),c.push(m.normals[g*3+2]));for(let g=0;g<m.uvs.length/2;g++)r.push(m.uvs[g*2+0]),r.push(m.uvs[g*2+1])}this.geom={vertices:new Float32Array(o),uvs:new Float32Array(r),normal:new Float32Array(c),centroids:new Float32Array(i),seeds:new Float32Array(s),indices:new Uint16Array(e)}}init(){this.geometry=new ht(this.gl,{position:{size:3,data:this.geom.vertices},centroids:{size:3,data:this.geom.centroids},seeds:{size:3,data:this.geom.seeds},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normal},index:{data:this.geom.indices}});let e={uTime:{value:this.scene.time},uAlpha:{value:this.alpha},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position},uProgress:{value:0}};this.defines.HAS_COLOR_CORRECTION=1,e=Object.assign(e,{uTint:{value:new R(this.config.Tint.value)},uTintOpacity:this.config.TintOpacity,uExposure:this.config.Exposure,uContrast:this.config.Contrast,uSaturation:this.config.Saturation}),this.scene.textureLoader.isTextureRegistered(`${this.textureId}`)?(this.defines.HAS_COLORMAP=1,this.texture=new be(this.gl),e=Object.assign(e,{uTexture:{value:this.texture}})):e=Object.assign(e,{uColor:{value:new R(this.materialInfos.color)}}),this.scene.textureLoader.isTextureRegistered(`${this.textureId}_Opacity`)&&(this.defines.HAS_ALPHAMAP=1,this.alphaTexture=new be(this.gl),this.transparent=!0,e=Object.assign(e,{uAlphaTexture:{value:this.alphaTexture}})),this.scene.textureLoader.isTextureRegistered(`${this.textureId}_Normal`)&&(this.defines.HAS_NORMALMAP=1,this.normalTexture=new be(this.gl),e=Object.assign(e,{uNormalSampler:{value:this.normalTexture},uNormalScale:this.config.NormalScale})),this.materialInfos&&this.materialInfos.sheen!==void 0&&(this.defines.HAS_SHEEN=1,e=Object.assign(e,{uSheenOpacity:this.config.SheenOpacity,uSheenDepth:this.config.SheenDepth,uSheenColor:{value:new R(this.config.SheenColor.value)}})),e=Object.assign(e,{uLightDirection:{value:[0,0,0]},uLightColor:{value:new R("#ffffff")}}),this.shader=new ve(ce[this.shaderId],1,this.defines),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:e}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,renderOrder:this.renderOrder,forceRenderOrder:this.forceRenderOrder}),this.mesh.name=this.name,this.mesh.setParent(this.parent)}onLoaded(){this.texture&&(this.texture=this.scene.textureLoader.getTexture(this.textureId),this.texture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.texture),this.alphaTexture&&(this.alphaTexture=this.scene.textureLoader.getTexture(`${this.textureId}_Opacity`),this.alphaTexture.needsUpdate=!0,this.program.uniforms.uAlphaTexture.value=this.alphaTexture),this.normalTexture&&(this.normalTexture=this.scene.textureLoader.getTexture(`${this.textureId}_Normal`),this.normalTexture.needsUpdate=!0,this.program.uniforms.uNormalSampler.value=this.normalTexture)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uAlpha.value=this.alpha,this.program.uniforms.uTint.value=new R(this.config.Tint.value);const e=new R(this.globalConfig.lightColor.value);this.program.uniforms.uLightColor.value=[e[0]*this.globalConfig.lightPower.value,e[1]*this.globalConfig.lightPower.value,e[2]*this.globalConfig.lightPower.value],this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.defines.HAS_FOG&&(this.program.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.defines.HAS_FOG&&(this.program.uniforms.uFogDensity.value=this.globalConfig.FogDensity.value),this.program.uniforms.uCamera.value=this.scene.camera.position,this.video&&this.video.currentTime>0&&this.video.readyState>=this.video.HAVE_ENOUGH_DATA&&(this.videoTexture.image||(this.videoTexture.image=this.video),this.videoTexture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.videoTexture),this.defines.HAS_SHEEN!==void 0&&(this.program.uniforms.uSheenColor.value=new R(this.config.SheenColor.value))}}class jp extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,shaderId:C="standard",depthWrite:S=!0,separatedEmissive:E=!1,renderOrder:T=0,forceRenderOrder:M=!1,globalConfig:W=null,fog:B=!0,alpha:O=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=S,this.separatedEmissive=E,this.videoTexture=null,this.video=null,this.fog=B,this.renderOrder=T,this.forceRenderOrder=M,this.groupId=r,this.shaderId=C,this.geom={},this.materialName=_,this.globalConfig=W,this.alpha=O,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.geomData=t,this.lastEnv=null,this.lastEnvDiffuse=null,this.localState={uniforms:{}},this.normalMatrix=ut(),this.MVPMatrix=ut(),this.maxTextureIndex=0,this.defines={},this.defines.USE_IBL=1,this.defines.MANUAL_SRGB=1,this.defines.HAS_NORMALS=1,this.defines.HAS_UV=1,this.getDataFromGltf(),this.initConfig(),this.initTextures(),this.cleanConfig(),this.createUniforms(),this.init()}getDataFromGltf(){this.geom={options:{}};const e=this.data.primitives,t=this.node;t.rotation&&(this.transform.quaternion.x=t.rotation[0],this.transform.quaternion.y=t.rotation[1],this.transform.quaternion.z=t.rotation[2],this.transform.quaternion.w=t.rotation[3]),t.scale&&Xe(this.transform.scale,t.scale),t.translation&&Xe(this.transform.position,t.translation);for(let s=0;s<e.length;s++){var i=e[Object.keys(e)[s]];for(let r in i.attributes)switch(r){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let r in i.attributes)this.getAccessorData(i.attributes[r],r);this.getAccessorData(i.indices,"INDEX")}}getAccessorData(e,t){if(this.gltf.isDracoCompressed){const g=e.value;switch(t){case"POSITION":this.geom.vertices=g,this.geom.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}return}const i=this.gltf.accessors[e],s=this.gltf.bufferViews[i.bufferView],r=this.gltf.bin;let o=null;s&&s.byteStride&&(o=s.byteStride);const p=defined(s.byteOffset)?s.byteOffset:0,m=p+s.byteLength,_=r.slice(p,m);let v;switch(i.componentType===5126?v=new Float32Array(_):i.componentType===5123?v=new Uint16Array(_):i.componentType===5125?v=new Uint32Array(_):console.warn("no type defined for this componentType:",i.componentType),v||console.warn("no data",e,t,v),t){case"POSITION":this.geom.vertices=v,this.geom.verticesAccessor=i,this.geom.options.vertices={byteStride:o,byteOffset:0};break;case"NORMAL":this.geom.normals=v,this.geom.normalsAccessor=i,this.geom.options.normals={byteStride:o,byteOffset:12};break;case"TANGENT":this.geom.tangents=v,this.geom.tangentsAccessor=i,this.geom.options.tangents={byteStride:o,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=v,this.geom.uvsAccessor=i,this.geom.options.uvs={byteStride:o,byteOffset:24};break;case"INDEX":this.geom.indices=v,this.geom.indicesAccessor=i,this.geom.options.indices={byteStride:o,byteOffset:s.byteOffset?s.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}}initConfig(){this.config=Qe.addPBRMaterial(this.materialName,this.groupId),this.gui=Qe.getGui(this.materialName),Qe.on("texture-upload",this.onTextureUpload.bind(this))}onTextureUpload(e){if(e.matName===this.materialName){const t=this.scene.textureLoader.initTexture(e.image,[]),i=e.title;let s=null;i==="albedoMap"&&(s="uBaseColorSampler"),i==="ORMTexture"&&(s="uOcclusionRoughnessMetallicSampler"),i==="metallicRoughnessTexture"&&(s="uMetallicRoughnessSampler"),i==="normalTexture"&&(s="uNormalSampler"),i==="emissiveTexture"&&(s="uEmissiveSampler"),i==="occlusionTexture"&&(s="uOcclusionSampler"),i==="shadowTexture"&&(s="uShadowSampler"),s?(this.localState.uniforms[s].value=t,this.localState.uniforms[s].value.needsUpdate=!0):console.warn("no uniform matching that title:",i)}}cleanConfig(){!this.gui||(this.defines.HAS_NORMALMAP==null&&(this.gui.NormalScale.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&this.defines.HAS_ORM_MAP==null&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_EMISSIVECOLOR==null&&(this.gui.EmissiveColor.hidden=!0,this.gui.EmissivePower.hidden=!0),this.defines.HAS_SHEEN==null&&(this.gui.SheenColor.hidden=!0,this.gui.SheenOpacity.hidden=!0,this.gui.SheenDepth.hidden=!0),this.defines.HAS_SHADOW_MAP==null&&(this.gui.ShadowFactor.hidden=!0))}init(){this.environement=this.globalConfig.Environment.value,this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.lightColor=new R(this.globalConfig.lightColor.value),this.shader=new ve(ce[this.shaderId],1,this.defines);const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normals},index:{data:this.geom.indices}};this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:this.localState.uniforms}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,transform:this.transform,frustumCulled:!1,renderOrder:this.renderOrder,forceRenderOrder:this.forceRenderOrder}),this.mesh.name=this.name+"_mesh",this.mesh.setParent(this.parent),this.mesh._entity=this,this.createEmissiveMesh()}createEmissiveMesh(){if(this.separatedEmissive)this.emissiveShader=new ve(ce[this.shaderId],1,Object.assign(this.defines,{SEPARATED_EMISSIVE:!0})),this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:this.localState.uniforms});else{this.emissiveShader=new ve(ce.basicOcculter,1,{});let e={uTime:{value:this.scene.time},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position},uColor:{value:[1,0,0]}};this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:e})}this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.parent),this.emissiveMesh.name=this.name+"_emissiveMesh",this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this}getImageInfo(e,t,i){this.localState.uniforms[i]={type:t,uri:e,textIndx:this.maxTextureIndex},this.maxTextureIndex++}initTextures(){const e=this.gl;this.gltf;let t=null;_e.materials[this.materialName]?t=_e.materials[this.materialName]:console.warn("material undefined:",this.materialName),this.config.IBL.value=t&&t.IBL?t.IBL:this.config.IBL.value,this.localState.uniforms.uDiffuseEnvSampler={type:"texture",uri:"env_diffuse",textIndx:this.maxTextureIndex},this.maxTextureIndex++,this.localState.uniforms.uSpecularEnvSampler={type:"texture",uri:"env_default",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.Alpha&&(this.config.Alpha.value=t.Alpha),this.localState.uniforms.uUvScale={type:"float1",value:t&&t.UvScale?t.UvScale:1};var i=t&&t.albedoColor?new R(t.albedoColor).getRGBA():[1,1,1,1];if(this.config.albedoColor.value=t&&t.albedoColor?t.albedoColor:new R(i).getHex(),this.localState.uniforms.uBaseColorFactor={type:"float4",value:i},t&&t.albedoMap?(this.getImageInfo(t.albedoMap,"texture","uBaseColorSampler"),this.defines.HAS_BASECOLORMAP=1):this.localState.uniforms.uBaseColorSampler&&delete this.localState.uniforms.uBaseColorSampler,t&&t.alphaTexture&&(this.getImageInfo(t.alphaTexture,"texture","uAlphaMapSampler"),this.defines.HAS_ALPHAMAP=1),this.config.MetalicFactor.value=t&&typeof t.MetalicFactor=="number"?t.MetalicFactor:this.config.MetalicFactor.value,this.config.RoughnessFactor.value=t&&typeof t.RoughnessFactor=="number"?t.RoughnessFactor:this.config.RoughnessFactor.value,this.localState.uniforms.uMetallicRoughnessValues={type:"float2",value:[this.config.MetalicFactor.value,this.config.RoughnessFactor.value]},t&&t.metallicRoughnessTexture?(this.getImageInfo(t.metallicRoughnessTexture,"texture","uMetallicRoughnessSampler",e.RGBA),this.defines.HAS_METALROUGHNESSMAP=1):this.localState.uniforms.uMetallicRoughnessSampler&&delete this.localState.uniforms.uMetallicRoughnessSampler,t&&t.ORMTexture?(this.getImageInfo(t.ORMTexture,"texture","uOcclusionRoughnessMetallicSampler",e.RGBA),this.defines.HAS_ORM_MAP=1,this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value}):this.localState.uniforms.uOcclusionRoughnessMetallicSampler&&delete this.localState.uniforms.uOcclusionRoughnessMetallicSampler,t&&t.normalTexture?(this.getImageInfo(t.normalTexture,"texture","uNormalSampler",e.RGBA),this.config.NormalScale.value=t.NormalScale?t.NormalScale:this.config.NormalScale.value,this.localState.uniforms.uNormalScale={type:"float1",value:this.config.NormalScale.value},this.defines.HAS_NORMALMAP=1):this.localState.uniforms.uNormalSampler&&delete this.localState.uniforms.uNormalSampler,this.localState.uniforms.uBrdfLUT={type:"texture",uri:"brdfLUT",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.emissiveTexture){this.getImageInfo(t.emissiveTexture,"texture","uEmissiveSampler"),this.defines.HAS_EMISSIVEMAP=1;var s=t.emissiveFactor?t.emissiveFactor:[0,0,0];this.globalConfig.emissiveColor.value=new R(s).getHex(),this.localState.uniforms.uEmissiveColor={type:"float3",value:s}}else this.localState.uniforms.uEmissiveSampler&&delete this.localState.uniforms.uEmissiveSampler;if(t&&t.emissiveColor){this.defines.HAS_EMISSIVECOLOR=1;var r=t.emissiveColor?new R(t.emissiveColor):[0,0,0];this.config.EmissivePower.value=typeof t.emissivePower=="number"?t.emissivePower:1,this.config.EmissiveColor.value=t.emissiveColor,this.localState.uniforms.uEmissiveColor={type:"float3",value:r},this.localState.uniforms.uEmissivePower={type:"float1",value:this.config.EmissivePower.value}}if(t&&t.occlusionTexture?(this.getImageInfo(t.occlusionTexture,"texture","uOcclusionSampler"),this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value},this.defines.HAS_OCCLUSIONMAP=1):this.localState.uniforms.uOcclusionSampler&&delete this.localState.uniforms.uOcclusionSampler,t&&t.shadowTexture?(this.getImageInfo(t.shadowTexture,"texture","uShadowSampler"),this.config.ShadowFactor.value=t&&typeof t.ShadowFactor=="number"?t.ShadowFactor:this.config.ShadowFactor.value,this.localState.uniforms.uShadowStrength={type:"float1",value:this.config.ShadowFactor.value},this.defines.HAS_SHADOW_MAP=1):this.localState.uniforms.uShadowSampler&&delete this.localState.uniforms.uShadowSampler,t&&t.sheenColor){var o=t.sheenColor?new R(t.sheenColor):[1,1,1],c=t.sheenOpacity?t.sheenOpacity:1,p=t.sheenDepth?t.sheenDepth:2;this.localState.uniforms.uSheenColor={type:"float3",value:o},this.localState.uniforms.uSheenOpacity={type:"float1",value:c},this.localState.uniforms.uSheenDepth={type:"float1",value:p},this.config.SheenColor.value=t.sheenColor,this.config.SheenOpacity.value=c,this.config.SheenDepth.value=p,this.defines.HAS_SHEEN=1}this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,this.localState.uniforms.uFogColor={type:"float3",value:new R(this.globalConfig.FogColor.value)},this.localState.uniforms.uFogNear={type:"float1",value:this.globalConfig.FogNear.value},this.localState.uniforms.uFogFar={type:"float1",value:this.globalConfig.FogFar.value})}createUniforms(){this.localState.uniforms.uTime={type:"float1",value:0},this.localState.uniforms.uAlpha={type:"float1",value:1},this.localState.uniforms.uLightDirection={type:"float3",value:[0,.5,.5]},this.localState.uniforms.uLightColor={type:"float3",value:[1,1,1]},this.localState.uniforms.uScaleDiffBaseMR={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleFGDSpec={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleIBLAmbient={type:"float4",value:[1.5,1.5,0,0]},this.localState.uniforms.uCamera={type:"float3",value:[0,0,0]},this.defines.HAS_COLOR_CORRECTION=1,this.localState.uniforms.uTint={type:"float3",value:[1,1,1]},this.localState.uniforms.uTintOpacity={type:"float1",value:0},this.localState.uniforms.uExposure={type:"float1",value:0},this.localState.uniforms.uContrast={type:"float1",value:0},this.localState.uniforms.uSaturation={type:"float1",value:0};for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=new be(this.gl))}onLoaded(){for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=this.scene.textureLoader.getTexture(this.localState.uniforms[e].uri),this.localState.uniforms[e].value.needsUpdate=!0)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.needsUpdate=!0,this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.lightColor.set(this.globalConfig.lightColor.value),this.localState.uniforms.uLightColor.value=[this.lightColor[0]*this.globalConfig.lightPower.value,this.lightColor[1]*this.globalConfig.lightPower.value,this.lightColor[2]*this.globalConfig.lightPower.value],this.localState.uniforms.uScaleIBLAmbient.value=[this.config.IBL.value*this.globalConfig.IBLDiffuseFactor.value,this.config.IBL.value*this.globalConfig.IBLSpecularFactor.value,0,0];const e=this.globalConfig.Debug.value;this.localState.uniforms.uScaleDiffBaseMR.value=[e=="mathDiff"?1:0,e=="baseColor"?1:0,e=="metallic"?1:0,e=="roughness"?1:0],this.localState.uniforms.uScaleFGDSpec.value=[e=="specRef"?1:0,e=="geomOcc"?1:0,e=="mcrfctDist"?1:0,e=="spec"?1:0],this.localState.uniforms.uMetallicRoughnessValues.value=[this.config.MetalicFactor.value,this.config.RoughnessFactor.value],this.localState.uniforms.uNormalScale&&(this.localState.uniforms.uNormalScale.value=this.config.NormalScale.value),this.localState.uniforms.uOcclusionStrength&&(this.localState.uniforms.uOcclusionStrength.value=this.config.OcclusionFactor.value),this.localState.uniforms.uShadowStrength&&(this.localState.uniforms.uShadowStrength.value=this.config.ShadowFactor.value);const t=new R(this.config.albedoColor.value);this.localState.uniforms.uBaseColorFactor.value=[t[0],t[1],t[2],this.config.Alpha.value*this.globalConfig.Alpha.value],this.localState.uniforms.uEmissiveColor&&(this.localState.uniforms.uEmissiveColor.value=new R(this.config.EmissiveColor.value)),this.localState.uniforms.uEmissivePower&&(this.localState.uniforms.uEmissivePower.value=this.config.EmissivePower.value),this.localState.uniforms.uSheenColor&&(this.localState.uniforms.uSheenOpacity.value=this.config.SheenOpacity.value,this.localState.uniforms.uSheenDepth.value=this.config.SheenDepth.value,this.localState.uniforms.uSheenColor.value=new R(this.config.SheenColor.value)),this.globalConfig.FogColor&&this.fog&&(this.localState.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.localState.uniforms.uFogFar.value=this.globalConfig.FogFar.value,this.localState.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.localState.uniforms.uCamera.value=this.scene.camera.position,this.environement=this.globalConfig.Environment.value,this.environement!==this.lastEnv&&(this.lastEnv=this.environement,this.localState.uniforms.uSpecularEnvSampler.value=this.scene.textureLoader.getTexture(this.environement),this.localState.uniforms.uSpecularEnvSampler.value.needsUpdate=!0),this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.diffuseEnvironement!==this.lastEnvDiffuse&&(this.lastEnvDiffuse=this.diffuseEnvironement,this.localState.uniforms.uDiffuseEnvSampler.value=this.scene.textureLoader.getTexture(this.diffuseEnvironement),this.localState.uniforms.uDiffuseEnvSampler.value.needsUpdate=!0),this.localState.uniforms.uTint.value=new R(this.config.Tint.value),this.localState.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.localState.uniforms.uExposure.value=this.config.Exposure.value,this.localState.uniforms.uContrast.value=this.config.Contrast.value,this.localState.uniforms.uSaturation.value=this.config.Saturation.value}dispose(){this.mesh.setParent(null),this.geometry&&this.geometry.remove(),this.mesh&&delete this.mesh,this.emissiveMesh&&delete this.emissiveMesh}}class qS extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,shaderId:C="standard",depthWrite:S=!0,separatedEmissive:E=!1,renderOrder:T=0,globalConfig:M=null,fog:W=!0,alpha:B=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=S,this.separatedEmissive=E,this.videoTexture=null,this.video=null,this.fog=W,this.renderOrder=T,this.groupId=r,this.shaderId=C,this.geom={},this.materialName=_,this.globalConfig=M,this.alpha=B,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.geomData=t,this.lastEnv=null,this.lastEnvDiffuse=null,this.localState={uniforms:{}},this.normalMatrix=ut(),this.MVPMatrix=ut(),this.maxTextureIndex=0,this.defines={},this.defines.USE_IBL=1,this.defines.MANUAL_SRGB=1,this.defines.HAS_NORMALS=1,this.defines.HAS_UV=1,this.getDataFromGltf(),this.initConfig(),this.initTextures(),this.cleanConfig(),this.createUniforms(),this.init()}getDataFromGltf(){this.geom={options:{}};const e=this.data.primitives,t=this.node;t.rotation&&(this.transform.quaternion.x=t.rotation[0],this.transform.quaternion.y=t.rotation[1],this.transform.quaternion.z=t.rotation[2],this.transform.quaternion.w=t.rotation[3]),t.scale&&Xe(this.transform.scale,t.scale),t.translation&&Xe(this.transform.position,t.translation);for(let s=0;s<e.length;s++){var i=e[Object.keys(e)[s]];for(let r in i.attributes)switch(r){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let r in i.attributes)this.getAccessorData(i.attributes[r],r);this.getAccessorData(i.indices,"INDEX")}}getAccessorData(e,t){if(this.gltf.isDracoCompressed){const g=e.value;switch(t){case"POSITION":this.geom.vertices=g,this.geom.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}return}const i=this.gltf.accessors[e],s=this.gltf.bufferViews[i.bufferView],r=this.gltf.bin;let o=null;s&&s.byteStride&&(o=s.byteStride);const p=defined(s.byteOffset)?s.byteOffset:0,m=p+s.byteLength,_=r.slice(p,m);let v;switch(i.componentType===5126?v=new Float32Array(_):i.componentType===5123?v=new Uint16Array(_):i.componentType===5125?v=new Uint32Array(_):console.warn("no type defined for this componentType:",i.componentType),v||console.warn("no data",e,t,v),t){case"POSITION":this.geom.vertices=v,this.geom.verticesAccessor=i,this.geom.options.vertices={byteStride:o,byteOffset:0};break;case"NORMAL":this.geom.normals=v,this.geom.normalsAccessor=i,this.geom.options.normals={byteStride:o,byteOffset:12};break;case"TANGENT":this.geom.tangents=v,this.geom.tangentsAccessor=i,this.geom.options.tangents={byteStride:o,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=v,this.geom.uvsAccessor=i,this.geom.options.uvs={byteStride:o,byteOffset:24};break;case"INDEX":this.geom.indices=v,this.geom.indicesAccessor=i,this.geom.options.indices={byteStride:o,byteOffset:s.byteOffset?s.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}}initConfig(){this.config=Qe.addPBRMaterial(this.materialName,this.groupId);const e={meshScale:{value:6+Math.random()*2,params:{min:0,max:20,step:.01}},clothWaveAmplitude:{value:.2+Math.random()*.2,params:{min:0,max:4,step:.1}},clothWaveFrequency:{value:1.5+Math.random()*5,params:{min:0,max:10,step:.1}},clothWaveLighting:{value:.85+Math.random()*.1,params:{min:0,max:5,step:.1}}};this.gui=ie.addBlade(e,this.name,1),this.config={...this.config,...e},Qe.on("texture-upload",this.onTextureUpload.bind(this))}onTextureUpload(e){if(e.matName===this.materialName){const t=this.scene.textureLoader.initTexture(e.image,[]),i=e.title;let s=null;i==="albedoMap"&&(s="uBaseColorSampler"),i==="ORMTexture"&&(s="uOcclusionRoughnessMetallicSampler"),i==="metallicRoughnessTexture"&&(s="uMetallicRoughnessSampler"),i==="normalTexture"&&(s="uNormalSampler"),i==="emissiveTexture"&&(s="uEmissiveSampler"),i==="occlusionTexture"&&(s="uOcclusionSampler"),i==="shadowTexture"&&(s="uShadowSampler"),s?(this.localState.uniforms[s].value=t,this.localState.uniforms[s].value.needsUpdate=!0):console.warn("no uniform matching that title:",i)}}cleanConfig(){!this.gui||(this.defines.HAS_NORMALMAP==null&&this.gui.NormalScale&&(this.gui.NormalScale.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&this.defines.HAS_ORM_MAP==null&&this.gui.OcclusionFactor&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_EMISSIVECOLOR==null&&(this.gui.EmissiveColor&&(this.gui.EmissiveColor.hidden=!0),this.gui.EmissivePower&&(this.gui.EmissivePower.hidden=!0)),this.defines.HAS_SHEEN==null&&(this.gui.SheenColor&&(this.gui.SheenColor.hidden=!0),this.gui.SheenOpacity&&(this.gui.SheenOpacity.hidden=!0),this.gui.SheenDepth&&(this.gui.SheenDepth.hidden=!0)))}init(){this.environement=this.globalConfig.Environment.value,this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.lightColor=new R(this.globalConfig.lightColor.value),this.shader=new ve(ce[this.shaderId],1,this.defines);const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normals},index:{data:this.geom.indices}};this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,cullFace:!1,uniforms:this.localState.uniforms}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,transform:this.transform,frustumCulled:!1}),this.mesh.setParent(this.parent),this.mesh._entity=this,this.separatedEmissive&&(this.emissiveShader=new ve(ce[this.shaderId],1,Object.assign(this.defines,{SEPARATED_EMISSIVE:!0})),this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,cullFace:!1,uniforms:this.localState.uniforms}),this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.parent),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this)}getImageInfo(e,t,i){this.localState.uniforms[i]={type:t,uri:e,textIndx:this.maxTextureIndex},this.maxTextureIndex++}initTextures(){const e=this.gl;this.gltf;let t=null;_e.materials[this.materialName]?t=_e.materials[this.materialName]:console.warn("material undefined:",this.materialName),this.config.IBL.value=t&&t.IBL?t.IBL:this.config.IBL.value,this.localState.uniforms.uDiffuseEnvSampler={type:"texture",uri:"env_diffuse",textIndx:this.maxTextureIndex},this.maxTextureIndex++,this.localState.uniforms.uSpecularEnvSampler={type:"texture",uri:"env_default",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.Alpha&&(this.config.Alpha.value=t.Alpha),this.localState.uniforms.uUvScale={type:"float1",value:t&&t.UvScale?t.UvScale:1};var i=t&&t.albedoColor?new R(t.albedoColor).getRGBA():[1,1,1,1];if(this.config.albedoColor.value=t&&t.albedoColor?t.albedoColor:new R(i).getHex(),this.localState.uniforms.uBaseColorFactor={type:"float4",value:i},t&&t.albedoMap?(this.getImageInfo(t.albedoMap,"texture","uBaseColorSampler"),this.defines.HAS_BASECOLORMAP=1):this.localState.uniforms.uBaseColorSampler&&delete this.localState.uniforms.uBaseColorSampler,t&&t.alphaTexture&&(this.getImageInfo(t.alphaTexture,"texture","uAlphaMapSampler"),this.defines.HAS_ALPHAMAP=1),this.config.MetalicFactor.value=t&&typeof t.MetalicFactor=="number"?t.MetalicFactor:this.config.MetalicFactor.value,this.config.RoughnessFactor.value=t&&typeof t.RoughnessFactor=="number"?t.RoughnessFactor:this.config.RoughnessFactor.value,this.localState.uniforms.uMetallicRoughnessValues={type:"float2",value:[this.config.MetalicFactor.value,this.config.RoughnessFactor.value]},t&&t.metallicRoughnessTexture?(this.getImageInfo(t.metallicRoughnessTexture,"texture","uMetallicRoughnessSampler",e.RGBA),this.defines.HAS_METALROUGHNESSMAP=1):this.localState.uniforms.uMetallicRoughnessSampler&&delete this.localState.uniforms.uMetallicRoughnessSampler,t&&t.ORMTexture?(this.getImageInfo(t.ORMTexture,"texture","uOcclusionRoughnessMetallicSampler",e.RGBA),this.defines.HAS_ORM_MAP=1,this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value}):this.localState.uniforms.uOcclusionRoughnessMetallicSampler&&delete this.localState.uniforms.uOcclusionRoughnessMetallicSampler,t&&t.normalTexture?(this.getImageInfo(t.normalTexture,"texture","uNormalSampler",e.RGBA),this.config.NormalScale.value=t.NormalScale?t.NormalScale:this.config.NormalScale.value,this.localState.uniforms.uNormalScale={type:"float1",value:this.config.NormalScale.value},this.defines.HAS_NORMALMAP=1):this.localState.uniforms.uNormalSampler&&delete this.localState.uniforms.uNormalSampler,this.localState.uniforms.uBrdfLUT={type:"texture",uri:"brdfLUT",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.emissiveTexture){this.getImageInfo(t.emissiveTexture,"texture","uEmissiveSampler"),this.defines.HAS_EMISSIVEMAP=1;var s=t.emissiveFactor?t.emissiveFactor:[0,0,0];this.globalConfig.emissiveColor.value=new R(s).getHex(),this.localState.uniforms.uEmissiveColor={type:"float3",value:s}}else this.localState.uniforms.uEmissiveSampler&&delete this.localState.uniforms.uEmissiveSampler;if(t&&t.emissiveColor){this.defines.HAS_EMISSIVECOLOR=1;var r=t.emissiveColor?new R(t.emissiveColor):[0,0,0];this.config.EmissivePower.value=typeof t.emissivePower=="number"?t.emissivePower:1,this.config.EmissiveColor.value=t.emissiveColor,this.localState.uniforms.uEmissiveColor={type:"float3",value:r},this.localState.uniforms.uEmissivePower={type:"float1",value:this.config.EmissivePower.value}}if(t&&t.occlusionTexture?(this.getImageInfo(t.occlusionTexture,"texture","uOcclusionSampler"),this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value},this.defines.HAS_OCCLUSIONMAP=1):this.localState.uniforms.uOcclusionSampler&&delete this.localState.uniforms.uOcclusionSampler,t&&t.sheenColor){var o=t.sheenColor?new R(t.sheenColor):[1,1,1],c=t.sheenOpacity?t.sheenOpacity:1,p=t.sheenDepth?t.sheenDepth:2;this.localState.uniforms.uSheenColor={type:"float3",value:o},this.localState.uniforms.uSheenOpacity={type:"float1",value:c},this.localState.uniforms.uSheenDepth={type:"float1",value:p},this.config.SheenColor.value=t.sheenColor,this.config.SheenOpacity.value=c,this.config.SheenDepth.value=p,this.defines.HAS_SHEEN=1}this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,this.localState.uniforms.uFogColor={type:"float3",value:new R(this.globalConfig.FogColor.value)},this.localState.uniforms.uFogNear={type:"float1",value:this.globalConfig.FogNear.value},this.localState.uniforms.uFogFar={type:"float1",value:this.globalConfig.FogFar.value})}createUniforms(){this.localState.uniforms.uTime={type:"float1",value:0},this.localState.uniforms.uAlpha={type:"float1",value:1},this.localState.uniforms.uLightDirection={type:"float3",value:[0,.5,.5]},this.localState.uniforms.uLightColor={type:"float3",value:[1,1,1]},this.localState.uniforms.uScaleDiffBaseMR={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleFGDSpec={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleIBLAmbient={type:"float4",value:[1.5,1.5,0,0]},this.localState.uniforms.uCamera={type:"float3",value:[0,0,0]},this.defines.HAS_COLOR_CORRECTION=1,this.localState.uniforms.uTint={type:"float3",value:[1,1,1]},this.localState.uniforms.uTintOpacity={type:"float1",value:0},this.localState.uniforms.uExposure={type:"float1",value:0},this.localState.uniforms.uContrast={type:"float1",value:0},this.localState.uniforms.uSaturation={type:"float1",value:0},this.localState.uniforms.uClothWaveAmplitude={type:"float1",value:this.config.clothWaveAmplitude},this.localState.uniforms.uClothWaveFrequency={type:"float1",value:this.config.clothWaveFrequency},this.localState.uniforms.uClothWaveLighting={type:"float1",value:this.config.clothWaveLighting},this.localState.uniforms.uMeshScale={type:"float1",value:this.config.meshScaleFactor};for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=new be(this.gl))}onLoaded(){for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=this.scene.textureLoader.getTexture(this.localState.uniforms[e].uri),this.localState.uniforms[e].value.needsUpdate=!0)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.needsUpdate=!0,this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.lightColor.set(this.globalConfig.lightColor.value),this.localState.uniforms.uLightColor.value=[this.lightColor[0]*this.globalConfig.lightPower.value,this.lightColor[1]*this.globalConfig.lightPower.value,this.lightColor[2]*this.globalConfig.lightPower.value],this.localState.uniforms.uScaleIBLAmbient.value=[this.config.IBL.value*this.globalConfig.IBLDiffuseFactor.value,this.config.IBL.value*this.globalConfig.IBLSpecularFactor.value,0,0];const e=this.globalConfig.Debug.value;this.localState.uniforms.uScaleDiffBaseMR.value=[e=="mathDiff"?1:0,e=="baseColor"?1:0,e=="metallic"?1:0,e=="roughness"?1:0],this.localState.uniforms.uScaleFGDSpec.value=[e=="specRef"?1:0,e=="geomOcc"?1:0,e=="mcrfctDist"?1:0,e=="spec"?1:0],this.localState.uniforms.uMetallicRoughnessValues.value=[this.config.MetalicFactor.value,this.config.RoughnessFactor.value],this.localState.uniforms.uNormalScale&&(this.localState.uniforms.uNormalScale.value=this.config.NormalScale.value),this.localState.uniforms.uOcclusionStrength&&(this.localState.uniforms.uOcclusionStrength.value=this.config.OcclusionFactor.value);const t=new R(this.config.albedoColor.value);this.localState.uniforms.uBaseColorFactor.value=[t[0],t[1],t[2],this.config.Alpha.value*this.globalConfig.Alpha.value],this.localState.uniforms.uEmissiveColor&&(this.localState.uniforms.uEmissiveColor.value=new R(this.config.EmissiveColor.value)),this.localState.uniforms.uEmissivePower&&(this.localState.uniforms.uEmissivePower.value=this.config.EmissivePower.value),this.localState.uniforms.uSheenColor&&(this.localState.uniforms.uSheenOpacity.value=this.config.SheenOpacity.value,this.localState.uniforms.uSheenDepth.value=this.config.SheenDepth.value,this.localState.uniforms.uSheenColor.value=new R(this.config.SheenColor.value)),this.globalConfig.FogColor&&this.fog&&(this.localState.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.localState.uniforms.uFogFar.value=this.globalConfig.FogFar.value,this.localState.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.localState.uniforms.uCamera.value=this.scene.camera.position,this.environement=this.globalConfig.Environment.value,this.environement!==this.lastEnv&&(this.lastEnv=this.environement,this.localState.uniforms.uSpecularEnvSampler.value=this.scene.textureLoader.getTexture(this.environement),this.localState.uniforms.uSpecularEnvSampler.value.needsUpdate=!0),this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.diffuseEnvironement!==this.lastEnvDiffuse&&(this.lastEnvDiffuse=this.diffuseEnvironement,this.localState.uniforms.uDiffuseEnvSampler.value=this.scene.textureLoader.getTexture(this.diffuseEnvironement),this.localState.uniforms.uDiffuseEnvSampler.value.needsUpdate=!0),this.localState.uniforms.uTint.value=new R(this.config.Tint.value),this.localState.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.localState.uniforms.uExposure.value=this.config.Exposure.value,this.localState.uniforms.uContrast.value=this.config.Contrast.value,this.localState.uniforms.uSaturation.value=this.config.Saturation.value,this.localState.uniforms.uMeshScale.value=this.config.meshScale.value,this.localState.uniforms.uClothWaveAmplitude.value=this.config.clothWaveAmplitude.value,this.localState.uniforms.uClothWaveFrequency.value=this.config.clothWaveFrequency.value,this.localState.uniforms.uClothWaveLighting.value=this.config.clothWaveLighting.value}dispose(){this.mesh.setParent(null),this.meshTransparent.setParent(null),this.geometry.remove(),this.program.remove(),this.transparentProgram.remove()}}class XS extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,shaderId:C="standard",depthWrite:S=!0,separatedEmissive:E=!1,renderOrder:T=0,globalConfig:M=null,fog:W=!0,alpha:B=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=S,this.separatedEmissive=E,this.videoTexture=null,this.video=null,this.fog=W,this.renderOrder=T,this.groupId=r,this.shaderId=C,this.geom={},this.materialName=_,this.globalConfig=M,this.alpha=B,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.geomData=t,this.lastEnv=null,this.lastEnvDiffuse=null,this.localState={uniforms:{}},this.normalMatrix=ut(),this.MVPMatrix=ut(),this.maxTextureIndex=0,this.defines={},this.defines.USE_IBL=1,this.defines.MANUAL_SRGB=1,this.defines.HAS_NORMALS=1,this.defines.HAS_UV=1,this.getDataFromGltf(),this.initConfig(),this.initTextures(),this.cleanConfig(),this.createUniforms(),this.init()}getDataFromGltf(){this.geom={options:{}};const e=this.data.primitives,t=this.node;t.rotation&&(this.transform.quaternion.x=t.rotation[0],this.transform.quaternion.y=t.rotation[1],this.transform.quaternion.z=t.rotation[2],this.transform.quaternion.w=t.rotation[3]),t.scale&&Xe(this.transform.scale,t.scale),t.translation&&Xe(this.transform.position,t.translation);for(let s=0;s<e.length;s++){var i=e[Object.keys(e)[s]];for(let r in i.attributes)switch(r){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let r in i.attributes)this.getAccessorData(i.attributes[r],r);this.getAccessorData(i.indices,"INDEX")}}getAccessorData(e,t){if(this.gltf.isDracoCompressed){const g=e.value;switch(t){case"POSITION":this.geom.vertices=g,this.geom.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}return}const i=this.gltf.accessors[e],s=this.gltf.bufferViews[i.bufferView],r=this.gltf.bin;let o=null;s&&s.byteStride&&(o=s.byteStride);const p=defined(s.byteOffset)?s.byteOffset:0,m=p+s.byteLength,_=r.slice(p,m);let v;switch(i.componentType===5126?v=new Float32Array(_):i.componentType===5123?v=new Uint16Array(_):i.componentType===5125?v=new Uint32Array(_):console.warn("no type defined for this componentType:",i.componentType),v||console.warn("no data",e,t,v),t){case"POSITION":this.geom.vertices=v,this.geom.verticesAccessor=i,this.geom.options.vertices={byteStride:o,byteOffset:0};break;case"NORMAL":this.geom.normals=v,this.geom.normalsAccessor=i,this.geom.options.normals={byteStride:o,byteOffset:12};break;case"TANGENT":this.geom.tangents=v,this.geom.tangentsAccessor=i,this.geom.options.tangents={byteStride:o,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=v,this.geom.uvsAccessor=i,this.geom.options.uvs={byteStride:o,byteOffset:24};break;case"INDEX":this.geom.indices=v,this.geom.indicesAccessor=i,this.geom.options.indices={byteStride:o,byteOffset:s.byteOffset?s.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}}initConfig(){this.config=Qe.addPBRMaterial(this.materialName,this.groupId);const e={meshScale:{value:10+Math.random()*3,params:{min:0,max:20,step:.1}},clothWaveAmplitude:{value:.015+Math.random()*.01,params:{min:0,max:.5,step:.01}},clothWaveFrequency:{value:3.5+Math.random(),params:{min:0,max:10,step:.1}},clothWaveLighting:{value:1.5,params:{min:0,max:5,step:.1}}};this.gui=ie.addBlade(e,this.name,1),this.config={...this.config,...e},Qe.on("texture-upload",this.onTextureUpload.bind(this))}onTextureUpload(e){if(e.matName===this.materialName){const t=this.scene.textureLoader.initTexture(e.image,[]),i=e.title;let s=null;i==="albedoMap"&&(s="uBaseColorSampler"),i==="ORMTexture"&&(s="uOcclusionRoughnessMetallicSampler"),i==="metallicRoughnessTexture"&&(s="uMetallicRoughnessSampler"),i==="normalTexture"&&(s="uNormalSampler"),i==="emissiveTexture"&&(s="uEmissiveSampler"),i==="occlusionTexture"&&(s="uOcclusionSampler"),i==="shadowTexture"&&(s="uShadowSampler"),s?(this.localState.uniforms[s].value=t,this.localState.uniforms[s].value.needsUpdate=!0):console.warn("no uniform matching that title:",i)}}cleanConfig(){!this.gui||(this.defines.HAS_NORMALMAP==null&&this.gui.NormalScale&&(this.gui.NormalScale.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&this.defines.HAS_ORM_MAP==null&&this.gui.OcclusionFactor&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_EMISSIVECOLOR==null&&(this.gui.EmissiveColor&&(this.gui.EmissiveColor.hidden=!0),this.gui.EmissivePower&&(this.gui.EmissivePower.hidden=!0)),this.defines.HAS_SHEEN==null&&(this.gui.SheenColor&&(this.gui.SheenColor.hidden=!0),this.gui.SheenOpacity&&(this.gui.SheenOpacity.hidden=!0),this.gui.SheenDepth&&(this.gui.SheenDepth.hidden=!0)))}init(){this.environement=this.globalConfig.Environment.value,this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.lightColor=new R(this.globalConfig.lightColor.value),this.shader=new ve(ce[this.shaderId],1,this.defines);const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normals},index:{data:this.geom.indices}};this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,cullFace:!1,uniforms:this.localState.uniforms}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,transform:this.transform,frustumCulled:!1}),this.mesh.setParent(this.parent),this.mesh._entity=this,this.createEmissiveMesh()}createEmissiveMesh(){if(this.separatedEmissive)this.emissiveShader=new ve(ce[this.shaderId],1,Object.assign(this.defines,{SEPARATED_EMISSIVE:!0})),this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:this.localState.uniforms});else{this.emissiveShader=new ve(ce.basicOcculter,1,{});let e={uTime:{value:this.scene.time},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position},uColor:{value:[1,0,0]}};this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:e})}this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.parent),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this}getImageInfo(e,t,i){this.localState.uniforms[i]={type:t,uri:e,textIndx:this.maxTextureIndex},this.maxTextureIndex++}initTextures(){const e=this.gl;this.gltf;let t=null;_e.materials[this.materialName]?t=_e.materials[this.materialName]:console.warn("material undefined:",this.materialName),this.config.IBL.value=t&&t.IBL?t.IBL:this.config.IBL.value,t&&t.weightsTexture&&(this.getImageInfo(t.weightsTexture,"texture","uWeightsSampler"),this.defines.HAS_WEIGHTSMAP=1),this.localState.uniforms.uDiffuseEnvSampler={type:"texture",uri:"env_diffuse",textIndx:this.maxTextureIndex},this.maxTextureIndex++,this.localState.uniforms.uSpecularEnvSampler={type:"texture",uri:"env_default",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.Alpha&&(this.config.Alpha.value=t.Alpha),this.localState.uniforms.uUvScale={type:"float1",value:t&&t.UvScale?t.UvScale:1};var i=t&&t.albedoColor?new R(t.albedoColor).getRGBA():[1,1,1,1];if(this.config.albedoColor.value=t&&t.albedoColor?t.albedoColor:new R(i).getHex(),this.localState.uniforms.uBaseColorFactor={type:"float4",value:i},t&&t.albedoMap?(this.getImageInfo(t.albedoMap,"texture","uBaseColorSampler"),this.defines.HAS_BASECOLORMAP=1):this.localState.uniforms.uBaseColorSampler&&delete this.localState.uniforms.uBaseColorSampler,t&&t.alphaTexture&&(this.getImageInfo(t.alphaTexture,"texture","uAlphaMapSampler"),this.defines.HAS_ALPHAMAP=1),this.config.MetalicFactor.value=t&&typeof t.MetalicFactor=="number"?t.MetalicFactor:this.config.MetalicFactor.value,this.config.RoughnessFactor.value=t&&typeof t.RoughnessFactor=="number"?t.RoughnessFactor:this.config.RoughnessFactor.value,this.localState.uniforms.uMetallicRoughnessValues={type:"float2",value:[this.config.MetalicFactor.value,this.config.RoughnessFactor.value]},t&&t.metallicRoughnessTexture?(this.getImageInfo(t.metallicRoughnessTexture,"texture","uMetallicRoughnessSampler",e.RGBA),this.defines.HAS_METALROUGHNESSMAP=1):this.localState.uniforms.uMetallicRoughnessSampler&&delete this.localState.uniforms.uMetallicRoughnessSampler,t&&t.ORMTexture?(this.getImageInfo(t.ORMTexture,"texture","uOcclusionRoughnessMetallicSampler",e.RGBA),this.defines.HAS_ORM_MAP=1,this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value}):this.localState.uniforms.uOcclusionRoughnessMetallicSampler&&delete this.localState.uniforms.uOcclusionRoughnessMetallicSampler,t&&t.normalTexture?(this.getImageInfo(t.normalTexture,"texture","uNormalSampler",e.RGBA),this.config.NormalScale.value=t.NormalScale?t.NormalScale:this.config.NormalScale.value,this.localState.uniforms.uNormalScale={type:"float1",value:this.config.NormalScale.value},this.defines.HAS_NORMALMAP=1):this.localState.uniforms.uNormalSampler&&delete this.localState.uniforms.uNormalSampler,this.localState.uniforms.uBrdfLUT={type:"texture",uri:"brdfLUT",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.emissiveTexture){this.getImageInfo(t.emissiveTexture,"texture","uEmissiveSampler"),this.defines.HAS_EMISSIVEMAP=1;var s=t.emissiveFactor?t.emissiveFactor:[0,0,0];this.globalConfig.emissiveColor.value=new R(s).getHex(),this.localState.uniforms.uEmissiveColor={type:"float3",value:s}}else this.localState.uniforms.uEmissiveSampler&&delete this.localState.uniforms.uEmissiveSampler;if(t&&t.emissiveColor){this.defines.HAS_EMISSIVECOLOR=1;var r=t.emissiveColor?new R(t.emissiveColor):[0,0,0];this.config.EmissivePower.value=typeof t.emissivePower=="number"?t.emissivePower:1,this.config.EmissiveColor.value=t.emissiveColor,this.localState.uniforms.uEmissiveColor={type:"float3",value:r},this.localState.uniforms.uEmissivePower={type:"float1",value:this.config.EmissivePower.value}}if(t&&t.occlusionTexture?(this.getImageInfo(t.occlusionTexture,"texture","uOcclusionSampler"),this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value},this.defines.HAS_OCCLUSIONMAP=1):this.localState.uniforms.uOcclusionSampler&&delete this.localState.uniforms.uOcclusionSampler,t&&t.shadowTexture?(this.getImageInfo(t.shadowTexture,"texture","uShadowSampler"),this.config.ShadowFactor.value=t&&typeof t.ShadowFactor=="number"?t.ShadowFactor:this.config.ShadowFactor.value,this.localState.uniforms.uShadowStrength={type:"float1",value:this.config.ShadowFactor.value},this.defines.HAS_SHADOW_MAP=1):this.localState.uniforms.uShadowSampler&&delete this.localState.uniforms.uShadowSampler,t&&t.sheenColor){var o=t.sheenColor?new R(t.sheenColor):[1,1,1],c=t.sheenOpacity?t.sheenOpacity:1,p=t.sheenDepth?t.sheenDepth:2;this.localState.uniforms.uSheenColor={type:"float3",value:o},this.localState.uniforms.uSheenOpacity={type:"float1",value:c},this.localState.uniforms.uSheenDepth={type:"float1",value:p},this.config.SheenColor.value=t.sheenColor,this.config.SheenOpacity.value=c,this.config.SheenDepth.value=p,this.defines.HAS_SHEEN=1}this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,this.localState.uniforms.uFogColor={type:"float3",value:new R(this.globalConfig.FogColor.value)},this.localState.uniforms.uFogNear={type:"float1",value:this.globalConfig.FogNear.value},this.localState.uniforms.uFogFar={type:"float1",value:this.globalConfig.FogFar.value})}createUniforms(){this.localState.uniforms.uTime={type:"float1",value:0},this.localState.uniforms.uAlpha={type:"float1",value:1},this.localState.uniforms.uLightDirection={type:"float3",value:[0,.5,.5]},this.localState.uniforms.uLightColor={type:"float3",value:[1,1,1]},this.localState.uniforms.uScaleDiffBaseMR={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleFGDSpec={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleIBLAmbient={type:"float4",value:[1.5,1.5,0,0]},this.localState.uniforms.uCamera={type:"float3",value:[0,0,0]},this.defines.HAS_COLOR_CORRECTION=1,this.localState.uniforms.uTint={type:"float3",value:[1,1,1]},this.localState.uniforms.uTintOpacity={type:"float1",value:0},this.localState.uniforms.uExposure={type:"float1",value:0},this.localState.uniforms.uContrast={type:"float1",value:0},this.localState.uniforms.uSaturation={type:"float1",value:0},this.localState.uniforms.uSeed={type:"float1",value:Math.random()*3e3+1},this.localState.uniforms.uClothWaveAmplitude={type:"float1",value:this.config.clothWaveAmplitude},this.localState.uniforms.uClothWaveFrequency={type:"float1",value:this.config.clothWaveFrequency},this.localState.uniforms.uClothWaveLighting={type:"float1",value:this.config.clothWaveLighting},this.localState.uniforms.uMeshScale={type:"float1",value:this.config.meshScaleFactor};for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=new be(this.gl))}onLoaded(){for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=this.scene.textureLoader.getTexture(this.localState.uniforms[e].uri),this.localState.uniforms[e].value.needsUpdate=!0)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.needsUpdate=!0,this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.lightColor.set(this.globalConfig.lightColor.value),this.localState.uniforms.uLightColor.value=[this.lightColor[0]*this.globalConfig.lightPower.value,this.lightColor[1]*this.globalConfig.lightPower.value,this.lightColor[2]*this.globalConfig.lightPower.value],this.localState.uniforms.uScaleIBLAmbient.value=[this.config.IBL.value*this.globalConfig.IBLDiffuseFactor.value,this.config.IBL.value*this.globalConfig.IBLSpecularFactor.value,0,0];const e=this.globalConfig.Debug.value;this.localState.uniforms.uScaleDiffBaseMR.value=[e=="mathDiff"?1:0,e=="baseColor"?1:0,e=="metallic"?1:0,e=="roughness"?1:0],this.localState.uniforms.uScaleFGDSpec.value=[e=="specRef"?1:0,e=="geomOcc"?1:0,e=="mcrfctDist"?1:0,e=="spec"?1:0],this.localState.uniforms.uMetallicRoughnessValues.value=[this.config.MetalicFactor.value,this.config.RoughnessFactor.value],this.localState.uniforms.uNormalScale&&(this.localState.uniforms.uNormalScale.value=this.config.NormalScale.value),this.localState.uniforms.uOcclusionStrength&&(this.localState.uniforms.uOcclusionStrength.value=this.config.OcclusionFactor.value);const t=new R(this.config.albedoColor.value);this.localState.uniforms.uBaseColorFactor.value=[t[0],t[1],t[2],this.config.Alpha.value*this.globalConfig.Alpha.value],this.localState.uniforms.uEmissiveColor&&(this.localState.uniforms.uEmissiveColor.value=new R(this.config.EmissiveColor.value)),this.localState.uniforms.uEmissivePower&&(this.localState.uniforms.uEmissivePower.value=this.config.EmissivePower.value),this.localState.uniforms.uSheenColor&&(this.localState.uniforms.uSheenOpacity.value=this.config.SheenOpacity.value,this.localState.uniforms.uSheenDepth.value=this.config.SheenDepth.value,this.localState.uniforms.uSheenColor.value=new R(this.config.SheenColor.value)),this.globalConfig.FogColor&&this.fog&&(this.localState.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.localState.uniforms.uFogFar.value=this.globalConfig.FogFar.value,this.localState.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.localState.uniforms.uCamera.value=this.scene.camera.position,this.environement=this.globalConfig.Environment.value,this.environement!==this.lastEnv&&(this.lastEnv=this.environement,this.localState.uniforms.uSpecularEnvSampler.value=this.scene.textureLoader.getTexture(this.environement),this.localState.uniforms.uSpecularEnvSampler.value.needsUpdate=!0),this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.diffuseEnvironement!==this.lastEnvDiffuse&&(this.lastEnvDiffuse=this.diffuseEnvironement,this.localState.uniforms.uDiffuseEnvSampler.value=this.scene.textureLoader.getTexture(this.diffuseEnvironement),this.localState.uniforms.uDiffuseEnvSampler.value.needsUpdate=!0),this.localState.uniforms.uTint.value=new R(this.config.Tint.value),this.localState.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.localState.uniforms.uExposure.value=this.config.Exposure.value,this.localState.uniforms.uContrast.value=this.config.Contrast.value,this.localState.uniforms.uSaturation.value=this.config.Saturation.value,this.localState.uniforms.uMeshScale.value=this.config.meshScale.value,this.localState.uniforms.uClothWaveAmplitude.value=this.config.clothWaveAmplitude.value,this.localState.uniforms.uClothWaveFrequency.value=this.config.clothWaveFrequency.value,this.localState.uniforms.uClothWaveLighting.value=this.config.clothWaveLighting.value}dispose(){this.mesh.setParent(null),this.meshTransparent.setParent(null),this.geometry.remove(),this.program.remove(),this.transparentProgram.remove()}}class YS extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,shaderId:C="standard",depthWrite:S=!0,separatedEmissive:E=!1,renderOrder:T=0,globalConfig:M=null,fog:W=!0,alpha:B=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=S,this.separatedEmissive=E,this.videoTexture=null,this.video=null,this.fog=W,this.renderOrder=T,this.groupId=r,this.shaderId=C,this.geom={},this.materialName=_,this.globalConfig=M,this.alpha=B,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.geomData=t,this.lastEnv=null,this.lastEnvDiffuse=null,this.localState={uniforms:{}},this.normalMatrix=ut(),this.MVPMatrix=ut(),this.maxTextureIndex=0,this.defines={},this.defines.USE_IBL=1,this.defines.MANUAL_SRGB=1,this.defines.HAS_NORMALS=1,this.defines.HAS_UV=1,this.getDataFromGltf(),this.initConfig(),this.initTextures(),this.cleanConfig(),this.createUniforms(),this.init()}getDataFromGltf(){this.geom={options:{}};const e=this.data.primitives,t=this.node;t.rotation&&(this.transform.quaternion.x=t.rotation[0],this.transform.quaternion.y=t.rotation[1],this.transform.quaternion.z=t.rotation[2],this.transform.quaternion.w=t.rotation[3]),t.scale&&Xe(this.transform.scale,t.scale),t.translation&&Xe(this.transform.position,t.translation);for(let s=0;s<e.length;s++){var i=e[Object.keys(e)[s]];for(let r in i.attributes)switch(r){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let r in i.attributes)this.getAccessorData(i.attributes[r],r);this.getAccessorData(i.indices,"INDEX")}}getAccessorData(e,t){if(this.gltf.isDracoCompressed){const g=e.value;switch(t){case"POSITION":this.geom.vertices=g,this.geom.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}return}const i=this.gltf.accessors[e],s=this.gltf.bufferViews[i.bufferView],r=this.gltf.bin;let o=null;s&&s.byteStride&&(o=s.byteStride);const p=defined(s.byteOffset)?s.byteOffset:0,m=p+s.byteLength,_=r.slice(p,m);let v;switch(i.componentType===5126?v=new Float32Array(_):i.componentType===5123?v=new Uint16Array(_):i.componentType===5125?v=new Uint32Array(_):console.warn("no type defined for this componentType:",i.componentType),v||console.warn("no data",e,t,v),t){case"POSITION":this.geom.vertices=v,this.geom.verticesAccessor=i,this.geom.options.vertices={byteStride:o,byteOffset:0};break;case"NORMAL":this.geom.normals=v,this.geom.normalsAccessor=i,this.geom.options.normals={byteStride:o,byteOffset:12};break;case"TANGENT":this.geom.tangents=v,this.geom.tangentsAccessor=i,this.geom.options.tangents={byteStride:o,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=v,this.geom.uvsAccessor=i,this.geom.options.uvs={byteStride:o,byteOffset:24};break;case"INDEX":this.geom.indices=v,this.geom.indicesAccessor=i,this.geom.options.indices={byteStride:o,byteOffset:s.byteOffset?s.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}}initConfig(){this.config=Qe.addPBRMaterial(this.materialName,this.groupId);const e={glowingFrequency:{value:1+Math.random()*.5,params:{min:0,max:10,step:.1}},glowingAmplitude:{value:4.8+Math.random(),params:{min:0,max:10,step:.1}}};this.config={...this.config,...e},this.gui=ie.addBlade(this.config,this.name,1)}cleanConfig(){!this.gui||(this.defines.HAS_NORMALMAP==null&&(this.gui.NormalScale.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&this.defines.HAS_ORM_MAP==null&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_EMISSIVECOLOR==null&&(this.gui.EmissiveColor.hidden=!0,this.gui.EmissivePower.hidden=!0),this.defines.HAS_SHEEN==null&&(this.gui.SheenColor.hidden=!0,this.gui.SheenOpacity.hidden=!0,this.gui.SheenDepth.hidden=!0))}init(){this.environement=this.globalConfig.Environment.value,this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.lightColor=new R(this.globalConfig.lightColor.value),this.shader=new ve(ce[this.shaderId],1,this.defines);const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normals},index:{data:this.geom.indices}};this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,cullFace:!1,uniforms:this.localState.uniforms}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,transform:this.transform,frustumCulled:!1}),this.mesh.setParent(this.parent),this.mesh._entity=this,this.separatedEmissive&&(this.emissiveShader=new ve(ce[this.shaderId],1,Object.assign(this.defines,{SEPARATED_EMISSIVE:!0})),this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,cullFace:!1,uniforms:this.localState.uniforms}),this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.parent),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this)}getImageInfo(e,t,i){this.localState.uniforms[i]={type:t,uri:e,textIndx:this.maxTextureIndex},this.maxTextureIndex++}initTextures(){const e=this.gl;this.gltf;let t=null;_e.materials[this.materialName]?t=_e.materials[this.materialName]:console.warn("material undefined:",this.materialName),this.config.IBL.value=t&&t.IBL?t.IBL:this.config.IBL.value,this.localState.uniforms.uDiffuseEnvSampler={type:"texture",uri:"env_diffuse",textIndx:this.maxTextureIndex},this.maxTextureIndex++,this.localState.uniforms.uSpecularEnvSampler={type:"texture",uri:"env_default",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.Alpha&&(this.config.Alpha.value=t.Alpha),this.localState.uniforms.uUvScale={type:"float1",value:t&&t.UvScale?t.UvScale:1};var i=t&&t.albedoColor?new R(t.albedoColor).getRGBA():[1,1,1,1];if(this.config.albedoColor.value=t&&t.albedoColor?t.albedoColor:new R(i).getHex(),this.localState.uniforms.uBaseColorFactor={type:"float4",value:i},t&&t.albedoMap?(this.getImageInfo(t.albedoMap,"texture","uBaseColorSampler"),this.defines.HAS_BASECOLORMAP=1):this.localState.uniforms.uBaseColorSampler&&delete this.localState.uniforms.uBaseColorSampler,t&&t.alphaTexture&&(this.getImageInfo(t.alphaTexture,"texture","uAlphaMapSampler"),this.defines.HAS_ALPHAMAP=1),this.config.MetalicFactor.value=t&&typeof t.MetalicFactor=="number"?t.MetalicFactor:this.config.MetalicFactor.value,this.config.RoughnessFactor.value=t&&typeof t.RoughnessFactor=="number"?t.RoughnessFactor:this.config.RoughnessFactor.value,this.localState.uniforms.uMetallicRoughnessValues={type:"float2",value:[this.config.MetalicFactor.value,this.config.RoughnessFactor.value]},t&&t.metallicRoughnessTexture?(this.getImageInfo(t.metallicRoughnessTexture,"texture","uMetallicRoughnessSampler",e.RGBA),this.defines.HAS_METALROUGHNESSMAP=1):this.localState.uniforms.uMetallicRoughnessSampler&&delete this.localState.uniforms.uMetallicRoughnessSampler,t&&t.ORMTexture?(this.getImageInfo(t.ORMTexture,"texture","uOcclusionRoughnessMetallicSampler",e.RGBA),this.defines.HAS_ORM_MAP=1,this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value}):this.localState.uniforms.uOcclusionRoughnessMetallicSampler&&delete this.localState.uniforms.uOcclusionRoughnessMetallicSampler,t&&t.normalTexture?(this.getImageInfo(t.normalTexture,"texture","uNormalSampler",e.RGBA),this.config.NormalScale.value=t.NormalScale?t.NormalScale:this.config.NormalScale.value,this.localState.uniforms.uNormalScale={type:"float1",value:this.config.NormalScale.value},this.defines.HAS_NORMALMAP=1):this.localState.uniforms.uNormalSampler&&delete this.localState.uniforms.uNormalSampler,this.localState.uniforms.uBrdfLUT={type:"texture",uri:"brdfLUT",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.emissiveTexture){this.getImageInfo(t.emissiveTexture,"texture","uEmissiveSampler"),this.defines.HAS_EMISSIVEMAP=1;var s=t.emissiveFactor?t.emissiveFactor:[0,0,0];this.globalConfig.emissiveColor.value=new R(s).getHex(),this.localState.uniforms.uEmissiveColor={type:"float3",value:s}}else this.localState.uniforms.uEmissiveSampler&&delete this.localState.uniforms.uEmissiveSampler;if(t&&t.emissiveColor){this.defines.HAS_EMISSIVECOLOR=1;var r=t.emissiveColor?new R(t.emissiveColor):[0,0,0];this.config.EmissivePower.value=typeof t.emissivePower=="number"?t.emissivePower:1,this.config.EmissiveColor.value=t.emissiveColor,this.localState.uniforms.uEmissiveColor={type:"float3",value:r},this.localState.uniforms.uEmissivePower={type:"float1",value:this.config.EmissivePower.value}}if(t&&t.occlusionTexture?(this.getImageInfo(t.occlusionTexture,"texture","uOcclusionSampler"),this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value},this.defines.HAS_OCCLUSIONMAP=1):this.localState.uniforms.uOcclusionSampler&&delete this.localState.uniforms.uOcclusionSampler,t&&t.sheenColor){var o=t.sheenColor?new R(t.sheenColor):[1,1,1],c=t.sheenOpacity?t.sheenOpacity:1,p=t.sheenDepth?t.sheenDepth:2;this.localState.uniforms.uSheenColor={type:"float3",value:o},this.localState.uniforms.uSheenOpacity={type:"float1",value:c},this.localState.uniforms.uSheenDepth={type:"float1",value:p},this.config.SheenColor.value=t.sheenColor,this.config.SheenOpacity.value=c,this.config.SheenDepth.value=p,this.defines.HAS_SHEEN=1}this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,this.localState.uniforms.uFogColor={type:"float3",value:new R(this.globalConfig.FogColor.value)},this.localState.uniforms.uFogNear={type:"float1",value:this.globalConfig.FogNear.value},this.localState.uniforms.uFogFar={type:"float1",value:this.globalConfig.FogFar.value})}createUniforms(){this.localState.uniforms.uTime={type:"float1",value:0},this.localState.uniforms.uAlpha={type:"float1",value:1},this.localState.uniforms.uLightDirection={type:"float3",value:[0,.5,.5]},this.localState.uniforms.uLightColor={type:"float3",value:[1,1,1]},this.localState.uniforms.uScaleDiffBaseMR={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleFGDSpec={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleIBLAmbient={type:"float4",value:[1.5,1.5,0,0]},this.localState.uniforms.uCamera={type:"float3",value:[0,0,0]},this.defines.HAS_COLOR_CORRECTION=1,this.localState.uniforms.uTint={type:"float3",value:[1,1,1]},this.localState.uniforms.uTintOpacity={type:"float1",value:0},this.localState.uniforms.uExposure={type:"float1",value:0},this.localState.uniforms.uContrast={type:"float1",value:0},this.localState.uniforms.uSaturation={type:"float1",value:0},this.localState.uniforms.uGlowingFrequency={type:"float1",value:this.config.glowingFrequency},this.localState.uniforms.uGlowingAmplitude={type:"float1",value:this.config.glowingAmplitude};for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=new be(this.gl))}onLoaded(){for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=this.scene.textureLoader.getTexture(this.localState.uniforms[e].uri),this.localState.uniforms[e].value.needsUpdate=!0)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.needsUpdate=!0,this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.lightColor.set(this.globalConfig.lightColor.value),this.localState.uniforms.uLightColor.value=[this.lightColor[0]*this.globalConfig.lightPower.value,this.lightColor[1]*this.globalConfig.lightPower.value,this.lightColor[2]*this.globalConfig.lightPower.value],this.localState.uniforms.uScaleIBLAmbient.value=[this.config.IBL.value*this.globalConfig.IBLDiffuseFactor.value,this.config.IBL.value*this.globalConfig.IBLSpecularFactor.value,0,0];const e=this.globalConfig.Debug.value;this.localState.uniforms.uScaleDiffBaseMR.value=[e=="mathDiff"?1:0,e=="baseColor"?1:0,e=="metallic"?1:0,e=="roughness"?1:0],this.localState.uniforms.uScaleFGDSpec.value=[e=="specRef"?1:0,e=="geomOcc"?1:0,e=="mcrfctDist"?1:0,e=="spec"?1:0],this.localState.uniforms.uMetallicRoughnessValues.value=[this.config.MetalicFactor.value,this.config.RoughnessFactor.value],this.localState.uniforms.uNormalScale&&(this.localState.uniforms.uNormalScale.value=this.config.NormalScale.value),this.localState.uniforms.uOcclusionStrength&&(this.localState.uniforms.uOcclusionStrength.value=this.config.OcclusionFactor.value);const t=new R(this.config.albedoColor.value);this.localState.uniforms.uBaseColorFactor.value=[t[0],t[1],t[2],this.config.Alpha.value*this.globalConfig.Alpha.value],this.localState.uniforms.uEmissiveColor&&(this.localState.uniforms.uEmissiveColor.value=new R(this.config.EmissiveColor.value)),this.localState.uniforms.uEmissivePower&&(this.localState.uniforms.uEmissivePower.value=this.config.EmissivePower.value),this.localState.uniforms.uSheenColor&&(this.localState.uniforms.uSheenOpacity.value=this.config.SheenOpacity.value,this.localState.uniforms.uSheenDepth.value=this.config.SheenDepth.value,this.localState.uniforms.uSheenColor.value=new R(this.config.SheenColor.value)),this.globalConfig.FogColor&&this.fog&&(this.localState.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.localState.uniforms.uFogFar.value=this.globalConfig.FogFar.value,this.localState.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.localState.uniforms.uCamera.value=this.scene.camera.position,this.environement=this.globalConfig.Environment.value,this.environement!==this.lastEnv&&(this.lastEnv=this.environement,this.localState.uniforms.uSpecularEnvSampler.value=this.scene.textureLoader.getTexture(this.environement),this.localState.uniforms.uSpecularEnvSampler.value.needsUpdate=!0),this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.diffuseEnvironement!==this.lastEnvDiffuse&&(this.lastEnvDiffuse=this.diffuseEnvironement,this.localState.uniforms.uDiffuseEnvSampler.value=this.scene.textureLoader.getTexture(this.diffuseEnvironement),this.localState.uniforms.uDiffuseEnvSampler.value.needsUpdate=!0),this.localState.uniforms.uTint.value=new R(this.config.Tint.value),this.localState.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.localState.uniforms.uExposure.value=this.config.Exposure.value,this.localState.uniforms.uContrast.value=this.config.Contrast.value,this.localState.uniforms.uSaturation.value=this.config.Saturation.value,this.localState.uniforms.uGlowingFrequency.value=this.config.glowingFrequency.value,this.localState.uniforms.uGlowingAmplitude.value=this.config.glowingAmplitude.value}dispose(){this.mesh.setParent(null),this.meshTransparent.setParent(null),this.geometry.remove(),this.program.remove(),this.transparentProgram.remove()}}class QS extends et{constructor(e,t,i,{parent:s=null,id:r=0,blendFunc:o={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},gltf:c=null,node:p=null,name:m="",materialName:_="",transparent:v=!1,depthTest:g=!0,shaderId:C="standard",depthWrite:S=!0,separatedEmissive:E=!1,renderOrder:T=0,forceRenderOrder:M=!1,globalConfig:W=null,fog:B=!0,alpha:O=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.gltf=c,this.data=t,this.node=p,this.name=m,this.parent=s||e.root,this.transparent=v,this.blendFunc=o,this.depthTest=g,this.depthWrite=S,this.separatedEmissive=E,this.videoTexture=null,this.video=null,this.fog=B,this.renderOrder=T,this.forceRenderOrder=M,this.groupId=r,this.shaderId=C,this.geom={},this.materialName=_,this.globalConfig=W,this.alpha=O,this.textureId=i,this.defines={},this.seed=Math.random(),this.transform=new Le,this.geomData=t,this.lastEnv=null,this.lastEnvDiffuse=null,this.localState={uniforms:{}},this.normalMatrix=ut(),this.MVPMatrix=ut(),this.maxTextureIndex=0,this.defines={},this.defines.USE_IBL=1,this.defines.MANUAL_SRGB=1,this.defines.HAS_NORMALS=1,this.defines.HAS_UV=1,this.getDataFromGltf(),this.initConfig(),this.initTextures(),this.cleanConfig(),this.createUniforms(),this.init()}getDataFromGltf(){this.geom={options:{}};const e=this.data.primitives,t=this.node;t.rotation&&(this.transform.quaternion.x=t.rotation[0],this.transform.quaternion.y=t.rotation[1],this.transform.quaternion.z=t.rotation[2],this.transform.quaternion.w=t.rotation[3]),t.scale&&Xe(this.transform.scale,t.scale),t.translation&&Xe(this.transform.position,t.translation);for(let s=0;s<e.length;s++){var i=e[Object.keys(e)[s]];for(let r in i.attributes)switch(r){case"NORMAL":this.defines.HAS_NORMALS=1;break;case"TANGENT":this.defines.HAS_TANGENTS=1;break;case"TEXCOORD_0":this.defines.HAS_UV=1;break}for(let r in i.attributes)this.getAccessorData(i.attributes[r],r);this.getAccessorData(i.indices,"INDEX")}}getAccessorData(e,t){if(this.gltf.isDracoCompressed){const g=e.value;switch(t){case"POSITION":this.geom.vertices=g,this.geom.options.vertices={byteStride:0,byteOffset:0};break;case"NORMAL":this.geom.normals=g,this.geom.options.normals={byteStride:0,byteOffset:12};break;case"TANGENT":this.geom.tangents=g,this.geom.options.tangents={byteStride:0,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=g,this.geom.options.uvs={byteStride:0,byteOffset:24};break;case"INDEX":this.geom.indices=g,this.geom.options.indices={byteStride:0,byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}return}const i=this.gltf.accessors[e],s=this.gltf.bufferViews[i.bufferView],r=this.gltf.bin;let o=null;s&&s.byteStride&&(o=s.byteStride);const p=defined(s.byteOffset)?s.byteOffset:0,m=p+s.byteLength,_=r.slice(p,m);let v;switch(i.componentType===5126?v=new Float32Array(_):i.componentType===5123?v=new Uint16Array(_):i.componentType===5125?v=new Uint32Array(_):console.warn("no type defined for this componentType:",i.componentType),v||console.warn("no data",e,t,v),t){case"POSITION":this.geom.vertices=v,this.geom.verticesAccessor=i,this.geom.options.vertices={byteStride:o,byteOffset:0};break;case"NORMAL":this.geom.normals=v,this.geom.normalsAccessor=i,this.geom.options.normals={byteStride:o,byteOffset:12};break;case"TANGENT":this.geom.tangents=v,this.geom.tangentsAccessor=i,this.geom.options.tangents={byteStride:o,byteOffset:null};break;case"TEXCOORD_0":this.geom.uvs=v,this.geom.uvsAccessor=i,this.geom.options.uvs={byteStride:o,byteOffset:24};break;case"INDEX":this.geom.indices=v,this.geom.indicesAccessor=i,this.geom.options.indices={byteStride:o,byteOffset:s.byteOffset?s.byteOffset:null};break;default:console.warn("Unknown attribute semantic: "+t)}}initConfig(){this.config=Qe.addPBRMaterial(this.materialName,this.groupId),this.gui=Qe.getGui(this.materialName)}cleanConfig(){!this.gui||(this.defines.HAS_NORMALMAP==null&&(this.gui.NormalScale.hidden=!0),this.defines.HAS_OCCLUSIONMAP==null&&this.defines.HAS_ORM_MAP==null&&(this.gui.OcclusionFactor.hidden=!0),this.defines.HAS_EMISSIVECOLOR==null&&(this.gui.EmissiveColor.hidden=!0,this.gui.EmissivePower.hidden=!0),this.defines.HAS_SHEEN==null&&(this.gui.SheenColor.hidden=!0,this.gui.SheenOpacity.hidden=!0,this.gui.SheenDepth.hidden=!0))}init(){this.environement=this.globalConfig.Environment.value,this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.lightColor=new R(this.globalConfig.lightColor.value),this.shader=new ve(ce[this.shaderId],1,this.defines);const e={position:{size:3,data:this.geom.vertices},uv:{size:2,data:this.geom.uvs},normal:{size:3,data:this.geom.normals},index:{data:this.geom.indices}};this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:this.localState.uniforms}),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,transform:this.transform,frustumCulled:!1,renderOrder:this.renderOrder,forceRenderOrder:this.forceRenderOrder}),this.mesh.setParent(this.parent),this.mesh._entity=this,this.createEmissiveMesh()}createEmissiveMesh(){if(this.separatedEmissive)this.emissiveShader=new ve(ce[this.shaderId],1,Object.assign(this.defines,{SEPARATED_EMISSIVE:!0})),this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:this.localState.uniforms});else{this.emissiveShader=new ve(ce.basicOcculter,1,{});let e={uTime:{value:this.scene.time},uSeed:{value:this.seed},uTint:{value:new R(this.config.Tint.value)},uCamera:{value:this.scene.camera.position},uColor:{value:[1,0,0]}};this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:e})}this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.mesh),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this}getImageInfo(e,t,i){this.localState.uniforms[i]={type:t,uri:e,textIndx:this.maxTextureIndex},this.maxTextureIndex++}initTextures(){const e=this.gl;this.gltf;let t=null;_e.materials[this.materialName]?t=_e.materials[this.materialName]:console.warn("material undefined:",this.materialName),this.config.IBL.value=t&&t.IBL?t.IBL:this.config.IBL.value,this.localState.uniforms.uDiffuseEnvSampler={type:"texture",uri:"env_diffuse",textIndx:this.maxTextureIndex},this.maxTextureIndex++,this.localState.uniforms.uSpecularEnvSampler={type:"texture",uri:"env_default",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.Alpha&&(this.config.Alpha.value=t.Alpha),this.localState.uniforms.uUvScale={type:"float1",value:t&&t.UvScale?t.UvScale:1};var i=t&&t.albedoColor?new R(t.albedoColor).getRGBA():[1,1,1,1];if(this.config.albedoColor.value=t&&t.albedoColor?t.albedoColor:new R(i).getHex(),this.localState.uniforms.uBaseColorFactor={type:"float4",value:i},t&&t.albedoMap?(this.getImageInfo(t.albedoMap,"texture","uBaseColorSampler"),this.defines.HAS_BASECOLORMAP=1):this.localState.uniforms.uBaseColorSampler&&delete this.localState.uniforms.uBaseColorSampler,t&&t.alphaTexture&&(this.getImageInfo(t.alphaTexture,"texture","uAlphaMapSampler"),this.defines.HAS_ALPHAMAP=1),this.config.MetalicFactor.value=t&&typeof t.MetalicFactor=="number"?t.MetalicFactor:this.config.MetalicFactor.value,this.config.RoughnessFactor.value=t&&typeof t.RoughnessFactor=="number"?t.RoughnessFactor:this.config.RoughnessFactor.value,this.localState.uniforms.uMetallicRoughnessValues={type:"float2",value:[this.config.MetalicFactor.value,this.config.RoughnessFactor.value]},t&&t.metallicRoughnessTexture?(this.getImageInfo(t.metallicRoughnessTexture,"texture","uMetallicRoughnessSampler",e.RGBA),this.defines.HAS_METALROUGHNESSMAP=1):this.localState.uniforms.uMetallicRoughnessSampler&&delete this.localState.uniforms.uMetallicRoughnessSampler,t&&t.ORMTexture?(this.getImageInfo(t.ORMTexture,"texture","uOcclusionRoughnessMetallicSampler",e.RGBA),this.defines.HAS_ORM_MAP=1,this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value}):this.localState.uniforms.uOcclusionRoughnessMetallicSampler&&delete this.localState.uniforms.uOcclusionRoughnessMetallicSampler,t&&t.normalTexture?(this.getImageInfo(t.normalTexture,"texture","uNormalSampler",e.RGBA),this.config.NormalScale.value=t.NormalScale?t.NormalScale:this.config.NormalScale.value,this.localState.uniforms.uNormalScale={type:"float1",value:this.config.NormalScale.value},this.defines.HAS_NORMALMAP=1):this.localState.uniforms.uNormalSampler&&delete this.localState.uniforms.uNormalSampler,this.localState.uniforms.uBrdfLUT={type:"texture",uri:"brdfLUT",textIndx:this.maxTextureIndex},this.maxTextureIndex++,t&&t.emissiveTexture){this.getImageInfo(t.emissiveTexture,"texture","uEmissiveSampler"),this.defines.HAS_EMISSIVEMAP=1;var s=t.emissiveFactor?t.emissiveFactor:[0,0,0];this.globalConfig.emissiveColor.value=new R(s).getHex(),this.localState.uniforms.uEmissiveColor={type:"float3",value:s}}else this.localState.uniforms.uEmissiveSampler&&delete this.localState.uniforms.uEmissiveSampler;if(t&&t.emissiveColor){this.defines.HAS_EMISSIVECOLOR=1;var r=t.emissiveColor?new R(t.emissiveColor):[0,0,0];this.config.EmissivePower.value=typeof t.emissivePower=="number"?t.emissivePower:1,this.config.EmissiveColor.value=t.emissiveColor,this.localState.uniforms.uEmissiveColor={type:"float3",value:r},this.localState.uniforms.uEmissivePower={type:"float1",value:this.config.EmissivePower.value}}if(t&&t.occlusionTexture?(this.getImageInfo(t.occlusionTexture,"texture","uOcclusionSampler"),this.config.OcclusionFactor.value=t&&typeof t.OcclusionFactor=="number"?t.OcclusionFactor:this.config.OcclusionFactor.value,this.localState.uniforms.uOcclusionStrength={type:"float1",value:this.config.OcclusionFactor.value},this.defines.HAS_OCCLUSIONMAP=1):this.localState.uniforms.uOcclusionSampler&&delete this.localState.uniforms.uOcclusionSampler,t&&t.sheenColor){var o=t.sheenColor?new R(t.sheenColor):[1,1,1],c=t.sheenOpacity?t.sheenOpacity:1,p=t.sheenDepth?t.sheenDepth:2;this.localState.uniforms.uSheenColor={type:"float3",value:o},this.localState.uniforms.uSheenOpacity={type:"float1",value:c},this.localState.uniforms.uSheenDepth={type:"float1",value:p},this.config.SheenColor.value=t.sheenColor,this.config.SheenOpacity.value=c,this.config.SheenDepth.value=p,this.defines.HAS_SHEEN=1}this.globalConfig.FogColor&&this.fog&&(this.defines.HAS_FOG=1,this.localState.uniforms.uFogColor={type:"float3",value:new R(this.globalConfig.FogColor.value)},this.localState.uniforms.uFogNear={type:"float1",value:this.globalConfig.FogNear.value},this.localState.uniforms.uFogFar={type:"float1",value:this.globalConfig.FogFar.value})}createUniforms(){this.localState.uniforms.uTime={type:"float1",value:0},this.localState.uniforms.uAlpha={type:"float1",value:1},this.localState.uniforms.uLightDirection={type:"float3",value:[0,.5,.5]},this.localState.uniforms.uLightColor={type:"float3",value:[1,1,1]},this.localState.uniforms.uScaleDiffBaseMR={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleFGDSpec={type:"float4",value:[0,0,0,0]},this.localState.uniforms.uScaleIBLAmbient={type:"float4",value:[1.5,1.5,0,0]},this.localState.uniforms.uCamera={type:"float3",value:[0,0,0]},this.defines.HAS_COLOR_CORRECTION=1,this.localState.uniforms.uTint={type:"float3",value:[1,1,1]},this.localState.uniforms.uTintOpacity={type:"float1",value:0},this.localState.uniforms.uExposure={type:"float1",value:0},this.localState.uniforms.uContrast={type:"float1",value:0},this.localState.uniforms.uSaturation={type:"float1",value:0};for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=new be(this.gl))}onLoaded(){for(const e in this.localState.uniforms)Object.hasOwnProperty.call(this.localState.uniforms,e)&&this.localState.uniforms[e].type=="texture"&&(this.localState.uniforms[e].value=this.scene.textureLoader.getTexture(this.localState.uniforms[e].uri),this.localState.uniforms[e].value.needsUpdate=!0)}preRender(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.needsUpdate=!0,this.program.uniforms.uLightDirection.value=[this.globalConfig.lightPosition.value.x*this.scene.root.scale.x-this.mesh.worldMatrix[12],this.globalConfig.lightPosition.value.y*this.scene.root.scale.y-this.mesh.worldMatrix[13],this.globalConfig.lightPosition.value.z*this.scene.root.scale.z-this.mesh.worldMatrix[14]],this.lightColor.set(this.globalConfig.lightColor.value),this.localState.uniforms.uLightColor.value=[this.lightColor[0]*this.globalConfig.lightPower.value,this.lightColor[1]*this.globalConfig.lightPower.value,this.lightColor[2]*this.globalConfig.lightPower.value],this.localState.uniforms.uScaleIBLAmbient.value=[this.config.IBL.value*this.globalConfig.IBLDiffuseFactor.value,this.config.IBL.value*this.globalConfig.IBLSpecularFactor.value,0,0];const e=this.globalConfig.Debug.value;this.localState.uniforms.uScaleDiffBaseMR.value=[e=="mathDiff"?1:0,e=="baseColor"?1:0,e=="metallic"?1:0,e=="roughness"?1:0],this.localState.uniforms.uScaleFGDSpec.value=[e=="specRef"?1:0,e=="geomOcc"?1:0,e=="mcrfctDist"?1:0,e=="spec"?1:0],this.localState.uniforms.uMetallicRoughnessValues.value=[this.config.MetalicFactor.value,this.config.RoughnessFactor.value],this.localState.uniforms.uNormalScale&&(this.localState.uniforms.uNormalScale.value=this.config.NormalScale.value),this.localState.uniforms.uOcclusionStrength&&(this.localState.uniforms.uOcclusionStrength.value=this.config.OcclusionFactor.value);const t=new R(this.config.albedoColor.value);this.localState.uniforms.uBaseColorFactor.value=[t[0],t[1],t[2],this.config.Alpha.value*this.globalConfig.Alpha.value],this.localState.uniforms.uEmissiveColor&&(this.localState.uniforms.uEmissiveColor.value=new R(this.config.EmissiveColor.value)),this.localState.uniforms.uEmissivePower&&(this.localState.uniforms.uEmissivePower.value=this.config.EmissivePower.value),this.localState.uniforms.uSheenColor&&(this.localState.uniforms.uSheenOpacity.value=this.config.SheenOpacity.value,this.localState.uniforms.uSheenDepth.value=this.config.SheenDepth.value,this.localState.uniforms.uSheenColor.value=new R(this.config.SheenColor.value)),this.globalConfig.FogColor&&this.fog&&(this.localState.uniforms.uFogNear.value=this.globalConfig.FogNear.value,this.localState.uniforms.uFogFar.value=this.globalConfig.FogFar.value,this.localState.uniforms.uFogColor.value=new R(this.globalConfig.FogColor.value)),this.localState.uniforms.uCamera.value=this.scene.camera.position,this.environement=this.globalConfig.Environment.value,this.environement!==this.lastEnv&&(this.lastEnv=this.environement,this.localState.uniforms.uSpecularEnvSampler.value=this.scene.textureLoader.getTexture(this.environement),this.localState.uniforms.uSpecularEnvSampler.value.needsUpdate=!0),this.diffuseEnvironement=this.globalConfig.EnvironmentDiffuse.value,this.diffuseEnvironement!==this.lastEnvDiffuse&&(this.lastEnvDiffuse=this.diffuseEnvironement,this.localState.uniforms.uDiffuseEnvSampler.value=this.scene.textureLoader.getTexture(this.diffuseEnvironement),this.localState.uniforms.uDiffuseEnvSampler.value.needsUpdate=!0),this.localState.uniforms.uTint.value=new R(this.config.Tint.value),this.localState.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.localState.uniforms.uExposure.value=this.config.Exposure.value,this.localState.uniforms.uContrast.value=this.config.Contrast.value,this.localState.uniforms.uSaturation.value=this.config.Saturation.value}dispose(){this.mesh.setParent(null),this.meshTransparent.setParent(null),this.geometry.remove(),this.program.remove(),this.transparentProgram.remove()}}class Hr{constructor(e,t=1,i="rgb",s=null,r=!1,o="linear",c=!1,p=null){this.scene=e,this.gl=e.gl,this.pixelRatio=t,this.format=i,this.size=s,this.depth=r,this.filter=o,this.transparent=c,this.depthTexture=null,this.previousFrameBuffer=null,this.preventResize=!1,this.data=p,s===null?(this.width=this.scene.width*this.pixelRatio,this.height=this.scene.height*this.pixelRatio):(this.width=s,this.height=s),this.createTexture(),r&&this.createDepthTexture(),this.createFB(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),window.addEventListener("resize",()=>{setTimeout(this.onResize.bind(this),100)},{passive:!1})}createTexture(){let e=this.gl;this.targetTexture=this.gl.createTexture(),e.bindTexture(e.TEXTURE_2D,this.targetTexture);let t=0,i=e.RGBA,s=0,r=e.RGBA,o=e.UNSIGNED_BYTE;this.format==="float"&&(o=e_?e.FLOAT:e.HALF_FLOAT||e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,i=e.renderer.isWebgl2?o===e.FLOAT?e.RGBA32F:e.RGBA16F:e.RGBA);let c=this.data;e.texImage2D(e.TEXTURE_2D,t,i,this.width,this.height,s,r,o,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),this.filter=="nearest"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.bindTexture(e.TEXTURE_2D,null)}createDepthTexture(){let e=this.scene.gl;this.depthTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),this.filter=="nearest"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.renderer.isWebgl2?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT,this.width,this.height,0,e.DEPTH_COMPONENT,e.UNSIGNED_INT,null),e.bindTexture(e.TEXTURE_2D,null)}onResize(){if(this.preventResize)return;let e=this.gl;this.size===null?(this.width=this.scene.width*this.pixelRatio,this.height=this.scene.height*this.pixelRatio):(this.width=this.size,this.height=this.size),e.deleteTexture(this.targetTexture),this.depth&&e.deleteTexture(this.depthTexture),e.deleteFramebuffer(this.fb),this.createTexture(),this.depth&&this.createDepthTexture(),this.createFB(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}createFB(){let e=this.gl;this.fb=e.createFramebuffer(),this.fb.width=this.width,this.fb.height=this.height,e.bindFramebuffer(e.FRAMEBUFFER,this.fb);const t=0,i=e.COLOR_ATTACHMENT0;e.framebufferTexture2D(e.FRAMEBUFFER,i,e.TEXTURE_2D,this.targetTexture,t);const s=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,s),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,s),this.depth&&e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthTexture,0)}clear(){let e=this.gl;this.transparent?(e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)):(e.clearColor(0,1,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT))}preRender(){let e=this.gl;this.previousFrameBuffer=this.scene.activeFrameBuffer!==void 0?this.scene.activeFrameBuffer:null,this.scene.activeFrameBuffer=this.fb,e.bindFramebuffer(e.FRAMEBUFFER,this.scene.activeFrameBuffer),e.viewport(0,0,this.width,this.height),this.clear()}postRender(){let e=this.gl;this.scene.activeFrameBuffer=this.previousFrameBuffer,e.bindFramebuffer(e.FRAMEBUFFER,this.scene.activeFrameBuffer),e.viewport(0,0,this.scene.width,this.scene.height)}bind(){let e=this.gl;e.bindTexture(e.TEXTURE_2D,this.targetTexture)}bindDepth(){let e=this.gl;this.depth&&e.bindTexture(e.TEXTURE_2D,this.depthTexture)}getTexture(){return this.targetTexture}getDepthTexture(){return this.depthTexture}}class ZS{constructor(e,{}={}){this.gl=e.gl,this.scene=e,this.rt=new Hr(this.scene,this.scene.dpr>1?.3:.6,"rgb",null,!0),this.texture=new be(this.gl,{rt:this.rt,width:this.rt.width,height:this.rt.height})}resize(){this.rt&&this.rt.onResize()}preRender(){this.rt.preRender()}postRender(){this.rt.postRender()}}class ew extends et{constructor(e,{volumeCorner:t=new q(-500,-300,-250),volumeSize:i=new q(1e3,600,500),wind:s=new q(0,0,0),count:r=300,gravity:o=30,color:c="#e29373",color1:p="#e2533f",timeScale:m=1,name:_="Particles",meshId:v=0,noiseIntensity:g=30,noiseFrequency:C=.1,fadeDistance:S=150,particleOpacity:E=.75,particleScale:T=300,alpha:M=1,scale:W=.01,parent:B=!1,fog:O=!1,globalConfig:L=!1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.shader=new ve(ce.fairyDust),this.count=r,this.offset=new q,this.wind=s,this.volumeCorner=t,this.volumeSize=i,this.gravity=o,this.timeScale=m,this.color=c,this.color1=p,this.name=_,this.meshId=v,this.alpha=M,this.time=0,this.noiseIntensity=g,this.noiseFrequency=C,this.fadeDistance=S,this.particleOpacity=E,this.particleScale=T,this.scale=W,this.fog=O,this.globalConfig=L,this.parent=B||e.root,this.initConfig(),this.createParticles(),this.init()}initConfig(){this.config={count:{value:this.count,params:{min:1,max:1e4,step:1}},color:{value:this.color,params:{}},color1:{value:this.color1,params:{}},wind_X:{value:this.wind.x,params:{min:-30,max:30,step:.1}},wind_Y:{value:this.wind.y,params:{min:-30,max:30,step:.1}},wind_Z:{value:this.wind.z,params:{min:-30,max:30,step:.1}},TimeScale:{value:this.timeScale,params:{min:0,max:2,step:.01}},Gravity:{value:this.gravity,params:{min:-100,max:100,step:.1}},FadeDistance:{value:this.fadeDistance,params:{min:0,max:1e3,step:1}},NoiseIntensity:{value:this.noiseIntensity,params:{min:0,max:150,step:.1}},NoiseFrequency:{value:this.noiseFrequency,params:{min:0,max:2,step:.01}},ParticleOpacity:{value:this.particleOpacity,params:{min:0,max:1,step:.01}},ParticleScale:{value:this.particleScale,params:{min:0,max:1e3,step:1}},DiscRadius:{value:this.scene.isMobile?.03:.1,params:{min:0,max:1,step:.001}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001}},BorderSize:{value:.5,params:{min:0,max:1,step:.001}},BorderSize1:{value:.6,params:{min:0,max:1,step:.001}}},this.gui=ie.addBlade(this.config,this.name,this.meshId),this.gui&&this.gui.count.on("change",()=>{this.mesh.visible=!1,this.createParticles(),this.init()})}createParticles(){this.count=this.config.count.value;let e=[],t=[];for(;this.count--;)e.push(Math.random()*this.volumeSize[0]-this.volumeSize[0]/2),e.push(Math.random()*this.volumeSize[1]-this.volumeSize[1]/2),e.push(Math.random()*this.volumeSize[2]-this.volumeSize[2]/2),t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this.vertices=new Float32Array(e),this.seeds=new Float32Array(t)}init(){const e={position:{size:3,data:this.vertices},seeds:{size:4,data:this.seeds}};this.geometry=new ht(this.gl,e);const t={uTime:{value:this.scene.time},uVolumeCorner:{value:this.volumeCorner},uVolumeSize:{value:this.volumeSize},uOffset:{value:this.offset},uColor:{value:new R(this.color)},uColor1:{value:new R(this.color1)},uPixelRatio:{value:this.scene.dpr},uAlpha:{value:this.alpha},uNoiseIntensity:{value:this.noiseIntensity},uNoiseFrequency:{value:this.noiseFrequency},uTimeScale:{value:this.timeScale},uParticleOpacity:{value:this.particleOpacity},uFadeDistance:{value:this.fadeDistance},uParticleScale:{value:this.particleScale},uFogFactor:{value:this.fog?1:0},uFogColor:{value:this.globalConfig?new R(this.globalConfig.FogColor.value):new R("#fff")},uFogNear:{value:this.globalConfig?this.globalConfig.FogNear.value:0},uFogFar:{value:this.globalConfig?this.globalConfig.FogFar.value:0},uDiscRadius:this.config.DiscRadius,uDiscRadius1:this.config.DiscRadius1,uBorderSize:this.config.BorderSize,uBorderSize1:this.config.BorderSize1};this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:t}),this.program.cullFace=!1,this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,forceRenderOrder:!0,renderOrder:10,mode:this.gl.POINTS}),this.mesh.scale.x=this.scale,this.mesh.scale.y=this.scale,this.mesh.scale.z=this.scale,this.mesh.setParent(this.parent)}onLoaded(){}preRender(){this.program.uniforms.uColor.value=new R(this.config.color.value),this.program.uniforms.uColor1.value=new R(this.config.color1.value),this.wind[0]=this.config.wind_X.value,this.wind[1]=this.config.wind_Y.value,this.wind[2]=this.config.wind_Z.value,this.timeScale=this.config.TimeScale.value,this.gravity=this.config.Gravity.value,this.fadeDistance=this.config.FadeDistance.value,this.noiseIntensity=this.config.NoiseIntensity.value,this.noiseFrequency=this.config.NoiseFrequency.value,this.time+=this.scene.dt/1e3,this.offset[0]=this.wind[0]*this.time*this.timeScale,this.offset[1]=(this.wind[1]+this.gravity)*this.time*this.timeScale,this.offset[2]=this.wind[2]*this.time*this.timeScale,this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uFadeDistance.value=this.fadeDistance,this.program.uniforms.uNoiseIntensity.value=this.noiseIntensity,this.program.uniforms.uNoiseFrequency.value=this.noiseFrequency,this.program.uniforms.uTimeScale.value=this.timeScale,this.program.uniforms.uOffset.value=this.offset,this.program.uniforms.uParticleOpacity.value=this.config.ParticleOpacity.value,this.program.uniforms.uParticleScale.value=this.config.ParticleScale.value,this.program.uniforms.uPixelRatio.value=this.scene.dpr}dispose(){this.mesh&&this.mesh.setParent(null),this.geometry&&this.geometry.remove(),this.mesh&&delete this.mesh}}class tw extends et{constructor(t,{count:i=12500,particleScale:s=200,name:r="Intro Particles",shaderId:o="introParticles",parent:c=!1}={}){super(t.gl,t);fe(this,"gl");fe(this,"scene");fe(this,"shader");fe(this,"count");fe(this,"config");fe(this,"gui");fe(this,"program");fe(this,"mesh");fe(this,"timeout");fe(this,"transparent",!0);fe(this,"depthTest",!0);fe(this,"depthWrite",!1);fe(this,"time",0);fe(this,"acceleration",new q);this.gl=t.gl,this.scene=t,this.shader=new ve(ce[o]),this.count=i,this.name=r,this.parent=c,this.initConfig(s),this.createParticles(),this.init()}initConfig(t){this.config={count:{value:this.count,params:{min:1,max:1e5,step:1}},Color:{value:"#e29373",params:{}},Color1:{value:"#e2533f",params:{}},Opacity:{value:1,params:{min:0,max:1,step:.01}},Scale:{value:t,params:{min:0,max:1e3,step:.01}},Acceleration:{value:{x:0,y:0,z:0},params:{x:{min:-20,max:20,step:.01},y:{min:-20,max:20,step:.01},z:{min:-20,max:20,step:.01}}},Friction:{value:.0345,params:{min:0,max:.8,step:.01}},PositionOffset:{value:{x:0,y:0,z:0},params:{}},DiscRadius:{value:this.scene.isMobile?.03:.1,params:{min:0,max:1,step:.001}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001}},BorderSize:{value:.5,params:{min:.001,max:1,step:.001}},BorderSize1:{value:.6,params:{min:.001,max:1,step:.001}}},this.gui=ie.addBlade(this.config,this.name,1),this.gui&&(ie.folders[this.name].addButton({title:"Launch"}).on("click",()=>{this.launch()}),ie.folders[this.name].addButton({title:"Reset"}).on("click",()=>{this.reset()}),this.gui.count.on("change",()=>{this.mesh.visible=!1,this.createParticles(),this.init()}),this.gui.Color.on("change",r=>{this.program.uniforms.uColor.value=new R(r.value)}),this.gui.Color1.on("change",r=>{this.program.uniforms.uColor1.value=new R(r.value)}),this.gui.Scale.on("change",r=>{this.program.uniforms.uParticleScale.value=r.value}),this.gui.PositionOffset.on("change",r=>{!this.mesh||this.mesh.position.set(r.value.x,r.value.y,r.value.z)}))}launch(t=2.6){this.config.Acceleration.value.z=t,this.acceleration.set(this.config.Acceleration.value.x,this.config.Acceleration.value.y,this.config.Acceleration.value.z),ie.pane.refresh(),this.timeout=setTimeout(()=>{this.dispose()},5500)}reset(){clearTimeout(this.timeout),this.mesh.visible=!0,this.config.Acceleration.value.z=0,this.acceleration.set(0),this.program.uniforms.uVelocity.value.set(0),this.config.PositionOffset.value.z=0}createParticles(){let t=[],i=[];const s=()=>Ge((Math.random()-.5)*15,(Math.random()-.5)*15,(Math.random()-.5)*60);for(this.count=this.config.count.value;this.count--;){const r=s();t.push(r[0]),t.push(r[1]),t.push(r[2]),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random())}this.vertices=new Float32Array(t),this.seeds=new Float32Array(i)}init(){const t={position:{size:3,data:this.vertices},seeds:{size:4,data:this.seeds}};this.geometry=new ht(this.gl,t),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:{uTime:{value:this.scene.time},uColor:{value:new R(this.config.Color.value)},uColor1:{value:new R(this.config.Color1.value)},uPixelRatio:{value:this.scene.dpr},uParticleScale:this.config.Scale,uOpacity:this.config.Opacity,uVelocity:{value:new q},uFadeDistance:{value:20},uFogFactor:{value:1},uFogColor:{value:this.globalConfig?new R(this.globalConfig.FogColor.value):new R("#000")},uFogNear:{value:this.globalConfig?this.globalConfig.FogNear.value:0},uFogFar:{value:this.globalConfig?this.globalConfig.FogFar.value:100},uOpacityTimescale:{value:1},uBorderSize:this.config.BorderSize,uBorderSize1:this.config.BorderSize1,uDiscRadius:this.config.DiscRadius,uDiscRadius1:this.config.DiscRadius1}}),this.program.cullFace=!1,this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,frustumCulled:!1,forceRenderOrder:!0,renderOrder:1e3,mode:this.gl.POINTS}),this.mesh.scale.set(1.2),this.mesh.setParent(this.parent!==!1?this.parent:this.scene.root),this.mesh.name=this.name,this.mesh.position.set(this.config.PositionOffset.value.x,this.config.PositionOffset.value.y,this.config.PositionOffset.value.z)}place(t){this.mesh.position.z=t,this.config.PositionOffset.value.z=t,ie.pane.refresh()}onLoaded(){}preRender(){if(!this.mesh.visible)return;this.program.uniforms.uTime.value=this.scene.time;const t=this.acceleration.clone().negate();t.multiply(this.config.Friction.value),this.acceleration.add(t),this.program.uniforms.uVelocity.value=this.program.uniforms.uVelocity.value.add(this.acceleration),this.program.uniforms.uPixelRatio.value=this.scene.dpr}dispose(){this.mesh&&this.mesh.setParent(null),this.geometry&&this.geometry.remove(),this.mesh&&delete this.mesh}}class nw extends et{constructor(t,{count:i=200,textureId:s="gradientParticle",name:r="Brazier Particles",parent:o=!1,globalScale:c=1,globalConfig:p={},forceRenderOrder:m=!1,renderOrder:_=0}={}){super(t.gl,t);fe(this,"acceleration",new q);this.gl=t.gl,this.scene=t,this.parent=o||t.root,this.textureId=s,this.globalScale=c,this.globalConfig=p,this.forceRenderOrder=m,this.renderOrder=_,this.shader=new ve(ce.simplerFireParticles),this.texture=new be(this.gl),this.count=i,this.initConfig(r)}initConfig(t){this.config={Count:{value:this.count,params:{min:0,max:6e3,step:1}},OutsideColor:{value:"#7f0000",params:{}},CenterColor:{value:"#ff6a00",params:{}},Opacity:{value:.3,params:{min:0,max:1,step:.01}},Scale:{value:100,params:{min:0,max:500,step:1}},Acceleration:{value:{x:0,y:.3,z:0},params:{}},MaxSpeed:{value:.05,params:{min:0,max:1,step:.01}},Height:{value:1.85,params:{min:0,max:10,step:.01}},ConeShapeFactor:{value:.78,params:{min:0,max:3,step:.01}},NoiseFrequency:{value:.48,params:{min:0,max:3,step:.01}},NoiseAmplitude:{value:.55,params:{min:0,max:3,step:.01}},SparkSpawnChance:{value:.15,params:{min:0,max:1,step:.01}},SparkColor:{value:"#ffeb00",params:{}},SparkSize:{value:.4,params:{min:0,max:5,step:.01}},SparkOpacity:{value:3.35,params:{min:0,max:10,step:.01}},TimeScale:{value:1,params:{min:0,max:2,step:.01}},wind_X:{value:0,params:{min:-3,max:3,step:.01}},wind_Y:{value:0,params:{min:-3,max:3,step:.01}},wind_Z:{value:0,params:{min:-3,max:3,step:.01}},Gravity:{value:0,params:{min:-10,max:10,step:.01}}},this.gravity=this.config.Gravity.value,this.timeScale=this.config.TimeScale.value,this.wind=new q,this.offset=new q,this.time=0,this.acceleration.set(this.config.Acceleration.value.x,this.config.Acceleration.value.y,this.config.Acceleration.value.z),this.gui=ie.addBlade(this.config,t,1),this.createParticles(this.config.SparkSpawnChance.value),this.init(),this.gui&&(this.gui.Count.on("change",i=>{this.count=i.value,this.mesh.visible=!1,this.createParticles(this.config.SparkSpawnChance.value),this.init()}),this.gui.SparkSpawnChance.on("change",i=>{this.count=this.config.Count.value,this.mesh.visible=!1,this.createParticles(this.config.SparkSpawnChance.value),this.init()}),this.gui.CenterColor.on("change",i=>{this.program.uniforms.uCenterColor.value=new R(i.value)}),this.gui.OutsideColor.on("change",i=>{this.program.uniforms.uOutsideColor.value=new R(i.value)}),this.gui.SparkColor.on("change",i=>{this.program.uniforms.uSparkColor.value=new R(i.value)}),this.gui.Scale.on("change",i=>{this.program.uniforms.uParticleScale.value=i.value}),this.gui.ConeShapeFactor.on("change",i=>{this.program.uniforms.uConeShapeFactor.value=i.value}),this.gui.NoiseFrequency.on("change",i=>{this.program.uniforms.uNoiseFrequency.value=i.value}),this.gui.NoiseAmplitude.on("change",i=>{this.program.uniforms.uNoiseAmplitude.value=i.value}),this.gui.SparkSize.on("change",i=>{this.program.uniforms.uSparkSize.value=i.value}),this.gui.SparkOpacity.on("change",i=>{this.program.uniforms.uSparkOpacity.value=i.value}))}createParticles(t,i=2){let s=[],r=[],o=[],c=[];const p=_=>{const v=Math.random()*Math.PI*2;return Ge(Math.cos(v)*_,0,Math.sin(v)*_)};for(;this.count--;){const _=Math.pow(Math.random()*i,.8),v=p(_);s.push(v[0]),s.push(v[1]),s.push(v[2]),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),o.push(_),c.push(Math.random()>1-t?1:0)}this.vertices=new Float32Array(s),this.seeds=new Float32Array(r),this.radii=new Float32Array(o),this.sparkFactors=new Float32Array(c)}init(){const t={position:{size:3,data:this.vertices},seeds:{size:4,data:this.seeds},distanceRadius:{size:1,data:this.radii},sparkFactor:{size:1,data:this.sparkFactors}};this.geometry=new ht(this.gl,t);const i={uTime:{value:this.scene.time},uCenterColor:{value:new R(this.config.CenterColor.value)},uOutsideColor:{value:new R(this.config.OutsideColor.value)},uSparkColor:{value:new R(this.config.SparkColor.value)},uPixelRatio:{value:this.scene.dpr},uParticleScale:this.config.Scale,uOpacity:this.config.Opacity,uVelocity:{value:new q},uTexture:{value:this.texture},uUpperBound:this.config.Height,uConeShapeFactor:this.config.ConeShapeFactor,uNoiseFrequency:this.config.NoiseFrequency,uNoiseAmplitude:this.config.NoiseAmplitude,uSparkSize:this.config.SparkSize,uSparkOpacity:this.config.SparkOpacity,uFogNear:{value:this.globalConfig?this.globalConfig.FogNear.value:0},uFogFar:{value:this.globalConfig?this.globalConfig.FogFar.value:0},uFogColor:{value:this.globalConfig?new R(this.globalConfig.FogColor.value):new R("#fff")},uOffset:{value:this.offset}};this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,uniforms:i,depthTest:!0,depthWrite:!1,transparent:!0,fog:!1}),this.program.cullFace=!1,this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,frustumCulled:!0,forceRenderOrder:this.forceRenderOrder,renderOrder:this.renderOrder,mode:this.gl.POINTS}),this.mesh.setParent(this.parent),this.mesh.scale.set(1/this.globalScale),this.mesh.name="Particles"}onLoaded(){this.textureId&&(this.texture=this.scene.textureLoader.getTexture(this.textureId),this.texture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.texture),this.acceleration.set(this.config.Acceleration.value.x,this.config.Acceleration.value.y,this.config.Acceleration.value.z),this.program.uniforms.uUpperBound.value=this.config.Height.value,this.program.uniforms.uConeShapeFactor.value=this.config.ConeShapeFactor.value,this.program.uniforms.uNoiseFrequency.value=this.config.NoiseFrequency.value,this.program.uniforms.uNoiseAmplitude.value=this.config.NoiseAmplitude.value,this.program.uniforms.uSparkSize.value=this.config.SparkSize.value}preRender(){!this.mesh.visible||(this.program.uniforms.uTime.value=this.scene.time,this.acceleration.y+=this.scene.dt*this.config.Acceleration.value.y*1e-4,this.acceleration.y=xr(this.acceleration.y,-this.config.MaxSpeed.value*.1,this.config.MaxSpeed.value*.1),this.wind[0]=this.config.wind_X.value,this.wind[1]=this.config.wind_Y.value,this.wind[2]=this.config.wind_Z.value,this.time=20+Math.sin(this.scene.time)*3,this.timeScale=this.config.TimeScale.value,this.gravity=this.config.Gravity.value,this.offset[0]=this.wind[0]*this.time*this.timeScale,this.offset[1]=(this.wind[1]+this.gravity)*this.time*this.timeScale,this.offset[2]=this.wind[2]*this.time*this.timeScale,this.program.uniforms.uVelocity.value=this.program.uniforms.uVelocity.value.add(this.acceleration),this.program.uniforms.uPixelRatio.value=this.scene.dpr)}}class iw{constructor(e){this.scene=e,this.gl=e.gl,this.uniforms={},this.hasNormal=!0,this.onlyVertices=!1,this.customAttributes=[],this.node=new Xu,this.defines={},this.buffersOptions={},this.isHidden=!1}initProgram(e,t){let i=this.gl,r=function(_){let v="";for(let g in _)v+="#define "+g+" "+_[g]+`
`;return v}(this.defines),o=i.createShader(i.VERTEX_SHADER);i.shaderSource(o,r+e),i.compileShader(o);let c=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(c,r+t),i.compileShader(c),window.location.hash.includes("debugShaders")){if(!i.getShaderParameter(o,i.COMPILE_STATUS))return console.error("error vert",this,i.getShaderInfoLog(o)),null;if(!i.getShaderParameter(c,i.COMPILE_STATUS))return console.error("error frag",this,i.getShaderInfoLog(c)),null}let p=i.createProgram();i.attachShader(p,o),i.attachShader(p,c),i.linkProgram(p),window.location.hash.includes("debugShaders")&&(i.getProgramParameter(p,i.LINK_STATUS)||console.error("Could not initialise shaders",i.getProgramInfoLog(p))),i.useProgram(p),p.vertexPositionAttribute=i.getAttribLocation(p,"aPos"),this.onlyVertices||(p.vertexUvAttribute=i.getAttribLocation(p,"aUvs")),this.hasNormal&&(p.vertexNormalAttribute=i.getAttribLocation(p,"aNormal")),this.customAttributes.forEach(_=>{p[`${_.name}Attribute`]=i.getAttribLocation(p,_.attributeName)}),this.vertShader=o,this.fragSahder=c,this.program=p;const m=i.getProgramParameter(p,i.ACTIVE_ATTRIBUTES);for(let _=0;_<m;++_){const v=i.getActiveAttrib(p,_);i.getAttribLocation(p,v.name)}}initVao(){let e=this.gl,t=this.buffersOptions;this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.vertexAttribPointer(this.program.vertexPositionAttribute,3,e.FLOAT,!1,t.vertices?t.vertices.byteStride:0,t.vertices?t.vertices.byteOffset:0),e.enableVertexAttribArray(this.program.vertexPositionAttribute),this.onlyVertices||(e.bindBuffer(e.ARRAY_BUFFER,this.uvsBuffer),e.vertexAttribPointer(this.program.vertexUvAttribute,2,e.FLOAT,!1,t.uvs?t.uvs.byteStride:0,t.uvs?t.uvs.byteOffset:0),e.enableVertexAttribArray(this.program.vertexUvAttribute)),this.hasNormal&&(e.bindBuffer(e.ARRAY_BUFFER,this.normalBuffer),e.vertexAttribPointer(this.program.vertexNormalAttribute,3,e.FLOAT,!1,t.normals?t.normals.byteStride:0,t.normals?t.normals.byteOffset:0),e.enableVertexAttribArray(this.program.vertexNormalAttribute));for(let i=0;i<this.customAttributes.length;i++){const s=this.customAttributes[i];e.bindBuffer(e.ARRAY_BUFFER,s.buffer),e.vertexAttribPointer(this.program[s.name+"Attribute"],s.dimensions,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.program[s.name+"Attribute"])}this.onlyVertices||e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.bindVertexArray(null)}initBuffer(e){let t=this.gl;e.options&&(this.buffersOptions=e.options);let i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.vertices),t.STATIC_DRAW);let s=t.createBuffer();this.hasNormal&&(t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.normal),t.STATIC_DRAW));let r=t.createBuffer(),o=t.createBuffer();this.onlyVertices||(t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.uvs),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),t.STATIC_DRAW)),this.customAttributes.forEach(c=>{c.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,c.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(c.data),t.STATIC_DRAW)}),this.vertexPositionBuffer=i,this.uvsBuffer=r,this.hasNormal&&(this.normalBuffer=s),this.indicesBuffer=o}initMatrix(){this.createUniform("uPMatrix","mat4"),this.createUniform("uVMatrix","mat4"),this.createUniform("uMMatrix","mat4")}bindMatrixUniforms(e){this.bindUniform("uPMatrix",e.getProjectionMatrix()),this.bindUniform("uVMatrix",e.getViewMatrix()),this.bindUniform("uMMatrix",this.node.getMatrix())}createUniform(e,t="float1"){return this.program[e+"Uniform"]=this.gl.getUniformLocation(this.program,e),this.uniforms[e+"Uniform"]={name:e,type:t,uniform:this.program[e+"Uniform"]},this.program[e+"Uniform"]}createAttribute(e,t,i,s){this.customAttributes.push({name:e,attributeName:t,dimensions:i,buffer:null,data:s})}bindUniform(e,t){let i=this.gl;this.uniforms[e+"Uniform"].type==="texture"&&i.uniform1i(this.program[e+"Uniform"],t),this.uniforms[e+"Uniform"].type==="textureCube"?i.uniform1i(this.program[e+"Uniform"],t):this.uniforms[e+"Uniform"].type==="float1"?i.uniform1f(this.program[e+"Uniform"],t):this.uniforms[e+"Uniform"].type==="float2"?i.uniform2fv(this.program[e+"Uniform"],t):this.uniforms[e+"Uniform"].type==="float3"?i.uniform3fv(this.program[e+"Uniform"],t):this.uniforms[e+"Uniform"].type==="float4"?i.uniform4fv(this.program[e+"Uniform"],t):this.uniforms[e+"Uniform"].type==="mat4"?i.uniformMatrix4fv(this.program[e+"Uniform"],!1,t):this.uniforms[e+"Uniform"].type==="[mat4]"&&i.uniformMatrix4fv(this.program[e+"Uniform"],!1,t)}checkVisibility(){return this.isHidden}}const sw=[-1,1,0,-1,-1,0,1,-1,0,1,1,0],ql=[0,1,2,0,2,3],aw=[0,1,0,0,1,0,1,1];class rw extends iw{constructor(e,t,i){super(e),this.hasNormal=!1,this.parent=t,this.rtScale=.25,this.power=0,this.id=i,this.transparent=!0,this.direction=[0,0],this.threshold=0,this.color=Ge(1,1,1),this.meshes=[],this.blurPass=[[4,-1],[-1,4],[1,0],[0,1]];var s=new ve(ce.postBlur,2,{TRANSPARENT:this.transparent?1:0});this.initProgram(s.vert,s.passes[0]),this.initBuffer({vertices:sw,uvs:aw,indices:ql}),this.initVao(),this.createUniforms(),this.activeRt=0,this.disabledRt=1,this.rts=[new Hr(this.scene,this.rtScale,"rgba",null,!0,"linear",this.transparent),new Hr(this.scene,this.rtScale,"rgba",null,!0,"linear",this.transparent)],this.config={BloomTint:{value:"#ffffff",params:{}},Threshold:{value:0,params:{min:0,max:1.25,step:.01}},Blur:{value:1,params:{min:0,max:1,step:.01}},Overdrive:{value:.5,params:{min:0,max:1,step:.01}},Similarity:{value:.3,params:{min:0,max:.2,step:.001}}},ie.addBlade(this.config,"Bloom")}createUniforms(){this.createUniform("uTexture","texture"),this.createUniform("uRez","float2"),this.createUniform("uDir","float2"),this.createUniform("uTint","float3"),this.createUniform("uPower"),this.createUniform("uIsFirstPass"),this.createUniform("uThresold"),this.createUniform("uSimilarity"),this.createUniform("uOverdrive")}applyState(){let e=this.gl;this.scene.applyDefaultState(),e.disable(e.DEPTH_TEST),e.depthMask(!1)}preRender(){this.rts[this.disabledRt].preRender()}postRender(){this.rts[this.disabledRt].postRender(),this.activeRt=this.activeRt===1?0:1,this.disabledRt=this.disabledRt===1?0:1}clear(){this.rts[this.activeRt].clear(),this.rts[this.disabledRt].clear()}bind(){this.rts[this.activeRt].bind()}getTexture(){return this.rts[this.activeRt].getTexture()}render(){let e=this.gl;e.useProgram(this.program),e.bindVertexArray(this.vao),this.applyState(),this.preRender(),this.power=this.config.Blur.value,this.color=new R(this.config.BloomTint.value),this.threshold=this.config.Threshold.value,this.bindUniform("uRez",[this.scene.width,this.scene.height]),this.direction=this.blurPass[0],this.bindUniform("uDir",[this.direction[0]*this.scene.dpr,this.direction[1]*this.scene.dpr]),e.activeTexture(e.TEXTURE0),this.parent.rt.bind(),this.bindUniform("uTexture",0),this.bindUniform("uPower",this.power),this.bindUniform("uIsFirstPass",1),this.bindUniform("uTint",this.color),this.bindUniform("uThresold",this.threshold),this.bindUniform("uSimilarity",this.config.Similarity.value),this.bindUniform("uOverdrive",this.config.Overdrive.value),e.drawElements(e.TRIANGLES,ql.length,e.UNSIGNED_SHORT,0),this.postRender();for(let t=1;t<this.blurPass.length;t++)this.preRender(),this.direction=this.blurPass[t],this.bindUniform("uDir",[this.direction[0]*this.scene.dpr,this.direction[1]*this.scene.dpr]),e.activeTexture(e.TEXTURE0),this.rts[this.activeRt].bind(),this.bindUniform("uTexture",0),this.bindUniform("uIsFirstPass",0),e.drawElements(e.TRIANGLES,ql.length,e.UNSIGNED_SHORT,0),this.postRender();e.bindVertexArray(null),e.bindFramebuffer(e.FRAMEBUFFER,null)}resize(){for(let e=0;e<this.rts.length;e++)this.rts[e].onResize()}}const fr=Xd();class ow{constructor(e){this.cursor=Zn(0,0),this.lastCursor=Zn(0,0),this.velocity=Zn(0,0),this.dampedCursor=Zn(.5,.5),this.target=e||window,this.wheelVelocity=Zn(0,0),this.wheel=Zn(0,0),this.lastWheel=Zn(0,0),this.screenWidth=document.documentElement.clientWidth,this.screenHeight=document.documentElement.clientHeight,this.isDown=!1,this.wheelDir=null,this.wheelConfigBy=.07,this.wheelSpeed=.35,this.isWheelLock=!1,this.normalizeWheel=0,this.current=0,this.maxWheel=3750,this.emitter={},this.preventDamping=!0,ya(this.emitter),this.on=this.emitter.on.bind(this.emitter),this.off=this.emitter.off.bind(this.emitter),ui.subscribe("mouse",()=>{this.update()}),this.config={damping:{value:.05,params:{min:0,max:.05,step:.001}}},this.initEvents(),window.__debugMouse=this}initEvents(){at?(this.target.addEventListener("touchstart",e=>{this.onDown(e.touches[0])}),this.target.addEventListener("touchend",e=>{this.onUp(e.touches[0])}),this.target.addEventListener("touchmove",e=>{this.onMouve(e.touches[0])})):(this.target.addEventListener("mousedown",e=>{this.onDown(e)}),this.target.addEventListener("mousemove",e=>{this.onMouve(e)}),this.target.addEventListener("mouseup",e=>{this.onUp(e)}),this.target.addEventListener("wheel",e=>{this.onWheel(e)},{passive:!1})),this.target.addEventListener("click",()=>{this.emitter.emit("click")},{passive:!1}),this.target.addEventListener("resize",()=>{setTimeout(this.resize.bind(this),100)},{passive:!1})}onDown(e){this.cursor[0]=(e.clientX/this.screenWidth-.5)*2,this.cursor[1]=(e.clientY/this.screenHeight-.5)*2,this.lastCursor[0]=this.cursor[0],this.lastCursor[1]=this.cursor[1],this.isDown=!0,this.emitter.emit("down",this)}onUp(e){this.isDown=!1,this.emitter.emit("up",this)}onWheel(e){this.isWheelLock||(this.lastWheel[0]=this.wheel[0],this.lastWheel[1]=this.wheel[1],this.wheel[0]=e.deltaX,this.wheel[1]=e.deltaY,this.wheelDir=e.deltaY<0?"up":"down",this.current+=e.deltaY*this.wheelConfigBy*this.wheelSpeed,this.current=xr(this.current,0,this.maxWheel),this.normalizeWheel=this.current/this.maxWheel,this.emitter.emit("wheel",this))}onMouve(e){if(this.cursor[0]=(e.clientX/this.screenWidth-.5)*2,this.cursor[1]=(e.clientY/this.screenHeight-.5)*2,this.emitter.emit("mouve",this),this.isDown&&this.emitter.emit("drag",this),!this.isWheelLock&&at){let t=(this.cursor[1]-this.lastCursor[1])*-.01;this.normalizeWheel=xr(t+this.normalizeWheel,0,1)}}resize(){this.screenWidth=document.documentElement.clientWidth,this.screenHeight=document.documentElement.clientHeight}update(){this.velocity[0]=this.cursor[0]-this.lastCursor[0],this.velocity[1]=this.cursor[1]-this.lastCursor[1],this.wheelVelocity[0]=this.wheel[0]-this.lastWheel[0],this.wheelVelocity[1]=this.wheel[1]-this.lastWheel[1],this.lastCursor[0]=this.cursor[0],this.lastCursor[1]=this.cursor[1],this.preventDamping||(jg(fr,this.cursor,this.dampedCursor),Wg(fr,fr,this.config.damping.value),Gg(this.dampedCursor,this.dampedCursor,fr))}}const Ke=new ow,Vi={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n},lw={layer4Top1:{value:"#9fa8cf",params:{label:"layer4Top1"}},layer4Bottom1:{value:"#2f1306",params:{label:"layer4Bottom1"}},layer4Opacity1:{value:.5,params:{min:0,max:1,step:.01,label:"layer4Opacity1"}},layer4Top2:{value:"#ffc5ac",params:{label:"layer4Top2"}},layer4Bottom2:{value:"#3a1646",params:{label:"layer4Bottom2"}},layer4Opacity2:{value:1,params:{min:0,max:1,step:.01,label:"layer4Opacity2"}},layer4Top3:{value:"#dab6aa",params:{label:"layer4Top3"}},layer4Bottom3:{value:"#000e16",params:{label:"layer4Bottom3"}},layer4Opacity3:{value:1,params:{min:0,max:1,step:.01,label:"layer4Opacity3"}},layer4Top4:{value:"#eef3d2",params:{label:"layer4Top4"}},layer4Bottom4:{value:"#482812",params:{label:"layer4Bottom4"}},layer4Opacity4:{value:1,params:{min:0,max:1,step:.01,label:"layer4Opacity4"}},layer4Top5:{value:"#b4bcc0",params:{label:"layer4Top5"}},layer4Bottom5:{value:"#000819",params:{label:"layer4Bottom5"}},layer4Opacity5:{value:.74,params:{min:0,max:1,step:.01,label:"layer4Opacity5"}},layer3Top1:{value:"#000000",params:{label:"layer3Top1"}},layer3Bottom1:{value:"#000000",params:{label:"layer3Bottom1"}},layer3Opacity1:{value:0,params:{min:0,max:1,step:.01,label:"layer3Opacity1"}},layer3Top2:{value:"#ffcdb8",params:{label:"layer3Top2"}},layer3Bottom2:{value:"#000c01",params:{label:"layer3Bottom2"}},layer3Opacity2:{value:.09,params:{min:0,max:1,step:.01,label:"layer3Opacity2"}},layer3Top3:{value:"#000000",params:{label:"layer3Top3"}},layer3Bottom3:{value:"#000000",params:{label:"layer3Bottom3"}},layer3Opacity3:{value:0,params:{min:0,max:1,step:.01,label:"layer3Opacity3"}},layer3Top4:{value:"#000000",params:{label:"layer3Top4"}},layer3Bottom4:{value:"#000000",params:{label:"layer3Bottom4"}},layer3Opacity4:{value:0,params:{min:0,max:1,step:.01,label:"layer3Opacity4"}},layer3Top5:{value:"#000000",params:{label:"layer3Top5"}},layer3Bottom5:{value:"#000000",params:{label:"layer3Bottom5"}},layer3Opacity5:{value:0,params:{min:0,max:1,step:.01,label:"layer3Opacity5"}},layer2Top1:{value:"#929292",params:{label:"layer2Top1"}},layer2Bottom1:{value:"#031223",params:{label:"layer2Bottom1"}},layer2Opacity1:{value:1,params:{min:0,max:1,step:.01,label:"layer2Opacity1"}},layer2Top2:{value:"#f5c6a1",params:{label:"layer2Top2"}},layer2Bottom2:{value:"#2f0033",params:{label:"layer2Bottom2"}},layer2Opacity2:{value:.27,params:{min:0,max:1,step:.01,label:"layer2Opacity2"}},layer2Top3:{value:"#17252c",params:{label:"layer2Top3"}},layer2Bottom3:{value:"#020026",params:{label:"layer2Bottom3"}},layer2Opacity3:{value:.38999999999999996,params:{min:0,max:1,step:.01,label:"layer2Opacity3"}},layer2Top4:{value:"#696f72",params:{label:"layer2Top4"}},layer2Bottom4:{value:"#340c01",params:{label:"layer2Bottom4"}},layer2Opacity4:{value:.67,params:{min:0,max:1,step:.01,label:"layer2Opacity4"}},layer2Top5:{value:"#a5a8aa",params:{label:"layer2Top5"}},layer2Bottom5:{value:"#0d0f14",params:{label:"layer2Bottom5"}},layer2Opacity5:{value:.45,params:{min:0,max:1,step:.01,label:"layer2Opacity5"}},layer1Color1:{value:"#000000",params:{label:"layer1Color1"}},layer1Opacity1:{value:0,params:{min:0,max:1,step:.01,label:"layer1Opacity1"}},layer1Color2:{value:"#000000",params:{label:"layer1Color2"}},layer1Opacity2:{value:.2,params:{min:0,max:1,step:.01,label:"layer1Opacity2"}},layer1Color3:{value:"#000000",params:{label:"layer1Color3"}},layer1Opacity3:{value:.15,params:{min:0,max:1,step:.01,label:"layer1Opacity3"}},layer1Color4:{value:"#000000",params:{label:"layer1Color4"}},layer1Opacity4:{value:0,params:{min:0,max:1,step:.01,label:"layer1Opacity4"}},layer1Color5:{value:"#000000",params:{label:"layer1Color5"}},layer1Opacity5:{value:0,params:{min:0,max:1,step:.01,label:"layer1Opacity5"}}};class uw{constructor(e){this.scene=e,this.tempColor=new R,this.scenesRatio=0,this.currentSceneIndex=0,this.prevSceneIndex=0,this.innerSceneProgress=0}init(){this.configMoods=lw,ie.addBlade(this.configMoods,"Moods"),this.layer4ColorTop=new R,this.layer4ColorBottom=new R,this.layer4Opacity=1,this.layer3ColorTop=new R,this.layer3ColorBottom=new R,this.layer3Opacity=1,this.layer2ColorTop=new R,this.layer2ColorBottom=new R,this.layer2Opacity=1,this.layer1Color=new R,this.layer1Opacity=1,ie.active&&(window.dumpMoodConfig=()=>{console.log(this.configMoods),copy&&copy(this.configMoods)}),this.setVariablesFromConfig()}setVariablesFromConfig(){this.layer4Tops=[new R(this.configMoods.layer4Top1.value),new R(this.configMoods.layer4Top2.value),new R(this.configMoods.layer4Top3.value),new R(this.configMoods.layer4Top4.value),new R(this.configMoods.layer4Top5.value)],this.layer4Bottoms=[new R(this.configMoods.layer4Bottom1.value),new R(this.configMoods.layer4Bottom2.value),new R(this.configMoods.layer4Bottom3.value),new R(this.configMoods.layer4Bottom4.value),new R(this.configMoods.layer4Bottom5.value)],this.layer4Opacities=[this.configMoods.layer4Opacity1.value,this.configMoods.layer4Opacity2.value,this.configMoods.layer4Opacity3.value,this.configMoods.layer4Opacity4.value,this.configMoods.layer4Opacity5.value],this.layer3Tops=[new R(this.configMoods.layer3Top1.value),new R(this.configMoods.layer3Top2.value),new R(this.configMoods.layer3Top3.value),new R(this.configMoods.layer3Top4.value),new R(this.configMoods.layer3Top5.value)],this.layer3Bottoms=[new R(this.configMoods.layer3Bottom1.value),new R(this.configMoods.layer3Bottom2.value),new R(this.configMoods.layer3Bottom3.value),new R(this.configMoods.layer3Bottom4.value),new R(this.configMoods.layer3Bottom5.value)],this.layer3Opacities=[this.configMoods.layer3Opacity1.value,this.configMoods.layer3Opacity2.value,this.configMoods.layer3Opacity3.value,this.configMoods.layer3Opacity4.value,this.configMoods.layer3Opacity2.value],this.layer2Tops=[new R(this.configMoods.layer2Top1.value),new R(this.configMoods.layer2Top2.value),new R(this.configMoods.layer2Top3.value),new R(this.configMoods.layer2Top4.value),new R(this.configMoods.layer2Top5.value)],this.layer2Bottoms=[new R(this.configMoods.layer2Bottom1.value),new R(this.configMoods.layer2Bottom2.value),new R(this.configMoods.layer2Bottom3.value),new R(this.configMoods.layer2Bottom4.value),new R(this.configMoods.layer2Bottom5.value)],this.layer2Opacities=[this.configMoods.layer2Opacity1.value,this.configMoods.layer2Opacity2.value,this.configMoods.layer2Opacity3.value,this.configMoods.layer2Opacity4.value,this.configMoods.layer2Opacity5.value],this.layer1Colors=[new R(this.configMoods.layer1Color1.value),new R(this.configMoods.layer1Color2.value),new R(this.configMoods.layer1Color3.value),new R(this.configMoods.layer1Color4.value),new R(this.configMoods.layer1Color5.value)],this.layer1Opacities=[this.configMoods.layer1Opacity1.value,this.configMoods.layer1Opacity2.value,this.configMoods.layer1Opacity3.value,this.configMoods.layer1Opacity4.value,this.configMoods.layer1Opacity5.value]}preRender(){this.setVariablesFromConfig(),!(this.scene.progress<0)&&(this.scenesRatio=gt(this.scene.progress,0,1,0,5,!0),this.currentSceneIndex=parseInt(this.scenesRatio),this.prevSceneIndex=this.currentSceneIndex===0?4:this.currentSceneIndex-1,this.innerSceneProgress=Vi.easeOutCubic(this.scenesRatio-this.currentSceneIndex),this.layer4ColorTop.copy(this.lerpColors(this.layer4Tops[this.prevSceneIndex],this.layer4Tops[this.currentSceneIndex],this.innerSceneProgress)),this.layer4ColorBottom.copy(this.lerpColors(this.layer4Bottoms[this.prevSceneIndex],this.layer4Bottoms[this.currentSceneIndex],this.innerSceneProgress)),this.layer4Opacity=In(this.layer4Opacities[this.prevSceneIndex],this.layer4Opacities[this.currentSceneIndex],this.innerSceneProgress),this.layer3ColorTop.copy(this.lerpColors(this.layer3Tops[this.prevSceneIndex],this.layer3Tops[this.currentSceneIndex],this.innerSceneProgress)),this.layer3ColorBottom.copy(this.lerpColors(this.layer3Bottoms[this.prevSceneIndex],this.layer3Bottoms[this.currentSceneIndex],this.innerSceneProgress)),this.layer3Opacity=In(this.layer3Opacities[this.prevSceneIndex],this.layer3Opacities[this.currentSceneIndex],this.innerSceneProgress),this.layer2ColorTop.copy(this.lerpColors(this.layer2Tops[this.prevSceneIndex],this.layer2Tops[this.currentSceneIndex],this.innerSceneProgress)),this.layer2ColorBottom.copy(this.lerpColors(this.layer2Bottoms[this.prevSceneIndex],this.layer2Bottoms[this.currentSceneIndex],this.innerSceneProgress)),this.layer2Opacity=In(this.layer2Opacities[this.prevSceneIndex],this.layer2Opacities[this.currentSceneIndex],this.innerSceneProgress),this.layer1Color.copy(this.lerpColors(this.layer1Colors[this.prevSceneIndex],this.layer1Colors[this.currentSceneIndex],this.innerSceneProgress)),this.layer1Opacity=In(this.layer1Opacities[this.prevSceneIndex],this.layer1Opacities[this.currentSceneIndex],this.innerSceneProgress))}lerpColors(e,t,i){return this.tempColor.r=e.r+(t.r-e.r)*i,this.tempColor.g=e.g+(t.g-e.g)*i,this.tempColor.b=e.b+(t.b-e.b)*i,this.tempColor}}class Ff extends Array{constructor(e=0,t=e,i=e,s=e){return super(e,t,i,s),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set w(e){this[3]=e}set(e,t,i,s){return e.length?this.copy(e):(Pf(this,e,t,i,s),this)}copy(e){return Bf(this,e),this}normalize(){return If(this,this),this}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}}const Xl=new Ff,cw=[-1,1,0,-1,-1,0,1,-1,0,1,1,0],hw=[0,1,2,0,2,3],pw=[0,1,0,0,1,0,1,1];class dw extends et{constructor(e,{blendFunc:t={},transparent:i=!1,depthTest:s=!1,depthWrite:r=!1,renderOrder:o=0,alpha:c=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.rt=new Hr(this.scene,1,"rgb",null,!0),this.transparent=i,this.blendFunc=t,this.depthTest=s,this.depthWrite=r,this.textureId=null,this.renderOrder=o,this.shader=new ve(ce.post),this.texture=new be(this.gl,{rt:this.rt,width:this.rt.width,height:this.rt.height}),this.bloomTexture=new be(this.gl),this.alpha=c,this.spritesheetOffsets={},this.activeSpritesheetOffset=0,this.config={BloomOpacity:{value:1,params:{min:0,max:1,step:.01}},NoiseOpacity:{value:0,params:{min:0,max:1,step:.01}},Gamma:{value:1.1,params:{min:0,max:2,step:.01}},Exposure:{value:0,params:{min:-2,max:2,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},ChromaticAberations:{value:.02,params:{min:0,max:1,step:.01}},Vignette:{value:.61,params:{min:0,max:1,step:.01}},VignetteStrength:{value:.71,params:{min:0,max:1,step:.01}},BlurStrength:{value:.1,params:{min:0,max:1,step:.01}},BlurRadius:{value:.8,params:{min:0,max:1,step:.01}},BlurMultiplier:{value:500,params:{min:0,max:2e3}},MoodVignetteRadialStrength:{value:5.65,params:{min:0,max:10,step:.01}},MoodVignetteMiddleStrength:{value:.15,params:{min:0,max:2,step:.01}},ActiveSpritesheetOffset:{value:0,params:{min:0,max:this.scene.spritesheetManager.framerate,step:1}}},this.gui=ie.addBlade(this.config,"Post Processing"),this.gui&&this.gui.ActiveSpritesheetOffset.on("change",m=>{this.activeSpritesheetOffset=m.value});const p=ie.folders["Post Processing"];p&&(p.addButton({title:"Make new spritesheet"}).on("click",()=>{this.scene.spritesheetManager.buildPostprocessingSpritesheet((v,g)=>{this.setSpritesheet(v,g),this.scene.spritesheetManager.downloadSpritesheet()})}),p.addButton({title:"Fetch current spritesheet"}).on("click",()=>{this.scene.spritesheetManager.fetchSpritesheetData().then(([v,g])=>{this.setSpritesheet(v,g)})})),this.moods=new uw(this.scene),this.blurMultiplierAmount=1,this.init()}init(){this.moods.init(),this.geometry=new vi(this.gl);const e={position:{size:3,data:new Float32Array(cw)},uv:{size:2,data:new Float32Array(pw)},index:{data:new Uint16Array(hw)}};this.geometry=new ht(this.gl,e),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:{uTexture:{value:this.texture},uBloom:{value:this.bloomTexture},uTime:{value:this.scene.time},uRez:{value:[this.scene.width,this.scene.height]},uMouse:{value:Ke.cursor},uVignette:this.config.Vignette,uVignetteStrength:this.config.VignetteStrength,uNoiseOpacity:this.config.NoiseOpacity,uChromaticAberations:this.config.ChromaticAberations,uGamma:this.config.Gamma,uBloomOpacity:this.config.BloomOpacity,uExposure:this.config.Exposure,uContrast:this.config.Contrast,uBlurStrength:{value:this.config.BlurStrength.value},uBlurRadius:{value:this.config.BlurRadius.value},uMoodVignetteRadialStrength:this.config.MoodVignetteRadialStrength,uMoodVignetteMiddleStrength:this.config.MoodVignetteMiddleStrength,uLayer4ColorTop:{value:this.moods.layer4ColorTop},uLayer4ColorBottom:{value:this.moods.layer4ColorBottom},uLayer4Opacity:{value:this.moods.layer4Opacity},uLayer3ColorTop:{value:this.moods.layer3ColorTop},uLayer3ColorBottom:{value:this.moods.layer3ColorBottom},uLayer3Opacity:{value:this.moods.layer3Opacity},uLayer2ColorTop:{value:this.moods.layer2ColorTop},uLayer2ColorBottom:{value:this.moods.layer2ColorBottom},uLayer2Opacity:{value:this.moods.layer2Opacity},uLayer1Color:{value:this.moods.layer1Color},uLayer1Opacity:{value:this.moods.layer1Opacity},uSpritesheetTexture:{value:new be(this.gl)},uSpritesheetOffset:{value:new Ff},uTransitionTexture:{value:new be(this.gl)},uTransitionTextureSize:{value:new wt},uTransitionToBlackFactor:{value:0}}}),this.program.cullFace=!1,this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,renderOrder:this.renderOrder})}onLoaded(){this.bloomTexture=new be(this.gl,{rt:this.scene.bloomPass.rts[0],width:this.scene.bloomPass.rts[0].width,height:this.scene.bloomPass.rts[0].height}),this.program.uniforms.uBloom.value=this.bloomTexture,this.scene.spritesheetManager.fetchSpritesheetData().then(([t,i])=>{this.setSpritesheet(t,i)});const e=this.scene.textureLoader.getTexture("background_gallery");e.needsUpdate=!0,this.program.uniforms.uTransitionTexture.value=e,this.program.uniforms.uTransitionTextureSize.value.set(e.image.width,e.image.height)}setSpritesheet(e,t){this.program.uniforms.uSpritesheetTexture.value=e,e.needsUpdate=!0,this.spritesheetOffsets=t}getActiveOffset(){const e=this.spritesheetOffsets[this.activeSpritesheetOffset];return e&&Xl.set(e.startU,e.endU,e.startV,e.endV),Xl}preRender(){this.moods.preRender()}postRender(){this.rt.postRender()}render(){this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uRez.value=[this.scene.width,this.scene.height],this.program.uniforms.uMouse.value=Ke.cursor,this.blurMultiplierAmount=1,this.blurMultiplierAmount+=this.scene.islandsManager.progressDelta*this.config.BlurMultiplier.value;const e=.004*(1-Math.abs(gt(this.scene.animationsManager.introProgress,.15,.6,-1,1,!0)));this.blurMultiplierAmount+=e*this.config.BlurMultiplier.value,this.program.uniforms.uBlurStrength.value=this.config.BlurStrength.value*this.blurMultiplierAmount,this.program.uniforms.uBlurRadius.value=this.config.BlurRadius.value*this.blurMultiplierAmount,this.program.uniforms.uLayer4ColorTop.value=this.moods.layer4ColorTop,this.program.uniforms.uLayer4ColorBottom.value=this.moods.layer4ColorBottom,this.program.uniforms.uLayer4Opacity.value=this.moods.layer4Opacity,this.program.uniforms.uLayer3ColorTop.value=this.moods.layer3ColorTop,this.program.uniforms.uLayer3ColorBottom.value=this.moods.layer3ColorBottom,this.program.uniforms.uLayer3Opacity.value=this.moods.layer3Opacity,this.program.uniforms.uLayer2ColorTop.value=this.moods.layer2ColorTop,this.program.uniforms.uLayer2ColorBottom.value=this.moods.layer2ColorBottom,this.program.uniforms.uLayer2Opacity.value=this.moods.layer2Opacity,this.program.uniforms.uLayer1Color.value=this.moods.layer1Color,this.program.uniforms.uLayer1Opacity.value=this.moods.layer1Opacity,this.program.uniforms.uSpritesheetOffset.value=this.getActiveOffset(),this.texture.needsUpdate=!0,this.scene.renderer.render({scene:this.mesh,clear:!0,frustumCull:!1,sort:!1})}resize(){this.rt&&this.rt.onResize()}dispose(){this.mesh.setParent(null),this.geometry.remove(),this.program.remove()}}const Uu={CONFIG_0:{IBLDiffuseFactor:{value:1,params:{min:0,max:2,step:.01}},IBLSpecularFactor:{value:1,params:{min:0,max:2,step:.01}},Environment:{value:"env_default",params:{options:{default:"env_default",papermill:"env_papermill",night_sky:"env_night_sky",coffe_shop:"env_coffe_shop",studio:"env_studio"}}},EnvironmentDiffuse:{value:"env_diffuse",params:{options:{default:"env_diffuse"}}},lightColor:{value:"#abbbc2",params:{}},lightPosition:{value:{x:0,y:40,z:30},params:{x:{step:10},y:{step:10},z:{step:10}}},emissiveColor:{value:"#000000",params:{}},FogColor:{value:"#1d262f",params:{}},FogColorClouds:{value:"#92979f",params:{}},FogNear:{value:8.7,params:{min:0,max:50,step:.01}},FogFar:{value:32,params:{min:0,max:50,step:.01}},lightPower:{value:7.39,params:{min:0,max:10,step:.01}},Alpha:{value:1,params:{min:0,max:1,step:.01}},Debug:{value:"disabled",params:{options:{disabled:"disabled",baseColor:"baseColor",metallic:"metallic",roughness:"roughness",specRef:"specRef",geomOcc:"geomOcc",mcrfctDist:"mcrfctDist",spec:"spec",mathDiff:"mathDiff"}}},OverwriteEnvIBL:{value:!1,type:"bool"},EnvIBL:{value:"placeholder",type:"input-image",input:null}}};ie.addBlade(Uu.CONFIG_0,"PBR_CONFIG",0);function cn(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const ns=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),Kp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Kp&&parseFloat(Kp[1]);const mw="3.2.10";function Kt(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Yl={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},fw=Yl.global||Yl.self||Yl.window||{},oi=typeof process!="object"||String(process)!=="[object process]"||process.browser,Fc=typeof importScripts=="function",vw=typeof window<"u"&&typeof window.orientation<"u",Jp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Jp&&parseFloat(Jp[1]);function ee(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}class gw{constructor(e,t){ee(this,"name",void 0),ee(this,"workerThread",void 0),ee(this,"isRunning",!0),ee(this,"result",void 0),ee(this,"_resolve",()=>{}),ee(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Kt(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Kt(this.isRunning),this.isRunning=!1,this._reject(e)}}class Ql{}const Zl=new Map;function _w(n){Kt(n.source&&!n.url||!n.source&&n.url);let e=Zl.get(n.source||n.url);return e||(n.url&&(e=bw(n.url),Zl.set(n.url,e)),n.source&&(e=Df(n.source),Zl.set(n.source,e))),Kt(e),e}function bw(n){if(!n.startsWith("http"))return n;const e=xw(n);return Df(e)}function Df(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function xw(n){return`try {
  importScripts('`.concat(n,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Lf(n,e=!0,t){const i=t||new Set;if(n){if($p(n))i.add(n);else if($p(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)Lf(n[s],e,i)}}return t===void 0?Array.from(i):[]}function $p(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const eu=()=>{};class Hu{static isSupported(){return typeof Worker<"u"&&oi||typeof Ql<"u"&&!oi}constructor(e){ee(this,"name",void 0),ee(this,"source",void 0),ee(this,"url",void 0),ee(this,"terminated",!1),ee(this,"worker",void 0),ee(this,"onMessage",void 0),ee(this,"onError",void 0),ee(this,"_loadableURL","");const{name:t,source:i,url:s}=e;Kt(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=eu,this.onError=r=>console.log(r),this.worker=oi?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=eu,this.onError=eu,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Lf(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=_w({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Ql(i,{eval:!1})}else if(this.source)e=new Ql(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class yw{static isSupported(){return Hu.isSupported()}constructor(e){ee(this,"name","unnamed"),ee(this,"source",void 0),ee(this,"url",void 0),ee(this,"maxConcurrency",1),ee(this,"maxMobileConcurrency",1),ee(this,"onDebug",()=>{}),ee(this,"reuseWorkers",!0),ee(this,"props",{}),ee(this,"jobQueue",[]),ee(this,"idleQueue",[]),ee(this,"count",0),ee(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,r,o)=>s.done(o),i=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new gw(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Hu({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return vw?this.maxMobileConcurrency:this.maxConcurrency}}const Cw={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class sn{static isSupported(){return Hu.isSupported()}static getWorkerFarm(e={}){return sn._workerFarm=sn._workerFarm||new sn({}),sn._workerFarm.setProps(e),sn._workerFarm}constructor(e){ee(this,"props",void 0),ee(this,"workerPools",new Map),this.props={...Cw},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let r=this.workerPools.get(t);return r||(r=new yw({name:t,source:i,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ee(sn,"_workerFarm",void 0);const Sw="latest";function ww(n,e={}){const t=e[n.id]||{},i="".concat(n.id,"-worker.js");let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(n.module,"/dist/").concat(i)),!s){let r=n.version;r==="latest"&&(r=Sw);const o=r?"@".concat(r):"";s="https://unpkg.com/@loaders.gl/".concat(n.module).concat(o,"/dist/").concat(i)}return Kt(s),s}function Aw(n,e=mw){Kt(n,"no worker provided");const t=n.version;return!(!e||!t)}const Ew={},Tw=Object.freeze(Object.defineProperty({__proto__:null,default:Ew},Symbol.toStringTag,{value:"Module"})),Mw="3.2.10",tu={};async function li(n,e=null,t={}){return e&&(n=Bw(n,e,t)),tu[n]=tu[n]||Pw(n),await tu[n]}function Bw(n,e,t){if(n.startsWith("http"))return n;const i=t.modules||{};return i[n]?i[n]:oi?t.CDN?(Kt(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(Mw,"/dist/libs/").concat(n)):Fc?"../src/libs/".concat(n):"modules/".concat(e,"/src/libs/").concat(n):"modules/".concat(e,"/dist/libs/").concat(n)}async function Pw(n){if(n.endsWith("wasm"))return await(await fetch(n)).arrayBuffer();if(!oi)try{return Tw&&void 0}catch{return null}if(Fc)return importScripts(n);const t=await(await fetch(n)).text();return Iw(t,n)}function Iw(n,e){if(!oi)return;if(Fc)return eval.call(fw,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}function Rw(n,e){return!sn.isSupported()||!oi&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function Ow(n,e,t,i,s){const r=n.id,o=ww(n,t),p=sn.getWorkerFarm(t).getWorkerPool({name:r,url:o});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const m=await p.startJob("process-on-worker",Fw.bind(null,s));return m.postMessage("process",{input:e,options:t,context:i}),await(await m.result).result}async function Fw(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:r,options:o}=i;try{const c=await n(r,o);e.postMessage("done",{id:s,result:c})}catch(c){const p=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:s,error:p})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function Dw(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?qp(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?qp(n,0,e):""}function qp(n,e,t){if(n.byteLength<=e+t)return"";const i=new DataView(n);let s="";for(let r=0;r<t;r++)s+=String.fromCharCode(i.getUint8(e+r));return s}function Lw(n){try{return JSON.parse(n)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(Dw(n),'"'))}}function Nf(n){return n&&typeof n=="object"&&n.isBuffer}function Nw(n){return Nf(n)?new Uint8Array(n.buffer,n.byteOffset,n.length).slice().buffer:n}function kf(n){if(Nf(n))return Nw(n);if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function kw(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0}function zw(...n){const e=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),t=e.reduce((r,o)=>r+o.byteLength,0),i=new Uint8Array(t);let s=0;for(const r of e)i.set(r,s),s+=r.byteLength;return i.buffer}function zf(n,e,t){const i=t!==void 0?new Uint8Array(n).subarray(e,e+t):new Uint8Array(n).subarray(e);return new Uint8Array(i).buffer}function Ba(n,e){return cn(n>=0),cn(e>0),n+(e-1)&~(e-1)}function Uw(n,e,t){let i;if(n instanceof ArrayBuffer)i=new Uint8Array(n);else{const s=n.byteOffset,r=n.byteLength;i=new Uint8Array(n.buffer||n.arrayBuffer,s,r)}return e.set(i,t),t+Ba(i.byteLength,4)}async function Hw(n){const e=[];for await(const t of n)e.push(t);return zw(...e)}let Gw="";const Xp={};function Vw(n){for(const e in Xp)if(n.startsWith(e)){const t=Xp[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat(Gw).concat(n)),n}function Ww(n){const e=n&&n.lastIndexOf("/");return e>=0?n.substr(e+1):""}const jw=n=>typeof n=="boolean",oa=n=>typeof n=="function",Pa=n=>n!==null&&typeof n=="object",Yp=n=>Pa(n)&&n.constructor==={}.constructor,Kw=n=>n&&typeof n[Symbol.iterator]=="function",Jw=n=>n&&typeof n[Symbol.asyncIterator]=="function",ls=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,us=n=>typeof Blob<"u"&&n instanceof Blob,$w=n=>n&&typeof n=="object"&&n.isBuffer,qw=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Pa(n)&&oa(n.tee)&&oa(n.cancel)&&oa(n.getReader),Xw=n=>Pa(n)&&oa(n.read)&&oa(n.pipe)&&jw(n.readable),Uf=n=>qw(n)||Xw(n),Yw=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qw=/^([-\w.]+\/[-\w.+]+)/;function Zw(n){const e=Qw.exec(n);return e?e[1]:n}function Qp(n){const e=Yw.exec(n);return e?e[1]:""}const eA=/\?.*/;function io(n){if(ls(n)){const e=nu(n.url||""),t=n.headers.get("content-type")||"";return{url:e,type:Zw(t)||Qp(e)}}return us(n)?{url:nu(n.name||""),type:n.type||""}:typeof n=="string"?{url:nu(n),type:Qp(n)}:{url:"",type:""}}function tA(n){return ls(n)?n.headers["content-length"]||-1:us(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}function nu(n){return n.replace(eA,"")}async function Hf(n){if(ls(n))return n;const e={},t=tA(n);t>=0&&(e["content-length"]=String(t));const{url:i,type:s}=io(n);s&&(e["content-type"]=s);const r=await sA(n);r&&(e["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function nA(n){if(!n.ok){const e=await iA(n);throw new Error(e)}}async function iA(n){let e="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{const t=n.headers.get("Content-Type");let i=n.statusText;t.includes("application/json")&&(i+=" ".concat(await n.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function sA(n){if(typeof n=="string")return"data:,".concat(n.slice(0,5));if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=r=>{var o;return i(r==null||(o=r.target)===null||o===void 0?void 0:o.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5),i=aA(t);return"data:base64,".concat(i)}return null}function aA(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}async function Zp(n,e){if(typeof n=="string"){n=Vw(n);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(n,t)}return await Hf(n)}function rA(n){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=n||e;return!!(t&&t.indexOf("Electron")>=0)}function Ia(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||rA()}const _r={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},vr=_r.window||_r.self||_r.global,Qs=_r.process||{},Gf=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ia();function oA(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class lA{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";ee(this,"storage",void 0),ee(this,"id",void 0),ee(this,"config",{}),this.storage=oA(i),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function uA(n){let e;return n<10?e="".concat(n.toFixed(2),"ms"):n<100?e="".concat(n.toFixed(1),"ms"):n<1e3?e="".concat(n.toFixed(0),"ms"):e="".concat((n/1e3).toFixed(2),"s"),e}function cA(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-n.length,0);return"".concat(" ".repeat(t)).concat(n)}function iu(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>i&&(t=Math.min(t,i/n.width));const r=n.width*t,o=n.height*t,c=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(r/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(s,");"),"background-size:".concat(r,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),c]}let Gr;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Gr||(Gr={}));function ed(n){return typeof n=="string"?Gr[n.toUpperCase()]||Gr.WHITE:n}function hA(n,e,t){return!Ia&&typeof n=="string"&&(e&&(e=ed(e),n="\x1B[".concat(e,"m").concat(n,"\x1B[39m")),t&&(e=ed(t),n="\x1B[".concat(t+10,"m").concat(n,"\x1B[49m"))),n}function pA(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t);for(const s of i)typeof n[s]=="function"&&(e.find(r=>s===r)||(n[s]=n[s].bind(n)))}function Vr(n,e){if(!n)throw new Error(e||"Assertion failed")}function ki(){let n;if(Ia&&"performance"in vr){var e,t;n=vr==null||(e=vr.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Qs){var i;const s=Qs==null||(i=Qs.hrtime)===null||i===void 0?void 0:i.call(Qs);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const zi={debug:Ia&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},dA={enabled:!0,level:0};function St(){}const td={},nd={once:!0};class Dc{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};ee(this,"id",void 0),ee(this,"VERSION",Gf),ee(this,"_startTs",ki()),ee(this,"_deltaTs",ki()),ee(this,"_storage",void 0),ee(this,"userData",{}),ee(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new lA("__probe-".concat(this.id,"__"),dA),this.userData={},this.timeStamp("".concat(this.id," started")),pA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ki()-this._startTs).toPrecision(10))}getDelta(){return Number((ki()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Vr(e,t)}warn(e){return this._getLogFunction(0,e,zi.warn,arguments,nd)}error(e){return this._getLogFunction(0,e,zi.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,zi.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,zi.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];return this._getLogFunction(e,t,zi.debug||zi.info,arguments,nd)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||St,i&&[i],{tag:gA(t)}):St}image(e){let{logLevel:t,priority:i,image:s,message:r="",scale:o=1}=e;return this._shouldLog(t||i)?Ia?vA({image:s,message:r,scale:o}):fA({image:s,message:r,scale:o}):St}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||St)}group(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=id({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||St)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Vf(e)}_getLogFunction(e,t,i,s,r){if(this._shouldLog(e)){r=id({logLevel:e,message:t,args:s,opts:r}),i=i||r.method,Vr(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=ki();const o=r.tag||r.message;if(r.once)if(!td[o])td[o]=ki();else return St;return t=mA(this.id,r.message,r),i.bind(console,t,...r.args)}return St}}ee(Dc,"VERSION",Gf);function Vf(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Vr(Number.isFinite(e)&&e>=0),e}function id(n){const{logLevel:e,message:t}=n;n.logLevel=Vf(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Vr(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function mA(n,e,t){if(typeof e=="string"){const i=t.time?cA(uA(t.total)):"";e=t.time?"".concat(n,": ").concat(i,"  ").concat(e):"".concat(n,": ").concat(e),e=hA(e,t.color,t.background)}return e}function fA(n){let{image:e,message:t="",scale:i=1}=n;return(void 0)({image:e,message:t,scale:i}),St}function vA(n){let{image:e,message:t="",scale:i=1}=n;if(typeof e=="string"){const r=new Image;return r.onload=()=>{const o=iu(r,t,i);console.log(...o)},r.src=e,St}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...iu(e,t,i)),St;if(s.toLowerCase()==="canvas"){const r=new Image;return r.onload=()=>console.log(...iu(r,t,i)),r.src=e.toDataURL(),St}return St}function gA(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const sd=new Dc({id:"loaders.gl"});class _A{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class bA{constructor(){ee(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Wf={fetch:null,mimeType:void 0,nothrow:!1,log:new bA,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ns,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},xA={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function jf(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}const Kf=()=>{const n=jf();return n.globalOptions=n.globalOptions||{...Wf},n.globalOptions};function yA(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],CA(n,t),wA(e,n,i)}function Jf(n,e){const t=Kf(),i=n||t;return typeof i.fetch=="function"?i.fetch:Pa(i.fetch)?s=>Zp(s,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Zp}function CA(n,e){ad(n,null,Wf,xA,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},r=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};ad(i,t.id,s,r,e)}}function ad(n,e,t,i,s){const r=e||"Top level",o=e?"".concat(e,"."):"";for(const c in n){const p=!e&&Pa(n[c]),m=c==="baseUri"&&!e,_=c==="workerUrl"&&e;if(!(c in t)&&!m&&!_){if(c in i)sd.warn("".concat(r," loader option '").concat(o).concat(c,"' no longer supported, use '").concat(i[c],"'"))();else if(!p){const v=SA(c,s);sd.warn("".concat(r," loader option '").concat(o).concat(c,"' not recognized. ").concat(v))()}}}}function SA(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const r in s.options){if(n===r)return"Did you mean '".concat(s.id,".").concat(r,"'?");const o=r.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(i=i||"Did you mean '".concat(s.id,".").concat(r,"'?"))}return i}function wA(n,e,t){const s={...n.options||{}};return AA(s,t),s.log===null&&(s.log=new _A),rd(s,Kf()),rd(s,e),s}function rd(n,e){for(const t in e)if(t in e){const i=e[t];Yp(i)&&Yp(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function AA(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Lc(n){var e;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((e=n)===null||e===void 0?void 0:e.extensions)):!1}function $f(n){var e,t;cn(n,"null loader"),cn(Lc(n),"invalid loader");let i;return Array.isArray(n)&&(i=n[1],n=n[0],n={...n,options:{...n.options,...i}}),((e=n)!==null&&e!==void 0&&e.parseTextSync||(t=n)!==null&&t!==void 0&&t.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const EA=()=>{const n=jf();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function TA(){return EA()}const MA=new Dc({id:"loaders.gl"}),BA=/\.([^.]+)$/;async function PA(n,e=[],t,i){if(!qf(n))return null;let s=od(n,e,{...t,nothrow:!0},i);if(s)return s;if(us(n)&&(n=await n.slice(0,10).arrayBuffer(),s=od(n,e,t,i)),!s&&!(t!=null&&t.nothrow))throw new Error(Xf(n));return s}function od(n,e=[],t,i){if(!qf(n))return null;if(e&&!Array.isArray(e))return $f(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...TA()),RA(s);const r=IA(n,s,t,i);if(!r&&!(t!=null&&t.nothrow))throw new Error(Xf(n));return r}function IA(n,e,t,i){const{url:s,type:r}=io(n),o=s||(i==null?void 0:i.url);let c=null,p="";if(t!=null&&t.mimeType&&(c=su(e,t==null?void 0:t.mimeType),p="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),c=c||OA(e,o),p=p||(c?"matched url ".concat(o):""),c=c||su(e,r),p=p||(c?"matched MIME type ".concat(r):""),c=c||DA(e,n),p=p||(c?"matched initial data ".concat(Yf(n)):""),c=c||su(e,t==null?void 0:t.fallbackMimeType),p=p||(c?"matched fallback MIME type ".concat(r):""),p){var m;MA.log(1,"selectLoader selected ".concat((m=c)===null||m===void 0?void 0:m.name,": ").concat(p,"."))}return c}function qf(n){return!(n instanceof Response&&n.status===204)}function Xf(n){const{url:e,type:t}=io(n);let i="No valid loader found (";i+=e?"".concat(Ww(e),", "):"no url provided, ",i+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const s=n?Yf(n):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function RA(n){for(const e of n)$f(e)}function OA(n,e){const t=e&&BA.exec(e),i=t&&t[1];return i?FA(n,i):null}function FA(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function su(n,e){for(const t of n)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function DA(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(LA(e,t))return t}else if(ArrayBuffer.isView(e)){if(ld(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&ld(e,0,t))return t;return null}function LA(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function ld(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>NA(n,e,t,s))}function NA(n,e,t,i){if(i instanceof ArrayBuffer)return kw(i,n,i.byteLength);switch(typeof i){case"function":return i(n,t);case"string":const s=Gu(n,e,i.length);return i===s;default:return!1}}function Yf(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Gu(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Gu(n,0,e):""}function Gu(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let r=0;r<t;r++)s+=String.fromCharCode(i.getUint8(e+r));return s}const kA=256*1024;function*zA(n,e){const t=(e==null?void 0:e.chunkSize)||kA;let i=0;const s=new TextEncoder;for(;i<n.length;){const r=Math.min(n.length-i,t),o=n.slice(i,i+r);i+=r,yield s.encode(o)}}const UA=256*1024;function*HA(n,e={}){const{chunkSize:t=UA}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),r=new ArrayBuffer(s),o=new Uint8Array(n,i,s);new Uint8Array(r).set(o),i+=s,yield r}}const GA=1024*1024;async function*VA(n,e){const t=(e==null?void 0:e.chunkSize)||GA;let i=0;for(;i<n.size;){const s=i+t,r=await n.slice(i,s).arrayBuffer();i=s,yield r}}function ud(n,e){return ns?WA(n,e):jA(n)}async function*WA(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e!=null&&e._streamReadAhead&&(i=t.read());const{done:r,value:o}=await s;if(r)return;yield kf(o)}}catch{t.releaseLock()}}async function*jA(n,e){for await(const t of n)yield kf(t)}function KA(n,e){if(typeof n=="string")return zA(n,e);if(n instanceof ArrayBuffer)return HA(n,e);if(us(n))return VA(n,e);if(Uf(n))return ud(n,e);if(ls(n))return ud(n.body,e);throw new Error("makeIterator")}const Qf="Cannot convert supplied data type";function JA(n,e,t){if(e.text&&typeof n=="string")return n;if($w(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(Qf)}async function $A(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return JA(n,e);if(us(n)&&(n=await Hf(n)),ls(n)){const s=n;return await nA(s),e.binary?await s.arrayBuffer():await s.text()}if(Uf(n)&&(n=KA(n,t)),Kw(n)||Jw(n))return Hw(n);throw new Error(Qf)}function qA(n,e,t=null){if(t)return t;const i={fetch:Jf(e,n),...n};return Array.isArray(i.loaders)||(i.loaders=null),i}function XA(n,e){if(!e&&n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:null}async function Nc(n,e,t,i){Kt(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Lc(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const{url:s}=io(n),o=XA(e,i),c=await PA(n,o,t);return c?(t=yA(t,c,o,s),i=qA({url:s,parse:Nc,loaders:o},t,i),await YA(c,n,t,i)):null}async function YA(n,e,t,i){if(Aw(n),ls(e)){const s=e,{ok:r,redirected:o,status:c,statusText:p,type:m,url:_}=s,v=Object.fromEntries(s.headers.entries());i.response={headers:v,ok:r,redirected:o,status:c,statusText:p,type:m,url:_}}if(e=await $A(e,n,t),n.parseTextSync&&typeof e=="string")return t.dataType="text",n.parseTextSync(e,t,i,n);if(Rw(n,t))return await Ow(n,e,t,i,Nc);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,i,n);if(n.parse)return await n.parse(e,t,i,n);throw Kt(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}async function cd(n,e,t,i){!Array.isArray(e)&&!Lc(e)&&(t=e,e=void 0);const s=Jf(t);let r=n;return typeof n=="string"&&(r=await s(n)),us(n)&&(r=await s(n)),await Nc(r,e,t)}const Zf="3.2.10",QA="3.2.10",e0="3.2.10",ZA="https://unpkg.com/@loaders.gl/textures@".concat(e0,"/dist/libs/basis_encoder.wasm"),eE="https://unpkg.com/@loaders.gl/textures@".concat(e0,"/dist/libs/basis_encoder.js");let au;async function hd(n){const e=n.modules||{};return e.basis?e.basis:(au=au||tE(n),await au)}async function tE(n){let e=null,t=null;return[e,t]=await Promise.all([await li("basis_transcoder.js","textures",n),await li("basis_transcoder.wasm","textures",n)]),e=e||globalThis.BASIS,await nE(e,t)}function nE(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{n(t).then(s=>{const{BasisFile:r,initializeBasis:o}=s;o(),i({BasisFile:r})})})}let ru;async function pd(n){const e=n.modules||{};return e.basisEncoder?e.basisEncoder:(ru=ru||iE(n),await ru)}async function iE(n){let e=null,t=null;return[e,t]=await Promise.all([await li(eE,"textures",n),await li(ZA,"textures",n)]),e=e||globalThis.BASIS,await sE(e,t)}function sE(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{n(t).then(s=>{const{BasisFile:r,KTX2File:o,initializeBasis:c,BasisEncoder:p}=s;c(),i({BasisFile:r,KTX2File:o,BasisEncoder:p})})})}const Ui={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},aE=["","WEBKIT_","MOZ_"],dd={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let gr=null;function rE(n){if(!gr){n=n||oE()||void 0,gr=new Set;for(const e of aE)for(const t in dd)if(n&&n.getExtension("".concat(e).concat(t))){const i=dd[t];gr.add(i)}}return gr}function oE(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var md,fd,vd,gd,_d,bd,xd,yd;(function(n){n[n.NONE=0]="NONE",n[n.BASISLZ=1]="BASISLZ",n[n.ZSTD=2]="ZSTD",n[n.ZLIB=3]="ZLIB"})(md||(md={})),function(n){n[n.BASICFORMAT=0]="BASICFORMAT"}(fd||(fd={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.ETC1S=163]="ETC1S",n[n.UASTC=166]="UASTC"}(vd||(vd={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SRGB=1]="SRGB"}(gd||(gd={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.LINEAR=1]="LINEAR",n[n.SRGB=2]="SRGB",n[n.ITU=3]="ITU",n[n.NTSC=4]="NTSC",n[n.SLOG=5]="SLOG",n[n.SLOG2=6]="SLOG2"}(_d||(_d={})),function(n){n[n.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",n[n.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(bd||(bd={})),function(n){n[n.RGB=0]="RGB",n[n.RRR=3]="RRR",n[n.GGG=4]="GGG",n[n.AAA=15]="AAA"}(xd||(xd={})),function(n){n[n.RGB=0]="RGB",n[n.RGBA=3]="RGBA",n[n.RRR=4]="RRR",n[n.RRRG=5]="RRRG"}(yd||(yd={}));const ft=[171,75,84,88,32,50,48,187,13,10,26,10];function lE(n){const e=new Uint8Array(n);return!(e.byteLength<ft.length||e[0]!==ft[0]||e[1]!==ft[1]||e[2]!==ft[2]||e[3]!==ft[3]||e[4]!==ft[4]||e[5]!==ft[5]||e[6]!==ft[6]||e[7]!==ft[7]||e[8]!==ft[8]||e[9]!==ft[9]||e[10]!==ft[10]||e[11]!==ft[11])}const uE={etc1:{basisFormat:0,compressed:!0,format:Ui.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Ui.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Ui.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Ui.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Ui.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Ui.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function cE(n,e){if(e.basis.containerFormat==="auto"){if(lE(n)){const i=await pd(e);return Cd(i.KTX2File,n,e)}const{BasisFile:t}=await hd(e);return ou(t,n,e)}switch(e.basis.module){case"encoder":const t=await pd(e);switch(e.basis.containerFormat){case"ktx2":return Cd(t.KTX2File,n,e);case"basis":default:return ou(t.BasisFile,n,e)}case"transcoder":default:const{BasisFile:i}=await hd(e);return ou(i,n,e)}}function ou(n,e,t){const i=new n(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const s=i.getNumImages(),r=[];for(let o=0;o<s;o++){const c=i.getNumLevels(o),p=[];for(let m=0;m<c;m++)p.push(hE(i,o,m,t));r.push(p)}return r}finally{i.close(),i.delete()}}function hE(n,e,t,i){const s=n.getImageWidth(e,t),r=n.getImageHeight(e,t),o=n.getHasAlpha(),{compressed:c,format:p,basisFormat:m}=t0(i,o),_=n.getImageTranscodedSizeInBytes(e,t,m),v=new Uint8Array(_);if(!n.transcodeImage(v,e,t,m,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:r,data:v,compressed:c,format:p,hasAlpha:o}}function Cd(n,e,t){const i=new n(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=i.getLevels(),r=[];for(let o=0;o<s;o++){r.push(pE(i,o,t));break}return[r]}finally{i.close(),i.delete()}}function pE(n,e,t){const{alphaFlag:i,height:s,width:r}=n.getImageLevelInfo(e,0,0),{compressed:o,format:c,basisFormat:p}=t0(t,i),m=n.getImageTranscodedSizeInBytes(e,0,0,p),_=new Uint8Array(m);if(!n.transcodeImage(_,e,0,0,p,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:s,data:_,compressed:o,hasAlpha:i,format:c}}function t0(n,e){let t=n&&n.basis&&n.basis.format;return t==="auto"&&(t=n0()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),uE[t]}function n0(){const n=rE();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const dE={name:"Basis",id:"basis",module:"textures",version:QA,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},mE={...dE,parse:cE},fE="3.2.10",{_parseImageNode:vE}=globalThis,Vu=typeof Image<"u",Wu=typeof ImageBitmap<"u",gE=Boolean(vE),ju=ns?!0:gE;function _E(n){switch(n){case"auto":return Wu||Vu||ju;case"imagebitmap":return Wu;case"image":return Vu;case"data":return ju;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}function bE(){if(Wu)return"imagebitmap";if(Vu)return"image";if(ju)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function xE(n){const e=CE(n);if(!e)throw new Error("Not an image");return e}function yE(n){switch(xE(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function CE(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const SE=/^data:image\/svg\+xml/,wE=/\.svg((\?|#).*)?$/;function kc(n){return n&&(SE.test(n)||wE.test(n))}function AE(n,e){if(kc(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(r){throw new Error(r.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return i0(n,e)}function i0(n,e){if(kc(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function s0(n,e,t){const i=AE(n,t),s=self.URL||self.webkitURL,r=typeof i!="string"&&s.createObjectURL(i);try{return await EE(r||i,e)}finally{r&&s.revokeObjectURL(r)}}async function EE(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=r=>s(new Error("Could not load image ".concat(n,": ").concat(r)))}catch(r){s(r)}})}const TE={};let Sd=!0;async function ME(n,e,t){let i;kc(t)?i=await s0(n,e,t):i=i0(n,t);const s=e&&e.imagebitmap;return await BE(i,s)}async function BE(n,e=null){if((PE(e)||!Sd)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),Sd=!1}return await createImageBitmap(n)}function PE(n){for(const e in n||TE)return!1;return!0}const Wt=!1,la=!0;function zc(n){const e=Ra(n);return IE(e)||FE(e)||RE(e)||OE(e)}function IE(n){const e=Ra(n);return e.byteLength>=24&&e.getUint32(0,Wt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Wt),height:e.getUint32(20,Wt)}:null}function RE(n){const e=Ra(n);return e.byteLength>=10&&e.getUint32(0,Wt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,la),height:e.getUint16(8,la)}:null}function OE(n){const e=Ra(n);return e.byteLength>=14&&e.getUint16(0,Wt)===16973&&e.getUint32(2,la)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,la),height:e.getUint32(22,la)}:null}function FE(n){const e=Ra(n);if(!(e.byteLength>=3&&e.getUint16(0,Wt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=DE();let r=2;for(;r+9<e.byteLength;){const o=e.getUint16(r,Wt);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(r+5,Wt),width:e.getUint16(r+7,Wt)};if(!i.has(o))return null;r+=2,r+=e.getUint16(r,Wt)}return null}function DE(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ra(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function LE(n,e){const{mimeType:t}=zc(n)||{},i=globalThis._parseImageNode;return cn(i),await i(n,t)}async function NE(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:r}=t||{},o=kE(s);let c;switch(o){case"imagebitmap":c=await ME(n,e,r);break;case"image":c=await s0(n,e,r);break;case"data":c=await LE(n);break;default:cn(!1)}return s==="data"&&(c=yE(c)),c}function kE(n){switch(n){case"auto":case"data":return bE();default:return _E(n),n}}const zE=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],UE=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],HE={image:{type:"auto",decode:!0}},GE={id:"image",module:"images",name:"Images",version:fE,mimeTypes:UE,extensions:zE,parse:NE,tests:[n=>Boolean(zc(new DataView(n)))],options:HE},VE=["image/png","image/jpeg","image/gif"],lu={};function WE(n){return lu[n]===void 0&&(lu[n]=jE(n)),lu[n]}function jE(n){switch(n){case"image/webp":return KE();case"image/svg":return ns;default:if(!ns){const{_parseImageNode:e}=globalThis;return Boolean(e)&&VE.includes(n)}return!0}}function KE(){if(!ns)return!1;try{return document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}}function bt(n,e){if(!n)throw new Error(e||"assert failed: gltf")}function a0(n,e){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(n));return i.substr(0,i.lastIndexOf("/")+1)+n}function JE(n,e,t){const i=n.bufferViews[t];bt(i);const s=i.buffer,r=e[s];bt(r);const o=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,i.byteLength)}const wd=["SCALAR","VEC2","VEC3","VEC4"],$E=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],qE=new Map($E),XE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},YE={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},QE={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function r0(n){return wd[n-1]||wd[0]}function o0(n){const e=qE.get(n.constructor);if(!e)throw new Error("Illegal typed array");return e}function l0(n,e){const t=QE[n.componentType],i=XE[n.type],s=YE[n.componentType],r=n.count*i,o=n.count*i*s;return bt(o>=0&&o<=e.byteLength),{ArrayType:t,length:r,byteLength:o}}const ZE={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class At{constructor(e){ee(this,"gltf",void 0),ee(this,"sourceBuffers",void 0),ee(this,"byteLength",void 0),this.gltf=e||{json:{...ZE},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(s=>s===e),i=this.json.extensions||{};return t?i[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];bt(i);const s=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,{ArrayType:r,length:o}=l0(e,t),c=t.byteOffset+e.byteOffset;return new r(s,c,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(s,r,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const s=e.extensions||{};s[t]=i}removeObjectExtension(e,t){const i=e.extensions||{},s=i[t];return delete i[t],s}addExtension(e,t={}){return bt(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return bt(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const s={mesh:t};return i&&(s.matrix=i),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:s,mode:r=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(i){const p=this._addIndices(i);c.primitives[0].indices=p}return Number.isFinite(s)&&(c.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,t){const i=zc(e),s=t||(i==null?void 0:i.mimeType),o={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const t=e.byteLength;bt(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Ba(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:r0(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let s={min:t.min,max:t.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:o0(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const i=this.byteLength,s=new ArrayBuffer(i),r=new Uint8Array(s);let o=0;for(const c of this.sourceBuffers||[])o=Uw(c,r,o);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=s,this.sourceBuffers=[s]}_removeStringFromArray(e,t){let i=!0;for(;i;){const s=e.indexOf(t);s>-1?e.splice(s,1):i=!1}}_addAttributes(e={}){const t={};for(const i in e){const s=e[i],r=this._getGltfAttributeName(i),o=this.addBinaryBuffer(s.value,s);t[r]=o}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const s=e.subarray(0,t);for(const r of s)i.min.push(r),i.max.push(r);for(let r=t;r<e.length;r+=t)for(let o=0;o<t;o++)i.min[0+o]=Math.min(i.min[0+o],e[r+o]),i.max[0+o]=Math.max(i.max[0+o],e[r+o]);return i}}const eT="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",tT="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",nT=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),iT=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),sT={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},aT={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function rT(n,e,t,i,s,r="NONE"){const o=await oT();cT(o,o.exports[aT[s]],n,e,t,i,o.exports[sT[r||"NONE"]])}let uu;async function oT(){return uu||(uu=lT()),uu}async function lT(){let n=eT;WebAssembly.validate(nT)&&(n=tT,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(uT(n),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function uT(n){const e=new Uint8Array(n.length);for(let i=0;i<n.length;++i){const s=n.charCodeAt(i);e[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let t=0;for(let i=0;i<n.length;++i)e[t++]=e[i]<60?iT[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,t)}function cT(n,e,t,i,s,r,o){const c=n.exports.sbrk,p=i+3&-4,m=c(p*s),_=c(r.length),v=new Uint8Array(n.exports.memory.buffer);v.set(r,_);const g=e(m,i,s,_,r.length);if(g===0&&o&&o(m,p,s),t.set(v.subarray(m,m+i*s)),c(m-c(0)),g!==0)throw new Error("Malformed buffer data: ".concat(g))}const Uc="EXT_meshopt_compression",hT=Uc;async function pT(n,e){var t;const i=new At(n);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const s=[];for(const r of n.json.bufferViews||[])s.push(dT(i,r));await Promise.all(s),i.removeExtension(Uc)}async function dT(n,e){const t=n.getObjectExtension(e,Uc);if(t){const{byteOffset:i=0,byteLength:s=0,byteStride:r,count:o,mode:c,filter:p="NONE",buffer:m}=t,_=n.gltf.buffers[m],v=new Uint8Array(_.arrayBuffer,_.byteOffset+i,s),g=new Uint8Array(n.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await rT(g,o,r,v,c,p),g}return null}const mT=Object.freeze(Object.defineProperty({__proto__:null,name:hT,decode:pT},Symbol.toStringTag,{value:"Module"})),Hi="EXT_texture_webp",fT=Hi;function vT(n,e){const t=new At(n);if(!WE("image/webp")){if(t.getRequiredExtensions().includes(Hi))throw new Error("gltf: Required extension ".concat(Hi," not supported by browser"));return}const{json:i}=t;for(const s of i.textures||[]){const r=t.getObjectExtension(s,Hi);r&&(s.source=r.source),t.removeObjectExtension(s,Hi)}t.removeExtension(Hi)}const gT=Object.freeze(Object.defineProperty({__proto__:null,name:fT,preprocess:vT},Symbol.toStringTag,{value:"Module"})),br="KHR_texture_basisu",_T=br;function bT(n,e){const t=new At(n),{json:i}=t;for(const s of i.textures||[]){const r=t.getObjectExtension(s,br);r&&(s.source=r.source),t.removeObjectExtension(s,br)}t.removeExtension(br)}const xT=Object.freeze(Object.defineProperty({__proto__:null,name:_T,preprocess:bT},Symbol.toStringTag,{value:"Module"})),yT="3.2.10",CT={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},ST={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:yT,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:CT};function wT(n){let e=1/0,t=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;const c=n.POSITION?n.POSITION.value:[],p=c&&c.length;for(let m=0;m<p;m+=3){const _=c[m],v=c[m+1],g=c[m+2];e=_<e?_:e,t=v<t?v:t,i=g<i?g:i,s=_>s?_:s,r=v>r?v:r,o=g>o?g:o}return[[e,t,i],[s,r,o]]}function AT(n,e){if(!n)throw new Error(e||"loader assertion failed.")}class Wi{constructor(e,t){ee(this,"fields",void 0),ee(this,"metadata",void 0),AT(Array.isArray(e)),ET(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(...e){const t=Object.create(null);for(const s of e)t[s]=!0;const i=this.fields.filter(s=>t[s.name]);return new Wi(i,this.metadata)}selectAt(...e){const t=e.map(i=>this.fields[i]).filter(Boolean);return new Wi(t,this.metadata)}assign(e){let t,i=this.metadata;if(e instanceof Wi){const o=e;t=o.fields,i=Ad(Ad(new Map,this.metadata),o.metadata)}else t=e;const s=Object.create(null);for(const o of this.fields)s[o.name]=o;for(const o of t)s[o.name]=o;const r=Object.values(s);return new Wi(r,i)}}function ET(n){const e={};for(const t of n)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function Ad(n,e){return new Map([...n||new Map,...e||new Map])}class Wr{constructor(e,t,i=!1,s=new Map){ee(this,"name",void 0),ee(this,"type",void 0),ee(this,"nullable",void 0),ee(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=i,this.metadata=s}get typeId(){return this.type&&this.type.typeId}clone(){return new Wr(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Pe;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.Float=3]="Float",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct=13]="Struct",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Dictionary=-1]="Dictionary",n[n.Int8=-2]="Int8",n[n.Int16=-3]="Int16",n[n.Int32=-4]="Int32",n[n.Int64=-5]="Int64",n[n.Uint8=-6]="Uint8",n[n.Uint16=-7]="Uint16",n[n.Uint32=-8]="Uint32",n[n.Uint64=-9]="Uint64",n[n.Float16=-10]="Float16",n[n.Float32=-11]="Float32",n[n.Float64=-12]="Float64",n[n.DateDay=-13]="DateDay",n[n.DateMillisecond=-14]="DateMillisecond",n[n.TimestampSecond=-15]="TimestampSecond",n[n.TimestampMillisecond=-16]="TimestampMillisecond",n[n.TimestampMicrosecond=-17]="TimestampMicrosecond",n[n.TimestampNanosecond=-18]="TimestampNanosecond",n[n.TimeSecond=-19]="TimeSecond",n[n.TimeMillisecond=-20]="TimeMillisecond",n[n.TimeMicrosecond=-21]="TimeMicrosecond",n[n.TimeNanosecond=-22]="TimeNanosecond",n[n.DenseUnion=-23]="DenseUnion",n[n.SparseUnion=-24]="SparseUnion",n[n.IntervalDayTime=-25]="IntervalDayTime",n[n.IntervalYearMonth=-26]="IntervalYearMonth"})(Pe||(Pe={}));let u0,c0,h0;class Hc{static isNull(e){return e&&e.typeId===Pe.Null}static isInt(e){return e&&e.typeId===Pe.Int}static isFloat(e){return e&&e.typeId===Pe.Float}static isBinary(e){return e&&e.typeId===Pe.Binary}static isUtf8(e){return e&&e.typeId===Pe.Utf8}static isBool(e){return e&&e.typeId===Pe.Bool}static isDecimal(e){return e&&e.typeId===Pe.Decimal}static isDate(e){return e&&e.typeId===Pe.Date}static isTime(e){return e&&e.typeId===Pe.Time}static isTimestamp(e){return e&&e.typeId===Pe.Timestamp}static isInterval(e){return e&&e.typeId===Pe.Interval}static isList(e){return e&&e.typeId===Pe.List}static isStruct(e){return e&&e.typeId===Pe.Struct}static isUnion(e){return e&&e.typeId===Pe.Union}static isFixedSizeBinary(e){return e&&e.typeId===Pe.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===Pe.FixedSizeList}static isMap(e){return e&&e.typeId===Pe.Map}static isDictionary(e){return e&&e.typeId===Pe.Dictionary}get typeId(){return Pe.NONE}compareTo(e){return this===e}}u0=Symbol.toStringTag;class cs extends Hc{constructor(e,t){super(),ee(this,"isSigned",void 0),ee(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return Pe.Int}get[u0](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class TT extends cs{constructor(){super(!0,8)}}class MT extends cs{constructor(){super(!0,16)}}class BT extends cs{constructor(){super(!0,32)}}class PT extends cs{constructor(){super(!1,8)}}class IT extends cs{constructor(){super(!1,16)}}class RT extends cs{constructor(){super(!1,32)}}const p0={HALF:16,SINGLE:32,DOUBLE:64};c0=Symbol.toStringTag;class d0 extends Hc{constructor(e){super(),ee(this,"precision",void 0),this.precision=e}get typeId(){return Pe.Float}get[c0](){return"Float"}toString(){return"Float".concat(this.precision)}}class OT extends d0{constructor(){super(p0.SINGLE)}}class FT extends d0{constructor(){super(p0.DOUBLE)}}h0=Symbol.toStringTag;class DT extends Hc{constructor(e,t){super(),ee(this,"listSize",void 0),ee(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return Pe.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[h0](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function LT(n){switch(n.constructor){case Int8Array:return new TT;case Uint8Array:return new PT;case Int16Array:return new MT;case Uint16Array:return new IT;case Int32Array:return new BT;case Uint32Array:return new RT;case Float32Array:return new OT;case Float64Array:return new FT;default:throw new Error("array type not supported")}}function NT(n,e,t){const i=LT(e.value),s=t||kT(e);return new Wr(n,new DT(e.size,new Wr("value",i)),!1,s)}function kT(n){const e=new Map;return"byteOffset"in n&&e.set("byteOffset",n.byteOffset.toString(10)),"byteStride"in n&&e.set("byteStride",n.byteStride.toString(10)),"normalized"in n&&e.set("normalized",n.normalized.toString()),e}function zT(n,e,t){const i=m0(e.metadata),s=[],r=UT(e.attributes);for(const o in n){const c=n[o],p=Ed(o,c,r[o]);s.push(p)}if(t){const o=Ed("indices",t);s.push(o)}return new Wi(s,i)}function UT(n){const e={};for(const t in n){const i=n[t];e[i.name||"undefined"]=i}return e}function Ed(n,e,t){const i=t?m0(t.metadata):void 0;return NT(n,e,i)}function m0(n){const e=new Map;for(const t in n)e.set("".concat(t,".string"),JSON.stringify(n[t]));return e}const Td={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},HT={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},GT=4;class VT{constructor(e){ee(this,"draco",void 0),ee(this,"decoder",void 0),ee(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const s=this.decoder.GetEncodedGeometryType(i),r=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(s){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!r.ptr){const g="DRACO decompression failed: ".concat(o.error_msg());throw new Error(g)}const c=this._getDracoLoaderData(r,s,t),p=this._getMeshData(r,c,t),m=wT(p.attributes),_=zT(p.attributes,c,p.indices);return{loader:"draco",loaderData:c,header:{vertexCount:r.num_points(),boundingBox:m},...p,schema:_}}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,i){const s=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:r}}_getDracoAttributes(e,t){const i={};for(let s=0;s<e.num_attributes();s++){const r=this.decoder.GetAttribute(e,s),o=this._getAttributeMetadata(e,s);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:s,metadata:o};const c=this._getQuantizationTransform(r,t);c&&(i[r.unique_id()].quantization_transform=c);const p=this._getOctahedronTransform(r,t);p&&(i[r.unique_id()].octahedron_transform=p)}return i}_getMeshData(e,t,i){const s=this._getMeshAttributes(t,e,i);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,t,i){const s={};for(const r of Object.values(e.attributes)){const o=this._deduceAttributeName(r,i);r.name=o;const{value:c,size:p}=this._getAttributeValues(t,r);s[o]={value:c,size:p,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return s}_getTriangleListIndices(e){const i=e.num_faces()*3,s=i*GT,r=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,r),new Uint32Array(this.draco.HEAPF32.buffer,r,i).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),KT(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const i=HT[t.data_type],s=t.num_components,o=e.num_points()*s,c=o*i.BYTES_PER_ELEMENT,p=WT(this.draco,i);let m;const _=this.draco._malloc(c);try{const v=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,v,p,c,_),m=new i(this.draco.HEAPF32.buffer,_,o).slice()}finally{this.draco._free(_)}return{value:m,size:s}}_deduceAttributeName(e,t){const i=e.unique_id;for(const[o,c]of Object.entries(t.extraAttributes||{}))if(c===i)return o;const s=e.attribute_type;for(const o in Td)if(this.draco[o]===s)return Td[o];const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},i=this.metadataQuerier.NumEntries(e);for(let s=0;s<i;s++){const r=this.metadataQuerier.GetEntryName(e,s);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);const s=jT(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:s}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,s=[...t,...i];for(const r of s)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:i=[]}=t,s=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(s)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(c=>o.min_value(c))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:i=[]}=t,s=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(s)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function WT(n,e){switch(e){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function jT(n){const e=n.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=n.GetValue(i);return t}function KT(n){const e=n.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=n.GetValue(i);return t}const Gc="1.4.1",JT="https://www.gstatic.com/draco/versioned/decoders/".concat(Gc,"/draco_decoder.js"),$T="https://www.gstatic.com/draco/versioned/decoders/".concat(Gc,"/draco_wasm_wrapper.js"),qT="https://www.gstatic.com/draco/versioned/decoders/".concat(Gc,"/draco_decoder.wasm");let Zs;async function XT(n){const e=n.modules||{};return e.draco3d?Zs=Zs||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Zs=Zs||YT(n),await Zs}async function YT(n){let e,t;switch(n.draco&&n.draco.decoderType){case"js":e=await li(JT,"draco",n);break;case"wasm":default:[e,t]=await Promise.all([await li($T,"draco",n),await li(qT,"draco",n)])}return e=e||globalThis.DracoDecoderModule,await QT(e,t)}function QT(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{n({...t,onModuleLoaded:s=>i({draco:s})})})}const f0={...ST,parse:ZT};async function ZT(n,e){const{draco:t}=await XT(e),i=new VT(t);try{return i.parseSync(n,e==null?void 0:e.draco)}finally{i.destroy()}}function e2(n){const e={};for(const t in n){const i=n[t];if(t!=="indices"){const s=v0(i);e[t]=s}}return e}function v0(n){const{buffer:e,size:t,count:i}=t2(n);return{value:e,size:t,byteOffset:0,count:i,type:r0(t),componentType:o0(e)}}function t2(n){let e=n,t=1,i=0;return n&&n.value&&(e=n.value,t=n.size||1),e&&(ArrayBuffer.isView(e)||(e=n2(e,Float32Array)),i=e.length/t),{buffer:e,size:t,count:i}}function n2(n,e,t=!1){return n?Array.isArray(n)?new e(n):t&&!(n instanceof e)?new e(n):n:null}const fi="KHR_draco_mesh_compression",i2=fi;function s2(n,e,t){const i=new At(n);for(const s of g0(i))i.getObjectExtension(s,fi)}async function a2(n,e,t){var i;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const s=new At(n),r=[];for(const o of g0(s))s.getObjectExtension(o,fi)&&r.push(o2(s,o,e,t));await Promise.all(r),s.removeExtension(fi)}function r2(n,e={}){const t=new At(n);for(const i of t.json.meshes||[])l2(i),t.addRequiredExtension(fi)}async function o2(n,e,t,i){const s=n.getObjectExtension(e,fi);if(!s)return;const r=n.getTypedArrayForBufferView(s.bufferView),o=zf(r.buffer,r.byteOffset),{parse:c}=i,p={...t};delete p["3d-tiles"];const m=await c(o,f0,p,i),_=e2(m.attributes);for(const[v,g]of Object.entries(_))if(v in e.attributes){const C=e.attributes[v],S=n.getAccessor(C);S!=null&&S.min&&S!==null&&S!==void 0&&S.max&&(g.min=S.min,g.max=S.max)}e.attributes=_,m.indices&&(e.indices=v0(m.indices)),u2(e)}function l2(n,e,t=4,i,s){var r;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:n}),c=s==null||(r=s.parseSync)===null||r===void 0?void 0:r.call(s,{attributes:n}),p=i._addFauxAttributes(c.attributes),m=i.addBufferView(o);return{primitives:[{attributes:p,mode:t,extensions:{[fi]:{bufferView:m,attributes:p}}}]}}function u2(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*g0(n){for(const e of n.json.meshes||[])for(const t of e.primitives)yield t}const c2=Object.freeze(Object.defineProperty({__proto__:null,name:i2,preprocess:s2,decode:a2,encode:r2},Symbol.toStringTag,{value:"Module"})),si="KHR_lights_punctual",h2=si;async function p2(n){const e=new At(n),{json:t}=e,i=e.getExtension(si);i&&(e.json.lights=i.lights,e.removeExtension(si));for(const s of t.nodes||[]){const r=e.getObjectExtension(s,si);r&&(s.light=r.light),e.removeObjectExtension(s,si)}}async function d2(n){const e=new At(n),{json:t}=e;if(t.lights){const i=e.addExtension(si);bt(!i.lights),i.lights=t.lights,delete t.lights}if(e.json.lights){for(const i of e.json.lights){const s=i.node;e.addObjectExtension(s,si,i)}delete e.json.lights}}const m2=Object.freeze(Object.defineProperty({__proto__:null,name:h2,decode:p2,encode:d2},Symbol.toStringTag,{value:"Module"})),xa="KHR_materials_unlit",f2=xa;async function v2(n){const e=new At(n),{json:t}=e;e.removeExtension(xa);for(const i of t.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,xa)}function g2(n){const e=new At(n),{json:t}=e;if(e.materials)for(const i of t.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,xa,{}),e.addExtension(xa))}const _2=Object.freeze(Object.defineProperty({__proto__:null,name:f2,decode:v2,encode:g2},Symbol.toStringTag,{value:"Module"})),ea="KHR_techniques_webgl",b2=ea;async function x2(n){const e=new At(n),{json:t}=e,i=e.getExtension(ea);if(i){const s=C2(i,e);for(const r of t.materials||[]){const o=e.getObjectExtension(r,ea);o&&(r.technique=Object.assign({},o,s[o.technique]),r.technique.values=S2(r.technique,e)),e.removeObjectExtension(r,ea)}e.removeExtension(ea)}}async function y2(n,e){}function C2(n,e){const{programs:t=[],shaders:i=[],techniques:s=[]}=n,r=new TextDecoder;return i.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=r.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(o=>{o.fragmentShader=i[o.fragmentShader],o.vertexShader=i[o.vertexShader]}),s.forEach(o=>{o.program=t[o.program]}),s}function S2(n,e){const t=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(i=>{n.uniforms[i].value&&!(i in t)&&(t[i]=n.uniforms[i].value)}),Object.keys(t).forEach(i=>{typeof t[i]=="object"&&t[i].index!==void 0&&(t[i].texture=e.getTexture(t[i].index))}),t}const w2=Object.freeze(Object.defineProperty({__proto__:null,name:b2,decode:x2,encode:y2},Symbol.toStringTag,{value:"Module"})),_0=[mT,gT,xT,c2,m2,_2,w2];function A2(n,e={},t){const i=_0.filter(r=>b0(r.name,e));for(const r of i){var s;(s=r.preprocess)===null||s===void 0||s.call(r,n,e,t)}}async function E2(n,e={},t){const i=_0.filter(r=>b0(r.name,e));for(const r of i){var s;await((s=r.decode)===null||s===void 0?void 0:s.call(r,n,e,t))}}function b0(n,e){var t;const i=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(n in i&&!i[n])}const cu="KHR_binary_glTF";function T2(n){const e=new At(n),{json:t}=e;for(const i of t.images||[]){const s=e.getObjectExtension(i,cu);s&&Object.assign(i,s),e.removeObjectExtension(i,cu)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(cu)}const Md={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},M2={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class B2{constructor(){ee(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),ee(this,"json",void 0)}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),T2(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in Md)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const s in i){const r=i[s];r.id=r.id||s;const o=e[t].length;e[t].push(r),this.idToIndexMap[t][s]=o}}}_convertObjectIdsToArrayIndices(e){for(const t in Md)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:s,material:r}=t;for(const o in i)i[o]=this._convertIdToIndex(i[o],"accessor");s&&(t.indices=this._convertIdToIndex(s,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const i of e[t])for(const s in i){const r=i[s],o=this._convertIdToIndex(r,s);i[s]=o}}_convertIdToIndex(e,t){const i=M2[t];if(i in this.idToIndexMap){const s=this.idToIndexMap[i][e];if(!Number.isFinite(s))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return s}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const r of e.materials){var t,i,s;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((t=r.values)===null||t===void 0?void 0:t.tex)||((i=r.values)===null||i===void 0?void 0:i.texture2d_0)||((s=r.values)===null||s===void 0?void 0:s.diffuseTex),c=e.textures.findIndex(p=>p.id===o);c!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:c})}}}function P2(n,e={}){return new B2().normalize(n,e)}const I2={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R2={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ct={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},O2={magFilter:Ct.TEXTURE_MAG_FILTER,minFilter:Ct.TEXTURE_MIN_FILTER,wrapS:Ct.TEXTURE_WRAP_S,wrapT:Ct.TEXTURE_WRAP_T},F2={[Ct.TEXTURE_MAG_FILTER]:Ct.LINEAR,[Ct.TEXTURE_MIN_FILTER]:Ct.NEAREST_MIPMAP_LINEAR,[Ct.TEXTURE_WRAP_S]:Ct.REPEAT,[Ct.TEXTURE_WRAP_T]:Ct.REPEAT};function D2(n){return R2[n]}function L2(n){return I2[n]}class N2{constructor(){ee(this,"baseUri",""),ee(this,"json",{}),ee(this,"buffers",[]),ee(this,"images",[])}postProcess(e,t={}){const{json:i,buffers:s=[],images:r=[],baseUri:o=""}=e;return bt(i),this.baseUri=o,this.json=i,this.buffers=s,this.images=r,this._resolveTree(this.json,t),this.json}_resolveTree(e,t={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map((i,s)=>this._resolveBufferView(i,s))),e.images&&(e.images=e.images.map((i,s)=>this._resolveImage(i,s))),e.samplers&&(e.samplers=e.samplers.map((i,s)=>this._resolveSampler(i,s))),e.textures&&(e.textures=e.textures.map((i,s)=>this._resolveTexture(i,s))),e.accessors&&(e.accessors=e.accessors.map((i,s)=>this._resolveAccessor(i,s))),e.materials&&(e.materials=e.materials.map((i,s)=>this._resolveMaterial(i,s))),e.meshes&&(e.meshes=e.meshes.map((i,s)=>this._resolveMesh(i,s))),e.nodes&&(e.nodes=e.nodes.map((i,s)=>this._resolveNode(i,s))),e.skins&&(e.skins=e.skins.map((i,s)=>this._resolveSkin(i,s))),e.scenes&&(e.scenes=e.scenes.map((i,s)=>this._resolveScene(i,s))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),i}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(i=>this.getNode(i)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(i=>this.getNode(i))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((i,s)=>{const r=this.getMesh(s);return i.id=r.id,i.primitives=i.primitives.concat(r.primitives),i},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(i=>{i={...i};const s=i.attributes;i.attributes={};for(const r in s)i.attributes[r]=this.getAccessor(s[r]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=D2(e.componentType),e.components=L2(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const i=e.bufferView.buffer,{ArrayType:s,byteLength:r}=l0(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset;let c=i.arrayBuffer.slice(o,o+r);e.bufferView.byteStride&&(c=this._getValueFromInterleavedBuffer(i,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new s(c)}return e}_getValueFromInterleavedBuffer(e,t,i,s,r){const o=new Uint8Array(r*s);for(let c=0;c<r;c++){const p=t+c*i;o.set(new Uint8Array(e.arrayBuffer.slice(p,p+s)),c*s)}return o.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):F2,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const i in e){const s=this._enumSamplerParameter(i);s!==void 0&&(e.parameters[s]=e[i])}return e}_enumSamplerParameter(e){return O2[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[t];return i&&(e.image=i),e}_resolveBufferView(e,t){const i=e.buffer,s={id:"bufferView-".concat(t),...e,buffer:this.buffers[i]},r=this.buffers[i].arrayBuffer;let o=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),s.data=new Uint8Array(r,o,e.byteLength),s}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function k2(n,e){return new N2().postProcess(n,e)}const Bd=1735152710,Vc=12,jr=8,z2=1313821514,U2=5130562,H2=0,G2=1,V2=0,is=!0;function W2(n,e=0){return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}function j2(n,e=0,t={}){const i=new DataView(n),{magic:s=Bd}=t,r=i.getUint32(e,!1);return r===s||r===Bd}function x0(n,e,t=0,i={}){const s=new DataView(e),r=W2(s,t+0),o=s.getUint32(t+4,is),c=s.getUint32(t+8,is);switch(Object.assign(n,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:r,version:o,json:{},binChunks:[]}),t+=Vc,n.version){case 1:return K2(n,s,t);case 2:return J2(n,s,t,i={});default:throw new Error("Invalid GLB version ".concat(n.version,". Only supports v1 and v2."))}}function K2(n,e,t){cn(n.header.byteLength>Vc+jr);const i=e.getUint32(t+0,is),s=e.getUint32(t+4,is);return t+=jr,cn(s===V2),Ku(n,e,t,i),t+=i,t+=Ju(n,e,t,n.header.byteLength),t}function J2(n,e,t,i){return cn(n.header.byteLength>Vc+jr),$2(n,e,t,i),t+n.header.byteLength}function $2(n,e,t,i){for(;t+8<=n.header.byteLength;){const s=e.getUint32(t+0,is),r=e.getUint32(t+4,is);switch(t+=jr,r){case z2:Ku(n,e,t,s);break;case U2:Ju(n,e,t,s);break;case H2:i.strict||Ku(n,e,t,s);break;case G2:i.strict||Ju(n,e,t,s);break}t+=Ba(s,4)}return t}function Ku(n,e,t,i){const s=new Uint8Array(e.buffer,t,i),o=new TextDecoder("utf8").decode(s);return n.json=JSON.parse(o),Ba(i,4)}function Ju(n,e,t,i){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:t,byteLength:i,arrayBuffer:e.buffer}),Ba(i,4)}async function q2(n,e,t=0,i,s){var r,o,c,p;X2(n,e,t,i),P2(n,{normalize:i==null||(r=i.gltf)===null||r===void 0?void 0:r.normalize}),A2(n,i,s);const m=[];if(i!=null&&(o=i.gltf)!==null&&o!==void 0&&o.loadBuffers&&n.json.buffers&&await Y2(n,i,s),i!=null&&(c=i.gltf)!==null&&c!==void 0&&c.loadImages){const v=Q2(n,i,s);m.push(v)}const _=E2(n,i,s);return m.push(_),await Promise.all(m),i!=null&&(p=i.gltf)!==null&&p!==void 0&&p.postProcess?k2(n,i):n}function X2(n,e,t,i){if(i.uri&&(n.baseUri=i.uri),e instanceof ArrayBuffer&&!j2(e,t,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")n.json=Lw(e);else if(e instanceof ArrayBuffer){const o={};t=x0(o,e,t,i.glb),bt(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),n._glb=o,n.json=o.json}else bt(!1,"GLTF: must be ArrayBuffer or string");const s=n.json.buffers||[];if(n.buffers=new Array(s.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const r=n.json.images||[];n.images=new Array(r.length).fill({})}async function Y2(n,e,t){const i=n.json.buffers||[];for(let o=0;o<i.length;++o){const c=i[o];if(c.uri){var s,r;const{fetch:p}=t;bt(p);const m=a0(c.uri,e),_=await(t==null||(s=t.fetch)===null||s===void 0?void 0:s.call(t,m)),v=await(_==null||(r=_.arrayBuffer)===null||r===void 0?void 0:r.call(_));n.buffers[o]={arrayBuffer:v,byteOffset:0,byteLength:v.byteLength},delete c.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function Q2(n,e,t){const i=Z2(n),s=n.json.images||[],r=[];for(const o of i)r.push(eM(n,s[o],o,e,t));return await Promise.all(r)}function Z2(n){const e=new Set,t=n.json.textures||[];for(const i of t)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function eM(n,e,t,i,s){const{fetch:r,parse:o}=s;let c;if(e.uri&&!e.hasOwnProperty("bufferView")){const m=a0(e.uri,i);c=await(await r(m)).arrayBuffer()}if(Number.isFinite(e.bufferView)){const m=JE(n.json,n.buffers,e.bufferView);c=zf(m.buffer,m.byteOffset,m.byteLength)}bt(c,"glTF image has no data");let p=await o(c,[GE,mE],{mimeType:e.mimeType,basis:i.basis||{format:n0()}},s);p&&p[0]&&(p={compressed:!0,mipmaps:!1,width:p[0].width,height:p[0].height,data:p[0]}),n.images=n.images||[],n.images[t]=p}const $u={name:"glTF",id:"gltf",module:"gltf",version:Zf,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:tM,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function tM(n,e={},t){e={...$u.options,...e},e.gltf={...$u.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await q2({},n,i,e,t)}const nM={name:"GLB",id:"glb",module:"gltf",version:Zf,extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,parse:iM,parseSync:y0,options:{glb:{strict:!1}}};async function iM(n,e){return y0(n,e)}function y0(n,e){const{byteOffset:t=0}=e||{},i={};return x0(i,n,t,e==null?void 0:e.glb),i}const sM=function(n,e){var t=new Uint8Array(n.byteLength+e.byteLength);return t.set(new Uint8Array(n),0),t.set(new Uint8Array(e),n.byteLength),t.buffer};class Pd{constructor(e,t=!0){return this.url=e,this.hasDracoCompression=t,this.promise=new Promise((i,s)=>{this.resolve=i}),this.load(),this.promise}async load(){if(this.hasDracoCompression){const e=await cd(this.url,$u,{DracoLoader:f0,decompress:!0});e.isDracoCompressed=!0,this.resolve(e)}else{const e=await cd(this.url,nM);let t=new ArrayBuffer;for(let i=0;i<e.binChunks.length;i++){const s=e.binChunks[i];t=sM(t,s.arrayBuffer.slice(s.byteOffset,s.byteOffset+s.byteLength))}e.json.bin=t,this.resolve(e.json)}}}const Id={buildNodeTreeCustom(n,e,t){let i={};for(let s=0;s<n.nodes.length;s++){const r=n.nodes[s];if(r.children&&r.children.length>0){i[r.name]={transform:new Le,childrenIds:[]},r.translation&&i[r.name].transform.position.copy(r.translation),r.scale&&i[r.name].transform.scale.copy(r.scale),r.rotation&&(i[r.name].transform.quaternion.x=r.rotation[0],i[r.name].transform.quaternion.y=r.rotation[1],i[r.name].transform.quaternion.z=r.rotation[2],i[r.name].transform.quaternion.w=r.rotation[3]);let o=e;for(const c in t)r.name.includes(c)&&(o=t[c].baseRoot);i[r.name].transform.setParent(o),i[r.name].transform.updateMatrixWorld(!0);for(let c=0;c<r.children.length;c++)i[r.name].childrenIds.push(r.children[c].name)}}return i},getParentInNodeTree(n,e){for(const t in n)if(Object.hasOwnProperty.call(n,t)){const i=n[t];if(i.childrenIds.indexOf(e)>-1)return i.transform}},buildMeshList(n,e){var i;const t=[];{for(let s=0;s<n.nodes.length;s++){const r=n.nodes[s];if(r.mesh!==void 0){const o=r.mesh,c=o.name;for(let p=0;p<o.primitives.length;p++){const m=o.primitives[p],_=o.primitives[p].material.name,v=this.getParentInNodeTree(e,c);t.push({meshData:{primitives:[m]},meshName:c,materialName:_,node:r,parent:v,material:(i=_e.main[_])==null?void 0:i.material})}}}return t}}},Pn=_t(),Rd=_t(),aM=Ge(0,1,0);class rM{constructor(e,t,{pan:i=!0,startDistance:s=10,minDistance:r=1e-4,maxDistance:o=1/0,applyTransform:c=!0,startAngleX:p=Math.PI,startAngleY:m=-Math.PI/2,angleLimitY:_=[-Math.PI+.1,-.1],dragVelocity:v=5,target:g=[0,0,0]}={}){this.scene=e,this.camera=t,this.node=new Xu,this.offset=Ge(m,p,0),this.offsetTarget=Ge(m,p,0),this.radiusTarget=s,this.radius=s,this.target=Ge(g[0],g[1],g[2]),this.canPan=i,this.dragVelocity=v,this.angleLimitY=_,this.pan=_t(),this.altPressed=!1,this.prevent=!1,this.applyTransform=c,this.canZoom=!0,this.canRotate=!0,this.config={camera_damping:{value:.2,range:[.001,.1]}},Ke.on("wheel",()=>{!this.canZoom||(this.prevent||(Ke.wheelDir=="up"?this.radiusTarget+=1:this.radiusTarget-=1),this.radiusTarget=Math.max(Math.min(this.radiusTarget,o),r))}),this.canPan&&(window.addEventListener("keydown",C=>{C.key=="Alt"&&(this.altPressed=!0)}),window.addEventListener("keyup",C=>{C.key=="Alt"&&(this.altPressed=!1)})),ie.on("prevent",()=>{this.prevent=!0}),ie.on("unprevent",()=>{this.prevent=!1}),ie.addConfig(this.config,"Orbit")}update(){if(!this.prevent)if(this.altPressed){if(Ke.isDown){let i=_t(),s=_t(),r=_t();this.pan[0]=Ke.velocity[0]*-10,this.pan[1]=Ke.velocity[1]*(this.scene.width/this.scene.height)*5,yr(i,this.node.position,this.target),ua(i,i),ai(r,aM,i),ua(r,r),ai(s,i,r),ta(Pn,r,this.pan[0]),ta(Rd,s,this.pan[1]),Ki(Pn,Pn,Rd),Ki(this.target,this.target,Pn)}}else Ke.isDown&&this.canRotate&&(this.offsetTarget[1]+=Ke.velocity[0]*this.dragVelocity,this.offsetTarget[0]+=Ke.velocity[1]*(this.scene.width/this.scene.height)*this.dragVelocity);this.offsetTarget[0]=Math.min(Math.max(this.offsetTarget[0],this.angleLimitY[0]),this.angleLimitY[1]),yr(Pn,this.offsetTarget,this.offset),ta(Pn,Pn,this.config.camera_damping.value),Ki(this.offset,this.offset,Pn);let e=this.radiusTarget-this.radius;e*=this.config.camera_damping.value,this.radius+=e;let t=this.radius;if(this.node.position[0]=t*-Math.sin(this.offset[0])*Math.sin(this.offset[1])+this.target[0],this.node.position[1]=t*Math.cos(this.offset[0])+this.target[1],this.node.position[2]=t*Math.sin(this.offset[0])*Math.cos(this.offset[1])+this.target[2],this.applyTransform){this.camera.position.set(this.node.position[0],this.node.position[1],this.node.position[2]);const i=new q;i.set(this.target[0],this.target[1],this.target[2]),this.camera.lookAt(i)}}}const oM=new jt,lM=new q,uM=new q;class cM extends Le{constructor(e,{near:t=.1,far:i=100,fov:s=45,aspect:r=1,left:o,right:c,bottom:p,top:m,zoom:_=1}={}){super(),Object.assign(this,{near:t,far:i,fov:s,aspect:r,left:o,right:c,bottom:p,top:m,zoom:_}),this.projectionMatrix=new jt,this.viewMatrix=new jt,this.projectionViewMatrix=new jt,this.worldPosition=new q,this.isFliped=!1,this.type=o||c?"orthographic":"perspective",this.type==="orthographic"?this.orthographic():this.perspective()}perspective({near:e=this.near,far:t=this.far,fov:i=this.fov,aspect:s=this.aspect}={}){return Object.assign(this,{near:e,far:t,fov:i,aspect:s}),this.projectionMatrix.fromPerspective({fov:i*(Math.PI/180),aspect:s,near:e,far:t}),this.type="perspective",this}orthographic({near:e=this.near,far:t=this.far,left:i=this.left,right:s=this.right,bottom:r=this.bottom,top:o=this.top,zoom:c=this.zoom}={}){return Object.assign(this,{near:e,far:t,left:i,right:s,bottom:r,top:o,zoom:c}),i/=c,s/=c,r/=c,o/=c,this.projectionMatrix.fromOrthogonal({left:i,right:s,bottom:r,top:o,near:e,far:t}),this.type="orthographic",this}updateMatrixWorld(e=!1){return super.updateMatrixWorld(),e&&(this.worldMatrix[1]*=-1,this.worldMatrix[5]*=-1,this.worldMatrix[9]*=-1,this.worldMatrix[13]*=-1),this.isFliped=e,this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(e){return super.lookAt(e,!0),this}project(e){return e.applyMatrix4(this.viewMatrix),e.applyMatrix4(this.projectionMatrix),this}unproject(e){return e.applyMatrix4(oM.inverse(this.projectionMatrix)),e.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new q,new q,new q,new q,new q,new q]);const e=this.projectionViewMatrix;this.frustum[0].set(e[3]-e[0],e[7]-e[4],e[11]-e[8]).constant=e[15]-e[12],this.frustum[1].set(e[3]+e[0],e[7]+e[4],e[11]+e[8]).constant=e[15]+e[12],this.frustum[2].set(e[3]+e[1],e[7]+e[5],e[11]+e[9]).constant=e[15]+e[13],this.frustum[3].set(e[3]-e[1],e[7]-e[5],e[11]-e[9]).constant=e[15]-e[13],this.frustum[4].set(e[3]-e[2],e[7]-e[6],e[11]-e[10]).constant=e[15]-e[14],this.frustum[5].set(e[3]+e[2],e[7]+e[6],e[11]+e[10]).constant=e[15]+e[14];for(let t=0;t<6;t++){const i=1/this.frustum[t].distance();this.frustum[t].multiply(i),this.frustum[t].constant*=i}}frustumIntersectsMesh(e){if(!e.geometry.attributes.position||((!e.geometry.bounds||e.geometry.bounds.radius===1/0)&&e.geometry.computeBoundingSphere(),!e.geometry.bounds))return!0;const t=lM;t.copy(e.geometry.bounds.center),t.applyMatrix4(e.worldMatrix);const i=e.geometry.bounds.radius*e.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(t,i)}frustumIntersectsSphere(e,t){const i=uM;for(let s=0;s<6;s++){const r=this.frustum[s];if(i.copy(r).dot(e)+r.constant<-t)return!1}return!0}}class hM{constructor(e,t){this.width=t.width,this.height=t.height,this.scene=t.scene,this.debug=t.debug,this.gl=e,this.toGo=new q(0,0,0),this.toLook=new q(0,0,0),this.lastWheel=0,this.catmulls={},this.config={camMouseEase:{value:.018,params:{min:0,max:.1,step:.001}},camMouseAmplitude:{value:.4,params:{min:0,max:1,step:.01}},fov:{value:40,params:{}}},this.mouse=new wt(0,0),this.cameraMovement=0,this.cameraContainer=new Le,this.cameraContainer.setParent(this.scene.root),this.camera=new cM(this.gl,{near:.01,far:1e5,fov:this.config.fov.value,aspect:this.width/this.height}),this.camera.setParent(this.cameraContainer),this.debug&&(this.debugMode=!0,this.orbit=new rM(this.scene,this.camera,{}),this.initDebugEvents()),this.gui=ie.addBlade(this.config,"Camera Manager"),this.gui&&this.gui.fov.on("change",i=>{this.camera.fov=i.value}),window.__cameraManager=this}resize(e,t){this.camera.perspective({aspect:e/t})}initDebugEvents(){this.guiIsEnabled&&(ie.panel.domElement.addEventListener("mouseover",()=>{this.preventUpdateOrbit=!0}),ie.panel.domElement.addEventListener("mouseleave",()=>{this.preventUpdateOrbit=!1}))}preRender(){this.update(),this.orbit&&(this.orbit.enabled=!this.preventUpdateOrbit,this.orbit.update())}update(){if(!this.debugMode&&(!at||!Yd)){let e=1;this.scene.animationsManager.introTl&&(e=this.scene.animationsManager.introTl.progress()),this.mouse.x+=(Ke.lastCursor[0]-this.mouse[0])*this.config.camMouseEase.value,this.mouse.y+=(Ke.lastCursor[1]-this.mouse[1])*this.config.camMouseEase.value,this.cameraMovement=this.config.camMouseAmplitude.value*this.scene.width/this.scene.dpr*5e-5,this.camera.rotation.x=-this.mouse.y*this.cameraMovement*e,this.camera.rotation.y=-this.mouse.x*this.cameraMovement*e}}}class pM extends et{constructor(e,{parent:t=null,globalScale:i=1,blendFunc:s={src:e.gl.SRC_ALPHA,dst:e.gl.ONE_MINUS_SRC_ALPHA},transparent:r=!0,depthTest:o=!0,shaderId:c="unlit",depthWrite:p=!0,textureId:m=null,color:_=Ge(0,0,0),renderOrder:v=0,alpha:g=1,name:C="Text_Plane",y:S=0,opacity:E=1,deformationFactor:T=1,scaleFactor:M=.125,scaleDamping:W=.1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.parent=t||e.root,this.globalScale=i,this.transparent=r,this.blendFunc=s,this.depthTest=o,this.depthWrite=p,this.shaderId=c,this.textureId=m,this.renderOrder=v,this.texture=new be(this.gl),this.alpha=g,this.alphaTarget=g,this.alphaDamping=.1,this.initialScaleFactor=M,this.scaleTarget=M,this.scaleConfig=M,this.scaleDamping=W,this.startPosition=new q,this.endPosition=new q,this.rotatedPosition=new q,this.currentPosition=new q,this.currentPositionTarget=new q,this.color=_,this.name=C,this.defines={HAS_COLOR_CORRECTION:1},this.initConfig(S,E,T,M),this.init()}initConfig(e,t,i,s){this.config={startPosition:{value:{x:0,y:e,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},endPosition:{value:{x:0,y:e,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},positionDamping:{value:.1,params:{min:0,max:1,step:.001}},scale:{value:s,params:{min:0,max:1,step:.01}},deformFactor:{value:i,params:{min:0,max:20,step:.01}},opacity:{value:t,params:{min:0,max:1,step:.01}},rotationAngleStart:{value:.22,params:{min:0,max:1,step:.01}},rotationAngleEnd:{value:.22,params:{min:0,max:1,step:.01}},rotationRadius:{value:1,params:{}},Tint:{value:"#ffffff",params:{}},TintOpacity:{value:0,params:{min:0,max:1,step:.01}},Exposure:{value:0,params:{min:-2,max:2,step:.01}},Contrast:{value:0,params:{min:-1,max:1,step:.01}},Saturation:{value:1,params:{min:0,max:2,step:.01}}},this.rotationAngle=this.config.rotationAngleStart.value,this.tintColor=new R(this.config.Tint.value),this.gui=ie.addBlade(this.config,this.name,1),this.gui&&(this.gui.scale.on("change",r=>{this.initialScaleFactor=r.value,this.scaleTarget=r.value,this.scaleToTexture()}),this.gui.deformFactor.on("change",r=>{this.program.uniforms.uDeformFactor.value=r.value}),this.gui.opacity.on("change",r=>{this.program.uniforms.uAlpha.value=r.value*this.alpha}),this.gui.rotationAngleStart.on("change",r=>{this.rotateAroundCenter(),this.lookOutside()}),this.gui.rotationAngleEnd.on("change",r=>{this.rotateAroundCenter(),this.lookOutside()}),this.gui.rotationRadius.on("change",r=>{this.rotateAroundCenter(),this.lookOutside()}))}scaleToTexture(){this.texture&&this.texture.image&&(this.mesh.scale.x*=this.texture.image.width/this.texture.image.height,this.emissiveMesh.scale.x*=this.texture.image.width/this.texture.image.height)}rotateAroundCenter(){this.rotatedPosition.set(Math.cos(this.rotationAngle*6.28)*this.config.rotationRadius.value*this.globalScale,0,Math.sin(this.rotationAngle*6.28)*this.config.rotationRadius.value*this.globalScale)}lookOutside(){const e=new q(this.mesh.worldMatrix[12],this.mesh.worldMatrix[13],this.mesh.worldMatrix[14]),i=new q(this.parent.worldMatrix[12],this.parent.worldMatrix[13],this.parent.worldMatrix[14]).clone().sub(e).normalize();this.mesh.lookAt(e.clone().add(i)),this.mesh.rotation.y-=Math.PI,this.mesh.rotation.x=0,this.emissiveMesh.rotation.y=this.mesh.rotation.y,this.emissiveMesh.rotation.x=0}init(){this.geometry=new vi(this.gl,{widthSegments:10,heightSegments:10}),this.shader=new ve(ce[this.shaderId],1,this.defines),this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:{uTexture:{value:this.texture},uTime:{value:this.scene.time},uAlpha:{value:this.config.opacity.value*this.alpha},uColor:{value:this.color},uRez:{value:[this.scene.width,this.scene.height]},uDeformFactor:{value:this.config.deformFactor.value},uTint:{value:[1,1,1]},uTintOpacity:{value:0},uExposure:{value:0},uContrast:{value:0},uSaturation:{value:0}}}),this.program.cullFace=!1,this.program.setBlendFunc(this.blendFunc.src,this.blendFunc.dst),this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,renderOrder:this.renderOrder}),this.createEmissiveMesh(),this.rotateAroundCenter(),this.lookOutside(),this.mesh.scale.set(this.config.scale.value*this.globalScale),this.emissiveMesh.scale.set(this.config.scale.value*this.globalScale),this.mesh.setParent(this.parent),this.mesh._entity=this}onLoaded(){this.textureId&&(this.texture=this.scene.textureLoader.getTexture(this.textureId),this.texture.needsUpdate=!0,this.program.uniforms.uTexture.value=this.texture,this.scaleToTexture()),this.currentPositionTarget.set(this.config.startPosition.value.x,this.config.startPosition.value.y,this.config.startPosition.value.z),this.currentPosition.set(this.config.startPosition.value.x,this.config.startPosition.value.y,this.config.startPosition.value.z),this.rotateAroundCenter(),this.lookOutside()}setPositionProgress(e){this.currentPositionTarget.copy(this.startPosition),this.currentPositionTarget.lerp(this.endPosition,e),this.rotationAngle=In(this.config.rotationAngleStart.value,this.config.rotationAngleEnd.value,e),this.rotateAroundCenter()}preRender(){this.rotateAroundCenter(),this.lookOutside(),this.initialScaleFactor=this.config.scale.value,this.scaleTarget=this.config.scale.value,this.startPosition.set(this.config.startPosition.value.x,this.config.startPosition.value.y,this.config.startPosition.value.z),this.endPosition.set(this.config.endPosition.value.x,this.config.endPosition.value.y,this.config.endPosition.value.z),this.startPosition.scale(this.globalScale),this.endPosition.scale(this.globalScale),this.startPosition.add(this.rotatedPosition),this.endPosition.add(this.rotatedPosition),this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uRez.value=[this.scene.width,this.scene.height],this.alpha+=(this.alphaTarget-this.alpha)*this.alphaDamping,this.scaleConfig+=(this.scaleTarget-this.scaleConfig)*this.scaleDamping,this.currentPosition.lerp(this.currentPositionTarget,this.config.positionDamping.value),this.mesh.position.copy(this.currentPosition),this.emissiveMesh.position.copy(this.currentPosition),this.mesh.scale.set(this.scaleConfig*this.globalScale),this.emissiveMesh.scale.set(this.scaleConfig*this.globalScale),this.scaleToTexture(),this.program.uniforms.uAlpha.value=this.config.opacity.value*this.alpha,this.tintColor.set(this.config.Tint.value),this.program.uniforms.uTint.value=this.tintColor,this.program.uniforms.uTintOpacity.value=this.config.TintOpacity.value,this.program.uniforms.uExposure.value=this.config.Exposure.value,this.program.uniforms.uContrast.value=this.config.Contrast.value,this.program.uniforms.uSaturation.value=this.config.Saturation.value}createEmissiveMesh(){this.emissiveShader=new ve(ce.basicOcculter,1,{});let e={uTime:{value:this.scene.time},uSeed:{value:this.seed},uTint:{value:this.color},uCamera:{value:this.scene.camera.position},uColor:{value:[1,0,0]}};this.emissiveProgram=new ge(this.gl,{vertex:this.emissiveShader.vert,fragment:this.emissiveShader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:e}),this.emissiveMesh=new Ae(this.gl,{geometry:this.geometry,program:this.emissiveProgram,transform:this.transform,frustumCulled:!1}),this.emissiveMesh.setParent(this.parent),this.emissiveMesh.visible=!1,this.emissiveMesh._entity=this}dispose(){this.mesh.setParent(null),this.geometry.remove(),this.program.remove()}}function dM(n=1,e=[]){var t=Math.random()*Math.PI*2,i=Math.acos(Math.random()*2-1);return e[0]=n*Math.sin(i)*Math.cos(t),e[1]=n*Math.sin(i)*Math.sin(t),e[2]=n*Math.cos(i),e}class mM extends et{constructor(e,{count:t=300,color:i="#e29373",color1:s="#e2533f",distanceFadeColor:r="#ffffff",distanceFadeColorFactor:o=1,timeScale:c=1,name:p="Particles",meshId:m=0,noiseIntensity:_=30,noiseFrequency:v=.1,fadeDistance:g=150,particleOpacity:C=.75,particleScale:S=300,radius:E=1,randomnessFactor:T=1,alpha:M=1,scale:W=.01,parent:B=!1,fog:O=!1,config:L=!1,globalConfig:H=!1,globalScale:G=1}={}){super(e.gl,e),this.gl=e.gl,this.scene=e,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.shader=new ve(ce.sphereParticles),this.count=t,this.timeScale=c,this.color=i,this.color1=s,this.name=p,this.meshId=m,this.alpha=M,this.time=0,this.noiseIntensity=_,this.noiseFrequency=v,this.fadeDistance=g,this.distanceFadeColor=r,this.distanceFadeColorFactor=o,this.particleOpacity=C,this.particleScale=S,this.scale=W,this.fog=O,this.globalConfig=H,this.parent=B||e.root,this.globalScale=G,this.radius=E,this.randomnessFactor=T,this.initConfig(L),this.createParticles(),this.init()}initConfig(e){this.config={count:{value:this.count,params:{min:1,max:1e4,step:1}},radius:{value:this.radius,params:{min:0,max:600,step:10}},randomnessFactor:{value:this.randomnessFactor,params:{min:0,max:6e3,step:10}},color:{value:this.color,params:{}},color1:{value:this.color1,params:{}},timeScale:{value:this.timeScale,params:{min:0,max:2,step:.01}},noiseIntensity:{value:this.noiseIntensity,params:{min:0,max:90*(1/this.globalScale),step:.1}},noiseFrequency:{value:this.noiseFrequency,params:{min:0,max:2e3,step:.01}},particleOpacity:{value:this.particleOpacity,params:{min:0,max:1,step:.01}},particleScale:{value:this.particleScale,params:{min:0,max:1e3,step:1}},DiscRadius:{value:this.scene.isMobile?.03:.1,params:{min:0,max:1,step:.001}},DiscRadius1:{value:.1,params:{min:0,max:1,step:.001}},BorderSize:{value:.5,params:{min:.001,max:1,step:.001}},BorderSize1:{value:.6,params:{min:.001,max:1,step:.001}}},e&&(this.config={...this.config,...e}),this.gui=ie.addBlade(this.config,this.name,this.meshId),this.gui&&(this.gui.count.on("change",()=>{this.mesh.visible=!1,this.createParticles(),this.init()}),this.gui.radius.on("change",()=>{this.mesh.visible=!1,this.createParticles(),this.init()}),this.gui.randomnessFactor.on("change",()=>{this.mesh.visible=!1,this.createParticles(),this.init()}))}createParticles(){this.count=this.config.count.value;let e=[],t=[];for(;this.count--;){const i=Math.random()*(this.config.randomnessFactor.value*(1/this.globalScale)),s=this.config.radius.value*(1/this.globalScale)+i;let[r,o,c]=dM(s);e.push(r,o,c),t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random())}this.vertices=new Float32Array(e),this.seeds=new Float32Array(t)}init(){const e={position:{size:3,data:this.vertices},seeds:{size:4,data:this.seeds}};this.geometry=new ht(this.gl,e);const t={uTime:{value:this.scene.time},uColor:{value:new R(this.color)},uColor1:{value:new R(this.color1)},uPixelRatio:{value:this.scene.dpr},uAlpha:{value:this.alpha},uNoiseIntensity:{value:this.noiseIntensity},uNoiseFrequency:{value:this.noiseFrequency},uTimeScale:{value:this.timeScale},uParticleOpacity:{value:this.particleOpacity},uFadeDistance:{value:20},uParticleScale:{value:this.particleScale},uFogFactor:{value:this.fog?1:0},uFogColor:{value:this.globalConfig?new R(this.globalConfig.FogColor.value):new R("#fff")},uFogNear:{value:this.globalConfig?this.globalConfig.FogNear.value:0},uFogFar:{value:this.globalConfig?this.globalConfig.FogFar.value:0},uWorldMatrix:{value:this.worldMatrix},uOpacityTimescale:{value:this.config.opacityTimescale},uBorderSize:this.config.BorderSize,uBorderSize1:this.config.BorderSize1,uDiscRadius:this.config.DiscRadius,uDiscRadius1:this.config.DiscRadius1};this.program=new ge(this.gl,{vertex:this.shader.vert,fragment:this.shader.frag,depthTest:this.depthTest,depthWrite:this.depthWrite,transparent:this.transparent,uniforms:t}),this.program.cullFace=!1,this.mesh=new Ae(this.gl,{geometry:this.geometry,program:this.program,forceRenderOrder:!0,renderOrder:10,mode:this.gl.POINTS}),this.mesh.scale.x=this.scale,this.mesh.scale.y=this.scale,this.mesh.scale.z=this.scale,this.mesh.name=this.name,this.mesh.setParent(this.parent)}onLoaded(){}preRender(){this.timeScale=this.config.timeScale.value,this.noiseIntensity=this.config.noiseIntensity.value,this.noiseFrequency=this.config.noiseFrequency.value,this.time+=this.scene.dt/1e3,this.program.uniforms.uTime.value=this.scene.time,this.program.uniforms.uColor.value=new R(this.config.color.value),this.program.uniforms.uColor1.value=new R(this.config.color1.value),this.program.uniforms.uNoiseIntensity.value=this.noiseIntensity,this.program.uniforms.uNoiseFrequency.value=this.noiseFrequency,this.program.uniforms.uTimeScale.value=this.timeScale,this.program.uniforms.uParticleOpacity.value=this.config.particleOpacity.value,this.program.uniforms.uParticleScale.value=this.config.particleScale.value,this.program.uniforms.uFogNear.value=this.globalConfig?this.globalConfig.FogNear.value:0,this.program.uniforms.uFogFar.value=this.globalConfig?this.globalConfig.FogFar.value:0,this.program.uniforms.uWorldMatrix.value=this.worldMatrix,this.program.uniforms.uOpacityTimescale.value=this.config.opacityTimescale.value,this.program.uniforms.uPixelRatio.value=this.scene.dpr}}const Od={lore:{lore_asteroid_medium_02_position:{value:{x:6100,y:0,z:-3300},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_medium_02_position"}},lore_asteroid_medium_02_rotation:{value:{x:.2,y:.86,z:.5899999999999999},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_medium_02_rotation"}},lore_asteroid_medium_02_scale:{value:2,params:{label:"lore_asteroid_medium_02_scale"}},lore_asteroid_medium_03_position:{value:{x:-2400,y:-1200,z:6800},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_medium_03_position"}},lore_asteroid_medium_03_rotation:{value:{x:-.07,y:-.89,z:-.38},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_medium_03_rotation"}},lore_asteroid_medium_03_scale:{value:1,params:{label:"lore_asteroid_medium_03_scale"}},lore_asteroid_small_016_position:{value:{x:13800,y:600,z:16e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_small_016_position"}},lore_asteroid_small_016_rotation:{value:{x:-.2,y:-2.27,z:4.2},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_small_016_rotation"}},lore_asteroid_small_016_scale:{value:2.8,params:{label:"lore_asteroid_small_016_scale"}},lore_asteroid_small_02_position:{value:{x:-11400,y:-5300,z:-1100},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_small_02_position"}},lore_asteroid_small_02_rotation:{value:{x:0,y:.57,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_small_02_rotation"}},lore_asteroid_small_02_scale:{value:10.6,params:{label:"lore_asteroid_small_02_scale"}},lore_asteroid_small_01_position:{value:{x:4800,y:3800,z:-3200},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_asteroid_small_01_position"}},lore_asteroid_small_01_rotation:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"lore_asteroid_small_01_rotation"}},lore_asteroid_small_01_scale:{value:2.1,params:{label:"lore_asteroid_small_01_scale"}}},creatures:{creatures_asteroid_medium_01_position:{value:{x:17400,y:3e3,z:8400},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_medium_01_position"}},creatures_asteroid_medium_01_rotation:{value:{x:-1.06,y:-.19,z:.84},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_medium_01_rotation"}},creatures_asteroid_medium_01_scale:{value:1.75,params:{label:"creatures_asteroid_medium_01_scale"}},creatures_asteroid_medium_02_position:{value:{x:-10900,y:4900,z:-9900},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_medium_02_position"}},creatures_asteroid_medium_02_rotation:{value:{x:.67,y:-1.24,z:.31},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_medium_02_rotation"}},creatures_asteroid_medium_02_scale:{value:4.4,params:{label:"creatures_asteroid_medium_02_scale"}},creatures_asteroid_small_013_position:{value:{x:-4600,y:0,z:-10200},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_small_013_position"}},creatures_asteroid_small_013_rotation:{value:{x:.72,y:-2.75,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_small_013_rotation"}},creatures_asteroid_small_013_scale:{value:2.8,params:{label:"creatures_asteroid_small_013_scale"}},creatures_asteroid_small_08_position:{value:{x:-4200,y:-1200,z:2e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_small_08_position"}},creatures_asteroid_small_08_rotation:{value:{x:0,y:.3,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_small_08_rotation"}},creatures_asteroid_small_08_scale:{value:1.9000000000000001,params:{label:"creatures_asteroid_small_08_scale"}},creatures_asteroid_small_07_position:{value:{x:12600,y:-2400,z:5200},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_small_07_position"}},creatures_asteroid_small_07_rotation:{value:{x:.24,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_small_07_rotation"}},creatures_asteroid_small_07_scale:{value:1,params:{label:"creatures_asteroid_small_07_scale"}},creatures_asteroid_medium_03_position:{value:{x:2200,y:4900,z:-12e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_asteroid_medium_03_position"}},creatures_asteroid_medium_03_rotation:{value:{x:0,y:.19,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"creatures_asteroid_medium_03_rotation"}},creatures_asteroid_medium_03_scale:{value:1,params:{label:"creatures_asteroid_medium_03_scale"}}},battlearena:{battlearena_asteroid_medium_01_position:{value:{x:-7500,y:0,z:9500},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_01_position"}},battlearena_asteroid_medium_01_rotation:{value:{x:-.48,y:-.92,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_01_rotation"}},battlearena_asteroid_medium_01_scale:{value:1.5,params:{label:"battlearena_asteroid_medium_01_scale"}},battlearena_asteroid_medium_02_position:{value:{x:-12800,y:-3400,z:9100},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_02_position"}},battlearena_asteroid_medium_02_rotation:{value:{x:-3.09,y:-2.48,z:-3.39},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_02_rotation"}},battlearena_asteroid_medium_02_scale:{value:1.881328821182251,params:{label:"battlearena_asteroid_medium_02_scale"}},battlearena_asteroid_medium_03_position:{value:{x:-19e3,y:11800,z:-18300},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_03_position"}},battlearena_asteroid_medium_03_rotation:{value:{x:-.48,y:-.92,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_03_rotation"}},battlearena_asteroid_medium_03_scale:{value:2.081328821182251,params:{label:"battlearena_asteroid_medium_03_scale"}},battlearena_asteroid_medium_04_position:{value:{x:-2400,y:-800,z:2200},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_medium_04_position"}},battlearena_asteroid_medium_04_rotation:{value:{x:-.98,y:-1.22,z:-2.0100000000000002},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_medium_04_rotation"}},battlearena_asteroid_medium_04_scale:{value:1,params:{label:"battlearena_asteroid_medium_04_scale"}},battlearena_asteroid_small_012_position:{value:{x:-2700,y:-6200,z:2400},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_012_position"}},battlearena_asteroid_small_012_rotation:{value:{x:0,y:2.56,z:.49},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_012_rotation"}},battlearena_asteroid_small_012_scale:{value:3.5,params:{label:"battlearena_asteroid_small_012_scale"}},battlearena_asteroid_small_011_position:{value:{x:5500,y:0,z:-5300},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_011_position"}},battlearena_asteroid_small_011_rotation:{value:{x:.38,y:0,z:-.15},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_011_rotation"}},battlearena_asteroid_small_011_scale:{value:3.4000000000000004,params:{label:"battlearena_asteroid_small_011_scale"}},battlearena_asteroid_small_010_position:{value:{x:-2500,y:5100,z:-7800},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_010_position"}},battlearena_asteroid_small_010_rotation:{value:{x:-.67,y:.46,z:1.51},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_010_rotation"}},battlearena_asteroid_small_010_scale:{value:1.9,params:{label:"battlearena_asteroid_small_010_scale"}},battlearena_asteroid_small_09_position:{value:{x:-6500,y:1800,z:3500},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_asteroid_small_09_position"}},battlearena_asteroid_small_09_rotation:{value:{x:-.58,y:-.43,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"battlearena_asteroid_small_09_rotation"}},battlearena_asteroid_small_09_scale:{value:2.6,params:{label:"battlearena_asteroid_small_09_scale"}}},gameplay:{gameplay_asteroid_small_014_position:{value:{x:6100,y:-5900,z:-5600},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_small_014_position"}},gameplay_asteroid_small_014_rotation:{value:{x:-.8200000000000001,y:-.87,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_small_014_rotation"}},gameplay_asteroid_small_014_scale:{value:3.900000000000001,params:{label:"gameplay_asteroid_small_014_scale"}},gameplay_asteroid_small_06_position:{value:{x:8800,y:2800,z:-300},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_small_06_position"}},gameplay_asteroid_small_06_rotation:{value:{x:1.01,y:-.13,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_small_06_rotation"}},gameplay_asteroid_small_06_scale:{value:1.4,params:{label:"gameplay_asteroid_small_06_scale"}},gameplay_asteroid_small_05_position:{value:{x:-8800,y:0,z:-12700},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_small_05_position"}},gameplay_asteroid_small_05_rotation:{value:{x:0,y:.17,z:-.59},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_small_05_rotation"}},gameplay_asteroid_small_05_scale:{value:2.3000000000000003,params:{label:"gameplay_asteroid_small_05_scale"}},gameplay_asteroid_medium_02_position:{value:{x:4300,y:-3300,z:7100},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_medium_02_position"}},gameplay_asteroid_medium_02_rotation:{value:{x:3.14,y:-.41000000000000003,z:1.28},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_medium_02_rotation"}},gameplay_asteroid_medium_02_scale:{value:2,params:{label:"gameplay_asteroid_medium_02_scale"}},gameplay_asteroid_medium_03_position:{value:{x:-20100,y:1700,z:-10400},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_medium_03_position"}},gameplay_asteroid_medium_03_rotation:{value:{x:-.79,y:-.8200000000000001,z:-.1},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_medium_03_rotation"}},gameplay_asteroid_medium_03_scale:{value:2.9712813854217535,params:{label:"gameplay_asteroid_medium_03_scale"}},gameplay_asteroid_medium_04_position:{value:{x:-2200,y:-2600,z:1400},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_asteroid_medium_04_position"}},gameplay_asteroid_medium_04_rotation:{value:{x:-2.08,y:-2.87,z:.27},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"gameplay_asteroid_medium_04_rotation"}},gameplay_asteroid_medium_04_scale:{value:2.162669849395752,params:{label:"gameplay_asteroid_medium_04_scale"}}},team:{team_asteroid_small_015_position:{value:{x:-3e3,y:-900,z:1700},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_small_015_position"}},team_asteroid_small_015_rotation:{value:{x:0,y:-.1,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_small_015_rotation"}},team_asteroid_small_015_scale:{value:2,params:{label:"team_asteroid_small_015_scale"}},team_asteroid_small_04_position:{value:{x:3600,y:2700,z:4400},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_small_04_position"}},team_asteroid_small_04_rotation:{value:{x:1.23,y:-1.1500000000000001,z:1.11},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_small_04_rotation"}},team_asteroid_small_04_scale:{value:1.5,params:{label:"team_asteroid_small_04_scale"}},team_asteroid_small_03_position:{value:{x:1300,y:100,z:5e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_small_03_position"}},team_asteroid_small_03_rotation:{value:{x:0,y:0,z:-1.17},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_small_03_rotation"}},team_asteroid_small_03_scale:{value:1.4,params:{label:"team_asteroid_small_03_scale"}},team_asteroid_medium_01_position:{value:{x:-6900,y:2900,z:-3300},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_asteroid_medium_01_position"}},team_asteroid_medium_01_rotation:{value:{x:-.42,y:-.76,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01},label:"team_asteroid_medium_01_rotation"}},team_asteroid_medium_01_scale:{value:1.7,params:{label:"team_asteroid_medium_01_scale"}}}},Fd={lore:{lore_cloud_1_position:{value:{x:-16900,y:-4400,z:900},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_1_position"}},lore_cloud_1_scale:{value:23.8,params:{label:"lore_cloud_1_scale"}},lore_cloud_2_position:{value:{x:2500,y:3100,z:-8e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_2_position"}},lore_cloud_2_scale:{value:11,params:{label:"lore_cloud_2_scale"}},lore_cloud_3_position:{value:{x:2400,y:-6100,z:4100},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_3_position"}},lore_cloud_3_scale:{value:15.3,params:{label:"lore_cloud_3_scale"}},lore_cloud_4_position:{value:{x:11200,y:-600,z:-5e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"lore_cloud_4_position"}},lore_cloud_4_scale:{value:33.3,params:{label:"lore_cloud_4_scale"}}},creatures:{creatures_cloud_1_position:{value:{x:2300,y:1400,z:8100},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_1_position"}},creatures_cloud_1_scale:{value:6,params:{label:"creatures_cloud_1_scale"}},creatures_cloud_2_position:{value:{x:17600,y:-6100,z:4e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_2_position"}},creatures_cloud_2_scale:{value:20.700000000000003,params:{label:"creatures_cloud_2_scale"}},creatures_cloud_3_position:{value:{x:14300,y:4800,z:-3300},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_3_position"}},creatures_cloud_3_scale:{value:17.3,params:{label:"creatures_cloud_3_scale"}},creatures_cloud_4_position:{value:{x:-6100,y:6400,z:300},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_4_position"}},creatures_cloud_4_scale:{value:15.100000000000001,params:{label:"creatures_cloud_4_scale"}},creatures_cloud_5_position:{value:{x:2200,y:6500,z:7500},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_5_position"}},creatures_cloud_5_scale:{value:22.5,params:{label:"creatures_cloud_5_scale"}},creatures_cloud_6_position:{value:{x:-12100,y:-5200,z:-12800},params:{x:{step:100},y:{step:100},z:{step:100},label:"creatures_cloud_6_position"}},creatures_cloud_6_scale:{value:15.3,params:{label:"creatures_cloud_6_scale"}}},battlearena:{battlearena_cloud_3_position:{value:{x:0,y:0,z:0},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_cloud_3_position"}},battlearena_cloud_3_scale:{value:16,params:{label:"battlearena_cloud_3_scale"}},battlearena_cloud_1_position:{value:{x:-4600,y:-1700,z:0},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_cloud_1_position"}},battlearena_cloud_1_scale:{value:9,params:{label:"battlearena_cloud_1_scale"}},battlearena_cloud_2_position:{value:{x:6600,y:-11500,z:-14900},params:{x:{step:100},y:{step:100},z:{step:100},label:"battlearena_cloud_2_position"}},battlearena_cloud_2_scale:{value:12.5,params:{label:"battlearena_cloud_2_scale"}}},gameplay:{gameplay_cloud_1_position:{value:{x:-3900,y:-2600,z:1700},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_1_position"}},gameplay_cloud_1_scale:{value:11.95,params:{label:"gameplay_cloud_1_scale"}},gameplay_cloud_2_position:{value:{x:-7700,y:-900,z:2100},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_2_position"}},gameplay_cloud_2_scale:{value:10.600000000000001,params:{label:"gameplay_cloud_2_scale"}},gameplay_cloud_3_position:{value:{x:-2800,y:2500,z:13e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_3_position"}},gameplay_cloud_3_scale:{value:4.7,params:{label:"gameplay_cloud_3_scale"}},gameplay_cloud_4_position:{value:{x:-1900,y:1100,z:0},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_4_position"}},gameplay_cloud_4_scale:{value:4.050000000000004,params:{label:"gameplay_cloud_4_scale"}},gameplay_cloud_5_position:{value:{x:-2900,y:-10400,z:8400},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_5_position"}},gameplay_cloud_5_scale:{value:18.65,params:{label:"gameplay_cloud_5_scale"}},gameplay_cloud_6_position:{value:{x:26e3,y:-7e3,z:-8e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"gameplay_cloud_6_position"}},gameplay_cloud_6_scale:{value:30,params:{label:"gameplay_cloud_6_scale"}}},team:{team_cloud_1_position:{value:{x:-4500,y:-3400,z:-3200},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_1_position"}},team_cloud_1_scale:{value:7,params:{label:"team_cloud_1_scale"}},team_cloud_2_position:{value:{x:800,y:-3700,z:2e3},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_2_position"}},team_cloud_2_scale:{value:10,params:{label:"team_cloud_2_scale"}},team_cloud_3_position:{value:{x:-5500,y:-7400,z:5300},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_3_position"}},team_cloud_3_scale:{value:11.2,params:{label:"team_cloud_3_scale"}},team_cloud_4_position:{value:{x:5500,y:-2400,z:-3700},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_4_position"}},team_cloud_4_scale:{value:11.2,params:{label:"team_cloud_4_scale"}},team_cloud_5_position:{value:{x:16500,y:-14400,z:-11700},params:{x:{step:100},y:{step:100},z:{step:100},label:"team_cloud_5_position"}},team_cloud_5_scale:{value:21.2,params:{label:"team_cloud_5_scale"}}}},fM={lore_particles:{count:{value:400,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:250,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:2120,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ffb08a",params:{label:"color1"}},timeScale:{value:.5019609696819467,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.5,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:324.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},creatures_particles:{count:{value:50,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:1140,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ffb08a",params:{label:"color1"}},timeScale:{value:.5037248094505982,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.5,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:324.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},battlearena_particles:{count:{value:65,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:820,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ffb08a",params:{label:"color1"}},timeScale:{value:.49657949745719,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.5,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:324.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},gameplay_particles:{count:{value:100,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:2710,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ffb08a",params:{label:"color1"}},timeScale:{value:.5022444567216432,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.5,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:324.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}},team_particles:{count:{value:100,params:{min:1,max:1e4,step:1,label:"count"}},radius:{value:100,params:{min:0,max:300,step:10,label:"radius"}},randomnessFactor:{value:2700,params:{min:0,max:3e3,step:10,label:"randomnessFactor"}},color:{value:"#ff5823",params:{label:"color"}},color1:{value:"#ffb08a",params:{label:"color1"}},timeScale:{value:.5005701802212797,params:{min:0,max:2,step:.01,label:"timeScale"}},noiseIntensity:{value:12e4,params:{min:0,max:15e4,step:.1,label:"noiseIntensity"}},noiseFrequency:{value:.1,params:{min:0,max:2e3,step:.01,label:"noiseFrequency"}},particleOpacity:{value:.5,params:{min:0,max:1,step:.01,label:"particleOpacity"}},particleScale:{value:324.66666666666674,params:{min:0,max:1e3,step:1,label:"particleScale"}},opacityTimescale:{value:.15,params:{min:0,max:2,step:.01,label:"opacityTimescale"}}}},vt=new q,hu=new jt;class vM{constructor(e){this.scene=e,this.timeline=null,this.isFirstDraw=!0,this.guis={},this.floatingAsteroids=[],this.floatingRocks=[],this.lastProgress=0,this.progressDeltaTarget=0,this.progressDelta=0,this.lookAtNextRatioTarget=0,this.lookAtNextRatio=0,this.lookAtPosition=new q,this.lookAtIntro=new q(0,0,-1e3),this.lookAtIslandOffset=new q,this.currentIslandKey="lore",this.configs={},this.configs.islands={zDistance:{value:-12e4,params:{min:-1e6,max:1,step:10}},staticTimeBetweenIsland:{value:.05,params:{min:0,max:4,step:.01}},tweenDuration:{value:4,params:{min:0,max:10,step:.01}},tweenEase:{value:"power4.inOut",params:{}},tweenEaseFirst:{value:"power4.out",params:{}},lookAtIslandOffset:{value:{x:0,y:-.1,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},startCameraPosition:{value:{x:0,y:0},params:{x:{step:.01},y:{step:.01}}}},this.zDistance=this.configs.islands.zDistance.value,this.configs.lore={originalPosition:{value:{x:0,y:300,z:2e3},params:{x:{step:10},y:{step:10},z:{step:10}}},cameraPosition:{value:{x:0,y:.1},params:{x:{step:.01},y:{step:.01}}},fadeColor:{value:"#000000",params:{}},lookatThreshold:{value:.45,params:{min:0,max:1}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},lookAtOffsetMobile:{value:{x:0,y:.25,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}}},this.configs.creatures={originalPosition:{value:{x:-7e3,y:4e3,z:28e3},params:{x:{step:10},y:{step:10},z:{step:10}}},cameraPosition:{value:{x:-4.3,y:3.46},params:{x:{step:.01},y:{step:.01}}},fadeColor:{value:"#000000",params:{}},lookatThreshold:{value:.45,params:{min:0,max:1}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},lookAtOffsetMobile:{value:{x:0,y:.28,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}}},this.configs.battlearena={originalPosition:{value:{x:2920,y:-1430,z:42e3},params:{x:{step:10},y:{step:10},z:{step:10}}},cameraPosition:{value:{x:1.76,y:.3},params:{x:{step:.01},y:{step:.01}}},fadeColor:{value:"#000000",params:{}},lookatThreshold:{value:.4,params:{min:0,max:1}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},lookAtOffsetMobile:{value:{x:.03,y:.13,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}}},this.configs.gameplay={originalPosition:{value:{x:-8220,y:4650,z:38e3},params:{x:{step:10},y:{step:10},z:{step:10}}},cameraPosition:{value:{x:-5.16,y:4.29},params:{x:{step:.01},y:{step:.01}}},fadeColor:{value:"#000000",params:{}},lookatThreshold:{value:.3,params:{min:0,max:1}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},lookAtOffsetMobile:{value:{x:-.35,y:.22,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}}},this.configs.team={originalPosition:{value:{x:4260,y:1230,z:36e3},params:{x:{step:10},y:{step:10},z:{step:10}}},cameraPosition:{value:{x:2.95,y:2.21},params:{x:{step:.01},y:{step:.01}}},fadeColor:{value:"#000000",params:{}},lookatThreshold:{value:.25,params:{min:0,max:1}},lookAtOffset:{value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}},lookAtOffsetMobile:{value:{x:.34,y:-.6,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}}};for(const t in this.configs)Od[t]&&(this.configs[t]={...this.configs[t],...Od[t]}),Fd[t]&&(this.configs[t]={...this.configs[t],...Fd[t]});this.islandRoots={lore:{},creatures:{},battlearena:{},gameplay:{},team:{}},this.lookAtIslandOffset.set(this.configs.islands.lookAtIslandOffset.value.x,this.configs.islands.lookAtIslandOffset.value.y,this.configs.islands.lookAtIslandOffset.value.z)}preInit(e){let t=0;for(const i in this.islandRoots){const s=this.islandRoots[i];s.index=t,s.key=i,s.progress=gt(s.index,0,4,0,1),s.isHovered=!1,s.hoverProgressTarget=0,s.hoverProgress=0,s.emissiveProgressTarget=0,s.emissiveProgress=0,s.root=new Le,s.root.key=i,s.root.name=i+"_transform",s.root.setParent(e),s.baseRoot=new Le,s.baseRoot.key=i,s.baseRoot.name=i+"_baseRoot",s.baseRoot.setParent(s.root),s.plane=new Of(this.scene,{scale:2500,parent:s.root}),s.plane.mesh.visible=!1,s.plane.mesh.position.set(0,-500,0),s.plane.mesh.island=s,this.scene.meshes.push(s.plane),this.scene.interactionManager.raycastMeshes.push(s.plane.mesh);const r=(e.scale.x+e.scale.y+e.scale.z)/3,o=i+"_particles",c=new mM(this.scene,{meshId:1,parent:s.root,fog:!0,globalConfig:this.scene.PBRConfigs,name:o,globalScale:r,config:fM[o]});this.scene.meshes.push(c);const p=new pM(this.scene,{parent:s.baseRoot,name:i+"_title_plane",shaderId:"curvedPlane",globalScale:1/r,textureId:i+"_title",y:-.2,opacity:1,alpha:0,deformationFactor:.5,scaleDamping:.08});p.islandKey=i,this.scene.meshes.push(p),this.scene.bloomPass.meshes.push(p.emissiveMesh),s.textPlanes={titleTextPlane:p},s.asteroids={},s.clouds={},t++}this.initTimeline(),this.scene.on("island-hover-on",this.onIslandHoverOn.bind(this)),this.scene.on("island-hover-off",this.onIslandHoverOff.bind(this))}postInit(){this.initGUI(),this.setOriginalPositions();for(const e in this.islandRoots){const t=this.islandRoots[e];t.emissiveMaterial=Qe.params[e+"_floating_island"],t.initialEmissivePower=t.emissiveMaterial.EmissivePower.value}}addAsteroid(e,t,i){this.configs[e][t+"_position"]||(this.configs[e][t+"_position"]={value:{x:0,y:0,z:0},params:{x:{step:100},y:{step:100},z:{step:100}}}),this.configs[e][t+"_rotation"]||(this.configs[e][t+"_rotation"]={value:{x:0,y:0,z:0},params:{x:{step:.01},y:{step:.01},z:{step:.01}}}),this.configs[e][t+"_scale"]||(this.configs[e][t+"_scale"]={value:1,params:{}}),this.islandRoots[e].asteroids[t]=i,this.addFloatingAsteroids(i)}addCloud(e,t,i){this.configs[e][t+"_position"]||(this.configs[e][t+"_position"]={value:{x:0,y:0,z:0},params:{x:{step:100},y:{step:100},z:{step:100}}}),this.configs[e][t+"_scale"]||(this.configs[e][t+"_scale"]={value:1,params:{}}),this.islandRoots[e].clouds[t]=i}initGUI(){for(const t in this.configs)this.guis[t]=ie.addBlade(this.configs[t],t,0);for(const t in this.guis)for(const i in this.guis[t])this.guis[t][i].on("change",()=>{this.initTimeline(),this.setOriginalPositions()});const e=ie.networkInputs&&ie.networkInputs.list;e&&e.on("change",()=>{setTimeout(()=>{this.initTimeline(),this.setOriginalPositions()},500)})}setOriginalPositions(){for(const e in this.islandRoots){const t=this.islandRoots[e],i=this.configs[e],s=i.originalPosition.value;t.originalPosition=new q(s.x,s.y,s.z),this.scene.cameraManager.debug&&t.originalPosition.set(gt(t.index,0,4,-1e4,1e4),0,0);for(const r in t.asteroids){const o=t.asteroids[r],c=i[r+"_position"].value,p=i[r+"_rotation"].value,m=i[r+"_scale"].value;o.position.set(c.x,c.y,c.z),o.rotation.set(p.x,p.y,p.z),o.scale.set(m,m,m)}for(const r in t.clouds){const o=t.clouds[r],c=i[r+"_position"].value,p=i[r+"_scale"].value;o.position.set(c.x,c.y,c.z),o.scale.set(p,p,p),o._entity.updateMeshScaleFromTexture()}t.root.position.copy(t.originalPosition)}}initTimeline(){this.timeline&&this.timeline.kill(),this.timeline=new ji.timeline({paused:!0});const e=this.configs.islands.staticTimeBetweenIsland.value,t=this.configs.islands.tweenDuration.value,i=this.configs.islands.tweenEase.value,s=this.configs.islands.tweenEaseFirst.value,r=e+t;let o=0;this.timeline.fromTo(this.scene.cameraContainer.position,{x:0,y:0},{x:this.configs.lore.cameraPosition.value.x,y:this.configs.lore.cameraPosition.value.y,duration:t/2,ease:s},0),o+=t/2;let c=["creatures","battlearena","gameplay","team"];for(let p=0;p<c.length;p++){const m=c[p];this.timeline.to(this.scene.cameraContainer.position,{x:this.configs[m].cameraPosition.value.x,y:this.configs[m].cameraPosition.value.y,duration:t,ease:i},o),o+=r}this.timeline.to(this.scene.cameraContainer.position,{x:0,y:0,duration:t,ease:i},o),this.timeline.add(()=>{},"10"),this.timeline.progress(1e-4)}addFloatingAsteroids(e){e.rotationSpeed=new q(Math.random()*.001,Math.random()*.001,Math.random()*.001),e.translateSpeed=new q(Math.random(),Math.random()+1,Math.random()),this.floatingAsteroids.push(e)}addFloatingRocks(e,t){e.mesh.rotationSpeed=new q(Math.random()*2e-4,Math.random()*2e-4,Math.random()*2e-4),e.mesh.translateSpeed=new q(Math.random()*.5,Math.random()*.5,Math.random()*.5),e.offsetPosition=new q,e.offsetRotation=new q,e.originalPosition=new q,e.originalPosition.copy(e.mesh.position),e.originalRotation=new q,e.originalRotation.set(e.mesh.rotation.x,e.mesh.rotation.y,e.mesh.rotation.z),e.islandRef=this.islandRoots[t],this.floatingRocks.push(e),e.hoverPosition=new q,e.hoverRotation=new q,e.rotationVec3=new q,e.hoverProgress=0,e.hoverDamping=this.getRandomBetween(.06,.3);let s=new q;s.copy(e.mesh.position);const r=new q(this.getRandomBetween(1.05,1.4),this.getRandomBetween(1.05,1.2),this.getRandomBetween(1.05,1.4));s.multiply(r);const o=new q;o.copy(e.islandRef.baseRoot.position),o.add(s),e.hoverPosition.copy(o),e.hoverRotation.copy(e.originalRotation);const c=Math.PI*.1,p=new q(this.getRandomBetween(-c,c),this.getRandomBetween(-c,c),this.getRandomBetween(-c,c));e.hoverRotation.add(p)}getRandomBetween(e,t){return Math.random()*(t-e)+e}getIslandScreenPosition(e){const t=this.islandRoots[e];return t&&t.root?(t.root.updateMatrix(),hu.identity(),hu.multiply(this.scene.camera.projectionViewMatrix,t.root.worldMatrix),vt.applyMatrix4(hu),{x:gt(vt.x,-1,1,0,this.scene.ratioWidth),y:gt(vt.y,1,-1,0,this.scene.ratioHeight)}):{x:0,y:0}}resize(){}onIslandHoverOn(e){e.isHovered=!0,e.textPlanes.titleTextPlane.scaleTarget=e.textPlanes.titleTextPlane.initialScaleFactor+.01,e.hoverProgressTarget=1,e.emissiveProgressTarget=1}onIslandHoverOff(e){e.isHovered=!1,e.textPlanes.titleTextPlane.scaleTarget=e.textPlanes.titleTextPlane.initialScaleFactor,e.hoverProgressTarget=0}showIsland(e){for(let t=0;t<e.root.children.length;t++){const i=e.root.children[t];if(i.visible=!0,i.children)for(let s=0;s<i.children.length;s++)i.children[s].visible=!0}for(let t=0;t<e.baseRoot.children.length;t++){const i=e.baseRoot.children[t];if(i.visible=!0,i.children)for(let s=0;s<i.children.length;s++)i.children[s].visible=!0}for(let t=0;t<this.scene.meshes.length;t++){const i=this.scene.meshes[t];if(i.name&&i.name.includes(e.key)){const s=i.mesh;if(s.visible=!0,s.children)for(let r=0;r<s.children.length;r++)s.children[r].visible=!0}}e.plane.mesh.visible=!1,e.root.visible=!0,e.isVisible=!0}hideIsland(e){for(let t=0;t<e.root.children.length;t++){const i=e.root.children[t];if(i.visible=!1,i.children)for(let s=0;s<i.children.length;s++)i.children[s].visible=!1}for(let t=0;t<e.baseRoot.children.length;t++){const i=e.baseRoot.children[t];if(i.visible=!1,i.children)for(let s=0;s<i.children.length;s++)i.children[s].visible=!1}for(let t=0;t<this.scene.meshes.length;t++){const i=this.scene.meshes[t];if(i.name&&i.name.includes(e.key)){const s=i.mesh;if(s.visible=!1,s.children)for(let r=0;r<s.children.length;r++)s.children[r].visible=!1}}e.root.visible=!1,e.isVisible=!1}preRender(){const e=this.configs.islands;this.zDistance=e.zDistance.value,this.lookAtIslandOffset.set(e.lookAtIslandOffset.value.x,e.lookAtIslandOffset.value.y,e.lookAtIslandOffset.value.z),this.progressDeltaTarget=xr(Math.abs(this.scene.progress-this.lastProgress),0,.0025),this.progressDelta+=(this.progressDeltaTarget-this.progressDelta)*.4;let t=0,i=0,s="creatures";for(const v in this.islandRoots){const g=this.islandRoots[v];g.isVisible=!0,g.progress=(gt(4-g.index,0,5,0,1)+this.scene.progress)%1;const C=t/5,S=C+1/5;if(g.visibility=gt(this.scene.progress,C,S,0,1,!0),g.visibility>0){let B=gt(g.visibility,this.configs[v].lookatThreshold.value,1,0,1,!0);this.lookAtNextRatioTarget=Vi.easeInOutCubic(B),gt(g.visibility,0,.35,1,0,!0),this.currentIslandKey=v;const O=Object.keys(this.islandRoots),L=g.index===4?0:g.index+1;s=O[L]}t===0&&g.visibility>.99&&(g.visibility=0),g.progress>i&&(i=g.progress);let E=this.zDistance+this.configs[v].originalPosition.value.z;g.root.position.z=gt(g.progress,0,1,E,0);const T=[g.root.worldMatrix[12],g.root.worldMatrix[13],g.root.worldMatrix[14]];T[2]<this.scene.config.textRenderThreshold.value?g.textPlanes.titleTextPlane.mesh.visible=!1:(g.textPlanes.titleTextPlane.mesh.visible=!0,g.textPlanes.titleTextPlane.setPositionProgress(g.visibility),g.visibility>.05&&g.visibility<.99?(g.textPlanes.titleTextPlane.alphaTarget=1,g.isHovered||(g.emissiveProgressTarget=g.initialEmissivePower*.35)):(g.textPlanes.titleTextPlane.alphaTarget=0,g.isHovered||(g.emissiveProgressTarget=0)));const M=T[2]<this.scene.config.renderThreshold.value;let W=!this.scene.animationsManager.introIsOver;(v==="lore"||v==="creatures")&&(W=this.scene.animationsManager.introProgress<.3),!this.isFirstDraw&&(W||M)?this.hideIsland(g):this.showIsland(g),g.baseRoot.position.y+=Math.sin(this.scene.time+t)*1,g.hoverProgress+=(g.hoverProgressTarget-g.hoverProgress)*.1,g.emissiveProgress+=(g.emissiveProgressTarget-g.emissiveProgress)*.1,g.emissiveMaterial&&(g.emissiveMaterial.EmissivePower.value=g.emissiveProgress),t++}const r=1+this.progressDelta*1e4;for(let v=0,g=this.floatingAsteroids.length;v<g;v++){const C=this.floatingAsteroids[v];[C.worldMatrix[12],C.worldMatrix[13],C.worldMatrix[14]][2]<this.scene.config.renderThreshold.value||(C.position.y+=Math.sin(this.scene.time+v)*C.translateSpeed.y,C.position.x+=Math.cos(this.scene.time-v)*C.translateSpeed.x,C.position.z+=Math.sin(this.scene.time+v*2)*C.translateSpeed.z,C.rotation.x+=C.rotationSpeed.x*r,C.rotation.y+=C.rotationSpeed.y*r,C.rotation.z+=C.rotationSpeed.z*r)}for(let v=0,g=this.floatingRocks.length;v<g;v++){const C=this.floatingRocks[v],S=C.mesh;if([S.worldMatrix[12],S.worldMatrix[13],S.worldMatrix[14]][2]<this.scene.config.renderThreshold.value)continue;C.offsetPosition.x+=Math.cos(this.scene.time-v)*S.translateSpeed.x,C.offsetPosition.y+=Math.cos(this.scene.time-v)*S.translateSpeed.y,C.offsetPosition.z+=Math.sin(this.scene.time+v*2)*S.translateSpeed.z;const T=gt(C.hoverProgress,0,1,1,5,!0);C.offsetRotation.x+=S.rotationSpeed.x*T,C.offsetRotation.y+=S.rotationSpeed.y*T,C.offsetRotation.z+=S.rotationSpeed.z*T,C.hoverProgress+=(C.islandRef.hoverProgress-C.hoverProgress)*C.hoverDamping;const M=Vi.easeOutCubic(C.hoverProgress);S.position.copy(C.originalPosition),S.position.lerp(C.hoverPosition,M),S.position.add(C.offsetPosition),C.rotationVec3.copy(C.originalRotation),C.rotationVec3.lerp(C.hoverRotation,M),C.rotationVec3.add(C.offsetRotation),S.rotation.copy(C.rotationVec3)}this.timeline.progress(this.scene.progress),this.lastProgress=this.scene.progress;const o=this.islandRoots[this.currentIslandKey];let c=this.islandRoots[s],p=this.configs[this.currentIslandKey].lookAtOffset.value,m=this.configs[s].lookAtOffset.value;this.scene.isSmartphonePortrait&&(p=this.configs[this.currentIslandKey].lookAtOffsetMobile.value,m=this.configs[s].lookAtOffsetMobile.value),vt.copy(o.baseRoot.worldPosition),vt.x+=p.x,vt.y+=p.y,vt.z+=p.z,this.lookAtPosition.copy(vt),vt.copy(c.baseRoot.worldPosition),vt.x+=m.x,vt.y+=m.y,vt.z+=m.z;const _=Vi.easeInOutQuad(this.lookAtNextRatioTarget);this.lookAtPosition.lerp(vt,_),this.lookAtPosition.add(this.lookAtIslandOffset),this.scene.animationsManager.introTl&&this.lookAtPosition.lerp(this.lookAtIntro,Vi.easeInQuint(1-this.scene.animationsManager.introTl.progress())),this.scene.cameraContainer.lookAtWorld(this.lookAtPosition,!0),this.isFirstDraw=!1}}class gM{constructor(e){fe(this,"introIsOver",!1);fe(this,"introWasOver",!1);fe(this,"isRaycastReady",!1);fe(this,"wasRaycastReady",!1);fe(this,"introTl",null);fe(this,"onIslandClickTl",null);fe(this,"introProgress",0);this.scene=e}initPlaneIntroTimeline(){this.introTl=new ji.timeline({paused:!0}),this.introTl.fromTo(this.scene.camera.position,{z:30},{z:0,duration:10,ease:"power2.inOut"},"0"),this.introTl.fromTo(this.scene.camera,{fov:30},{fov:40,duration:10,ease:"power2.inOut"},"0")}initIntroTimeline(){this.introTl=new ji.timeline({paused:!0}),this.introTl.fromTo(this.scene.introMeshes.lettersGeoms.program.uniforms.uProgress,{value:0},{value:1,duration:4,ease:"power2.inOut"},"0"),this.introTl.fromTo(this.scene.camera.position,{z:32},{z:0,duration:10,ease:"power2.inOut"},"0"),this.introTl.fromTo(this.scene.camera,{fov:20},{fov:40,duration:10,ease:"power2.inOut"},"0"),this.introTl.fromTo(this.scene.introMeshes.bigRockGeoms,{progress:0},{progress:.045,duration:1.85,ease:"expo.out"},"1"),this.introTl.to(this.scene.introMeshes.bigRockGeoms,{progress:2,duration:2,ease:"power2.out"},"2"),this.introTl.fromTo(this.scene.introMeshes.smallRockGeoms,{progress:0},{progress:.045,duration:1.85,ease:"expo.out"},"1"),this.introTl.to(this.scene.introMeshes.smallRockGeoms,{progress:1,duration:2,ease:"power2.out"},"2"),this.introTl.add(()=>{this.scene.introParticles.launch()},"2"),this.introTl.fromTo(this.scene.introMeshes.light,{alpha:0},{alpha:1,duration:2,ease:"power3.inOut"},"0"),this.introTl.to(this.scene.introMeshes.light,{alpha:0,duration:4,ease:"power3.inOut"},"3")}initOnIslandClickTimeline(){const e=this.scene.cameraManager.config.fov.value;this.onIslandClickTl=new ji.timeline({paused:!0}),this.onIslandClickTl.to(this.scene.camera,{fov:e-10,duration:.9,ease:"power2.in"},0),this.onIslandClickTl.to(this.scene.post,{activeSpritesheetOffset:this.scene.spritesheetManager.framerate+1,duration:1,ease:`steps(${this.scene.spritesheetManager.framerate+1})`},.15)}playIntro(){this.introTl.play()}playIslandClick(){return this.onIslandClickTl.play()}skipIntro(){this.introIsOver=!0,this.introWasOver=!0,this.scene._emitter.emit("intro-over"),this.scene._emitter.emit("raycast-ready")}preRender(){if(this.introTl&&!this.wasRaycastReady&&(this.isRaycastReady=this.introTl.progress()>.95,this.isRaycastReady&&(this.scene._emitter.emit("raycast-ready"),this.wasRaycastReady=!0)),this.introTl&&!this.introWasOver){this.introProgress=this.introTl.progress(),this.introIsOver=this.introProgress>.6,this.introIsOver&&(this.scene._emitter.emit("intro-over"),this.introWasOver=!0);const e=Vi.easeOutCubic(this.introProgress),t=5*e,i=1.6,s=i+t;this.scene.glowPlane.mesh.scale.set(i*1.424+t,s,s);let r=.5,o=e*-.5;this.scene.glowPlane.mesh.position.set(0,r+o,23);const c=gt(this.introProgress,.2,.21,1,0,!0);this.scene.glowPlane.alpha=c,c<.01&&(this.scene.glowPlane.mesh.visible=!1)}this.scene.cameraManager.debug&&this.introTl&&this.introTl.progress(this.scene.progress)}}const _M=new wt,bM=new wt,xM=new wt,Dd=new q,Ld=new q,Nd=new q,yM=new q,CM=new q,SM=new q,kd=new q,pu=new q,zd=new q,Ud=new q,wM=new q,Hd=new jt;class AM{constructor(){this.origin=new q,this.direction=new q}castMouse(e,t=[0,0]){if(e.type==="orthographic"){const{left:i,right:s,bottom:r,top:o,zoom:c}=e,p=i/c+(s-i)/c*(t[0]*.5+.5),m=r/c+(o-r)/c*(t[1]*.5+.5);this.origin.set(p,m,0),this.origin.applyMatrix4(e.worldMatrix),this.direction.x=-e.worldMatrix[8],this.direction.y=-e.worldMatrix[9],this.direction.z=-e.worldMatrix[10]}else e.worldMatrix.getTranslation(this.origin),this.direction.set(t[0],t[1],.5),e.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(e,{maxDistance:t,output:i=[]}={}){Array.isArray(e)||(e=[e]);const s=Hd,r=Dd,o=Ld,c=i;return c.length=0,e.forEach(p=>{if(!p.castable)return;(!p.geometry.bounds||p.geometry.bounds.radius===1/0)&&p.geometry.computeBoundingSphere();const m=p.geometry.bounds;s.inverse(p.worldMatrix);let _;if(t&&(o.copy(this.direction).scaleRotateMatrix4(s),_=t*o.len()),r.copy(this.origin).applyMatrix4(s),o.copy(this.direction).transformDirection(s),t&&r.distance(m.center)-m.radius>_)return;let v=0;if(p.geometry.raycast==="sphere"){if(r.distance(m.center)>m.radius&&(v=this.intersectSphere(m,r,o),!v))return}else if((r.x<m.min.x||r.x>m.max.x||r.y<m.min.y||r.y>m.max.y||r.z<m.min.z||r.z>m.max.z)&&(v=this.intersectBox(m,r,o),!v))return;t&&v>_||(p.hit||(p.hit={localPoint:new q,point:new q}),p.hit.localPoint.copy(o).multiply(v).add(r),p.hit.point.copy(p.hit.localPoint).applyMatrix4(p.worldMatrix),p.hit.distance=p.hit.point.distance(this.origin),c.push(p))}),c.sort((p,m)=>p.hit.distance-m.hit.distance),c}intersectMeshes(e,{cullFace:t=!0,maxDistance:i,includeUV:s=!0,includeNormal:r=!0,output:o=[]}={}){const c=this.intersectBounds(e,{maxDistance:i,output:o});if(!c.length)return c;const p=Hd,m=Dd,_=Ld,v=Nd,g=yM,C=CM,S=SM,E=kd,T=pu,M=_M,W=bM,B=xM;for(let O=c.length-1;O>=0;O--){const L=c[O];p.inverse(L.worldMatrix);let H;i&&(_.copy(this.direction).scaleRotateMatrix4(p),H=i*_.len()),m.copy(this.origin).applyMatrix4(p),_.copy(this.direction).transformDirection(p);let G=0,N,U,J;const Q=L.geometry,Y=Q.attributes,D=Y.index,z=Math.max(0,Q.drawRange.start),F=Math.min(D?D.count:Y.position.count,Q.drawRange.start+Q.drawRange.count);for(let V=z;V<F;V+=3){const j=D?D.data[V]:V,ue=D?D.data[V+1]:V+1,Ie=D?D.data[V+2]:V+2;v.fromArray(Y.position.data,j*3),g.fromArray(Y.position.data,ue*3),C.fromArray(Y.position.data,Ie*3);const ke=this.intersectTriangle(v,g,C,t,m,_,E);!ke||i&&ke>H||(!G||ke<G)&&(G=ke,N=j,U=ue,J=Ie,S.copy(E))}G||c.splice(O,1),L.hit.localPoint.copy(_).multiply(G).add(m),L.hit.point.copy(L.hit.localPoint).applyMatrix4(L.worldMatrix),L.hit.distance=L.hit.point.distance(this.origin),L.hit.faceNormal||(L.hit.localFaceNormal=new q,L.hit.faceNormal=new q,L.hit.uv=new wt,L.hit.localNormal=new q,L.hit.normal=new q),L.hit.localFaceNormal.copy(S),L.hit.faceNormal.copy(L.hit.localFaceNormal).transformDirection(L.worldMatrix),(s||r)&&(v.fromArray(Y.position.data,N*3),g.fromArray(Y.position.data,U*3),C.fromArray(Y.position.data,J*3),this.getBarycoord(L.hit.localPoint,v,g,C,T)),s&&Y.uv&&(M.fromArray(Y.uv.data,N*2),W.fromArray(Y.uv.data,U*2),B.fromArray(Y.uv.data,J*2),L.hit.uv.set(M.x*T.x+W.x*T.y+B.x*T.z,M.y*T.x+W.y*T.y+B.y*T.z)),r&&Y.normal&&(v.fromArray(Y.normal.data,N*3),g.fromArray(Y.normal.data,U*3),C.fromArray(Y.normal.data,J*3),L.hit.localNormal.set(v.x*T.x+g.x*T.y+C.x*T.z,v.y*T.x+g.y*T.y+C.y*T.z,v.z*T.x+g.z*T.y+C.z*T.z),L.hit.normal.copy(L.hit.localNormal).transformDirection(L.worldMatrix))}return c.sort((O,L)=>O.hit.distance-L.hit.distance),c}intersectSphere(e,t=this.origin,i=this.direction){const s=Nd;s.sub(e.center,t);const r=s.dot(i),o=s.dot(s)-r*r,c=e.radius*e.radius;if(o>c)return 0;const p=Math.sqrt(c-o),m=r-p,_=r+p;return m<0&&_<0?0:m<0?_:m}intersectBox(e,t=this.origin,i=this.direction){let s,r,o,c,p,m;const _=1/i.x,v=1/i.y,g=1/i.z,C=e.min,S=e.max;return s=((_>=0?C.x:S.x)-t.x)*_,r=((_>=0?S.x:C.x)-t.x)*_,o=((v>=0?C.y:S.y)-t.y)*v,c=((v>=0?S.y:C.y)-t.y)*v,s>c||o>r||(o>s&&(s=o),c<r&&(r=c),p=((g>=0?C.z:S.z)-t.z)*g,m=((g>=0?S.z:C.z)-t.z)*g,s>m||p>r)||(p>s&&(s=p),m<r&&(r=m),r<0)?0:s>=0?s:r}intersectTriangle(e,t,i,s=!0,r=this.origin,o=this.direction,c=kd){const p=pu,m=zd,_=Ud;p.sub(t,e),m.sub(i,e),c.cross(p,m);let v=o.dot(c);if(!v)return 0;let g;if(v>0){if(s)return 0;g=1}else g=-1,v=-v;_.sub(r,e);let C=g*o.dot(m.cross(_,m));if(C<0)return 0;let S=g*o.dot(p.cross(_));if(S<0||C+S>v)return 0;let E=-g*_.dot(c);return E<0?0:E/v}getBarycoord(e,t,i,s,r=pu){const o=zd,c=Ud,p=wM;o.sub(s,t),c.sub(i,t),p.sub(e,t);const m=o.dot(o),_=o.dot(c),v=o.dot(p),g=c.dot(c),C=c.dot(p),S=m*g-_*_;if(S===0)return r.set(-2,-1,-1);const E=1/S,T=(g*v-_*C)*E,M=(m*C-_*v)*E;return r.set(1-T-M,M,T)}}class EM{constructor(e){this.scene=e,this.raycast=new AM(this.scene.gl),this.raycastMeshes=[],this.meshHovered=null,this.mouse=new wt,this.mouseDebounce=null,this.raycastEnabled=!1}initEvents(){this.wWidth=document.documentElement.clientWidth,this.wHeight=document.documentElement.clientHeight,at&&(document.body.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),document.body.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0})),document.body.addEventListener("mousemove",this.onMouseMove.bind(this)),Ke.emitter.on("wheel",this.onMouseMove.bind(this)),Ke.emitter.on("click",this.onClick.bind(this)),Mh.on("menu-click",()=>{this.onMenuClicked()})}onTouchStart(e){!this.scene.active||(this.mouse.set((e.touches[0].clientX/this.wWidth-.5)*2,(e.touches[0].clientY/this.wHeight-.5)*-2),this.updateRaycast())}onTouchMove(e){!this.scene.active||(this.mouse.set((e.touches[0].clientX/this.wWidth-.5)*2,(e.touches[0].clientY/this.wHeight-.5)*-2),this.updateRaycast())}onMouseMove(){!this.scene.active||this.raycastEnabled&&(clearTimeout(this.mouseDebounce),this.mouseDebounce=setTimeout(this.updateRaycast(),15))}updateRaycast(){this.mouseDebounce=null,this.mouse.set(Ke.lastCursor[0],-Ke.lastCursor[1]),this.raycast.castMouse(this.scene.cameraManager.camera,this.mouse);const e=this.raycast.intersectBounds(this.raycastMeshes,{maxDistance:25});this.raycastMeshes.forEach(t=>{e[0]===t||e[1]===t?t.wasHovered||this.onMouseEnter(t):t.wasHovered&&this.onMouseLeave(t)}),document.body.classList.toggle("is-hover",this.meshHovered!==null)}onClick(){this.scene.active&&this.meshHovered&&this.raycastEnabled&&this.onIslandClicked()}onMouseEnter(e){this.meshHovered=e,e.wasHovered=!0,this.scene._emitter.emit("island-hover-on",e.island)}onMouseLeave(e){e.wasHovered=!1,this.meshHovered=null,this.scene._emitter.emit("island-hover-off",e.island)}onIslandClicked(){const e=this.meshHovered.island;this.scene.islandsManager.currentIslandKey===e.key?this.scene._emitter.emit("island-clicked",e):this.scene._emitter.emit("island-clicked",e)}onMenuClicked(){this.scene.post.program.uniforms.uTransitionToBlackFactor.value=.5,this.scene.animationsManager.playIslandClick().then(()=>{this.scene.animationsManager.onIslandClickTl.restart().pause(),this.scene.post.program.uniforms.uTransitionToBlackFactor.value=0,Mh.emit("menu-open")})}resize(e,t){this.wWidth=e,this.wHeight=t}dispose(){this.raycastMeshes=[]}}var Ot=function(n,e,t,i){this.x=n,this.y=e,this.width=t,this.height=i,this.finalX=n+t,this.finalY=e+i};Ot.prototype.set=function(n,e,t,i,s,r){return this.x=n,this.y=e,this.finalX=t,this.finalY=i,this.width=s,this.height=r,this};Ot.prototype.fits=function(n){var e=n.image.width,t=n.image.height;return e<=this.width&&t<=this.height};Ot.prototype.fitsPerfectly=function(n){var e=n.image.width,t=n.image.height;return e==this.width&&t==this.height};Ot.prototype.overlaps=function(n){return this.x<n.x+n.width&&this.x+this.width>n.x&&this.y<n.y+n.height&&this.y+this.height>n.y};var _i=function(n,e){if(this.MAX_TEXTURE_SIZE=e,!!n){this.dataURLs=new Object;for(var t in n){var i=n[t];if(typeof i.image.toDataURL>"u"){var s=document.createElement("canvas");s.width=i.image.naturalWidth,s.height=i.image.naturalHeight,s.getContext("2d").drawImage(i.image,0,0),this.dataURLs[t]=s.toDataURL()}else this.dataURLs[t]=i.image.toDataURL()}this.canvas=document.createElement("canvas"),this.textureCount=0,this.maxWidth=0,this.maxHeight=0;var r="";for(t in n){this.textureCount++;var o=n[t];o.area=o.image.width*o.image.height,o.image.width>this.maxWidth&&(this.maxWidth=o.image.width),o.image.height>this.maxHeight&&(this.maxHeight=o.image.height),r+=t+","}r=r.substring(0,r.length-1),this.textureCache=new Object,this.node=new Object,this.node.rectangle=new Ot(0,0,this.maxWidth*this.textureCount,this.maxHeight*this.textureCount),this.textureOffsets=new Object,this.allNodes=[],this.insert(this.node,this.findNextTexture(n),n),this.ranges=new Object;var c=this.calculateImageSize(n);this.canvas.width=c.width,this.canvas.height=c.height;var p=this.canvas.getContext("2d");this.context=p;for(t in this.textureOffsets){for(var o=n[t],m=this.textureOffsets[t].x,_=this.textureOffsets[t].y,v=o.image.width,g=o.image.height,C=_;C<_+g;C+=g)for(var S=m;S<m+v;S+=v)p.drawImage(o.image,S,C,v,g);var E=new Object;E.startU=m/c.width,E.endU=(m+v)/c.width,E.startV=1-_/c.height,E.endV=1-(_+g)/c.height,this.ranges[t]=E}this.makeCanvasPowerOfTwo()}};_i.prototype.isTextureAlreadyInserted=function(n,e){var t=e[n],i=this.dataURLs[n];for(var s in e)if(s!=n){var r=e[s],o=this.dataURLs[s];if(i==o&&r.offset.x==t.offset.x&&r.offset.y==t.offset.y&&r.offset.z==t.offset.z&&r.repeat.x==t.repeat.x&&r.repeat.y==t.repeat.y&&r.flipX==t.flipX&&r.flipY==t.flipY&&r.wrapS==t.wrapS&&r.wrapT==t.wrapT&&this.textureOffsets[s])return this.textureOffsets[s]}return!1};_i.prototype.insert=function(n,e,t){var i=t[e],s=this.isTextureAlreadyInserted(e,t);if(s){this.textureOffsets[e]=s;var r=this.findNextTexture(t);r!=null&&this.insert(n,r,t);return}var o=i.image.width,c=i.image.height;if(n.upperNode){for(var p=this.maxWidth*this.textureCount+this.maxHeight*this.textureCount,m=0,_=!1,v=0;v<this.allNodes.length;v++){var g=this.allNodes[v];if(!g.textureName&&g.rectangle.fits(i)){this.textureOffsets[e]={x:g.rectangle.x,y:g.rectangle.y};var C=this.calculateImageSize(t),S=C.width+C.height;if(S<p&&C.width<=this.MAX_TEXTURE_SIZE&&C.height<=this.MAX_TEXTURE_SIZE){var E=!1;for(var T in this.textureOffsets)if(T!=e){var M=g.rectangle,W=this.textureOffsets[T].x,B=this.textureOffsets[T].y,O=t[T].image,L=new Ot(M.x,M.y,o,c),H=new Ot(W,B,O.width,O.height);L.overlaps(H)&&(E=!0)}E||(p=S,m=this.allNodes[v],_=!0)}delete this.textureOffsets[e]}}if(_){if(this.textureOffsets[e]={x:m.rectangle.x,y:m.rectangle.y},m.textureName=e,!m.children){var G=new Object,N=new Object;G.upperNode=m,N.upperNode=m,m.children=[G,N];var U=m.rectangle.x,J=m.rectangle.y,Q=this.maxWidth*this.textureCount,Y=this.maxHeight*this.textureCount;G.rectangle=new Ot(U+o,J,Q-(U+o),Y-J),N.rectangle=new Ot(U,J+c,Q-U,Y-(J+c)),this.allNodes.push(G),this.allNodes.push(N)}var r=this.findNextTexture(t);r!=null&&this.insert(n,r,t)}else throw new Error("Error: Try to use smaller textures.")}else{var D=n.rectangle.width,z=n.rectangle.height;n.textureName=e;var G=new Object,N=new Object;G.upperNode=n,N.upperNode=n,n.children=[G,N],G.rectangle=new Ot(o,0,D-o,c),N.rectangle=new Ot(0,c,D,z-c),this.textureOffsets[e]={x:n.rectangle.x,y:n.rectangle.y};var F=n.children[0];this.allNodes=[n,G,N];var r=this.findNextTexture(t);r!=null&&this.insert(F,r,t)}};_i.prototype.makeCanvasPowerOfTwo=function(n){var e=!1;n||(n=this.canvas,e=!0);var t=n.width,i=n.height,s=Math.pow(2,Math.round(Math.log(t)/Math.log(2))),r=Math.pow(2,Math.round(Math.log(i)/Math.log(2))),o=document.createElement("canvas");o.width=s,o.height=r,o.getContext("2d").drawImage(n,0,0,s,r),e&&(this.canvas=o)};_i.prototype.calculateImageSize=function(n){var e=0,t=0;for(var i in this.textureOffsets){var s=n[i],r=s.image.width,o=s.image.height,c=this.textureOffsets[i].x,p=this.textureOffsets[i].y;c+r>e&&(e=c+r),p+o>t&&(t=p+o)}return{width:e,height:t}};_i.prototype.findNextTexture=function(n){var e=-1,t;for(const s in n){var i=n[s];this.textureCache[s]||i.area>e&&(e=i.area,t=s)}return e==-1?null:(this.textureCache[t]=!0,t)};_i.prototype.rescale=function(n,e){var t=document.createElement("canvas");t.width=n.width*e,t.height=n.height*e;var i=t.getContext("2d");return i.drawImage(n,0,0,n.width,n.height,0,0,t.width,t.height),t};class TM{constructor(e){fe(this,"canvas",null);fe(this,"spritesheet",null);fe(this,"ranges",null);fe(this,"framerate",30);this.scene=e,this.gl=e.gl}fetchSpritesheetData(e="/glxp/spritesheets/postprocessing-30fps/",t="postprocessing_spritesheet"){return new Promise(i=>{const s=[this.scene.textureLoader.load(e+"spritesheet.png",t,["compressed",`lodTarget=${at?"1024":"2048"}`]),fetch(e+"spritesheet_ranges.json")];Promise.all(s).then(async([r,o])=>{const c=await o.json();i([r,c])})})}buildPostprocessingSpritesheet(e,t=2048){const i=new Array(this.framerate).fill().map((s,r)=>this.scene.textureLoader.load(`/glxp/sprites/postprocessing-${this.framerate}fps/000${("0"+r).slice(-2)}.jpg`,`postprocessing_sprites_${r}`,[""]));Promise.all(i).then(s=>{const{ranges:r,canvas:o}=new _i(s,t);this.canvas=o,this.spritesheet=new be(this.gl,{image:o}),this.ranges=r,e(this.spritesheet,this.ranges)})}downloadSpritesheet(e="image/png",t="spritesheet.png",i="spritesheet_ranges.json"){const s=this.canvas.toDataURL(e),r=document.createElement("a");r.href=s,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r);const o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.ranges)),c=document.createElement("a");c.href=o,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c)}}class MM extends $g{constructor(e,t=null){super(e,t),this.manager=t,this.renderer=t.renderer,this.time=0,this.dt=0,this.drawcalls=0,this.progress=0,this.previousProgress=0,this.progressDelta=0,this.progressTarget=1e-5,this.direction=1,this.forceAllDraw=!0,this.globalScale=6e-4,this.skipIntro=!1,this.root=new Le,this.bgRoot=new Le,this.bgRoot.setParent(this.root),this.initCameras(),this.animationsManager=new gM(this),this.islandsManager=new vM(this),this.interactionManager=new EM(this),this.spritesheetManager=new TM(this),this.clearColor=this.manager.clearColor,this.loaded=!1,this.active=!1,this.textureLoader=new n_(this),this.meshes=[],this.skinedMeshes=[],this.nodes=[],this.trackers=[],this.isMobile=at,this.isSmartphonePortrait=Zg,this.root.scale.set(1,1,1),this.ratioWidth=this.width/this.dpr,this.ratioHeight=this.height/this.dpr,this.config={Pause:{value:!1,type:"bool"},time_scale:{value:1.5,params:{min:0,max:3,step:.01}},scroll_damping:{value:.05,params:{min:0,max:1,step:.01}},scroll_damping_mobile:{value:.1,params:{min:0,max:1,step:.01}},scroll_speed:{value:5,params:{min:0,max:10,step:.1}},progress:{value:0,params:{min:0,max:1,step:.001}},renderThreshold:{value:-(Uu.CONFIG_0.FogFar.value+8),params:{min:-100,max:0,step:.1}},textRenderThreshold:{value:-17,params:{min:-100,max:0,step:.1}}},this.scrollDamping=this.isMobile?this.config.scroll_damping_mobile.value:this.config.scroll_damping.value,ie.addBlade(this.config,"Global Settings"),this.ready=!1,this.pendingReadyMeshes=[],this.pendingReadyMeshesPassed=[]}initCameras(){this.cameraManager=new hM(this.gl,{width:this.width,height:this.height,scene:this,debug:ie.queryDebug("orbit")}),this.camera=this.cameraManager.camera,this.cameraContainer=this.cameraManager.cameraContainer,this.BloomRT=new ZS(this)}setProgressTarget(e){this.progressTarget=e}postFirstDraw(){}activate(){return new Promise(e=>{this.active=!0,this.activationResolve=e,this.postFirstDraw()})}onLoaded(){this.active=!0,this._emitter.emit("loaded"),this.initBackground();for(let i=0;i<this.meshes.length;i++)this.meshes[i].onLoaded();this.post.onLoaded(),ie.onLoaded(),ie.pane.refresh(),ie.queryDebug("skipIntro")||this.skipIntro?(this.animationsManager.skipIntro(),ji.delayedCall(1,()=>{this.interactionManager.initEvents()})):this.animationsManager.initIntroTimeline(),this.animationsManager.initOnIslandClickTimeline();let e=[];for(const i of this.meshes)i.getFirstDrawPromise&&e.push(i.getFirstDrawPromise());e.push(this.post.getFirstDrawPromise());let t=0;for(const i of e)i.then(s=>{t++;const r=Math.round(t/e.length*100),o=Math.round(90+r*.1);this._emitter.emit("progress",o)});Promise.all(e).then(()=>{this.ready=!0})}async load(){let e=[];this.post=new dw(this);for(const i in _e.main)if(_e.main.hasOwnProperty(i)){const s=_e.main[i].url;e.push(this.textureLoader.load(s,i,_e.main[i].options))}this.PBRConfigs=Uu.CONFIG_0,this.bloomPass=new rw(this,this.BloomRT),this.loadIntro(e),this.loadIslands(e),Promise.all(e).then(()=>{this.onLoaded()});let t=0;for(let i=0;i<e.length;i++)e[i].then(()=>{t++,this._emitter.emit("progress",Math.round(t/e.length*90))})}playIntro(){this.animationsManager.playIntro(),ji.delayedCall(7,()=>{this.interactionManager.initEvents()})}loadIntro(e){const i=`/glxp/models/${this.isSmartphonePortrait?"Intro_00013_mobile_draco":"Intro_00013_draco"}`;this.on("intro-over",this.onIntroOver.bind(this)),this.on("raycast-ready",()=>{this.interactionManager.raycastEnabled=!0}),e.push(new Pd(i+".glb").then(s=>{var C,S,E,T,M;let r=new Le;r.scale.set(.01,.01,.01),r.position.z=20,r.setParent(this.root),this.logoRoot=new Le,this.logoRoot.position.y=22,this.logoRoot.setParent(r);const o=[],c=[],p=[];let m,_;for(let W=0;W<s.nodes.length;W++){const B=s.nodes[W];if(B.mesh!==void 0){const O=B.mesh,L=O.name,H=O.primitives[0].material.name;L.includes("Big_Rock")?o.push({meshName:L,materialName:H,meshData:O,node:B}):L.includes("Small_Rock")?c.push({meshName:L,materialName:H,meshData:O,node:B}):L.includes("Letter_Part")?p.push({meshName:L,materialName:H,meshData:O,node:B}):(m=new jp(this,O,_e.main[H]!==void 0?H:"testPng",{id:this.pannelId,parent:this.logoRoot,gltf:s,name:L,node:B,fog:!1,transparent:!0,id:1,materialName:H,material:(C=_e.main[H])==null?void 0:C.material,globalConfig:this.PBRConfigs}),this.meshes.push(m))}}this.introMeshes={light:{alpha:0}};let v=new MS(this,{scale:40,forceRenderOrder:!0,renderOrder:999});v.mesh.position.z=0,this.cameraManager.debug&&(v.mesh.visible=!1),this.meshes.push(v),v.bloomPassIndex=this.bloomPass.meshes.length,this.bloomPass.meshes.push(v.mesh),this.introMeshes.light=v,this.introFloatingParticles=new ew(this,{meshId:1,name:"Intro Floating Particles"}),this.introFloatingParticles.mesh.position.z=26,this.meshes.push(this.introFloatingParticles),this.introParticles=new tw(this,{name:"Intro Flying Particles"}),this.introParticles.place(-17.5),this.meshes.push(this.introParticles),_=o[0].materialName,m=new $l(this,o,_e.main[_]!==void 0?_:"testPng",{id:this.pannelId,parent:r,gltf:s,name:o[0].meshName,fog:!1,transparent:!0,shaderId:"mergedStandard",id:1,offsetPosition:at?[0,0,0]:[-220,0,0],separatedEmissive:!0,materialName:_,material:(S=_e.main[_])==null?void 0:S.material,globalConfig:this.PBRConfigs}),this.meshes.push(m),this.bloomPass.meshes.push(m.emissiveMesh),this.introMeshes.bigRockGeoms=[],this.introMeshes.bigRockGeoms.push(m),at||(m=new $l(this,o,_e.main[_]!==void 0?_:"testPng",{id:this.pannelId,parent:r,gltf:s,name:o[0].meshName,fog:!1,transparent:!0,shaderId:"mergedStandard",id:1,offsetPosition:[190,0,0],separatedEmissive:!0,materialName:_,material:(E=_e.main[_])==null?void 0:E.material,globalConfig:this.PBRConfigs}),this.meshes.push(m),this.bloomPass.meshes.push(m.emissiveMesh),this.introMeshes.bigRockGeoms.push(m)),_=c[0].materialName,m=new $l(this,c,_e.main[_]!==void 0?_:"testPng",{id:1,parent:r,gltf:s,name:c[0].meshName,fog:!1,transparent:!1,shaderId:"mergedStandard",materialName:_,separatedEmissive:!0,material:(T=_e.main[_])==null?void 0:T.material,globalConfig:this.PBRConfigs}),this.meshes.push(m),this.bloomPass.meshes.push(m.emissiveMesh),this.introMeshes.smallRockGeoms=m,_=p[0].materialName;const g="title";m=new $S(this,p,g,{id:1,parent:this.logoRoot,gltf:s,name:p[0].meshName,fog:!1,transparent:!0,shaderId:"lettersMergedUnlit",name:_,forceRenderOrder:!0,renderOrder:1e3,isLetters:!0,material:(M=_e.main[_])==null?void 0:M.material,globalConfig:this.PBRConfigs}),m.mesh.position.z=570,this.meshes.push(m),this.introMeshes.lettersGeoms=m})),this.glowPlane=new Of(this,{textureId:"title_glow",transparent:!0,blendFunc:{src:this.gl.SRC_ALPHA,dst:this.gl.ONE_MINUS_SRC_ALPHA}}),this.glowPlane.mesh.position.set(0,.5,23),this.meshes.push(this.glowPlane)}loadIslands(e){let t="/glxp/models/islands_merged_0015_draco";e.push(new Pd(t+".glb").then(i=>{var p;let s=new Le;s.scale.set(this.globalScale,this.globalScale,this.globalScale),s.position.z=1,s.setParent(this.root),this.islandsManager.preInit(s);let r=Id.buildNodeTreeCustom(i,s,this.islandsManager.islandRoots),o=Id.buildMeshList(i,r),c;for(let m=0;m<o.length;m++){const _=o[m],v=_e.main[_.materialName]!==void 0?_.materialName:"testPng",g=_.materialName.includes("floating_island"),C=_.meshName.includes("cloth_flag"),S=_.meshName.includes("brazier"),E=_.meshName.includes("tapestry"),T=_.meshName.includes("asteroid"),M=g&&!_.meshName.includes("sland"),W=_.meshName.includes("cloud"),B=_.meshName.split("_")[0];let O=s;if(_.parent!==void 0)if(T){const G=_.parent.key||((p=_.parent.parent)==null?void 0:p.key)||B;O=this.islandsManager.islandRoots[G].root}else O=_.parent;let L="standard";g?L="standardEmissive":C?L="standardFlag":S?L="standardEmissiveBrazier":E?L="standardTapestry":W&&(L="unlitCloud");const H={id:this.pannelId,parent:O,gltf:i,name:_.meshName,node:_.node,fog:!0,transparent:!0,id:1,shaderId:L,separatedEmissive:g||S,materialName:_.materialName,globalConfig:this.PBRConfigs,forceRenderOrder:g,renderOrder:g?-1:0};if(C)c=new qS(this,_.meshData,v,H);else if(S){c=new YS(this,_.meshData,v,H),this.bloomPass.meshes.push(c.emissiveMesh);const G=new nw(this,{globalScale:this.globalScale*.1,parent:c.mesh,globalConfig:this.PBRConfigs,count:at?50:150,renderOrder:0,forceRenderOrder:!0,name:"Brazier Particles "+_.meshName});this.meshes.push(G)}else E?(c=new XS(this,_.meshData,v,H),this.bloomPass.meshes.push(c.emissiveMesh)):T?(c=new QS(this,_.meshData,v,H),this.bloomPass.meshes.push(c.emissiveMesh),this.islandsManager.addAsteroid(B,_.meshName,c.mesh)):W?(c=new JS(this,_.meshData,v,{...H,transparent:!0,depthTest:!0,depthWrite:!1,renderOrder:-2,forceRenderOrder:!0}),this.islandsManager.addCloud(B,_.meshName,c.mesh),this.bloomPass.meshes.push(c.emissiveMesh)):(c=new jp(this,_.meshData,v,H),this.bloomPass.meshes.push(c.emissiveMesh));c.islandKey=B,c&&this.meshes.push(c),M&&this.islandsManager.addFloatingRocks(c,B)}this.islandsManager.postInit()}))}initBackground(){this.background=new WS(this,{depthTest:!0,depthWrite:!1,parent:this.bgRoot,shaderId:"background",textureIds:{mobile:"background_mobile",desktop:"background"},renderOrder:-2}),this.meshes.push(this.background)}applyDefaultState(){let e=this.gl;e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthMask(!0)}onIntroOver(){for(let e=0,t=this.introMeshes.bigRockGeoms.length;e<t;e++)this.introMeshes.bigRockGeoms[e].dispose();for(let e=0,t=this.introMeshes.smallRockGeoms.length;e<t;e++)this.introMeshes.smallRockGeoms[e].dispose();for(let e=0,t=this.introMeshes.lettersGeoms.length;e<t;e++)this.introMeshes.lettersGeoms[e].dispose();this.introMeshes.light&&(this.bloomPass.meshes.splice(this.introMeshes.light.bloomPassIndex,1),this.introMeshes.light.dispose()),this.introFloatingParticles&&this.introFloatingParticles.dispose(),this.glowPlane&&this.glowPlane.dispose(),this.textureLoader.disposeTexture("Rock_COL"),this.textureLoader.disposeTexture("Rock_AO"),this.textureLoader.disposeTexture("Rock_MR"),this.textureLoader.disposeTexture("Rock_NRM")}preRender(){this.previousProgress=this.progress,this.cameraManager.debug?this.progress=this.config.progress.value:(this.progressDelta=this.progressTarget-this.progress,this.progressDelta<=-.6?this.progress=wl(In(this.progress,this.progressTarget+1,.1),1):this.progressDelta>=.6?this.progress=wl(In(this.progress,this.progressTarget-1,.1),1):this.progress=wl(In(this.progress,this.progressTarget,this.scrollDamping),1),this.progress=Math.max(1e-5,this.progress),this.islandsManager.preRender());for(let e=0;e<this.meshes.length;e++)this.meshes[e].mesh&&this.meshes[e].preRender();this.cameraManager.preRender(),this.animationsManager.preRender(),this.post.preRender()}resize(){this.ratioWidth=this.width/this.dpr,this.ratioHeight=this.height/this.dpr,this.cameraManager.resize(this.width,this.height),this.interactionManager&&this.interactionManager.resize(this.width,this.height),this.background&&this.background.resize(),this.post&&this.post.resize(),this.bloomPass&&this.bloomPass.resize(),this.BloomRT&&this.BloomRT.resize()}render(){if(!this.active)return;let e=this.gl;if(this.time+=ui.dt/1e3,this.dt=ui.dt,this.preRender(),!this.ready){this.pendingReadyMeshes.length>0&&(this.pendingReadyMeshes[0].drawInit(),this.pendingReadyMeshesPassed.push(this.pendingReadyMeshes.shift()));for(const t of this.pendingReadyMeshesPassed)t.drawInit();return}if(e.viewport(0,0,this.width,this.height),this.camera.perspective({aspect:this.width/this.height}),this.renderer.setViewport(this.width,this.height),this.bloomPass){this.bloomPass.meshes.forEach(t=>{if(t._entity.emissiveMesh){let i=!0;t._entity.islandKey&&(i=this.islandsManager.islandRoots[t._entity.islandKey].isVisible),t.visible=i}});for(let t=0;t<this.bloomPass.meshes.length;t++){const i=this.bloomPass.meshes[t];this.renderer.render({scene:i,camera:this.camera,clear:t==0,frustumCull:!1,sort:!1,update:!0,post:this.BloomRT})}this.bloomPass.meshes.forEach(t=>{t._entity.emissiveMesh&&(t.visible=!1)})}this.renderer.render({scene:this.root,camera:this.camera,clear:!0,frustumCull:!0,sort:!0,post:this.post}),this.bloomPass.render(),this.post.render(),this.postRender()}postRender(){this.gl.viewport(0,0,this.width,this.height),this.drawcalls++,this.forceAllDraw&&this.drawcalls>40&&(this.forceAllDraw=!1,this.activationResolve())}}const du=new q;let BM=1;class PM{constructor({canvas:e=document.createElement("canvas"),width:t=300,height:i=150,dpr:s=1,alpha:r=!1,depth:o=!0,stencil:c=!1,antialias:p=!1,premultipliedAlpha:m=!1,preserveDrawingBuffer:_=!1,powerPreference:v="default",autoClear:g=!0,webgl:C=2}={}){const S={alpha:r,depth:o,stencil:c,antialias:p,premultipliedAlpha:m,preserveDrawingBuffer:_,powerPreference:v};this.dpr=s,this.alpha=r,this.color=!0,this.depth=o,this.stencil=c,this.premultipliedAlpha=m,this.autoClear=g,this.id=BM++,this.drawCalls=0,this.vpOffset=new wt,this.vpOverwriteSize=null,C===2&&(this.gl=e.getContext("webgl2",S)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",S)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(t,i),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,t){this.width=e,this.height=t,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=t*this.dpr,Object.assign(this.gl.canvas.style,{width:e+"px",height:t+"px"})}setViewport(e,t){this.state.viewport.width===e&&this.state.viewport.height===t||(this.state.viewport.width=e,this.state.viewport.height=t,this.gl.viewport(this.vpOffset.x,this.vpOffset.y,e,t))}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,t,i,s){this.state.blendFunc.src===e&&this.state.blendFunc.dst===t&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===s||(this.state.blendFunc.src=e,this.state.blendFunc.dst=t,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=s,i!==void 0?this.gl.blendFuncSeparate(e,t,i,s):this.gl.blendFunc(e,t))}setBlendEquation(e,t){e=e||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===t)&&(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=t,t!==void 0?this.gl.blendEquationSeparate(e,t):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:t=null}={}){this.state.framebuffer!==t&&(this.state.framebuffer=t,this.gl.bindFramebuffer(e,t))}getExtension(e,t,i){return t&&this.gl[t]?this.gl[t].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),t?this.extensions[e]?this.extensions[e][i].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:e.zDepth!==t.zDepth?e.zDepth-t.zDepth:t.id-e.id}sortTransparent(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.zDepth!==t.zDepth?t.zDepth-e.zDepth:t.id-e.id}sortManual(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.zDepth!==t.zDepth?t.zDepth-e.zDepth:t.id-e.id}sortUI(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:t.id-e.id}getRenderList({scene:e,camera:t,frustumCull:i,sort:s}){let r=[];if(t&&i&&t.updateFrustum(),e.traverse(o=>{if(!o.visible)return!0;!o.draw||!o.forceRenderOrder&&i&&o.frustumCulled&&t&&!t.frustumIntersectsMesh(o)||r.push(o)}),s){const o=[],c=[],p=[],m=[],_=[];r.forEach(v=>{v.program.transparent?v.forceRenderOrder?v.renderOrder<0?m.push(v):_.push(v):v.program.depthTest?c.push(v):p.push(v):o.push(v),v.zDepth=0,!(v.renderOrder!==0||!v.program.depthTest||!t)&&(v.worldMatrix.getTranslation(du),du.applyMatrix4(t.projectionViewMatrix),v.zDepth=du.z)}),o.sort(this.sortOpaque),c.sort(this.sortTransparent),m.sort(this.sortManual),_.sort(this.sortManual),p.sort(this.sortUI),r=m.concat(o,c,p,_)}return r}render({scene:e,camera:t,target:i=null,flip:s=!1,post:r=null,update:o=!0,sort:c=!0,frustumCull:p=!0,clear:m}){if(i===null&&r===null&&this.vpOverwriteSize===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):r!==null?(this.setViewport(r.rt.width,r.rt.height),this.bindFramebuffer({target:this.gl.FRAMEBUFFER,buffer:r.rt.fb})):this.vpOverwriteSize!==null?(this.bindFramebuffer(),this.setViewport(this.vpOverwriteSize[0],this.vpOverwriteSize[1])):(this.bindFramebuffer(i),this.setViewport(i.width,i.height)),(m||this.autoClear&&m!==!1)&&(this.depth&&(!i||i.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),Array.isArray(e))for(let _=0;_<e.length;_++)this.draw(e[_],o,t,s,p,c,r,i);else this.draw(e,o,t,s,p,c,r,i)}draw(e,t,i,s,r,o,c,p){t&&e.updateMatrixWorld(),i&&i.updateMatrixWorld(s),this.getRenderList({scene:e,camera:i,frustumCull:r,sort:o}).forEach(_=>{_.draw({camera:i}),this.drawCalls++}),s&&(i.isFliped=!1),c!==null&&this.bindFramebuffer({target:this.gl.FRAMEBUFFER,buffer:p})}}class IM{constructor(){this.scenes={},this.initialized=!1,this.mobile=!1,this.perfCheckEnabled=!0,this.windowIsBlurred=!1,this.windowHasBlurred=!1,this.clearColor=[0,0,0,0],this.renderQuality="normal",this.perfInterval=setInterval(()=>{},0),window.GLXP=this,this._emitter={},ya(this._emitter),this.on=this._emitter.on.bind(this._emitter)}init(e){return this.dpr=Math.max(Math.min(window.devicePixelRatio,2),1),this.width=e.offsetWidth*this.dpr,this.height=e.offsetHeight*this.dpr,this.container=e,this.catchContext(),this.initialized=!0,this.mobile=typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1,this.initScenes(),window.addEventListener("resize",t=>{setTimeout(this.resize.bind(this),100)},{passive:!1}),this.on("perf-check",t=>{if(this.windowHasBlurred){this.windowHasBlurred=!1;return}if(!this.perfCheckEnabled||document.hidden||this.windowIsBlurred)return;const i=at?.5:.3;if(t.delta>t.cappedFPS*i)if(this.dpr>1){this.renderQuality="low";const s=at?1.2:1;this.dpr=Math.max(Math.min(window.devicePixelRatio,s),1),this.resize(),this._emitter.emit("resize")}else this.dpr==1&&(this.dpr=1,this.renderQuality="minimal",this.resize(),this._emitter.emit("resize"),this.disablePerfCheck());else this.renderQuality=="low"?(this.renderQuality="normal",this.dpr=Math.max(Math.min(window.devicePixelRatio,2),1),this.resize(),this._emitter.emit("resize")):this.renderQuality=="minimal"&&(this.renderQuality="low",this.dpr=Math.max(Math.min(window.devicePixelRatio,1),1),this.resize(),this._emitter.emit("resize"))}),window.addEventListener("blur",()=>{clearInterval(this.perfInterval),this.windowIsBlurred=!0,this.windowHasBlurred=!0}),window.addEventListener("visibilitychange",t=>{document.visibilityState==="visible"?(this.windowIsBlurred=!1,this.perfCheckEnabled&&this.activatePerfCheck()):(clearInterval(this.perfInterval),this.windowIsBlurred=!0,this.windowHasBlurred=!0)}),window.addEventListener("focus",()=>{this.windowIsBlurred=!1,this.perfCheckEnabled&&this.activatePerfCheck()}),this}initScenes(){this.addScene("main",MM)}addScene(e,t){this.scenes[e]={scene:new t(this.container,this),active:!1,callbackCanvas:null}}registerCallbackCanvas(e,t){this.scenes[e].callbackCanvas=t}getScene(e){return this.scenes[e].scene}loadScene(e){if(this.scenes[e].scene.loaded===!1)return new Promise((i,s)=>{this.scenes[e].scene.load(),this.scenes[e].scene.on("loaded",()=>{this.scenes[e].scene.onResize(),i()})})}activate(e){return this.scenes[e].active=!0,this.activatePerfCheck(),this.scenes[e].scene.activate()}setProgressTarget(e,t=!1){this.scenes.main.scene.setProgressTarget(e),t&&(this.scenes.main.scene.progress=e)}getProgress(){return this.scenes.main.scene.progress}getPreviousProgress(){return this.scenes.main.scene.previousProgress}playIntro(){this.scenes.main.scene.playIntro()}setMainFPS(e){this.FPSBase=e}calcMainFPS(e=60){let t,i=new Promise(s=>{t=s});return Bh({count:120,callback:s=>{this.FPSBase=Math.min(s,e),t()}}),i}disablePerfCheck(){this.perfCheckEnabled=!1,clearInterval(this.perfInterval)}activatePerfCheck(){clearInterval(this.perfInterval),this.perfInterval=setInterval(()=>{!document.hidden&&!this.windowIsBlurred&&this.checkFPS()},2e3)}checkFPS(e=60){this.FPSBase!=null&&Bh({count:120,callback:t=>{const i=Math.min(t,e),s=this.FPSBase-i;this._emitter.emit("perf-check",{FPSBase:this.FPSBase,cappedFPS:i,delta:s})}})}resize(){this.width=this.container.offsetWidth*this.dpr,this.height=this.container.offsetHeight*this.dpr,this.canvas.style.minWidth=this.container.offsetWidth+"px",this.canvas.style.minHeight=this.container.offsetHeight+"px",this.renderer.setSize(this.width,this.height),Ke.resize()}desactivate(e){this.scenes[e].active=!1,this.scenes[e].scene.active=!1,this.gl.clearColor(0,0,0,0),this.gl.clear(this.COLOR_BUFFER_BIT|this.DEPTH_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0),document.body.classList.remove("is-hover")}catchContext(){if(this.renderer=new PM({antialias:this.dpr<2}),this.gl=this.renderer.gl,!this.renderer.isWebgl2){let e=this.gl.getExtension("OES_vertex_array_object");e&&(this.gl.createVertexArray=function(){return e.createVertexArrayOES()},this.gl.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},this.gl.bindVertexArray=function(t){e.bindVertexArrayOES(t)},this.gl.isVertexArray=function(t){return e.isVertexArrayOES(t)}),this.gl.getExtension("OES_standard_derivatives"),this.gl.getExtension("EXT_shader_texture_lod"),this.gl.getExtension("OES_texture_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("OES_texture_half_float"),this.gl.getExtension("OES_texture_half_float_linear"),this.gl.getExtension("EXT_color_buffer_half_float")}this.canvas=this.gl.canvas,this.canvas.style.minWidth=this.container.offsetWidth+"px",this.canvas.style.minHeight=this.container.offsetHeight+"px",this.container.appendChild(this.gl.canvas),this.renderer.setSize(this.width,this.height)}render(){let e=this.gl;e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.colorMask(!0,!0,!0,!0),this.renderer.drawCalls=0;for(const t in this.scenes)if(this.scenes.hasOwnProperty(t)){const i=this.scenes[t];i.active===!0&&i.scene.render()}}}const Gd=new IM;export{Gd as default};
