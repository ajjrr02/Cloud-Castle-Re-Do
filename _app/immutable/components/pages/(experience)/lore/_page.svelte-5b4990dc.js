import{S as et,i as tt,s as rt,Z as ce,_ as ve,m as ie,h as te,n as X,b as Qe,J as ee,Q as Ae,B as He,D as dt,R as $e,k as de,a as Me,l as he,c as be,w as Ve,q as ot,x as Ye,r as lt,T as Je,L as Ue,y as Xe,u as mt,f as Ne,a5 as Et,t as We,z as ze,K as St,M as _t,o as Ft,V as Bt,a8 as Ut,N as Lt,O as Nt,a4 as kt,d as wt,g as Kt}from"../../../../chunks/index-bc06f92d.js";import{d as Wt,o as Gt,C as jt,f as pt}from"../../../../chunks/index-d954d85d.js";import{A as Ht}from"../../../../chunks/AudioButton-55789cb9.js";import{e as ut,b as Tt}from"../../../../chunks/stores-d809ebdc.js";import{i as yt}from"../../../../chunks/utils-cfade855.js";var Dt={exports:{}};(function(z,V){typeof window<"u"&&function(C,y){z.exports=y()}(Wt,function(){return function(K){var C={};function y(M){if(C[M])return C[M].exports;var O=C[M]={i:M,l:!1,exports:{}};return K[M].call(O.exports,O,O.exports,y),O.l=!0,O.exports}return y.m=K,y.c=C,y.d=function(M,O,D){y.o(M,O)||Object.defineProperty(M,O,{enumerable:!0,get:D})},y.r=function(M){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},y.t=function(M,O){if(O&1&&(M=y(M)),O&8||O&4&&typeof M=="object"&&M&&M.__esModule)return M;var D=Object.create(null);if(y.r(D),Object.defineProperty(D,"default",{enumerable:!0,value:M}),O&2&&typeof M!="string")for(var b in M)y.d(D,b,function(R){return M[R]}.bind(null,b));return D},y.n=function(M){var O=M&&M.__esModule?function(){return M.default}:function(){return M};return y.d(O,"a",O),O},y.o=function(M,O){return Object.prototype.hasOwnProperty.call(M,O)},y.p="/dist/",y(y.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(K,C,y){var M=Object.prototype.hasOwnProperty,O="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(O=!1));function b(p,x,E){this.fn=p,this.context=x,this.once=E||!1}function R(p,x,E,T,m){if(typeof E!="function")throw new TypeError("The listener must be a function");var g=new b(E,T||p,m),n=O?O+x:x;return p._events[n]?p._events[n].fn?p._events[n]=[p._events[n],g]:p._events[n].push(g):(p._events[n]=g,p._eventsCount++),p}function I(p,x){--p._eventsCount===0?p._events=new D:delete p._events[x]}function A(){this._events=new D,this._eventsCount=0}A.prototype.eventNames=function(){var x=[],E,T;if(this._eventsCount===0)return x;for(T in E=this._events)M.call(E,T)&&x.push(O?T.slice(1):T);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(E)):x},A.prototype.listeners=function(x){var E=O?O+x:x,T=this._events[E];if(!T)return[];if(T.fn)return[T.fn];for(var m=0,g=T.length,n=new Array(g);m<g;m++)n[m]=T[m].fn;return n},A.prototype.listenerCount=function(x){var E=O?O+x:x,T=this._events[E];return T?T.fn?1:T.length:0},A.prototype.emit=function(x,E,T,m,g,n){var e=O?O+x:x;if(!this._events[e])return!1;var l=this._events[e],f=arguments.length,c,i;if(l.fn){switch(l.once&&this.removeListener(x,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,E),!0;case 3:return l.fn.call(l.context,E,T),!0;case 4:return l.fn.call(l.context,E,T,m),!0;case 5:return l.fn.call(l.context,E,T,m,g),!0;case 6:return l.fn.call(l.context,E,T,m,g,n),!0}for(i=1,c=new Array(f-1);i<f;i++)c[i-1]=arguments[i];l.fn.apply(l.context,c)}else{var t=l.length,r;for(i=0;i<t;i++)switch(l[i].once&&this.removeListener(x,l[i].fn,void 0,!0),f){case 1:l[i].fn.call(l[i].context);break;case 2:l[i].fn.call(l[i].context,E);break;case 3:l[i].fn.call(l[i].context,E,T);break;case 4:l[i].fn.call(l[i].context,E,T,m);break;default:if(!c)for(r=1,c=new Array(f-1);r<f;r++)c[r-1]=arguments[r];l[i].fn.apply(l[i].context,c)}}return!0},A.prototype.on=function(x,E,T){return R(this,x,E,T,!1)},A.prototype.once=function(x,E,T){return R(this,x,E,T,!0)},A.prototype.removeListener=function(x,E,T,m){var g=O?O+x:x;if(!this._events[g])return this;if(!E)return I(this,g),this;var n=this._events[g];if(n.fn)n.fn===E&&(!m||n.once)&&(!T||n.context===T)&&I(this,g);else{for(var e=0,l=[],f=n.length;e<f;e++)(n[e].fn!==E||m&&!n[e].once||T&&n[e].context!==T)&&l.push(n[e]);l.length?this._events[g]=l.length===1?l[0]:l:I(this,g)}return this},A.prototype.removeAllListeners=function(x){var E;return x?(E=O?O+x:x,this._events[E]&&I(this,E)):(this._events=new D,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=O,A.EventEmitter=A,K.exports=A},"./node_modules/url-toolkit/src/url-toolkit.js":function(K,C,y){(function(M){var O=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,D=/^(?=([^\/?#]*))\1([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(A,p,x){if(x=x||{},A=A.trim(),p=p.trim(),!p){if(!x.alwaysNormalize)return A;var E=I.parseURL(A);if(!E)throw new Error("Error trying to parse base URL.");return E.path=I.normalizePath(E.path),I.buildURLFromParts(E)}var T=I.parseURL(p);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return x.alwaysNormalize?(T.path=I.normalizePath(T.path),I.buildURLFromParts(T)):p;var m=I.parseURL(A);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var g=D.exec(m.path);m.netLoc=g[1],m.path=g[2]}m.netLoc&&!m.path&&(m.path="/");var n={scheme:m.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(n.netLoc=m.netLoc,T.path[0]!=="/"))if(!T.path)n.path=m.path,T.params||(n.params=m.params,T.query||(n.query=m.query));else{var e=m.path,l=e.substring(0,e.lastIndexOf("/")+1)+T.path;n.path=I.normalizePath(l)}return n.path===null&&(n.path=x.alwaysNormalize?I.normalizePath(T.path):T.path),I.buildURLFromParts(n)},parseURL:function(A){var p=O.exec(A);return p?{scheme:p[1]||"",netLoc:p[2]||"",path:p[3]||"",params:p[4]||"",query:p[5]||"",fragment:p[6]||""}:null},normalizePath:function(A){for(A=A.split("").reverse().join("").replace(b,"");A.length!==(A=A.replace(R,"")).length;);return A.split("").reverse().join("")},buildURLFromParts:function(A){return A.scheme+A.netLoc+A.path+A.params+A.query+A.fragment}};K.exports=I})()},"./node_modules/webworkify-webpack/index.js":function(K,C,y){function M(x){var E={};function T(g){if(E[g])return E[g].exports;var n=E[g]={i:g,l:!1,exports:{}};return x[g].call(n.exports,n,n.exports,T),n.l=!0,n.exports}T.m=x,T.c=E,T.i=function(g){return g},T.d=function(g,n,e){T.o(g,n)||Object.defineProperty(g,n,{configurable:!1,enumerable:!0,get:e})},T.r=function(g){Object.defineProperty(g,"__esModule",{value:!0})},T.n=function(g){var n=g&&g.__esModule?function(){return g.default}:function(){return g};return T.d(n,"a",n),n},T.o=function(g,n){return Object.prototype.hasOwnProperty.call(g,n)},T.p="/",T.oe=function(g){throw console.error(g),g};var m=T(T.s=ENTRY_MODULE);return m.default||m}var O="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function b(x){return(x+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(x){return!isNaN(1*x)}function I(x,E,T){var m={};m[T]=[];var g=E.toString(),n=g.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return m;for(var e=n[1],l=new RegExp("(\\\\n|\\W)"+b(e)+D,"g"),f;f=l.exec(g);)f[3]!=="dll-reference"&&m[T].push(f[3]);for(l=new RegExp("\\("+b(e)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+D,"g");f=l.exec(g);)x[f[2]]||(m[T].push(f[1]),x[f[2]]=y(f[1]).m),m[f[2]]=m[f[2]]||[],m[f[2]].push(f[4]);for(var c=Object.keys(m),i=0;i<c.length;i++)for(var t=0;t<m[c[i]].length;t++)R(m[c[i]][t])&&(m[c[i]][t]=1*m[c[i]][t]);return m}function A(x){var E=Object.keys(x);return E.reduce(function(T,m){return T||x[m].length>0},!1)}function p(x,E){for(var T={main:[E]},m={main:[]},g={main:{}};A(T);)for(var n=Object.keys(T),e=0;e<n.length;e++){var l=n[e],f=T[l],c=f.pop();if(g[l]=g[l]||{},!(g[l][c]||!x[l][c])){g[l][c]=!0,m[l]=m[l]||[],m[l].push(c);for(var i=I(x,x[l][c],l),t=Object.keys(i),r=0;r<t.length;r++)T[t[r]]=T[t[r]]||[],T[t[r]]=T[t[r]].concat(i[t[r]])}}return m}K.exports=function(x,E){E=E||{};var T={main:y.m},m=E.all?{main:Object.keys(T.main)}:p(T,x),g="";Object.keys(m).filter(function(c){return c!=="main"}).forEach(function(c){for(var i=0;m[c][i];)i++;m[c].push(i),T[c][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+c+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+m[c].map(function(t){return""+JSON.stringify(t)+": "+T[c][t].toString()}).join(",")+`});
`}),g=g+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(x))+")({"+m.main.map(function(c){return""+JSON.stringify(c)+": "+T.main[c].toString()}).join(",")+"}))(self);";var n=new window.Blob([g],{type:"text/javascript"});if(E.bare)return n;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,l=e.createObjectURL(n),f=new window.Worker(l);return f.objectURL=l,f}},"./src/config.ts":function(K,C,y){y.r(C),y.d(C,"hlsDefaultConfig",function(){return r}),y.d(C,"mergeConfig",function(){return a}),y.d(C,"enableStreamingMode",function(){return s});var M=y("./src/controller/abr-controller.ts"),O=y("./src/controller/audio-stream-controller.ts"),D=y("./src/controller/audio-track-controller.ts"),b=y("./src/controller/subtitle-stream-controller.ts"),R=y("./src/controller/subtitle-track-controller.ts"),I=y("./src/controller/buffer-controller.ts"),A=y("./src/controller/timeline-controller.ts"),p=y("./src/controller/cap-level-controller.ts"),x=y("./src/controller/fps-controller.ts"),E=y("./src/controller/eme-controller.ts"),T=y("./src/controller/cmcd-controller.ts"),m=y("./src/utils/xhr-loader.ts"),g=y("./src/utils/fetch-loader.ts"),n=y("./src/utils/cues.ts"),e=y("./src/utils/mediakeys-helper.ts"),l=y("./src/utils/logger.ts");function f(){return f=Object.assign?Object.assign.bind():function(d){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var v in u)Object.prototype.hasOwnProperty.call(u,v)&&(d[v]=u[v])}return d},f.apply(this,arguments)}function c(d,o){var u=Object.keys(d);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(d);o&&(v=v.filter(function(S){return Object.getOwnPropertyDescriptor(d,S).enumerable})),u.push.apply(u,v)}return u}function i(d){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?arguments[o]:{};o%2?c(Object(u),!0).forEach(function(v){t(d,v,u[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(u)):c(Object(u)).forEach(function(v){Object.defineProperty(d,v,Object.getOwnPropertyDescriptor(u,v))})}return d}function t(d,o,u){return o in d?Object.defineProperty(d,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):d[o]=u,d}var r=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:I.default,capLevelController:p.default,fpsController:x.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},h()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:R.default,timelineController:A.TimelineController,audioStreamController:O.default,audioTrackController:D.default,emeController:E.default,cmcdController:T.default});function h(){return{cueHandler:n.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function a(d,o){if((o.liveSyncDurationCount||o.liveMaxLatencyDurationCount)&&(o.liveSyncDuration||o.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(o.liveMaxLatencyDurationCount!==void 0&&(o.liveSyncDurationCount===void 0||o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(o.liveMaxLatencyDuration!==void 0&&(o.liveSyncDuration===void 0||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return f({},d,o)}function s(d){var o=d.loader;if(o!==g.default&&o!==m.default)l.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),d.progressive=!1;else{var u=Object(g.fetchSupported)();u&&(d.loader=g.default,d.progressive=!0,d.enableSoftwareAES=!0,l.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(K,C,y){y.r(C);var M=y("./src/polyfills/number.ts"),O=y("./src/utils/ewma-bandwidth-estimator.ts"),D=y("./src/events.ts"),b=y("./src/errors.ts"),R=y("./src/types/loader.ts"),I=y("./src/utils/logger.ts");function A(E,T){for(var m=0;m<T.length;m++){var g=T[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(E,g.key,g)}}function p(E,T,m){return T&&A(E.prototype,T),m&&A(E,m),Object.defineProperty(E,"prototype",{writable:!1}),E}var x=function(){function E(m){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=m;var g=m.config;this.bwEstimator=new O.default(g.abrEwmaSlowVoD,g.abrEwmaFastVoD,g.abrEwmaDefaultEstimate),this.registerListeners()}var T=E.prototype;return T.registerListeners=function(){var g=this.hls;g.on(D.Events.FRAG_LOADING,this.onFragLoading,this),g.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(D.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var g=this.hls;g.off(D.Events.FRAG_LOADING,this.onFragLoading,this),g.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(D.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},T.onFragLoading=function(g,n){var e=n.frag;if(e.type===R.PlaylistLevelType.MAIN&&!this.timer){var l;this.fragCurrent=e,this.partCurrent=(l=n.part)!=null?l:null,this.timer=self.setInterval(this.onCheck,100)}},T.onLevelLoaded=function(g,n){var e=this.hls.config;n.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},T._abandonRulesCheck=function(){var g=this.fragCurrent,n=this.partCurrent,e=this.hls,l=e.autoLevelEnabled;e.config;var f=e.media;if(!(!g||!f)){var c=n?n.stats:g.stats,i=n?n.duration:g.duration;if(c.aborted||c.loaded&&c.loaded===c.total||g.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!l||f.paused||!f.playbackRate||!f.readyState)){var t=e.mainForwardBufferInfo;if(t!==null){var r=performance.now()-c.loading.start,h=Math.abs(f.playbackRate);if(!(r<=500*i/h)){var a=c.loaded&&c.loading.first,s=this.bwEstimator.getEstimate(),d=e.levels,o=e.minAutoLevel,u=d[g.level],v=c.total||Math.max(c.loaded,Math.round(i*u.maxBitrate/8)),S=a?c.loaded*1e3/r:0,L=S?(v-c.loaded)/S:v*8/s,P=t.len/h;if(!(L<=P)){var F=Number.POSITIVE_INFINITY,_;for(_=g.level-1;_>o;_--){var B=d[_].maxBitrate;if(F=S?i*B/(8*.8*S):i*B/s,F<P)break}F>=L||(I.logger.warn("Fragment "+g.sn+(n?" part "+n.index:"")+" of level "+g.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+_+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(s)?(s/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+L.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+P.toFixed(3)+" s"),e.nextLoadLevel=_,a&&this.bwEstimator.sample(r,c.loaded),this.clearTimer(),g.loader&&(this.fragCurrent=this.partCurrent=null,g.loader.abort()),e.trigger(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:g,part:n,stats:c}))}}}}}},T.onFragLoaded=function(g,n){var e=n.frag,l=n.part;if(e.type===R.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(e.sn)){var f=l?l.stats:e.stats,c=l?l.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[e.level],t=(i.loaded?i.loaded.bytes:0)+f.loaded,r=(i.loaded?i.loaded.duration:0)+c;i.loaded={bytes:t,duration:r},i.realBitrate=Math.round(8*t/r)}if(e.bitrateTest){var h={stats:f,frag:e,part:l,id:e.type};this.onFragBuffered(D.Events.FRAG_BUFFERED,h)}}},T.onFragBuffered=function(g,n){var e=n.frag,l=n.part,f=l?l.stats:e.stats;if(!f.aborted&&!(e.type!==R.PlaylistLevelType.MAIN||e.sn==="initSegment")){var c=f.parsing.end-f.loading.start;this.bwEstimator.sample(c,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=c/1e3:this.bitrateTestDelay=0}},T.onError=function(g,n){switch(n.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},T.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},T.getNextABRAutoLevel=function(){var g=this.fragCurrent,n=this.partCurrent,e=this.hls,l=e.maxAutoLevel,f=e.config,c=e.minAutoLevel,i=e.media,t=n?n.duration:g?g.duration:0;i&&i.currentTime;var r=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,a=e.mainForwardBufferInfo,s=(a?a.len:0)/r,d=this.findBestLevel(h,c,l,s,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(d>=0)return d;I.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var o=t?Math.min(t,f.maxStarvationDelay):f.maxStarvationDelay,u=f.abrBandWidthFactor,v=f.abrBandWidthUpFactor;if(!s){var S=this.bitrateTestDelay;if(S){var L=t?Math.min(t,f.maxLoadingDelay):f.maxLoadingDelay;o=L-S,I.logger.trace("bitrate test took "+Math.round(1e3*S)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*o)+" ms"),u=v=1}}return d=this.findBestLevel(h,c,l,s+o,u,v),Math.max(d,0)},T.findBestLevel=function(g,n,e,l,f,c){for(var i,t=this.fragCurrent,r=this.partCurrent,h=this.lastLoadedFragLevel,a=this.hls.levels,s=a[h],d=!!(s!=null&&(i=s.details)!==null&&i!==void 0&&i.live),o=s==null?void 0:s.codecSet,u=r?r.duration:t?t.duration:0,v=e;v>=n;v--){var S=a[v];if(!(!S||o&&S.codecSet!==o)){var L=S.details,P=(r?L==null?void 0:L.partTarget:L==null?void 0:L.averagetargetduration)||u,F=void 0;v<=h?F=f*g:F=c*g;var _=a[v].maxBitrate,B=_*P/F;if(I.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+v+"/"+Math.round(F)+"/"+_+"/"+P+"/"+l+"/"+B),F>_&&(B===0||!Object(M.isFiniteNumber)(B)||d&&!this.bitrateTestDelay||B<l))return v}}return-1},p(E,[{key:"nextAutoLevel",get:function(){var g=this._nextAutoLevel,n=this.bwEstimator;if(g!==-1&&!n.canEstimate())return g;var e=this.getNextABRAutoLevel();return g!==-1&&this.hls.levels[e].loadError?g:(g!==-1&&(e=Math.min(g,e)),e)},set:function(g){this._nextAutoLevel=g}}]),E}();C.default=x},"./src/controller/audio-stream-controller.ts":function(K,C,y){y.r(C);var M=y("./src/polyfills/number.ts"),O=y("./src/controller/base-stream-controller.ts"),D=y("./src/events.ts"),b=y("./src/utils/buffer-helper.ts"),R=y("./src/controller/fragment-tracker.ts"),I=y("./src/types/level.ts"),A=y("./src/types/loader.ts"),p=y("./src/loader/fragment.ts"),x=y("./src/demux/chunk-cache.ts"),E=y("./src/demux/transmuxer-interface.ts"),T=y("./src/types/transmuxer.ts"),m=y("./src/controller/fragment-finders.ts"),g=y("./src/utils/discontinuities.ts"),n=y("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var h=arguments[r];for(var a in h)Object.prototype.hasOwnProperty.call(h,a)&&(t[a]=h[a])}return t},e.apply(this,arguments)}function l(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,f(t,r)}function f(t,r){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,s){return a.__proto__=s,a},f(t,r)}var c=100,i=function(t){l(r,t);function r(a,s){var d;return d=t.call(this,a,s,"[audio-stream-controller]")||this,d.videoBuffer=null,d.videoTrackCC=-1,d.waitingVideoCC=-1,d.audioSwitch=!1,d.trackId=-1,d.waitingData=null,d.mainDetails=null,d.bufferFlushed=!1,d.cachedTrackLoadedData=null,d._registerListeners(),d}var h=r.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var s=this.hls;s.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(D.Events.ERROR,this.onError,this),s.on(D.Events.BUFFER_RESET,this.onBufferReset,this),s.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var s=this.hls;s.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(D.Events.ERROR,this.onError,this),s.off(D.Events.BUFFER_RESET,this.onBufferReset,this),s.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onInitPtsFound=function(s,d){var o=d.frag,u=d.id,v=d.initPTS;if(u==="main"){var S=o.cc;this.initPTS[o.cc]=v,this.log("InitPTS for cc: "+S+" found from main: "+v),this.videoTrackCC=S,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},h.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=O.State.STOPPED;return}var d=this.lastCurrentTime;this.stopLoad(),this.setInterval(c),this.fragLoadError=0,d>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+d.toFixed(3)),s=d,this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},h.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:{var s,d=this.levels,o=this.trackId,u=d==null||(s=d[o])===null||s===void 0?void 0:s.details;if(u){if(this.waitForCdnTuneIn(u))break;this.state=O.State.WAITING_INIT_PTS}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var v,S=performance.now(),L=this.retryDate;(!L||S>=L||(v=this.media)!==null&&v!==void 0&&v.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=O.State.IDLE);break}case O.State.WAITING_INIT_PTS:{var P=this.waitingData;if(P){var F=P.frag,_=P.part,B=P.cache,U=P.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var N=B.flush(),k={frag:F,part:_,payload:N,networkDetails:null};this._handleFragmentLoadProgress(k),U&&t.prototype._handleFragmentLoadComplete.call(this,k)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var w=this.getLoadPosition(),W=b.BufferHelper.bufferInfo(this.mediaBuffer,w,this.config.maxBufferHole),G=Object(m.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,F);G<0&&(this.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}}this.onTickEnd()},h.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},h.resetLoadingState=function(){this.clearWaitingFragment(),t.prototype.resetLoadingState.call(this)},h.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var d=this.mediaBuffer?this.mediaBuffer:s,o=d.buffered;!this.loadedmetadata&&o.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},h.doTickIdle=function(){var s,d,o=this.hls,u=this.levels,v=this.media,S=this.trackId,L=o.config;if(!(!u||!u[S])&&!(!v&&(this.startFragRequested||!L.startFragPrefetch))){var P=u[S],F=P.details;if(!F||F.live&&this.levelLastLoaded!==S||this.waitForCdnTuneIn(F)){this.state=O.State.WAITING_TRACK;return}var _=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&_&&(this.bufferFlushed=!1,this.afterBufferFlushed(_,p.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var B=this.getFwdBufferInfo(_,A.PlaylistLevelType.AUDIO);if(B!==null){var U=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN),N=B.len,k=this.getMaxBufferLength(U==null?void 0:U.len),w=this.audioSwitch;if(!(N>=k&&!w)){if(!w&&this._streamEnded(B,F)){o.trigger(D.Events.BUFFER_EOS,{type:"audio"}),this.state=O.State.ENDED;return}var W=F.fragments,G=W[0].start,j=B.end;if(w&&v){var Y=this.getLoadPosition();j=Y,F.PTSKnown&&Y<G&&(B.end>G||B.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),v.currentTime=G+.05)}if(!(U&&j>U.end+F.targetduration)&&!((!U||!U.len)&&B.len)){var J=this.getNextFragment(j,F);if(!J){this.bufferFlushed=!0;return}((s=J.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((d=J.decryptdata)!==null&&d!==void 0&&d.key)?this.loadKey(J,F):this.loadFragment(J,F,j)}}}}},h.getMaxBufferLength=function(s){var d=t.prototype.getMaxBufferLength.call(this);return s?Math.max(d,s):d},h.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},h.onAudioTracksUpdated=function(s,d){var o=d.audioTracks;this.resetTransmuxer(),this.levels=o.map(function(u){return new I.Level(u)})},h.onAudioTrackSwitching=function(s,d){var o=!!d.url;this.trackId=d.id;var u=this.fragCurrent;u!=null&&u.loader&&u.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),o?this.setInterval(c):this.resetTransmuxer(),o?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},h.onLevelLoaded=function(s,d){this.mainDetails=d.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(D.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},h.onAudioTrackLoaded=function(s,d){var o;if(this.mainDetails==null){this.cachedTrackLoadedData=d;return}var u=this.levels,v=d.details,S=d.id;if(!u){this.warn("Audio tracks were reset while loading level "+S);return}this.log("Track "+S+" loaded ["+v.startSN+","+v.endSN+"],duration:"+v.totalduration);var L=u[S],P=0;if(v.live||(o=L.details)!==null&&o!==void 0&&o.live){var F=this.mainDetails;if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed||!F)return;!L.details&&v.hasProgramDateTime&&F.hasProgramDateTime?(Object(g.alignMediaPlaylistByPDT)(v,F),P=v.fragments[0].start):P=this.alignPlaylists(v,L.details)}L.details=v,this.levelLastLoaded=S,!this.startFragRequested&&(this.mainDetails||!v.live)&&this.setStartPosition(L.details,P),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(v)&&(this.state=O.State.IDLE),this.tick()},h._handleFragmentLoadProgress=function(s){var d,o=s.frag,u=s.part,v=s.payload,S=this.config,L=this.trackId,P=this.levels;if(!P){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered");return}var F=P[L];console.assert(F,"Audio track is defined on fragment load progress");var _=F.details;console.assert(_,"Audio track details are defined on fragment load progress");var B=S.defaultAudioCodec||F.audioCodec||"mp4a.40.2",U=this.transmuxer;U||(U=this.transmuxer=new E.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[o.cc],k=(d=o.initSegment)===null||d===void 0?void 0:d.data;if(N!==void 0){var w=!1,W=u?u.index:-1,G=W!==-1,j=new T.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,v.byteLength,W,G);U.push(v,k,B,"",o,u,_.totalduration,w,j,N)}else{this.log("Unknown video PTS for cc "+o.cc+", waiting for video PTS before demuxing audio frag "+o.sn+" of ["+_.startSN+" ,"+_.endSN+"],track "+L);var Y=this.waitingData=this.waitingData||{frag:o,part:u,cache:new x.default,complete:!1},J=Y.cache;J.push(new Uint8Array(v)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}},h._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}t.prototype._handleFragmentLoadComplete.call(this,s)},h.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},h.onBufferCreated=function(s,d){var o=d.tracks.audio;o&&(this.mediaBuffer=o.buffer||null),d.tracks.video&&(this.videoBuffer=d.tracks.video.buffer||null)},h.onFragBuffered=function(s,d){var o=d.frag,u=d.part;if(o.type===A.PlaylistLevelType.AUDIO){if(this.fragContextChanged(o)){this.warn("Fragment "+o.sn+(u?" p: "+u.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}o.sn!=="initSegment"&&(this.fragPrevious=o,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(o,u)}},h.onError=function(s,d){switch(d.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,d);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=d.fatal?O.State.ERROR:O.State.IDLE,this.warn(d.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(d.parent==="audio"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var o=!0,u=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);u&&u.len>.5&&(o=!this.reduceMaxBufferLength(u.len)),o&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},h.onBufferFlushed=function(s,d){var o=d.type;o===p.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},h._handleTransmuxComplete=function(s){var d,o="audio",u=this.hls,v=s.remuxResult,S=s.chunkMeta,L=this.getCurrentContext(S);if(!L){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(S.level);return}var P=L.frag,F=L.part,_=L.level.details,B=v.audio,U=v.text,N=v.id3,k=v.initSegment;if(!(this.fragContextChanged(P)||!_)){if(this.state=O.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),k!=null&&k.tracks&&(this._bufferInitSegment(k.tracks,P,S),u.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:o,tracks:k.tracks})),B){var w=B.startPTS,W=B.endPTS,G=B.startDTS,j=B.endDTS;F&&(F.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:w,endPTS:W,startDTS:G,endDTS:j}),P.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,w,W,G,j),this.bufferFragmentData(B,P,F,S)}if(N!=null&&(d=N.samples)!==null&&d!==void 0&&d.length){var Y=e({id:o,frag:P,details:_},N);u.trigger(D.Events.FRAG_PARSING_METADATA,Y)}if(U){var J=e({id:o,frag:P,details:_},U);u.trigger(D.Events.FRAG_PARSING_USERDATA,J)}}},h._bufferInitSegment=function(s,d,o){if(this.state===O.State.PARSING){s.video&&delete s.video;var u=s.audio;if(!!u){u.levelCodec=u.codec,u.id="audio",this.log("Init audio buffer, container:"+u.container+", codecs[parsed]=["+u.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,s);var v=u.initSegment;if(v!=null&&v.byteLength){var S={type:"audio",frag:d,part:null,chunkMeta:o,parent:d.type,data:v};this.hls.trigger(D.Events.BUFFER_APPENDING,S)}this.tick()}}},h.loadFragment=function(s,d,o){var u=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||u===R.FragmentState.NOT_LOADED||u===R.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):d.live&&!Object(M.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,s,d,o)))},h.completeAudioSwitch=function(){var s=this.hls,d=this.media,o=this.trackId;d&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:o})},r}(O.default);C.default=i},"./src/controller/audio-track-controller.ts":function(K,C,y){y.r(C);var M=y("./src/events.ts"),O=y("./src/errors.ts"),D=y("./src/controller/base-playlist-controller.ts"),b=y("./src/types/loader.ts");function R(E,T){for(var m=0;m<T.length;m++){var g=T[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(E,g.key,g)}}function I(E,T,m){return T&&R(E.prototype,T),m&&R(E,m),Object.defineProperty(E,"prototype",{writable:!1}),E}function A(E,T){E.prototype=Object.create(T.prototype),E.prototype.constructor=E,p(E,T)}function p(E,T){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,n){return g.__proto__=n,g},p(E,T)}var x=function(E){A(T,E);function T(g){var n;return n=E.call(this,g,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var m=T.prototype;return m.registerListeners=function(){var n=this.hls;n.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(M.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var n=this.hls;n.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(M.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(n,e){this.tracks=e.audioTracks||[]},m.onAudioTrackLoaded=function(n,e){var l=e.id,f=e.details,c=this.tracksInGroup[l];if(!c){this.warn("Invalid audio track id "+l);return}var i=c.details;c.details=e.details,this.log("audioTrack "+l+" loaded ["+f.startSN+"-"+f.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,e,i))},m.onLevelLoading=function(n,e){this.switchLevel(e.level)},m.onLevelSwitching=function(n,e){this.switchLevel(e.level)},m.switchLevel=function(n){var e=this.hls.levels[n];if(!!(e!=null&&e.audioGroupIds)){var l=e.audioGroupIds[e.urlId];if(this.groupId!==l){this.groupId=l;var f=this.tracks.filter(function(i){return!l||i.groupId===l});this.selectDefaultTrack&&!f.some(function(i){return i.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=f;var c={audioTracks:f};this.log("Updating audio tracks, "+f.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,c),this.selectInitialTrack()}}},m.onError=function(n,e){E.prototype.onError.call(this,n,e),!(e.fatal||!e.context)&&e.context.type===b.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},m.setAudioTrack=function(n){var e=this.tracksInGroup;if(n<0||n>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var l=e[this.trackId];this.log("Now switching to audio-track index "+n);var f=e[n],c=f.id,i=f.groupId,t=i===void 0?"":i,r=f.name,h=f.type,a=f.url;if(this.trackId=n,this.trackName=r,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:c,groupId:t,name:r,type:h,url:a}),!(f.details&&!f.details.live)){var s=this.switchParams(f.url,l==null?void 0:l.details);this.loadPlaylist(s)}},m.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,l=this.findTrackId(e)||this.findTrackId();l!==-1?this.setAudioTrack(l):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(n){for(var e=this.tracksInGroup,l=0;l<e.length;l++){var f=e[l];if((!this.selectDefaultTrack||f.default)&&(!n||n===f.name))return f.id}return-1},m.loadPlaylist=function(n){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var l=e.id,f=e.groupId,c=e.url;if(n)try{c=n.addDirectives(c)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("loading audio-track playlist for id: "+l),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:c,id:l,groupId:f,deliveryDirectives:n||null})}},I(T,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),T}(D.default);C.default=x},"./src/controller/base-playlist-controller.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return I});var M=y("./src/polyfills/number.ts"),O=y("./src/types/level.ts"),D=y("./src/controller/level-helper.ts"),b=y("./src/utils/logger.ts"),R=y("./src/errors.ts"),I=function(){function A(x,E){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,E+":"),this.warn=b.logger.warn.bind(b.logger,E+":"),this.hls=x}var p=A.prototype;return p.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},p.onError=function(E,T){T.fatal&&T.type===R.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},p.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},p.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},p.stopLoad=function(){this.canLoad=!1,this.clearTimer()},p.switchParams=function(E,T){var m=T==null?void 0:T.renditionReports;if(m)for(var g=0;g<m.length;g++){var n=m[g],e=""+n.URI;if(e===E.slice(-e.length)){var l=parseInt(n["LAST-MSN"]),f=parseInt(n["LAST-PART"]);if(T&&this.hls.config.lowLatencyMode){var c=Math.min(T.age-T.partTarget,T.targetduration);f!==void 0&&c>T.partTarget&&(f+=1)}if(Object(M.isFiniteNumber)(l))return new O.HlsUrlParameters(l,Object(M.isFiniteNumber)(f)?f:void 0,O.HlsSkip.No)}}},p.loadPlaylist=function(E){},p.shouldLoadTrack=function(E){return this.canLoad&&E&&!!E.url&&(!E.details||E.details.live)},p.playlistLoaded=function(E,T,m){var g=this,n=T.details,e=T.stats,l=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(n.advancedDateTime=Date.now()-l,n.live||m!=null&&m.live){if(n.reloaded(m),m&&this.log("live playlist "+E+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),m&&n.fragments.length>0&&Object(D.mergeDetails)(m,n),!this.canLoad||!n.live)return;var f,c=void 0,i=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var t=this.hls.config.lowLatencyMode,r=n.lastPartSn,h=n.endSN,a=n.lastPartIndex,s=a!==-1,d=r===h,o=t?0:a;s?(c=d?h+1:r,i=d?o:a+1):c=h+1;var u=n.age,v=u+n.ageHeader,S=Math.min(v-n.partTarget,n.targetduration*1.5);if(S>0){if(m&&S>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+S+" with playlist age: "+n.age),S=0;else{var L=Math.floor(S/n.targetduration);if(c+=L,i!==void 0){var P=Math.round(S%n.targetduration/n.partTarget);i+=P}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+S+" skip sn "+L+" to part "+i)}n.tuneInGoal=S}if(f=this.getDeliveryDirectives(n,T.deliveryDirectives,c,i),t||!d){this.loadPlaylist(f);return}}else f=this.getDeliveryDirectives(n,T.deliveryDirectives,c,i);var F=Object(D.computeReloadInterval)(n,e);c!==void 0&&n.canBlockReload&&(F-=n.partTarget||1),this.log("reload live playlist "+E+" in "+Math.round(F)+" ms"),this.timer=self.setTimeout(function(){return g.loadPlaylist(f)},F)}else this.clearTimer()},p.getDeliveryDirectives=function(E,T,m,g){var n=Object(O.getSkipValue)(E,m);return T!=null&&T.skip&&E.deltaUpdateFailed&&(m=T.msn,g=T.part,n=O.HlsSkip.No),new O.HlsUrlParameters(m,g,n)},p.retryLoadingOrFail=function(E){var T=this,m=this.hls.config,g=this.retryCount<m.levelLoadingMaxRetry;if(g){var n;if(this.retryCount++,E.details.indexOf("LoadTimeOut")>-1&&(n=E.context)!==null&&n!==void 0&&n.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+E.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+E.details+'"')}}else this.warn('cannot recover from error "'+E.details+'"'),this.clearTimer(),E.fatal=!0;return g},A}()},"./src/controller/base-stream-controller.ts":function(K,C,y){y.r(C),y.d(C,"State",function(){return h}),y.d(C,"default",function(){return a});var M=y("./src/polyfills/number.ts"),O=y("./src/task-loop.ts"),D=y("./src/controller/fragment-tracker.ts"),b=y("./src/utils/buffer-helper.ts"),R=y("./src/utils/logger.ts"),I=y("./src/events.ts"),A=y("./src/errors.ts"),p=y("./src/types/transmuxer.ts"),x=y("./src/utils/mp4-tools.ts"),E=y("./src/utils/discontinuities.ts"),T=y("./src/controller/fragment-finders.ts"),m=y("./src/controller/level-helper.ts"),g=y("./src/loader/fragment-loader.ts"),n=y("./src/crypt/decrypter.ts"),e=y("./src/utils/time-ranges.ts"),l=y("./src/types/loader.ts");function f(s,d){for(var o=0;o<d.length;o++){var u=d[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(s,u.key,u)}}function c(s,d,o){return d&&f(s.prototype,d),o&&f(s,o),Object.defineProperty(s,"prototype",{writable:!1}),s}function i(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function t(s,d){s.prototype=Object.create(d.prototype),s.prototype.constructor=s,r(s,d)}function r(s,d){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,v){return u.__proto__=v,u},r(s,d)}var h={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},a=function(s){t(d,s);function d(u,v,S){var L;return L=s.call(this)||this,L.hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=h.STOPPED,L.media=null,L.mediaBuffer=null,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=S,L.log=R.logger.log.bind(R.logger,S+":"),L.warn=R.logger.warn.bind(R.logger,S+":"),L.hls=u,L.fragmentLoader=new g.default(u.config),L.fragmentTracker=v,L.config=u.config,L.decrypter=new n.default(u,u.config),u.on(I.Events.KEY_LOADED,L.onKeyLoaded,i(L)),u.on(I.Events.LEVEL_SWITCHING,L.onLevelSwitching,i(L)),L}var o=d.prototype;return o.doTick=function(){this.onTickEnd()},o.onTickEnd=function(){},o.startLoad=function(v){},o.stopLoad=function(){this.fragmentLoader.abort();var v=this.fragCurrent;v&&this.fragmentTracker.removeFragment(v),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=h.STOPPED},o._streamEnded=function(v,S){var L=this.fragCurrent,P=this.fragmentTracker;if(!S.live&&L&&this.media&&L.sn>=S.endSN&&!v.nextStart){var F=S.partList;if(F!=null&&F.length){var _=F[F.length-1],B=b.BufferHelper.isBuffered(this.media,_.start+_.duration/2);return B}var U=P.getState(L);return U===D.FragmentState.PARTIAL||U===D.FragmentState.OK}return!1},o.onMediaAttached=function(v,S){var L=this.media=this.mediaBuffer=S.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),L.addEventListener("seeking",this.onvseeking),L.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===h.STOPPED&&this.startLoad(P.startPosition)},o.onMediaDetaching=function(){var v=this.media;v!=null&&v.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),v&&this.onvseeking&&this.onvended&&(v.removeEventListener("seeking",this.onvseeking),v.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},o.onMediaSeeking=function(){var v=this.config,S=this.fragCurrent,L=this.media,P=this.mediaBuffer,F=this.state,_=L?L.currentTime:0,B=b.BufferHelper.bufferInfo(P||L,_,v.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(_)?_.toFixed(3):_)+", state: "+F),F===h.ENDED)this.resetLoadingState();else if(S&&!B.len){var U=v.maxFragLookUpTolerance,N=S.start-U,k=S.start+S.duration+U,w=_>k;(_<N||w)&&(w&&S.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),S.loader.abort()),this.resetLoadingState())}L&&(this.lastCurrentTime=_),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=_),this.tickImmediate()},o.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},o.onKeyLoaded=function(v,S){if(!(this.state!==h.KEY_LOADING||S.frag!==this.fragCurrent||!this.levels)){this.state=h.IDLE;var L=this.levels[S.frag.level].details;L&&this.loadFragment(S.frag,L,S.frag.start)}},o.onLevelSwitching=function(v,S){this.fragLoadError=0},o.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},o.onHandlerDestroyed=function(){this.state=h.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},o.loadKey=function(v,S){this.log("Loading key for "+v.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level),this.state=h.KEY_LOADING,this.fragCurrent=v,this.hls.trigger(I.Events.KEY_LOADING,{frag:v})},o.loadFragment=function(v,S,L){this._loadFragForPlayback(v,S,L)},o._loadFragForPlayback=function(v,S,L){var P=this,F=function(B){if(P.fragContextChanged(v)){P.warn("Fragment "+v.sn+(B.part?" p: "+B.part.index:"")+" of level "+v.level+" was dropped during download."),P.fragmentTracker.removeFragment(v);return}v.stats.chunkCount++,P._handleFragmentLoadProgress(B)};this._doFragLoad(v,S,L,F).then(function(_){if(!!_){P.fragLoadError=0;var B=P.state;if(P.fragContextChanged(v)){(B===h.FRAG_LOADING||!P.fragCurrent&&B===h.PARSING)&&(P.fragmentTracker.removeFragment(v),P.state=h.IDLE);return}"payload"in _&&(P.log("Loaded fragment "+v.sn+" of level "+v.level),P.hls.trigger(I.Events.FRAG_LOADED,_)),P._handleFragmentLoadComplete(_)}}).catch(function(_){P.state===h.STOPPED||P.state===h.ERROR||(P.warn(_),P.resetFragmentLoading(v))})},o.flushMainBuffer=function(v,S,L){if(L===void 0&&(L=null),!!(v-S)){var P={startOffset:v,endOffset:S,type:L};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,P)}},o._loadInitSegment=function(v){var S=this;this._doFragLoad(v).then(function(L){if(!L||S.fragContextChanged(v)||!S.levels)throw new Error("init load aborted");return L}).then(function(L){var P=S.hls,F=L.payload,_=v.decryptdata;if(F&&F.byteLength>0&&_&&_.key&&_.iv&&_.method==="AES-128"){var B=self.performance.now();return S.decrypter.webCryptoDecrypt(new Uint8Array(F),_.key.buffer,_.iv.buffer).then(function(U){var N=self.performance.now();return P.trigger(I.Events.FRAG_DECRYPTED,{frag:v,payload:U,stats:{tstart:B,tdecrypt:N}}),L.payload=U,L})}return L}).then(function(L){var P=S.fragCurrent,F=S.hls,_=S.levels;if(!_)throw new Error("init load aborted, missing levels");var B=_[v.level].details;console.assert(B,"Level details are defined when init segment is loaded");var U=v.stats;S.state=h.IDLE,S.fragLoadError=0,v.data=new Uint8Array(L.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),L.frag===P&&F.trigger(I.Events.FRAG_BUFFERED,{stats:U,frag:P,part:null,id:v.type}),S.tick()}).catch(function(L){S.state===h.STOPPED||S.state===h.ERROR||(S.warn(L),S.resetFragmentLoading(v))})},o.fragContextChanged=function(v){var S=this.fragCurrent;return!v||!S||v.level!==S.level||v.sn!==S.sn||v.urlId!==S.urlId},o.fragBufferedComplete=function(v,S){var L=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+v.type+" sn: "+v.sn+(S?" part: "+S.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level+" "+(L?e.default.toString(b.BufferHelper.getBuffered(L)):"(detached)")),this.state=h.IDLE,L&&(!this.loadedmetadata&&L.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},o.seekToStartPos=function(){},o._handleFragmentLoadComplete=function(v){var S=this.transmuxer;if(!!S){var L=v.frag,P=v.part,F=v.partsLoaded,_=!F||F.length===0||F.some(function(U){return!U}),B=new p.ChunkMetadata(L.level,L.sn,L.stats.chunkCount+1,0,P?P.index:-1,!_);S.flush(B)}},o._handleFragmentLoadProgress=function(v){},o._doFragLoad=function(v,S,L,P){var F=this;if(L===void 0&&(L=null),!this.levels)throw new Error("frag load aborted, missing levels");if(L=Math.max(v.start,L||0),this.config.lowLatencyMode&&S){var _=S.partList;if(_&&P){L>v.end&&S.fragmentHint&&(v=S.fragmentHint);var B=this.getNextPart(_,v,L);if(B>-1){var U=_[B];return this.log("Loading part sn: "+v.sn+" p: "+U.index+" cc: "+v.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+B+"-"+(_.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(L.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=h.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:v,part:_[B],targetBufferTime:L}),this.doFragPartsLoad(v,_,B,P).catch(function(N){return F.handleFragLoadError(N)})}else if(!v.url||this.loadedEndOfParts(_,L))return Promise.resolve(null)}}return this.log("Loading fragment "+v.sn+" cc: "+v.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(L.toFixed(3))),Object(M.isFiniteNumber)(v.sn)&&!this.bitrateTest&&(this.nextLoadPosition=v.start+v.duration),this.state=h.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:v,targetBufferTime:L}),this.fragmentLoader.load(v,P).catch(function(N){return F.handleFragLoadError(N)})},o.doFragPartsLoad=function(v,S,L,P){var F=this;return new Promise(function(_,B){var U=[],N=function k(w){var W=S[w];F.fragmentLoader.loadPart(v,W,P).then(function(G){U[W.index]=G;var j=G.part;F.hls.trigger(I.Events.FRAG_LOADED,G);var Y=S[w+1];if(Y&&Y.fragment===v)k(w+1);else return _({frag:v,part:j,partsLoaded:U})}).catch(B)};N(L)})},o.handleFragLoadError=function(v){var S=v.data;return S&&S.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(S.frag,S.part):this.hls.trigger(I.Events.ERROR,S),null},o._handleTransmuxerFlush=function(v){var S=this.getCurrentContext(v);if(!S||this.state!==h.PARSING){this.fragCurrent||(this.state=h.IDLE);return}var L=S.frag,P=S.part,F=S.level,_=self.performance.now();L.stats.parsing.end=_,P&&(P.stats.parsing.end=_),this.updateLevelTiming(L,P,F,v.partial)},o.getCurrentContext=function(v){var S=this.levels,L=v.level,P=v.sn,F=v.part;if(!S||!S[L])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+L+". The current chunk will not be buffered."),null;var _=S[L],B=F>-1?Object(m.getPartWith)(_,P,F):null,U=B?B.fragment:Object(m.getFragmentWithSN)(_,P,this.fragCurrent);return U?{frag:U,part:B,level:_}:null},o.bufferFragmentData=function(v,S,L,P){if(!(!v||this.state!==h.PARSING)){var F=v.data1,_=v.data2,B=F;if(F&&_&&(B=Object(x.appendUint8Array)(F,_)),!(!B||!B.length)){var U={type:v.type,frag:S,part:L,chunkMeta:P,parent:S.type,data:B};this.hls.trigger(I.Events.BUFFER_APPENDING,U),v.dropped&&v.independent&&!L&&this.flushBufferGap(S)}}},o.flushBufferGap=function(v){var S=this.media;if(!!S){if(!b.BufferHelper.isBuffered(S,S.currentTime)){this.flushMainBuffer(0,v.start);return}var L=S.currentTime,P=b.BufferHelper.bufferInfo(S,L,0),F=v.duration,_=Math.min(this.config.maxFragLookUpTolerance*2,F*.25),B=Math.max(Math.min(v.start-_,P.end-_),L+_);v.start-B>_&&this.flushMainBuffer(B,v.start)}},o.getFwdBufferInfo=function(v,S){var L=this.config,P=this.getLoadPosition();if(!Object(M.isFiniteNumber)(P))return null;var F=b.BufferHelper.bufferInfo(v,P,L.maxBufferHole);if(F.len===0&&F.nextStart!==void 0){var _=this.fragmentTracker.getBufferedFrag(P,S);if(_&&F.nextStart<_.end)return b.BufferHelper.bufferInfo(v,P,Math.max(F.nextStart,L.maxBufferHole))}return F},o.getMaxBufferLength=function(v){var S=this.config,L;return v?L=Math.max(8*S.maxBufferSize/v,S.maxBufferLength):L=S.maxBufferLength,Math.min(L,S.maxMaxBufferLength)},o.reduceMaxBufferLength=function(v){var S=this.config,L=v||S.maxBufferLength;return S.maxMaxBufferLength>=L?(S.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+S.maxMaxBufferLength+"s"),!0):!1},o.getNextFragment=function(v,S){var L=S.fragments,P=L.length;if(!P)return null;var F=this.config,_=L[0].start,B;if(S.live){var U=F.initialLiveManifestSize;if(P<U)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+U+")"),null;!S.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(B=this.getInitialLiveFragment(S,L),this.startPosition=B?this.hls.liveSyncPosition||B.start:v)}else v<=_&&(B=L[0]);if(!B){var N=F.lowLatencyMode?S.partEnd:S.fragmentEnd;B=this.getFragmentAtPosition(v,N,S)}return this.mapToInitFragWhenRequired(B)},o.mapToInitFragWhenRequired=function(v){return v!=null&&v.initSegment&&!(v!=null&&v.initSegment.data)&&!this.bitrateTest?v.initSegment:v},o.getNextPart=function(v,S,L){for(var P=-1,F=!1,_=!0,B=0,U=v.length;B<U;B++){var N=v[B];if(_=_&&!N.independent,P>-1&&L<N.start)break;var k=N.loaded;!k&&(F||N.independent||_)&&N.fragment===S&&(P=B),F=k}return P},o.loadedEndOfParts=function(v,S){var L=v[v.length-1];return L&&S>L.start&&L.loaded},o.getInitialLiveFragment=function(v,S){var L=this.fragPrevious,P=null;if(L){if(v.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+L.programDateTime),P=Object(T.findFragmentByPDT)(S,L.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var F=L.sn+1;if(F>=v.startSN&&F<=v.endSN){var _=S[F-v.startSN];L.cc===_.cc&&(P=_,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(T.findFragWithCC)(S,L.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(P=this.getFragmentAtPosition(B,this.bitrateTest?v.fragmentEnd:v.edge,v))}return P},o.getFragmentAtPosition=function(v,S,L){var P=this.config,F=this.fragPrevious,_=L.fragments,B=L.endSN,U=L.fragmentHint,N=P.maxFragLookUpTolerance,k=!!(P.lowLatencyMode&&L.partList&&U);k&&U&&!this.bitrateTest&&(_=_.concat(U),B=U.sn);var w;if(v<S){var W=v>S-N?0:N;w=Object(T.findFragmentByPTS)(F,_,v,W)}else w=_[_.length-1];if(w){var G=w.sn-L.startSN;if(F&&w.sn===F.sn&&!k){var j=F&&w.level===F.level;if(j){var Y=_[G+1];w.sn<B&&this.fragmentTracker.getState(Y)!==D.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+Y.sn),w=Y):w=null}}}return w},o.synchronizeToLiveEdge=function(v){var S=this.config,L=this.media;if(!!L){var P=this.hls.liveSyncPosition,F=L.currentTime,_=v.fragments[0].start,B=v.edge,U=F>=_-S.maxFragLookUpTolerance&&F<=B;if(P!==null&&L.duration>P&&(F<P||!U)){var N=S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:S.liveMaxLatencyDurationCount*v.targetduration;(!U&&L.readyState<4||F<B-N)&&(this.loadedmetadata||(this.nextLoadPosition=P),L.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+P.toFixed(3)),L.currentTime=P))}}},o.alignPlaylists=function(v,S){var L=this.levels,P=this.levelLastLoaded,F=this.fragPrevious,_=P!==null?L[P]:null,B=v.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var U=v.fragments[0].start,N=!S,k=v.alignedSliding&&Object(M.isFiniteNumber)(U);if(N||!k&&!U){Object(E.alignStream)(F,_,v);var w=v.fragments[0].start;return this.log("Live playlist sliding: "+w.toFixed(2)+" start-sn: "+(S?S.startSN:"na")+"->"+v.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+B),w}return U},o.waitForCdnTuneIn=function(v){var S=3;return v.live&&v.canBlockReload&&v.partTarget&&v.tuneInGoal>Math.max(v.partHoldBack,v.partTarget*S)},o.setStartPosition=function(v,S){var L=this.startPosition;if(L<S&&(L=-1),L===-1||this.lastCurrentTime===-1){var P=v.startTimeOffset;Object(M.isFiniteNumber)(P)?(L=S+P,P<0&&(L+=v.totalduration),L=Math.min(Math.max(S,L),S+v.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+L),this.startPosition=L):v.live?L=this.hls.liveSyncPosition||S:this.startPosition=L=0,this.lastCurrentTime=L}this.nextLoadPosition=L},o.getLoadPosition=function(){var v=this.media,S=0;return this.loadedmetadata&&v?S=v.currentTime:this.nextLoadPosition&&(S=this.nextLoadPosition),S},o.handleFragLoadAborted=function(v,S){this.transmuxer&&v.sn!=="initSegment"&&v.stats.aborted&&(this.warn("Fragment "+v.sn+(S?" part"+S.index:"")+" of level "+v.level+" was aborted"),this.resetFragmentLoading(v))},o.resetFragmentLoading=function(v){(!this.fragCurrent||!this.fragContextChanged(v)&&this.state!==h.FRAG_LOADING_WAITING_RETRY)&&(this.state=h.IDLE)},o.onFragmentOrKeyLoadError=function(v,S){if(!S.fatal){var L=S.frag;if(!(!L||L.type!==v)){var P=this.fragCurrent;console.assert(P&&L.sn===P.sn&&L.level===P.level&&L.urlId===P.urlId,"Frag load error must match current frag to retry");var F=this.config;if(this.fragLoadError+1<=F.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var _=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+L.sn+" of "+v+" "+L.level+" failed to load, retrying in "+_+"ms"),this.retryDate=self.performance.now()+_,this.fragLoadError++,this.state=h.FRAG_LOADING_WAITING_RETRY}else S.levelRetry?(v===l.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=h.IDLE):(R.logger.error(S.details+" reaches max retry, redispatch as fatal ..."),S.fatal=!0,this.hls.stopLoad(),this.state=h.ERROR)}}},o.afterBufferFlushed=function(v,S,L){if(!!v){var P=b.BufferHelper.getBuffered(v);this.fragmentTracker.detectEvictedFragments(S,P,L),this.state===h.ENDED&&this.resetLoadingState()}},o.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=h.IDLE},o.resetStartWhenNotLoaded=function(v){if(!this.loadedmetadata){this.startFragRequested=!1;var S=this.levels?this.levels[v].details:null;S!=null&&S.live?(this.startPosition=-1,this.setStartPosition(S,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},o.updateLevelTiming=function(v,S,L,P){var F=this,_=L.details;console.assert(!!_,"level.details must be defined");var B=Object.keys(v.elementaryStreams).reduce(function(U,N){var k=v.elementaryStreams[N];if(k){var w=k.endPTS-k.startPTS;if(w<=0)return F.warn("Could not parse fragment "+v.sn+" "+N+" duration reliably ("+w+")"),U||!1;var W=P?0:Object(m.updateFragPTSDTS)(_,v,k.startPTS,k.endPTS,k.startDTS,k.endDTS);return F.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:_,level:L,drift:W,type:N,frag:v,start:k.startPTS,end:k.endPTS}),!0}return U},!1);B||(this.warn("Found no media in fragment "+v.sn+" of level "+L.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=h.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:v,part:S})},o.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},c(d,[{key:"state",get:function(){return this._state},set:function(v){var S=this._state;S!==v&&(this._state=v,this.log(S+"->"+v))}}]),d}(O.default)},"./src/controller/buffer-controller.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return T});var M=y("./src/polyfills/number.ts"),O=y("./src/events.ts"),D=y("./src/utils/logger.ts"),b=y("./src/errors.ts"),R=y("./src/utils/buffer-helper.ts"),I=y("./src/utils/mediasource-helper.ts"),A=y("./src/loader/fragment.ts"),p=y("./src/controller/buffer-operation-queue.ts"),x=Object(I.getMediaSource)(),E=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function m(n){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var l=e.hls,f=e.media,c=e.mediaSource;D.logger.log("[buffer-controller]: Media source opened"),f&&(e.updateMediaElementDuration(),l.trigger(O.Events.MEDIA_ATTACHED,{media:f})),c&&c.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){D.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){D.logger.log("[buffer-controller]: Media source ended")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var g=m.prototype;return g.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},g.destroy=function(){this.unregisterListeners(),this.details=null},g.registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.Events.BUFFER_RESET,this.onBufferReset,this),e.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.Events.BUFFER_EOS,this.onBufferEos,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.Events.FRAG_PARSED,this.onFragParsed,this),e.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},g.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.Events.BUFFER_RESET,this.onBufferReset,this),e.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.Events.BUFFER_EOS,this.onBufferEos,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.Events.FRAG_PARSED,this.onFragParsed,this),e.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},g._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new p.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},g.onManifestParsed=function(e,l){var f=2;(l.audio&&!l.video||!l.altAudio)&&(f=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=f,this.details=null,D.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},g.onMediaAttaching=function(e,l){var f=this.media=l.media;if(f&&x){var c=this.mediaSource=new x;c.addEventListener("sourceopen",this._onMediaSourceOpen),c.addEventListener("sourceended",this._onMediaSourceEnded),c.addEventListener("sourceclose",this._onMediaSourceClose),f.src=self.URL.createObjectURL(c),this._objectUrl=f.src}},g.onMediaDetaching=function(){var e=this.media,l=this.mediaSource,f=this._objectUrl;if(l){if(D.logger.log("[buffer-controller]: media source detaching"),l.readyState==="open")try{l.endOfStream()}catch(c){D.logger.warn("[buffer-controller]: onMediaDetaching: "+c.message+" while calling endOfStream")}this.onBufferReset(),l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(f&&self.URL.revokeObjectURL(f),e.src===f?(e.removeAttribute("src"),e.load()):D.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},g.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(l){var f=e.sourceBuffer[l];try{f&&(e.removeBufferListeners(l),e.mediaSource&&e.mediaSource.removeSourceBuffer(f),e.sourceBuffer[l]=void 0)}catch(c){D.logger.warn("[buffer-controller]: Failed to reset the "+l+" buffer",c)}}),this._initSourceBuffer()},g.onBufferCodecs=function(e,l){var f=this,c=this.getSourceBufferTypes().length;Object.keys(l).forEach(function(i){if(c){var t=f.tracks[i];if(t&&typeof t.buffer.changeType=="function"){var r=l[i],h=r.id,a=r.codec,s=r.levelCodec,d=r.container,o=r.metadata,u=(t.levelCodec||t.codec).replace(E,"$1"),v=(s||a).replace(E,"$1");if(u!==v){var S=d+";codecs="+(s||a);f.appendChangeType(i,S),D.logger.log("[buffer-controller]: switching codec "+u+" to "+v),f.tracks[i]={buffer:t.buffer,codec:a,container:d,levelCodec:s,metadata:o,id:h}}}}else f.pendingTracks[i]=l[i]}),!c&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},g.appendChangeType=function(e,l){var f=this,c=this.operationQueue,i={execute:function(){var r=f.sourceBuffer[e];r&&(D.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+l),r.changeType(l)),c.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(r){D.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",r)}};c.append(i,e)},g.onBufferAppending=function(e,l){var f=this,c=this.hls,i=this.operationQueue,t=this.tracks,r=l.data,h=l.type,a=l.frag,s=l.part,d=l.chunkMeta,o=d.buffering[h],u=self.performance.now();o.start=u;var v=a.stats.buffering,S=s?s.stats.buffering:null;v.start===0&&(v.start=u),S&&S.start===0&&(S.start=u);var L=t.audio,P=h==="audio"&&d.id===1&&(L==null?void 0:L.container)==="audio/mpeg",F={execute:function(){if(o.executeStart=self.performance.now(),P){var B=f.sourceBuffer[h];if(B){var U=a.start-B.timestampOffset;Math.abs(U)>=.1&&(D.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+a.start+" (delta: "+U+") sn: "+a.sn+")"),B.timestampOffset=a.start)}}f.appendExecutor(r,h)},onStart:function(){},onComplete:function(){var B=self.performance.now();o.executeEnd=o.end=B,v.first===0&&(v.first=B),S&&S.first===0&&(S.first=B);var U=f.sourceBuffer,N={};for(var k in U)N[k]=R.BufferHelper.getBuffered(U[k]);f.appendError=0,f.hls.trigger(O.Events.BUFFER_APPENDED,{type:h,frag:a,part:s,chunkMeta:d,parent:a.type,timeRanges:N})},onError:function(B){D.logger.error("[buffer-controller]: Error encountered while trying to append to the "+h+" SourceBuffer",B);var U={type:b.ErrorTypes.MEDIA_ERROR,parent:a.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:B,fatal:!1};B.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=b.ErrorDetails.BUFFER_FULL_ERROR:(f.appendError++,U.details=b.ErrorDetails.BUFFER_APPEND_ERROR,f.appendError>c.config.appendErrorMaxRetry&&(D.logger.error("[buffer-controller]: Failed "+c.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0,c.stopLoad())),c.trigger(O.Events.ERROR,U)}};i.append(F,h)},g.onBufferFlushing=function(e,l){var f=this,c=this.operationQueue,i=function(r){return{execute:f.removeExecutor.bind(f,r,l.startOffset,l.endOffset),onStart:function(){},onComplete:function(){f.hls.trigger(O.Events.BUFFER_FLUSHED,{type:r})},onError:function(a){D.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",a)}}};l.type?c.append(i(l.type),l.type):this.getSourceBufferTypes().forEach(function(t){c.append(i(t),t)})},g.onFragParsed=function(e,l){var f=this,c=l.frag,i=l.part,t=[],r=i?i.elementaryStreams:c.elementaryStreams;r[A.ElementaryStreamTypes.AUDIOVIDEO]?t.push("audiovideo"):(r[A.ElementaryStreamTypes.AUDIO]&&t.push("audio"),r[A.ElementaryStreamTypes.VIDEO]&&t.push("video"));var h=function(){var s=self.performance.now();c.stats.buffering.end=s,i&&(i.stats.buffering.end=s);var d=i?i.stats:c.stats;f.hls.trigger(O.Events.FRAG_BUFFERED,{frag:c,part:i,stats:d,id:c.type})};t.length===0&&D.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+c.type+" level: "+c.level+" sn: "+c.sn),this.blockBuffers(h,t)},g.onFragChanged=function(e,l){this.flushBackBuffer()},g.onBufferEos=function(e,l){var f=this,c=this.getSourceBufferTypes().reduce(function(i,t){var r=f.sourceBuffer[t];return(!l.type||l.type===t)&&r&&!r.ended&&(r.ended=!0,D.logger.log("[buffer-controller]: "+t+" sourceBuffer now EOS")),i&&!!(!r||r.ended)},!0);c&&this.blockBuffers(function(){var i=f.mediaSource;!i||i.readyState!=="open"||i.endOfStream()})},g.onLevelUpdated=function(e,l){var f=l.details;!f.fragments.length||(this.details=f,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},g.flushBackBuffer=function(){var e=this.hls,l=this.details,f=this.media,c=this.sourceBuffer;if(!(!f||l===null)){var i=this.getSourceBufferTypes();if(!!i.length){var t=l.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(t)||t<0)){var r=f.currentTime,h=l.levelTargetDuration,a=Math.max(t,h),s=Math.floor(r/h)*h-a;i.forEach(function(d){var o=c[d];if(o){var u=R.BufferHelper.getBuffered(o);u.length>0&&s>u.start(0)&&(e.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:s}),l.live&&e.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s}),e.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:d}))}})}}}},g.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,l=this.hls,f=this.media,c=this.mediaSource,i=e.fragments[0].start+e.totalduration,t=f.duration,r=Object(M.isFiniteNumber)(c.duration)?c.duration:0;e.live&&l.config.liveDurationInfinity?(D.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),c.duration=1/0,this.updateSeekableRange(e)):(i>r&&i>t||!Object(M.isFiniteNumber)(t))&&(D.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),c.duration=i)}},g.updateSeekableRange=function(e){var l=this.mediaSource,f=e.fragments,c=f.length;if(c&&e.live&&l!==null&&l!==void 0&&l.setLiveSeekableRange){var i=Math.max(0,f[0].start),t=Math.max(i,i+e.totalduration);l.setLiveSeekableRange(i,t)}},g.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,l=this.operationQueue,f=this.pendingTracks,c=Object.keys(f).length;if(c&&!e||c===2){this.createSourceBuffers(f),this.pendingTracks={};var i=this.getSourceBufferTypes();if(i.length===0){this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}i.forEach(function(t){l.executeNext(t)})}},g.createSourceBuffers=function(e){var l=this.sourceBuffer,f=this.mediaSource;if(!f)throw Error("createSourceBuffers called when mediaSource was null");var c=0;for(var i in e)if(!l[i]){var t=e[i];if(!t)throw Error("source buffer exists for track "+i+", however track does not");var r=t.levelCodec||t.codec,h=t.container+";codecs="+r;D.logger.log("[buffer-controller]: creating sourceBuffer("+h+")");try{var a=l[i]=f.addSourceBuffer(h),s=i;this.addBufferListener(s,"updatestart",this._onSBUpdateStart),this.addBufferListener(s,"updateend",this._onSBUpdateEnd),this.addBufferListener(s,"error",this._onSBUpdateError),this.tracks[i]={buffer:a,codec:r,container:t.container,levelCodec:t.levelCodec,metadata:t.metadata,id:t.id},c++}catch(d){D.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+d.message),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,mimeType:h})}}c&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},g._onSBUpdateStart=function(e){var l=this.operationQueue,f=l.current(e);f.onStart()},g._onSBUpdateEnd=function(e){var l=this.operationQueue,f=l.current(e);f.onComplete(),l.shiftAndExecuteNext(e)},g._onSBUpdateError=function(e,l){D.logger.error("[buffer-controller]: "+e+" SourceBuffer error",l),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var f=this.operationQueue.current(e);f&&f.onError(l)},g.removeExecutor=function(e,l,f){var c=this.media,i=this.mediaSource,t=this.operationQueue,r=this.sourceBuffer,h=r[e];if(!c||!i||!h){D.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(e);return}var a=Object(M.isFiniteNumber)(c.duration)?c.duration:1/0,s=Object(M.isFiniteNumber)(i.duration)?i.duration:1/0,d=Math.max(0,l),o=Math.min(f,a,s);o>d?(D.logger.log("[buffer-controller]: Removing ["+d+","+o+"] from the "+e+" SourceBuffer"),console.assert(!h.updating,e+" sourceBuffer must not be updating"),h.remove(d,o)):t.shiftAndExecuteNext(e)},g.appendExecutor=function(e,l){var f=this.operationQueue,c=this.sourceBuffer,i=c[l];if(!i){D.logger.warn("[buffer-controller]: Attempting to append to the "+l+" SourceBuffer, but it does not exist"),f.shiftAndExecuteNext(l);return}i.ended=!1,console.assert(!i.updating,l+" sourceBuffer must not be updating"),i.appendBuffer(e)},g.blockBuffers=function(e,l){var f=this;if(l===void 0&&(l=this.getSourceBufferTypes()),!l.length){D.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var c=this.operationQueue,i=l.map(function(t){return c.appendBlocker(t)});Promise.all(i).then(function(){e(),l.forEach(function(t){var r=f.sourceBuffer[t];(!r||!r.updating)&&c.shiftAndExecuteNext(t)})})},g.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},g.addBufferListener=function(e,l,f){var c=this.sourceBuffer[e];if(!!c){var i=f.bind(this,e);this.listeners[e].push({event:l,listener:i}),c.addEventListener(l,i)}},g.removeBufferListeners=function(e){var l=this.sourceBuffer[e];!l||this.listeners[e].forEach(function(f){l.removeEventListener(f.event,f.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return O});var M=y("./src/utils/logger.ts"),O=function(){function D(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var b=D.prototype;return b.append=function(I,A){var p=this.queues[A];p.push(I),p.length===1&&this.buffers[A]&&this.executeNext(A)},b.insertAbort=function(I,A){var p=this.queues[A];p.unshift(I),this.executeNext(A)},b.appendBlocker=function(I){var A,p=new Promise(function(E){A=E}),x={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(x,I),p},b.executeNext=function(I){var A=this.buffers,p=this.queues,x=A[I],E=p[I];if(E.length){var T=E[0];try{T.execute()}catch(m){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),T.onError(m),(!x||!x.updating)&&(E.shift(),this.executeNext(I))}}},b.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},b.current=function(I){return this.queues[I][0]},D}()},"./src/controller/cap-level-controller.ts":function(K,C,y){y.r(C);var M=y("./src/events.ts");function O(R,I){for(var A=0;A<I.length;A++){var p=I[A];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(R,p.key,p)}}function D(R,I,A){return I&&O(R.prototype,I),A&&O(R,A),Object.defineProperty(R,"prototype",{writable:!1}),R}var b=function(){function R(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=R.prototype;return I.setStreamController=function(p){this.streamController=p},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var p=this.hls;p.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),p.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),p.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var p=this.hls;p.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),p.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),p.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(p,x){R.isLevelAllowed(x.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(x.droppedLevel)},I.onMediaAttaching=function(p,x){this.media=x.media instanceof HTMLVideoElement?x.media:null},I.onManifestParsed=function(p,x){var E=this.hls;this.restrictedLevels=[],this.firstLevel=x.firstLevel,E.config.capLevelToPlayerSize&&x.video&&this.startCapping()},I.onBufferCodecs=function(p,x){var E=this.hls;E.config.capLevelToPlayerSize&&x.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var p=this.hls.levels;if(p.length){var x=this.hls;x.autoLevelCapping=this.getMaxLevel(p.length-1),x.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=x.autoLevelCapping}}},I.getMaxLevel=function(p){var x=this,E=this.hls.levels;if(!E.length)return-1;var T=E.filter(function(m,g){return R.isLevelAllowed(g,x.restrictedLevels)&&g<=p});return this.clientRect=null,R.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var p=this.media,x={width:0,height:0};if(p){var E=p.getBoundingClientRect();x.width=E.width,x.height=E.height,!x.width&&!x.height&&(x.width=E.right-E.left||p.width||0,x.height=E.bottom-E.top||p.height||0)}return this.clientRect=x,x},R.isLevelAllowed=function(p,x){return x===void 0&&(x=[]),x.indexOf(p)===-1},R.getMaxLevelByMediaSize=function(p,x,E){if(!p||!p.length)return-1;for(var T=function(l,f){return f?l.width!==f.width||l.height!==f.height:!0},m=p.length-1,g=0;g<p.length;g+=1){var n=p[g];if((n.width>=x||n.height>=E)&&T(n,p[g+1])){m=g;break}}return m},D(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var p=1;if(!this.hls.config.ignoreDevicePixelRatio)try{p=self.devicePixelRatio}catch{}return p}}]),R}();C.default=b},"./src/controller/cmcd-controller.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return T});var M=y("./src/events.ts"),O=y("./src/types/cmcd.ts"),D=y("./src/utils/buffer-helper.ts"),b=y("./src/utils/logger.ts");function R(m,g){for(var n=0;n<g.length;n++){var e=g[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(m,e.key,e)}}function I(m,g,n){return g&&R(m.prototype,g),n&&R(m,n),Object.defineProperty(m,"prototype",{writable:!1}),m}function A(m,g){var n=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(n)return(n=n.call(m)).next.bind(n);if(Array.isArray(m)||(n=p(m))||g&&m&&typeof m.length=="number"){n&&(m=n);var e=0;return function(){return e>=m.length?{done:!0}:{done:!1,value:m[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p(m,g){if(!!m){if(typeof m=="string")return x(m,g);var n=Object.prototype.toString.call(m).slice(8,-1);if(n==="Object"&&m.constructor&&(n=m.constructor.name),n==="Map"||n==="Set")return Array.from(m);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(m,g)}}function x(m,g){(g==null||g>m.length)&&(g=m.length);for(var n=0,e=new Array(g);n<g;n++)e[n]=m[n];return e}function E(){return E=Object.assign?Object.assign.bind():function(m){for(var g=1;g<arguments.length;g++){var n=arguments[g];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(m[e]=n[e])}return m},E.apply(this,arguments)}var T=function(){function m(n){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(c){try{e.apply(c,{ot:O.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(i){b.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=function(c){try{var i=c.frag,t=e.hls.levels[i.level],r=e.getObjectType(i),h={d:i.duration*1e3,ot:r};(r===O.CMCDObjectType.VIDEO||r===O.CMCDObjectType.AUDIO||r==O.CMCDObjectType.MUXED)&&(h.br=t.bitrate/1e3,h.tb=e.getTopBandwidth(r)/1e3,h.bl=e.getBufferLength(r)),e.apply(c,h)}catch(a){b.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=n;var l=this.config=n.config,f=l.cmcd;f!=null&&(l.pLoader=this.createPlaylistLoader(),l.fLoader=this.createFragmentLoader(),this.sid=f.sessionId||m.uuid(),this.cid=f.contentId,this.useHeaders=f.useHeaders===!0,this.registerListeners())}var g=m.prototype;return g.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},g.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},g.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},g.onMediaAttached=function(e,l){this.media=l.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},g.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},g.onBufferCreated=function(e,l){var f,c;this.audioBuffer=(f=l.tracks.audio)===null||f===void 0?void 0:f.buffer,this.videoBuffer=(c=l.tracks.video)===null||c===void 0?void 0:c.buffer},g.createData=function(){var e;return{v:O.CMCDVersion,sf:O.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},g.apply=function(e,l){l===void 0&&(l={}),E(l,this.createData());var f=l.ot===O.CMCDObjectType.INIT||l.ot===O.CMCDObjectType.VIDEO||l.ot===O.CMCDObjectType.MUXED;if(this.starved&&f&&(l.bs=!0,l.su=!0,this.starved=!1),l.su==null&&(l.su=this.buffering),this.useHeaders){var c=m.toHeaders(l);if(!Object.keys(c).length)return;e.headers||(e.headers={}),E(e.headers,c)}else{var i=m.toQuery(l);if(!i)return;e.url=m.appendQueryToUri(e.url,i)}},g.getObjectType=function(e){var l=e.type;if(l==="subtitle")return O.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return O.CMCDObjectType.INIT;if(l==="audio")return O.CMCDObjectType.AUDIO;if(l==="main")return this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED},g.getTopBandwidth=function(e){var l=0,f,c=this.hls;if(e===O.CMCDObjectType.AUDIO)f=c.audioTracks;else{var i=c.maxAutoLevel,t=i>-1?i+1:c.levels.length;f=c.levels.slice(0,t)}for(var r=A(f),h;!(h=r()).done;){var a=h.value;a.bitrate>l&&(l=a.bitrate)}return l>0?l:NaN},g.getBufferLength=function(e){var l=this.hls.media,f=e===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!f||!l)return NaN;var c=D.BufferHelper.bufferInfo(f,l.currentTime,this.config.maxBufferHole);return c.len*1e3},g.createPlaylistLoader=function(){var e=this.config.pLoader,l=this.applyPlaylistData,f=e||this.config.loader;return function(){function c(t){this.loader=void 0,this.loader=new f(t)}var i=c.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(r,h,a){l(r),this.loader.load(r,h,a)},I(c,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),c}()},g.createFragmentLoader=function(){var e=this.config.fLoader,l=this.applyFragmentData,f=e||this.config.loader;return function(){function c(t){this.loader=void 0,this.loader=new f(t)}var i=c.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(r,h,a){l(r),this.loader.load(r,h,a)},I(c,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),c}()},m.uuid=function(){var e=URL.createObjectURL(new Blob),l=e.toString();return URL.revokeObjectURL(e),l.slice(l.lastIndexOf("/")+1)},m.serialize=function(e){for(var l=[],f=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},c=function(P){return Math.round(P)},i=function(P){return c(P/100)*100},t=function(P){return encodeURIComponent(P)},r={br:c,d:c,bl:i,dl:i,mtp:i,nor:t,rtp:i,tb:c},h=Object.keys(e||{}).sort(),a=A(h),s;!(s=a()).done;){var d=s.value,o=e[d];if(!!f(o)&&!(d==="v"&&o===1)&&!(d=="pr"&&o===1)){var u=r[d];u&&(o=u(o));var v=typeof o,S=void 0;d==="ot"||d==="sf"||d==="st"?S=d+"="+o:v==="boolean"?S=d:v==="number"?S=d+"="+o:S=d+"="+JSON.stringify(o),l.push(S)}}return l.join(",")},m.toHeaders=function(e){for(var l=Object.keys(e),f={},c=["Object","Request","Session","Status"],i=[{},{},{},{}],t={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,h=l;r<h.length;r++){var a=h[r],s=t[a]!=null?t[a]:1;i[s][a]=e[a]}for(var d=0;d<i.length;d++){var o=m.serialize(i[d]);o&&(f["CMCD-"+c[d]]=o)}return f},m.toQuery=function(e){return"CMCD="+encodeURIComponent(m.serialize(e))},m.appendQueryToUri=function(e,l){if(!l)return e;var f=e.includes("?")?"&":"?";return""+e+f+l},m}()},"./src/controller/eme-controller.ts":function(K,C,y){y.r(C);var M=y("./src/events.ts"),O=y("./src/errors.ts"),D=y("./src/utils/logger.ts"),b=y("./src/utils/mediakeys-helper.ts");function R(T,m){for(var g=0;g<m.length;g++){var n=m[g];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(T,n.key,n)}}function I(T,m,g){return m&&R(T.prototype,m),g&&R(T,g),Object.defineProperty(T,"prototype",{writable:!1}),T}var A=3,p=function(m,g,n){var e={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(l){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+l+'"',robustness:n.audioRobustness||""})}),g.forEach(function(l){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+l+'"',robustness:n.videoRobustness||""})}),[e]},x=function(m,g,n,e){switch(m){case b.KeySystems.WIDEVINE:return p(g,n,e);default:throw new Error("Unknown key-system: "+m)}},E=function(){function T(g){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=g,this._config=g.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var m=T.prototype;return m.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},m._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m.getLicenseServerUrl=function(n){switch(n){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},m._attemptKeySystemAccess=function(n,e,l){var f=this,c=x(n,e,l,this._drmSystemOptions);D.logger.log("Requesting encrypted media key-system access");var i=this.requestMediaKeySystemAccess(n,c);this.mediaKeysPromise=i.then(function(t){return f._onMediaKeySystemAccessObtained(n,t)}),i.catch(function(t){D.logger.error('Failed to obtain key-system "'+n+'" access:',t)})},m._onMediaKeySystemAccessObtained=function(n,e){var l=this;D.logger.log('Access for key-system "'+n+'" obtained');var f={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:n};this._mediaKeysList.push(f);var c=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(i){return f.mediaKeys=i,D.logger.log('Media-keys created for key-system "'+n+'"'),l._onMediaKeysCreated(),i});return c.catch(function(i){D.logger.error("Failed to create media-keys:",i)}),c},m._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),n._onNewMediaKeySession(e.mediaKeysSession))})},m._onNewMediaKeySession=function(n){var e=this;D.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(l){e._onKeySessionMessage(n,l.message)},!1)},m._onKeySessionMessage=function(n,e){D.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(l){D.logger.log("Received license data (length: "+(l&&l.byteLength)+"), updating key-session"),n.update(l).catch(function(f){D.logger.warn("Updating key-session failed: "+f)})})},m.onMediaEncrypted=function(n){var e=this;if(D.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var l=function(c){!e._media||(e._attemptSetMediaKeys(c),e._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(l).catch(l)},m._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}D.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},m._generateRequestWithPreferredKeySession=function(n,e){var l=this,f=this._mediaKeysList[0];if(!f){D.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(f.mediaKeysSessionInitialized){D.logger.warn("Key-Session already initialized but requested again");return}var c=f.mediaKeysSession;if(!c){D.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){D.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}D.logger.log('Generating key-session request for "'+n+'" init data type'),f.mediaKeysSessionInitialized=!0,c.generateRequest(n,e).then(function(){D.logger.debug("Key-session generation succeeded")}).catch(function(i){D.logger.error("Error generating key-session request:",i),l.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},m._createLicenseXhr=function(n,e,l){var f=new XMLHttpRequest;f.responseType="arraybuffer",f.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,f,n,e,l);var c=this._licenseXhrSetup;if(c)try{c.call(this.hls,f,n),c=void 0}catch(i){D.logger.error(i)}try{f.readyState||f.open("POST",n,!0),c&&c.call(this.hls,f,n)}catch(i){throw new Error("issue setting up KeySystem license XHR "+i)}return f},m._onLicenseRequestReadyStageChange=function(n,e,l,f){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,D.logger.log("License request succeeded");var c=n.response,i=this._licenseResponseCallback;if(i)try{c=i.call(this.hls,n,e)}catch(r){D.logger.error(r)}f(c)}else{if(D.logger.error("License Request XHR failed ("+e+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>A){this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var t=A-this._requestLicenseFailureCount+1;D.logger.warn("Retrying license request, "+t+" attempts left"),this._requestLicense(l,f)}break}},m._generateLicenseRequestChallenge=function(n,e){switch(n.mediaKeySystemDomain){case b.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},m._requestLicense=function(n,e){D.logger.log("Requesting content license for key-system");var l=this._mediaKeysList[0];if(!l){D.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var f=this.getLicenseServerUrl(l.mediaKeySystemDomain),c=this._createLicenseXhr(f,n,e);D.logger.log("Sending license request to URL: "+f);var i=this._generateLicenseRequestChallenge(l,n);c.send(i)}catch(t){D.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},m.onMediaAttached=function(n,e){if(!!this._emeEnabled){var l=e.media;this._media=l,l.addEventListener("encrypted",this._onMediaEncrypted)}},m.onMediaDetached=function(){var n=this._media,e=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(l){if(l.mediaKeysSession)return l.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},m.onManifestParsed=function(n,e){if(!!this._emeEnabled){var l=e.levels.map(function(c){return c.audioCodec}).filter(function(c){return!!c}),f=e.levels.map(function(c){return c.videoCodec}).filter(function(c){return!!c});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,l,f)}},I(T,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),T}();C.default=E},"./src/controller/fps-controller.ts":function(K,C,y){y.r(C);var M=y("./src/events.ts"),O=y("./src/utils/logger.ts"),D=function(){function b(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var R=b.prototype;return R.setStreamController=function(A){this.streamController=A},R.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(A,p){var x=this.hls.config;if(x.capLevelOnFPSDrop){var E=p.media instanceof self.HTMLVideoElement?p.media:null;this.media=E,E&&typeof E.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),x.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(A,p,x){var E=performance.now();if(p){if(this.lastTime){var T=E-this.lastTime,m=x-this.lastDroppedFrames,g=p-this.lastDecodedFrames,n=1e3*m/T,e=this.hls;if(e.trigger(M.Events.FPS_DROP,{currentDropped:m,currentDecoded:g,totalDroppedFrames:x}),n>0&&m>e.config.fpsDroppedMonitoringThreshold*g){var l=e.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=l)&&(l=l-1,e.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:e.currentLevel}),e.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=E,this.lastDroppedFrames=x,this.lastDecodedFrames=p}},R.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var p=A.getVideoPlaybackQuality();this.checkFPS(A,p.totalVideoFrames,p.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},b}();C.default=D},"./src/controller/fragment-finders.ts":function(K,C,y){y.r(C),y.d(C,"findFragmentByPDT",function(){return D}),y.d(C,"findFragmentByPTS",function(){return b}),y.d(C,"fragmentWithinToleranceTest",function(){return R}),y.d(C,"pdtWithinToleranceTest",function(){return I}),y.d(C,"findFragWithCC",function(){return A});var M=y("./src/polyfills/number.ts"),O=y("./src/utils/binary-search.ts");function D(p,x,E){if(x===null||!Array.isArray(p)||!p.length||!Object(M.isFiniteNumber)(x))return null;var T=p[0].programDateTime;if(x<(T||0))return null;var m=p[p.length-1].endProgramDateTime;if(x>=(m||0))return null;E=E||0;for(var g=0;g<p.length;++g){var n=p[g];if(I(x,E,n))return n}return null}function b(p,x,E,T){E===void 0&&(E=0),T===void 0&&(T=0);var m=null;if(p?m=x[p.sn-x[0].sn+1]||null:E===0&&x[0].start===0&&(m=x[0]),m&&R(E,T,m)===0)return m;var g=O.default.search(x,R.bind(null,E,T));return g||m}function R(p,x,E){p===void 0&&(p=0),x===void 0&&(x=0);var T=Math.min(x,E.duration+(E.deltaPTS?E.deltaPTS:0));return E.start+E.duration-T<=p?1:E.start-T>p&&E.start?-1:0}function I(p,x,E){var T=Math.min(x,E.duration+(E.deltaPTS?E.deltaPTS:0))*1e3,m=E.endProgramDateTime||0;return m-T>p}function A(p,x){return O.default.search(p,function(E){return E.cc<x?1:E.cc>x?-1:0})}},"./src/controller/fragment-tracker.ts":function(K,C,y){y.r(C),y.d(C,"FragmentState",function(){return D}),y.d(C,"FragmentTracker",function(){return b});var M=y("./src/events.ts"),O=y("./src/types/loader.ts"),D;(function(A){A.NOT_LOADED="NOT_LOADED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(D||(D={}));var b=function(){function A(x){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=x,this._registerListeners()}var p=A.prototype;return p._registerListeners=function(){var E=this.hls;E.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),E.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},p._unregisterListeners=function(){var E=this.hls;E.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),E.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},p.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},p.getAppendedFrag=function(E,T){if(T===O.PlaylistLevelType.MAIN){var m=this.activeFragment,g=this.activeParts;if(!m)return null;if(g)for(var n=g.length;n--;){var e=g[n],l=e?e.end:m.appendedPTS;if(e.start<=E&&l!==void 0&&E<=l)return n>9&&(this.activeParts=g.slice(n-9)),e}else if(m.start<=E&&m.appendedPTS!==void 0&&E<=m.appendedPTS)return m}return this.getBufferedFrag(E,T)},p.getBufferedFrag=function(E,T){for(var m=this.fragments,g=Object.keys(m),n=g.length;n--;){var e=m[g[n]];if((e==null?void 0:e.body.type)===T&&e.buffered){var l=e.body;if(l.start<=E&&E<=l.end)return l}}return null},p.detectEvictedFragments=function(E,T,m){var g=this;Object.keys(this.fragments).forEach(function(n){var e=g.fragments[n];if(!!e){if(!e.buffered){e.body.type===m&&g.removeFragment(e.body);return}var l=e.range[E];!l||l.time.some(function(f){var c=!g.isTimeBuffered(f.startPTS,f.endPTS,T);return c&&g.removeFragment(e.body),c})}})},p.detectPartialFragments=function(E){var T=this,m=this.timeRanges,g=E.frag,n=E.part;if(!(!m||g.sn==="initSegment")){var e=I(g),l=this.fragments[e];!l||(Object.keys(m).forEach(function(f){var c=g.elementaryStreams[f];if(!!c){var i=m[f],t=n!==null||c.partial===!0;l.range[f]=T.getBufferedTimes(g,n,t,i)}}),l.loaded=null,Object.keys(l.range).length?l.buffered=!0:this.removeFragment(l.body))}},p.fragBuffered=function(E){var T=I(E),m=this.fragments[T];m&&(m.loaded=null,m.buffered=!0)},p.getBufferedTimes=function(E,T,m,g){for(var n={time:[],partial:m},e=T?T.start:E.start,l=T?T.end:E.end,f=E.minEndPTS||l,c=E.maxStartPTS||e,i=0;i<g.length;i++){var t=g.start(i)-this.bufferPadding,r=g.end(i)+this.bufferPadding;if(c>=t&&f<=r){n.time.push({startPTS:Math.max(e,g.start(i)),endPTS:Math.min(l,g.end(i))});break}else if(e<r&&l>t)n.partial=!0,n.time.push({startPTS:Math.max(e,g.start(i)),endPTS:Math.min(l,g.end(i))});else if(l<=t)break}return n},p.getPartialFragment=function(E){var T=null,m,g,n,e=0,l=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(c){var i=f[c];!i||R(i)&&(g=i.body.start-l,n=i.body.end+l,E>=g&&E<=n&&(m=Math.min(E-g,n-E),e<=m&&(T=i.body,e=m)))}),T},p.getState=function(E){var T=I(E),m=this.fragments[T];return m?m.buffered?R(m)?D.PARTIAL:D.OK:D.APPENDING:D.NOT_LOADED},p.isTimeBuffered=function(E,T,m){for(var g,n,e=0;e<m.length;e++){if(g=m.start(e)-this.bufferPadding,n=m.end(e)+this.bufferPadding,E>=g&&T<=n)return!0;if(T<=g)return!1}return!1},p.onFragLoaded=function(E,T){var m=T.frag,g=T.part;if(!(m.sn==="initSegment"||m.bitrateTest||g)){var n=I(m);this.fragments[n]={body:m,loaded:T,buffered:!1,range:Object.create(null)}}},p.onBufferAppended=function(E,T){var m=this,g=T.frag,n=T.part,e=T.timeRanges;if(g.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=g,n){var l=this.activeParts;l||(this.activeParts=l=[]),l.push(n)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(f){var c=e[f];if(m.detectEvictedFragments(f,c),!n)for(var i=0;i<c.length;i++)g.appendedPTS=Math.max(c.end(i),g.appendedPTS||0)})},p.onFragBuffered=function(E,T){this.detectPartialFragments(T)},p.hasFragment=function(E){var T=I(E);return!!this.fragments[T]},p.removeFragmentsInRange=function(E,T,m){var g=this;Object.keys(this.fragments).forEach(function(n){var e=g.fragments[n];if(!!e&&e.buffered){var l=e.body;l.type===m&&l.start<T&&l.end>E&&g.removeFragment(l)}})},p.removeFragment=function(E){var T=I(E);E.stats.loaded=0,E.clearElementaryStreamInfo(),delete this.fragments[T]},p.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function R(A){var p,x;return A.buffered&&(((p=A.range.video)===null||p===void 0?void 0:p.partial)||((x=A.range.audio)===null||x===void 0?void 0:x.partial))}function I(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(K,C,y){y.r(C),y.d(C,"STALL_MINIMUM_DURATION_MS",function(){return R}),y.d(C,"MAX_START_GAP_JUMP",function(){return I}),y.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return A}),y.d(C,"SKIP_BUFFER_RANGE_START",function(){return p}),y.d(C,"default",function(){return x});var M=y("./src/utils/buffer-helper.ts"),O=y("./src/errors.ts"),D=y("./src/events.ts"),b=y("./src/utils/logger.ts"),R=250,I=2,A=.1,p=.05,x=function(){function E(m,g,n,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=g,this.fragmentTracker=n,this.hls=e}var T=E.prototype;return T.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},T.poll=function(g,n){var e=this.config,l=this.media,f=this.stalled;if(l!==null){var c=l.currentTime,i=l.seeking,t=this.seeking&&!i,r=!this.seeking&&i;if(this.seeking=i,c!==g){if(this.moved=!0,f!==null){if(this.stallReported){var h=self.performance.now()-f;b.logger.warn("playback not stuck anymore @"+c+", after "+Math.round(h)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((r||t)&&(this.stalled=null),!(l.paused&&!i||l.ended||l.playbackRate===0||!M.BufferHelper.getBuffered(l).length)){var a=M.BufferHelper.bufferInfo(l,c,0),s=a.len>0,d=a.nextStart||0;if(!(!s&&!d)){if(i){var o=a.len>I,u=!d||n&&n.start<=c||d-c>I&&!this.fragmentTracker.getPartialFragment(c);if(o||u)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,S=Math.max(d,a.start||0)-c,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=L==null||(v=L.details)===null||v===void 0?void 0:v.live,F=P?L.details.targetduration*2:I;if(S>0&&S<=F){this._trySkipBufferHole(null);return}}var _=self.performance.now();if(f===null){this.stalled=_;return}var B=_-f;if(!(!i&&B>=R&&(this._reportStall(a),!this.media))){var U=M.BufferHelper.bufferInfo(l,c,e.maxBufferHole);this._tryFixBufferStall(U,B)}}}}},T._tryFixBufferStall=function(g,n){var e=this.config,l=this.fragmentTracker,f=this.media;if(f!==null){var c=f.currentTime,i=l.getPartialFragment(c);if(i){var t=this._trySkipBufferHole(i);if(t||!this.media)return}g.len>e.maxBufferHole&&n>e.highBufferWatchdogPeriod*1e3&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},T._reportStall=function(g){var n=this.hls,e=this.media,l=this.stallReported;!l&&e&&(this.stallReported=!0,b.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(g)+")"),n.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g.len}))},T._trySkipBufferHole=function(g){var n=this.config,e=this.hls,l=this.media;if(l===null)return 0;for(var f=l.currentTime,c=0,i=M.BufferHelper.getBuffered(l),t=0;t<i.length;t++){var r=i.start(t);if(f+n.maxBufferHole>=c&&f<r){var h=Math.max(r+p,l.currentTime+A);return b.logger.warn("skipping hole, adjusting currentTime from "+f+" to "+h),this.moved=!0,this.stalled=null,l.currentTime=h,g&&e.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+f+" to "+h,frag:g}),h}c=i.end(t)}return 0},T._tryNudgeBuffer=function(){var g=this.config,n=this.hls,e=this.media,l=this.nudgeRetry;if(e!==null){var f=e.currentTime;if(this.nudgeRetry++,l<g.nudgeMaxRetry){var c=f+(l+1)*g.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+f+" to "+c),e.currentTime=c,n.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+f+" after "+g.nudgeMaxRetry+" nudges"),n.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},E}()},"./src/controller/id3-track-controller.ts":function(K,C,y){y.r(C);var M=y("./src/polyfills/number.ts"),O=y("./src/events.ts"),D=y("./src/utils/texttrack-utils.ts"),b=y("./src/demux/id3.ts"),R=y("./src/loader/date-range.ts"),I=y("./src/types/demuxer.ts"),A=.25;function p(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function x(m,g){return m.getTime()/1e3-g}function E(m){return Uint8Array.from(m.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var T=function(){function m(n){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=n,this._registerListeners()}var g=m.prototype;return g.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},g._registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},g._unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},g.onMediaAttached=function(e,l){this.media=l.media},g.onMediaDetaching=function(){!this.id3Track||(Object(D.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},g.onManifestLoading=function(){this.dateRangeCuesAppended={}},g.createTrack=function(e){var l=this.getID3Track(e.textTracks);return l.mode="hidden",l},g.getID3Track=function(e){if(!!this.media){for(var l=0;l<e.length;l++){var f=e[l];if(f.kind==="metadata"&&f.label==="id3")return Object(D.sendAddTrackEvent)(f,this.media),f}return this.media.addTextTrack("metadata","id3")}},g.onFragParsingMetadata=function(e,l){if(!!this.media){var f=this.hls.config,c=f.enableEmsgMetadataCues,i=f.enableID3MetadataCues;if(!(!c&&!i)){var t=l.frag,r=l.samples,h=l.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=h.edge||t.end,s=p(),d=!1,o={},u=0;u<r.length;u++){var v=r[u].type;if(!(v===I.MetadataSchema.emsg&&!c||!i)){var S=b.getID3Frames(r[u].data);if(S){var L=r[u].pts,P=a,F=P-L;F<=0&&(P=L+A);for(var _=0;_<S.length;_++){var B=S[_];if(!b.isTimeStampFrame(B)){var U=new s(L,P,"");U.value=B,v&&(U.type=v),this.id3Track.addCue(U),o[B.key]=null,d=!0}}}}}d&&this.updateId3CueEnds(o)}}},g.updateId3CueEnds=function(e){var l,f=(l=this.id3Track)===null||l===void 0?void 0:l.cues;if(f)for(var c=f.length;c--;){var i,t=f[c],r=(i=t.value)===null||i===void 0?void 0:i.key;if(r&&r in e){var h=e[r];h&&t.endTime!==h&&(t.endTime=h),e[r]=t.startTime}}},g.onBufferFlushing=function(e,l){var f=l.startOffset,c=l.endOffset,i=l.type,t=this.id3Track,r=this.hls;if(!!r){var h=r.config,a=h.enableEmsgMetadataCues,s=h.enableID3MetadataCues;if(t&&(a||s)){var d;i==="audio"?d=function(u){return u.type===I.MetadataSchema.audioId3&&s}:i==="video"?d=function(u){return u.type===I.MetadataSchema.emsg&&a}:d=function(u){return u.type===I.MetadataSchema.audioId3&&s||u.type===I.MetadataSchema.emsg&&a},Object(D.removeCuesInRange)(t,f,c,d)}}},g.onLevelUpdated=function(e,l){var f=this,c=l.details;if(!(!this.media||!c.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.dateRangeCuesAppended,t=this.id3Track,r=c.dateRanges,h=Object.keys(r);if(t)for(var a=Object.keys(i).filter(function(F){return!h.includes(F)}),s=function(_){var B=a[_];Object.keys(i[B].cues).forEach(function(U){t.removeCue(i[B].cues[U])}),delete i[B]},d=a.length;d--;)s(d);var o=c.fragments[c.fragments.length-1];if(!(h.length===0||!Object(M.isFiniteNumber)(o==null?void 0:o.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=o.programDateTime/1e3-o.start,v=c.edge||o.end,S=p(),L=function(_){var B=h[_],U=r[B],N=i[B],k=(N==null?void 0:N.cues)||{},w=(N==null?void 0:N.durationKnown)||!1,W=x(U.startDate,u),G=v,j=U.endDate;if(j)G=x(j,u),w=!0;else if(U.endOnNext&&!w){var Y=h.reduce(function($,ne){var re=r[ne];return re.class===U.class&&re.id!==ne&&re.startDate>U.startDate&&$.push(re),$},[]).sort(function($,ne){return $.startDate.getTime()-ne.startDate.getTime()})[0];Y&&(G=x(Y.startDate,u),w=!0)}for(var J=Object.keys(U.attr),Z=0;Z<J.length;Z++){var H=J[Z];if(!(H===R.DateRangeAttribute.ID||H===R.DateRangeAttribute.CLASS||H===R.DateRangeAttribute.START_DATE||H===R.DateRangeAttribute.DURATION||H===R.DateRangeAttribute.END_DATE||H===R.DateRangeAttribute.END_ON_NEXT)){var q=k[H];if(q)w&&!N.durationKnown&&(q.endTime=G);else{var Q=U.attr[H];q=new S(W,G,""),(H===R.DateRangeAttribute.SCTE35_OUT||H===R.DateRangeAttribute.SCTE35_IN)&&(Q=E(Q)),q.value={key:H,data:Q},q.type=I.MetadataSchema.dateRange,f.id3Track.addCue(q),k[H]=q}}}i[B]={cues:k,dateRange:U,durationKnown:w}},P=0;P<h.length;P++)L(P)}}},m}();C.default=T},"./src/controller/latency-controller.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return I});var M=y("./src/errors.ts"),O=y("./src/events.ts"),D=y("./src/utils/logger.ts");function b(A,p){for(var x=0;x<p.length;x++){var E=p[x];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(A,E.key,E)}}function R(A,p,x){return p&&b(A.prototype,p),x&&b(A,x),Object.defineProperty(A,"prototype",{writable:!1}),A}var I=function(){function A(x){var E=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return E.timeupdate()},this.hls=x,this.config=x.config,this.registerListeners()}var p=A.prototype;return p.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},p.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},p.onMediaAttached=function(E,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},p.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},p.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},p.onLevelUpdated=function(E,T){var m=T.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},p.onError=function(E,T){T.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,D.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},p.timeupdate=function(){var E=this.media,T=this.levelDetails;if(!(!E||!T)){this.currentTime=E.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var g=this.config,n=g.lowLatencyMode,e=g.maxLiveSyncPlaybackRate;if(!(!n||e===1)){var l=this.targetLatency;if(l!==null){var f=m-l,c=Math.min(this.maxLatency,l+T.targetduration),i=f<c;if(T.live&&i&&f>.05&&this.forwardBufferLength>1){var t=Math.min(2,Math.max(1,e)),r=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20;E.playbackRate=Math.min(t,Math.max(1,r))}else E.playbackRate!==1&&E.playbackRate!==0&&(E.playbackRate=1)}}}}},p.estimateLiveEdge=function(){var E=this.levelDetails;return E===null?null:E.edge+E.age},p.computeLatency=function(){var E=this.estimateLiveEdge();return E===null?null:E-this.currentTime},R(A,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var E=this.config,T=this.levelDetails;return E.liveMaxLatencyDuration!==void 0?E.liveMaxLatencyDuration:T?E.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var E=this.levelDetails;if(E===null)return null;var T=E.holdBack,m=E.partHoldBack,g=E.targetduration,n=this.config,e=n.liveSyncDuration,l=n.liveSyncDurationCount,f=n.lowLatencyMode,c=this.hls.userConfig,i=f&&m||T;(c.liveSyncDuration||c.liveSyncDurationCount||i===0)&&(i=e!==void 0?e:l*g);var t=g,r=1;return i+Math.min(this.stallCount*r,t)}},{key:"liveSyncPosition",get:function(){var E=this.estimateLiveEdge(),T=this.targetLatency,m=this.levelDetails;if(E===null||T===null||m===null)return null;var g=m.edge,n=E-T-this.edgeStalled,e=g-m.totalduration,l=g-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(e,n),l)}},{key:"drift",get:function(){var E=this.levelDetails;return E===null?1:E.drift}},{key:"edgeStalled",get:function(){var E=this.levelDetails;if(E===null)return 0;var T=(this.config.lowLatencyMode&&E.partTarget||E.targetduration)*3;return Math.max(E.age-T,0)}},{key:"forwardBufferLength",get:function(){var E=this.media,T=this.levelDetails;if(!E||!T)return 0;var m=E.buffered.length;return(m?E.buffered.end(m-1):T.edge)-this.currentTime}}]),A}()},"./src/controller/level-controller.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return n});var M=y("./src/types/level.ts"),O=y("./src/events.ts"),D=y("./src/errors.ts"),b=y("./src/utils/codecs.ts"),R=y("./src/controller/level-helper.ts"),I=y("./src/controller/base-playlist-controller.ts"),A=y("./src/types/loader.ts");function p(){return p=Object.assign?Object.assign.bind():function(e){for(var l=1;l<arguments.length;l++){var f=arguments[l];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(e[c]=f[c])}return e},p.apply(this,arguments)}function x(e,l){for(var f=0;f<l.length;f++){var c=l[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function E(e,l,f){return l&&x(e.prototype,l),f&&x(e,f),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e,l){e.prototype=Object.create(l.prototype),e.prototype.constructor=e,m(e,l)}function m(e,l){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,i){return c.__proto__=i,c},m(e,l)}var g=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(e){T(l,e);function l(c){var i;return i=e.call(this,c,"[level-controller]")||this,i._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}var f=l.prototype;return f._registerListeners=function(){var i=this.hls;i.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(O.Events.ERROR,this.onError,this)},f._unregisterListeners=function(){var i=this.hls;i.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(O.Events.ERROR,this.onError,this)},f.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},f.startLoad=function(){var i=this._levels;i.forEach(function(t){t.loadError=0}),e.prototype.startLoad.call(this)},f.onManifestLoaded=function(i,t){var r=[],h=[],a=[],s,d={},o,u=!1,v=!1,S=!1;if(t.levels.forEach(function(_){var B=_.attrs;u=u||!!(_.width&&_.height),v=v||!!_.videoCodec,S=S||!!_.audioCodec,g&&_.audioCodec&&_.audioCodec.indexOf("mp4a.40.34")!==-1&&(_.audioCodec=void 0);var U=_.bitrate+"-"+_.attrs.RESOLUTION+"-"+_.attrs.CODECS;o=d[U],o?o.url.push(_.url):(o=new M.Level(_),d[U]=o,r.push(o)),B&&(B.AUDIO&&Object(R.addGroupId)(o,"audio",B.AUDIO),B.SUBTITLES&&Object(R.addGroupId)(o,"text",B.SUBTITLES))}),(u||v)&&S&&(r=r.filter(function(_){var B=_.videoCodec,U=_.width,N=_.height;return!!B||!!(U&&N)})),r=r.filter(function(_){var B=_.audioCodec,U=_.videoCodec;return(!B||Object(b.isCodecSupportedInMp4)(B,"audio"))&&(!U||Object(b.isCodecSupportedInMp4)(U,"video"))}),t.audioTracks&&(h=t.audioTracks.filter(function(_){return!_.audioCodec||Object(b.isCodecSupportedInMp4)(_.audioCodec,"audio")}),Object(R.assignTrackIdsByGroup)(h)),t.subtitles&&(a=t.subtitles,Object(R.assignTrackIdsByGroup)(a)),r.length>0){s=r[0].bitrate,r.sort(function(_,B){return _.bitrate-B.bitrate}),this._levels=r;for(var L=0;L<r.length;L++)if(r[L].bitrate===s){this._firstLevel=L,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+s);break}var P=S&&!v,F={levels:r,audioTracks:h,subtitleTracks:a,firstLevel:this._firstLevel,stats:t.stats,audio:S,video:v,altAudio:!P&&h.some(function(_){return!!_.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},f.onError=function(i,t){var r;if(e.prototype.onError.call(this,i,t),!t.fatal){var h=t.context,a=this._levels[this.currentLevelIndex];if(h&&(h.type===A.PlaylistContextType.AUDIO_TRACK&&a.audioGroupIds&&h.groupId===a.audioGroupIds[a.urlId]||h.type===A.PlaylistContextType.SUBTITLE_TRACK&&a.textGroupIds&&h.groupId===a.textGroupIds[a.urlId])){this.redundantFailover(this.currentLevelIndex);return}var s=!1,d=!0,o;switch(t.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:if(t.frag){var u=t.frag.type===A.PlaylistLevelType.MAIN?t.frag.level:this.currentLevelIndex,v=this._levels[u];v?(v.fragmentError++,v.fragmentError>this.hls.config.fragLoadingMaxRetry&&(o=u)):o=u}break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:h&&(h.deliveryDirectives&&(d=!1),o=h.level),s=!0;break;case D.ErrorDetails.REMUX_ALLOC_ERROR:o=(r=t.level)!=null?r:this.currentLevelIndex,s=!0;break}o!==void 0&&this.recoverLevel(t,o,s,d)}},f.recoverLevel=function(i,t,r,h){var a=i.details,s=this._levels[t];if(s.loadError++,r){var d=this.retryLoadingOrFail(i);if(d)i.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(h){var o=s.url.length;if(o>1&&s.loadError<o)i.levelRetry=!0,this.redundantFailover(t);else if(this.manualLevelIndex===-1){for(var u=-1,v=this._levels,S=v.length;S--;){var L=(S+this.currentLevelIndex)%v.length;if(L!==this.currentLevelIndex&&v[L].loadError===0){u=L;break}}u>-1&&this.currentLevelIndex!==u&&(this.warn(a+": switch to "+u),i.levelRetry=!0,this.hls.nextAutoLevel=u)}}},f.redundantFailover=function(i){var t=this._levels[i],r=t.url.length;if(r>1){var h=(t.urlId+1)%r;this.warn("Switching to redundant URL-id "+h),this._levels.forEach(function(a){a.urlId=h}),this.level=i}},f.onFragLoaded=function(i,t){var r=t.frag;if(r!==void 0&&r.type===A.PlaylistLevelType.MAIN){var h=this._levels[r.level];h!==void 0&&(h.fragmentError=0,h.loadError=0)}},f.onLevelLoaded=function(i,t){var r,h=t.level,a=t.details,s=this._levels[h];if(!s){var d;this.warn("Invalid level index "+h),(d=t.deliveryDirectives)!==null&&d!==void 0&&d.skip&&(a.deltaUpdateFailed=!0);return}h===this.currentLevelIndex?(s.fragmentError===0&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(h,t,s.details)):(r=t.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(a.deltaUpdateFailed=!0)},f.onAudioTrackSwitched=function(i,t){var r=this.hls.levels[this.currentLevelIndex];if(!!r&&r.audioGroupIds){for(var h=-1,a=this.hls.audioTracks[t.id].groupId,s=0;s<r.audioGroupIds.length;s++)if(r.audioGroupIds[s]===a){h=s;break}h!==r.urlId&&(r.urlId=h,this.startLoad())}},f.loadPlaylist=function(i){var t=this.currentLevelIndex,r=this._levels[t];if(this.canLoad&&r&&r.url.length>0){var h=r.urlId,a=r.url[h];if(i)try{a=i.addDirectives(a)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+t+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+h+" "+a),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:a,level:t,id:h,deliveryDirectives:i||null})}},f.removeLevel=function(i,t){var r=function(s,d){return d!==t},h=this._levels.filter(function(a,s){return s!==i?!0:a.url.length>1&&t!==void 0?(a.url=a.url.filter(r),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(r)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(r)),a.urlId=0,!0):!1}).map(function(a,s){var d=a.details;return d!=null&&d.fragments&&d.fragments.forEach(function(o){o.level=s}),a});this._levels=h,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:h})},E(l,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var t,r=this._levels;if(r.length!==0&&!(this.currentLevelIndex===i&&(t=r[i])!==null&&t!==void 0&&t.details)){if(i<0||i>=r.length){var h=i<0;if(this.hls.trigger(O.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:h,reason:"invalid level idx"}),h)return;i=Math.min(i,r.length-1)}this.clearTimer();var a=this.currentLevelIndex,s=r[a],d=r[i];this.log("switching to level "+i+" from "+a),this.currentLevelIndex=i;var o=p({},d,{level:i,maxBitrate:d.maxBitrate,uri:d.uri,urlId:d.urlId});delete o._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,o);var u=d.details;if(!u||u.live){var v=this.switchParams(d.uri,s==null?void 0:s.details);this.loadPlaylist(v)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var i=this.hls.config.startLevel;return i!==void 0?i:this._firstLevel}else return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}}]),l}(I.default)},"./src/controller/level-helper.ts":function(K,C,y){y.r(C),y.d(C,"addGroupId",function(){return R}),y.d(C,"assignTrackIdsByGroup",function(){return I}),y.d(C,"updatePTS",function(){return A}),y.d(C,"updateFragPTSDTS",function(){return x}),y.d(C,"mergeDetails",function(){return E}),y.d(C,"mapPartIntersection",function(){return m}),y.d(C,"mapFragmentIntersection",function(){return g}),y.d(C,"adjustSliding",function(){return n}),y.d(C,"addSliding",function(){return e}),y.d(C,"computeReloadInterval",function(){return l}),y.d(C,"getFragmentWithSN",function(){return f}),y.d(C,"getPartWith",function(){return c});var M=y("./src/polyfills/number.ts"),O=y("./src/utils/logger.ts"),D=y("./src/loader/date-range.ts");function b(){return b=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&(i[h]=r[h])}return i},b.apply(this,arguments)}function R(i,t,r){switch(t){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(r);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(r);break}}function I(i){var t={};i.forEach(function(r){var h=r.groupId||"";r.id=t[h]=t[h]||0,t[h]++})}function A(i,t,r){var h=i[t],a=i[r];p(h,a)}function p(i,t){var r=t.startPTS;if(Object(M.isFiniteNumber)(r)){var h=0,a;t.sn>i.sn?(h=r-i.start,a=i):(h=i.start-r,a=t),a.duration!==h&&(a.duration=h)}else if(t.sn>i.sn){var s=i.cc===t.cc;s&&i.minEndPTS?t.start=i.start+(i.minEndPTS-i.start):t.start=i.start+i.duration}else t.start=Math.max(i.start-t.duration,0)}function x(i,t,r,h,a,s){var d=h-r;d<=0&&(O.logger.warn("Fragment should have a positive duration",t),h=r+t.duration,s=a+t.duration);var o=r,u=h,v=t.startPTS,S=t.endPTS;if(Object(M.isFiniteNumber)(v)){var L=Math.abs(v-r);Object(M.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(L,t.deltaPTS):t.deltaPTS=L,o=Math.max(r,v),r=Math.min(r,v),a=Math.min(a,t.startDTS),u=Math.min(h,S),h=Math.max(h,S),s=Math.max(s,t.endDTS)}t.duration=h-r;var P=r-t.start;t.appendedPTS=h,t.start=t.startPTS=r,t.maxStartPTS=o,t.startDTS=a,t.endPTS=h,t.minEndPTS=u,t.endDTS=s;var F=t.sn;if(!i||F<i.startSN||F>i.endSN)return 0;var _,B=F-i.startSN,U=i.fragments;for(U[B]=t,_=B;_>0;_--)p(U[_],U[_-1]);for(_=B;_<U.length-1;_++)p(U[_],U[_+1]);return i.fragmentHint&&p(U[U.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,P}function E(i,t){for(var r=null,h=i.fragments,a=h.length-1;a>=0;a--){var s=h[a].initSegment;if(s){r=s;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var d=0,o;if(g(i,t,function(_,B){_.relurl&&(d=_.cc-B.cc),Object(M.isFiniteNumber)(_.startPTS)&&Object(M.isFiniteNumber)(_.endPTS)&&(B.start=B.startPTS=_.startPTS,B.startDTS=_.startDTS,B.appendedPTS=_.appendedPTS,B.maxStartPTS=_.maxStartPTS,B.endPTS=_.endPTS,B.endDTS=_.endDTS,B.minEndPTS=_.minEndPTS,B.duration=_.endPTS-_.startPTS,B.duration&&(o=B),t.PTSKnown=t.alignedSliding=!0),B.elementaryStreams=_.elementaryStreams,B.loader=_.loader,B.stats=_.stats,B.urlId=_.urlId,_.initSegment&&(B.initSegment=_.initSegment,r=_.initSegment)}),r){var u=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;u.forEach(function(_){var B;(!_.initSegment||_.initSegment.relurl===((B=r)===null||B===void 0?void 0:B.relurl))&&(_.initSegment=r)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(_){return!_}),t.deltaUpdateFailed){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var v=t.skippedSegments;v--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=T(i.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var S=t.fragments;if(d){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<S.length;L++)S[L].cc+=d}t.skippedSegments&&(t.startCC=t.fragments[0].cc),m(i.partList,t.partList,function(_,B){B.elementaryStreams=_.elementaryStreams,B.stats=_.stats}),o?x(t,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):n(i,t),S.length&&(t.totalduration=t.edge-S[0].start),t.driftStartTime=i.driftStartTime,t.driftStart=i.driftStart;var P=t.advancedDateTime;if(t.advanced&&P){var F=t.edge;t.driftStart||(t.driftStartTime=P,t.driftStart=F),t.driftEndTime=P,t.driftEnd=F}else t.driftEndTime=i.driftEndTime,t.driftEnd=i.driftEnd,t.advancedDateTime=i.advancedDateTime}function T(i,t,r){var h=b({},i);return r&&r.forEach(function(a){delete h[a]}),Object.keys(t).forEach(function(a){var s=new D.DateRange(t[a].attr,h[a]);s.isValid?h[a]=s:O.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[a].attr)+'"')}),h}function m(i,t,r){if(i&&t)for(var h=0,a=0,s=i.length;a<=s;a++){var d=i[a],o=t[a+h];d&&o&&d.index===o.index&&d.fragment.sn===o.fragment.sn?r(d,o):h--}}function g(i,t,r){for(var h=t.skippedSegments,a=Math.max(i.startSN,t.startSN)-t.startSN,s=(i.fragmentHint?1:0)+(h?t.endSN:Math.min(i.endSN,t.endSN))-t.startSN,d=t.startSN-i.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,v=a;v<=s;v++){var S=u[d+v],L=o[v];h&&!L&&v<h&&(L=t.fragments[v]=S),S&&L&&r(S,L)}}function n(i,t){var r=t.startSN+t.skippedSegments-i.startSN,h=i.fragments;r<0||r>=h.length||e(t,h[r].start)}function e(i,t){if(t){for(var r=i.fragments,h=i.skippedSegments;h<r.length;h++)r[h].start+=t;i.fragmentHint&&(i.fragmentHint.start+=t)}}function l(i,t){var r=1e3*i.levelTargetDuration,h=r/2,a=i.age,s=a>0&&a<r*3,d=t.loading.end-t.loading.start,o,u=i.availabilityDelay;if(i.updated===!1)if(s){var v=333*i.misses;o=Math.max(Math.min(h,d*2),v),i.availabilityDelay=(i.availabilityDelay||0)+o}else o=h;else s?(u=Math.min(u||r/2,a),i.availabilityDelay=u,o=u+r-a):o=r-d;return Math.round(o)}function f(i,t,r){if(!i||!i.details)return null;var h=i.details,a=h.fragments[t-h.startSN];return a||(a=h.fragmentHint,a&&a.sn===t)?a:t<h.startSN&&r&&r.sn===t?r:null}function c(i,t,r){if(!i||!i.details)return null;var h=i.details.partList;if(h)for(var a=h.length;a--;){var s=h[a];if(s.index===r&&s.fragment.sn===t)return s}return null}},"./src/controller/stream-controller.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return c});var M=y("./src/polyfills/number.ts"),O=y("./src/controller/base-stream-controller.ts"),D=y("./src/is-supported.ts"),b=y("./src/events.ts"),R=y("./src/utils/buffer-helper.ts"),I=y("./src/controller/fragment-tracker.ts"),A=y("./src/types/loader.ts"),p=y("./src/loader/fragment.ts"),x=y("./src/demux/transmuxer-interface.ts"),E=y("./src/types/transmuxer.ts"),T=y("./src/controller/gap-controller.ts"),m=y("./src/errors.ts");function g(i,t){for(var r=0;r<t.length;r++){var h=t[r];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function n(i,t,r){return t&&g(i.prototype,t),r&&g(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function e(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,l(i,t)}function l(i,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,a){return h.__proto__=a,h},l(i,t)}var f=100,c=function(i){e(t,i);function t(h,a){var s;return s=i.call(this,h,a,"[stream-controller]")||this,s.audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.couldBacktrack=!1,s.backtrackFragment=null,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}var r=t.prototype;return r._registerListeners=function(){var a=this.hls;a.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.on(b.Events.ERROR,this.onError,this),a.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var a=this.hls;a.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.off(b.Events.ERROR,this.onError,this),a.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(a){if(this.levels){var s=this.lastCurrentTime,d=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var o=d.startLevel;o===-1&&(d.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=d.nextAutoLevel),this.level=d.nextLoadLevel=o,this.loadedmetadata=!1}s>0&&a===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),a=s),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:{var a,s=this.levels,d=this.level,o=s==null||(a=s[d])===null||a===void 0?void 0:a.details;if(o&&(!o.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(o))break;this.state=O.State.IDLE;break}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var u,v=self.performance.now(),S=this.retryDate;(!S||v>=S||(u=this.media)!==null&&u!==void 0&&u.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=O.State.IDLE)}break}this.onTickEnd()},r.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var a,s,d=this.hls,o=this.levelLastLoaded,u=this.levels,v=this.media,S=d.config,L=d.nextLoadLevel;if(!(o===null||!v&&(this.startFragRequested||!S.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!u||!u[L])){var P=u[L];this.level=d.nextLoadLevel=L;var F=P.details;if(!F||this.state===O.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==L){this.state=O.State.WAITING_LEVEL;return}var _=this.getMainFwdBufferInfo();if(_!==null){var B=_.len,U=this.getMaxBufferLength(P.maxBitrate);if(!(B>=U)){if(this._streamEnded(_,F)){var N={};this.altAudio&&(N.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,N),this.state=O.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>_.end&&(this.backtrackFragment=null);var k=this.backtrackFragment?this.backtrackFragment.start:_.end,w=this.getNextFragment(k,F);if(this.couldBacktrack&&!this.fragPrevious&&w&&w.sn!=="initSegment"&&this.fragmentTracker.getState(w)!==I.FragmentState.OK){var W,G=((W=this.backtrackFragment)!=null?W:w).sn,j=G-F.startSN,Y=F.fragments[j-1];Y&&w.cc===Y.cc&&(w=Y,this.fragmentTracker.removeFragment(Y))}else this.backtrackFragment&&_.len&&(this.backtrackFragment=null);if(w&&this.fragmentTracker.getState(w)===I.FragmentState.OK&&this.nextLoadPosition>k){var J=this.audioOnly&&!this.altAudio?p.ElementaryStreamTypes.AUDIO:p.ElementaryStreamTypes.VIDEO;v&&this.afterBufferFlushed(v,J,A.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,F)}!w||(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),((a=w.decryptdata)===null||a===void 0?void 0:a.keyFormat)==="identity"&&!((s=w.decryptdata)!==null&&s!==void 0&&s.key)?this.loadKey(w,F):this.loadFragment(w,F,k))}}}},r.loadFragment=function(a,s,d){var o,u=this.fragmentTracker.getState(a);this.fragCurrent=a,u===I.FragmentState.NOT_LOADED?a.sn==="initSegment"?this._loadInitSegment(a):this.bitrateTest?(this.log("Fragment "+a.sn+" of level "+a.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(a)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,a,s,d)):u===I.FragmentState.APPENDING?this.reduceMaxBufferLength(a.duration)&&this.fragmentTracker.removeFragment(a):((o=this.media)===null||o===void 0?void 0:o.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(a){var s=this.fragmentTracker.getAppendedFrag(a,A.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},r.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,A.PlaylistLevelType.MAIN)},r.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var a=this.levels,s=this.media;if(s!=null&&s.readyState){var d,o=this.getAppendedFrag(s.currentTime);if(o&&o.start>1&&this.flushMainBuffer(0,o.start-1),!s.paused&&a){var u=this.hls.nextLoadLevel,v=a[u],S=this.fragLastKbps;S&&this.fragCurrent?d=this.fragCurrent.duration*v.maxBitrate/(1e3*S)+1:d=0}else d=0;var L=this.getBufferedFrag(s.currentTime+d);if(L){var P=this.followingBufferedFrag(L);if(P){this.abortCurrentFrag();var F=P.maxStartPTS?P.maxStartPTS:P.start,_=P.duration,B=Math.max(L.end,F+Math.min(Math.max(_-this.config.maxFragLookUpTolerance,_*.5),_*.75));this.flushMainBuffer(B,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var a=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,a!=null&&a.loader&&a.loader.abort(),this.state){case O.State.KEY_LOADING:case O.State.FRAG_LOADING:case O.State.FRAG_LOADING_WAITING_RETRY:case O.State.PARSING:case O.State.PARSED:this.state=O.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(a,s){i.prototype.flushMainBuffer.call(this,a,s,this.altAudio?"video":null)},r.onMediaAttached=function(a,s){i.prototype.onMediaAttached.call(this,a,s);var d=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),d.addEventListener("playing",this.onvplaying),d.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,d,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var a=this.media;a&&this.onvplaying&&this.onvseeked&&(a.removeEventListener("playing",this.onvplaying),a.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var a=this.media,s=a?a.currentTime:null;Object(M.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},r.onManifestParsed=function(a,s){var d=!1,o=!1,u;s.levels.forEach(function(v){u=v.audioCodec,u&&(u.indexOf("mp4a.40.2")!==-1&&(d=!0),u.indexOf("mp4a.40.5")!==-1&&(o=!0))}),this.audioCodecSwitch=d&&o&&!Object(D.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},r.onLevelLoading=function(a,s){var d=this.levels;if(!(!d||this.state!==O.State.IDLE)){var o=d[s.level];(!o.details||o.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(o.details))&&(this.state=O.State.WAITING_LEVEL)}},r.onLevelLoaded=function(a,s){var d,o=this.levels,u=s.level,v=s.details,S=v.totalduration;if(!o){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+v.startSN+","+v.endSN+"], cc ["+v.startCC+", "+v.endCC+"] duration:"+S);var L=this.fragCurrent;L&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&L.level!==s.level&&L.loader&&(this.state=O.State.IDLE,this.backtrackFragment=null,L.loader.abort());var P=o[u],F=0;if(v.live||(d=P.details)!==null&&d!==void 0&&d.live){if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed)return;F=this.alignPlaylists(v,P.details)}if(P.details=v,this.levelLastLoaded=u,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:v,level:u}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(v))return;this.state=O.State.IDLE}this.startFragRequested?v.live&&this.synchronizeToLiveEdge(v):this.setStartPosition(v,F),this.tick()},r._handleFragmentLoadProgress=function(a){var s,d=a.frag,o=a.part,u=a.payload,v=this.levels;if(!v){this.warn("Levels were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var S=v[d.level],L=S.details;if(!L){this.warn("Dropping fragment "+d.sn+" of level "+d.level+" after level details were reset");return}var P=S.videoCodec,F=L.PTSKnown||!L.live,_=(s=d.initSegment)===null||s===void 0?void 0:s.data,B=this._getAudioCodec(S),U=this.transmuxer=this.transmuxer||new x.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=o?o.index:-1,k=N!==-1,w=new E.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,u.byteLength,N,k),W=this.initPTS[d.cc];U.push(u,_,B,P,d,o,L.totalduration,F,w,W)},r.onAudioTrackSwitching=function(a,s){var d=this.altAudio,o=!!s.url,u=s.id;if(!o){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var v=this.fragCurrent;v!=null&&v.loader&&(this.log("Switching to main audio track, cancel main fragment load"),v.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var S=this.hls;d&&S.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),S.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:u})}},r.onAudioTrackSwitched=function(a,s){var d=s.id,o=!!this.hls.audioTracks[d].url;if(o){var u=this.videoBuffer;u&&this.mediaBuffer!==u&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=u)}this.altAudio=o,this.tick()},r.onBufferCreated=function(a,s){var d=s.tracks,o,u,v=!1;for(var S in d){var L=d[S];if(L.id==="main"){if(u=S,o=L,S==="video"){var P=d[S];P&&(this.videoBuffer=P.buffer)}}else v=!0}v&&o?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(a,s){var d=s.frag,o=s.part;if(!(d&&d.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(o?" p: "+o.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state),this.state===O.State.PARSED&&(this.state=O.State.IDLE);return}var u=o?o.stats:d.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),d.sn!=="initSegment"&&(this.fragPrevious=d),this.fragBufferedComplete(d,o)}},r.onError=function(a,s){switch(s.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,s);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=O.State.ERROR):!s.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var d=!0,o=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);o&&o.len>.5&&(d=!this.reduceMaxBufferLength(o.len)),d&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},r.checkBuffer=function(){var a=this.media,s=this.gapController;if(!(!a||!s||!a.readyState)){if(this.loadedmetadata||!R.BufferHelper.getBuffered(a).length){var d=this.state!==O.State.IDLE?this.fragCurrent:null;s.poll(this.lastCurrentTime,d)}this.lastCurrentTime=a.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(a,s){var d=s.type;if(d!==p.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var o=(d===p.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(o,d,A.PlaylistLevelType.MAIN)}},r.onLevelsUpdated=function(a,s){this.levels=s.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var a=this.media;if(!!a){var s=a.currentTime,d=this.startPosition;if(d>=0&&s<d){if(a.seeking){this.log("could not seek to "+d+", already seeking at "+s);return}var o=R.BufferHelper.getBuffered(a),u=o.length?o.start(0):0,v=u-d;v>0&&(v<this.config.maxBufferHole||v<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+v+" to match buffer start"),d+=v,this.startPosition=d),this.log("seek to target start position "+d+" from current time "+s),a.currentTime=d}}},r._getAudioCodec=function(a){var s=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s},r._loadBitrateTestFrag=function(a){var s=this;a.bitrateTest=!0,this._doFragLoad(a).then(function(d){var o=s.hls;if(!(!d||o.nextLoadLevel||s.fragContextChanged(a))){s.fragLoadError=0,s.state=O.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var u=a.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),o.trigger(b.Events.FRAG_LOADED,d),a.bitrateTest=!1}})},r._handleTransmuxComplete=function(a){var s,d="main",o=this.hls,u=a.remuxResult,v=a.chunkMeta,S=this.getCurrentContext(v);if(!S){this.warn("The loading context changed while buffering fragment "+v.sn+" of level "+v.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(v.level);return}var L=S.frag,P=S.part,F=S.level,_=u.video,B=u.text,U=u.id3,N=u.initSegment,k=F.details,w=this.altAudio?void 0:u.audio;if(!this.fragContextChanged(L)){if(this.state=O.State.PARSING,N){N.tracks&&(this._bufferInitSegment(F,N.tracks,L,v),o.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:d,tracks:N.tracks}));var W=N.initPTS,G=N.timescale;Object(M.isFiniteNumber)(W)&&(this.initPTS[L.cc]=W,o.trigger(b.Events.INIT_PTS_FOUND,{frag:L,id:d,initPTS:W,timescale:G}))}if(_&&u.independent!==!1){if(k){var j=_.startPTS,Y=_.endPTS,J=_.startDTS,Z=_.endDTS;if(P)P.elementaryStreams[_.type]={startPTS:j,endPTS:Y,startDTS:J,endDTS:Z};else if(_.firstKeyFrame&&_.independent&&(this.couldBacktrack=!0),_.dropped&&_.independent){var H=this.getMainFwdBufferInfo(),q=(H?H.end:this.getLoadPosition())+this.config.maxBufferHole,Q=_.firstKeyFramePTS?_.firstKeyFramePTS:j;if(q<Q-this.config.maxBufferHole){this.backtrack(L);return}L.setElementaryStreamInfo(_.type,L.start,Y,L.start,Z,!0)}L.setElementaryStreamInfo(_.type,j,Y,J,Z),this.backtrackFragment&&(this.backtrackFragment=L),this.bufferFragmentData(_,L,P,v)}}else if(u.independent===!1){this.backtrack(L);return}if(w){var $=w.startPTS,ne=w.endPTS,re=w.startDTS,ae=w.endDTS;P&&(P.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:$,endPTS:ne,startDTS:re,endDTS:ae}),L.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,$,ne,re,ae),this.bufferFragmentData(w,L,P,v)}if(k&&U!==null&&U!==void 0&&(s=U.samples)!==null&&s!==void 0&&s.length){var le={id:d,frag:L,details:k,samples:U.samples};o.trigger(b.Events.FRAG_PARSING_METADATA,le)}if(k&&B){var se={id:d,frag:L,details:k,samples:B.samples};o.trigger(b.Events.FRAG_PARSING_USERDATA,se)}}},r._bufferInitSegment=function(a,s,d,o){var u=this;if(this.state===O.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var v=s.audio,S=s.video,L=s.audiovideo;if(v){var P=a.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),v.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(P="mp4a.40.5")),F.indexOf("android")!==-1&&v.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),a.audioCodec&&a.audioCodec!==P&&this.log('Swapping manifest audio codec "'+a.audioCodec+'" for "'+P+'"'),v.levelCodec=P,v.id="main",this.log("Init audio buffer, container:"+v.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(a.audioCodec||"")+"/"+v.codec+"]")}S&&(S.levelCodec=a.videoCodec,S.id="main",this.log("Init video buffer, container:"+S.container+", codecs[level/parsed]=["+(a.videoCodec||"")+"/"+S.codec+"]")),L&&this.log("Init audiovideo buffer, container:"+L.container+", codecs[level/parsed]=["+(a.attrs.CODECS||"")+"/"+L.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(_){var B=s[_],U=B.initSegment;U!=null&&U.byteLength&&u.hls.trigger(b.Events.BUFFER_APPENDING,{type:_,data:U,frag:d,part:null,chunkMeta:o,parent:d.type})}),this.tick()}},r.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.MAIN)},r.backtrack=function(a){this.couldBacktrack=!0,this.backtrackFragment=a,this.resetTransmuxer(),this.flushBufferGap(a),this.fragmentTracker.removeFragment(a),this.fragPrevious=null,this.nextLoadPosition=a.start,this.state=O.State.IDLE},r.checkFragmentChanged=function(){var a=this.media,s=null;if(a&&a.readyState>1&&a.seeking===!1){var d=a.currentTime;if(R.BufferHelper.isBuffered(a,d)?s=this.getAppendedFrag(d):R.BufferHelper.isBuffered(a,d+.1)&&(s=this.getAppendedFrag(d+.1)),s){this.backtrackFragment=null;var o=this.fragPlaying,u=s.level;(!o||s.sn!==o.sn||o.level!==u||s.urlId!==o.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:s}),(!o||o.level!==u)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:u}),this.fragPlaying=s)}}},n(t,[{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"currentFrag",get:function(){var a=this.media;return a?this.fragPlaying||this.getAppendedFrag(a.currentTime):null}},{key:"currentProgramDateTime",get:function(){var a=this.media;if(a){var s=a.currentTime,d=this.currentFrag;if(d&&Object(M.isFiniteNumber)(s)&&Object(M.isFiniteNumber)(d.programDateTime)){var o=d.programDateTime+(s-d.start)*1e3;return new Date(o)}}return null}},{key:"currentLevel",get:function(){var a=this.currentFrag;return a?a.level:-1}},{key:"nextBufferedFrag",get:function(){var a=this.currentFrag;return a?this.followingBufferedFrag(a):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(K,C,y){y.r(C),y.d(C,"SubtitleStreamController",function(){return e});var M=y("./src/events.ts"),O=y("./src/utils/buffer-helper.ts"),D=y("./src/controller/fragment-finders.ts"),b=y("./src/utils/discontinuities.ts"),R=y("./src/controller/level-helper.ts"),I=y("./src/controller/fragment-tracker.ts"),A=y("./src/controller/base-stream-controller.ts"),p=y("./src/types/loader.ts"),x=y("./src/types/level.ts");function E(f,c){for(var i=0;i<c.length;i++){var t=c[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(f,t.key,t)}}function T(f,c,i){return c&&E(f.prototype,c),i&&E(f,i),Object.defineProperty(f,"prototype",{writable:!1}),f}function m(f,c){f.prototype=Object.create(c.prototype),f.prototype.constructor=f,g(f,c)}function g(f,c){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},g(f,c)}var n=500,e=function(f){m(c,f);function c(t,r){var h;return h=f.call(this,t,r,"[subtitle-stream-controller]")||this,h.levels=[],h.currentTrackId=-1,h.tracksBuffered=[],h.mainDetails=null,h._registerListeners(),h}var i=c.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var r=this.hls;r.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(M.Events.ERROR,this.onError,this),r.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i._unregisterListeners=function(){var r=this.hls;r.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(M.Events.ERROR,this.onError,this),r.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(n),this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},i.onLevelLoaded=function(r,h){this.mainDetails=h.details},i.onSubtitleFragProcessed=function(r,h){var a=h.frag,s=h.success;if(this.fragPrevious=a,this.state=A.State.IDLE,!!s){var d=this.tracksBuffered[this.currentTrackId];if(!!d){for(var o,u=a.start,v=0;v<d.length;v++)if(u>=d[v].start&&u<=d[v].end){o=d[v];break}var S=a.start+a.duration;o?o.end=S:(o={start:u,end:S},d.push(o)),this.fragmentTracker.fragBuffered(a)}}},i.onBufferFlushing=function(r,h){var a=h.startOffset,s=h.endOffset;if(a===0&&s!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,o=this.levels;if(!o.length||!o[d]||!o[d].details)return;var u=o[d].details,v=u.targetduration,S=s-v;if(S<=0)return;h.endOffsetSubtitles=Math.max(0,S),this.tracksBuffered.forEach(function(L){for(var P=0;P<L.length;){if(L[P].end<=S){L.shift();continue}else if(L[P].start<S)L[P].start=S;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(a,S,p.PlaylistLevelType.SUBTITLE)}},i.onError=function(r,h){var a,s=h.frag;!s||s.type!==p.PlaylistLevelType.SUBTITLE||((a=this.fragCurrent)!==null&&a!==void 0&&a.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},i.onSubtitleTracksUpdated=function(r,h){var a=this,s=h.subtitleTracks;this.tracksBuffered=[],this.levels=s.map(function(d){return new x.Level(d)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(d){a.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},i.onSubtitleTrackSwitch=function(r,h){if(this.currentTrackId=h.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.setInterval(n)},i.onSubtitleTrackLoaded=function(r,h){var a,s=h.details,d=h.id,o=this.currentTrackId,u=this.levels;if(!!u.length){var v=u[o];if(!(d>=u.length||d!==o||!v)){if(this.mediaBuffer=this.mediaBufferTimeRanges,s.live||(a=v.details)!==null&&a!==void 0&&a.live){var S=this.mainDetails;if(s.deltaUpdateFailed||!S)return;var L=S.fragments[0];if(!v.details)s.hasProgramDateTime&&S.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(s,S):L&&Object(R.addSliding)(s,L.start);else{var P=this.alignPlaylists(s,v.details);P===0&&L&&Object(R.addSliding)(s,L.start)}}if(v.details=s,this.levelLastLoaded=d,this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE){var F=Object(D.findFragmentByPTS)(null,s.fragments,this.media.currentTime,0);F||(this.warn("Subtitle playlist not aligned with playback"),v.details=void 0)}}}},i._handleFragmentLoadComplete=function(r){var h=r.frag,a=r.payload,s=h.decryptdata,d=this.hls;if(!this.fragContextChanged(h)&&a&&a.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){var o=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(a),s.key.buffer,s.iv.buffer).then(function(u){var v=performance.now();d.trigger(M.Events.FRAG_DECRYPTED,{frag:h,payload:u,stats:{tstart:o,tdecrypt:v}})})}},i.doTick=function(){if(!this.media){this.state=A.State.IDLE;return}if(this.state===A.State.IDLE){var r=this.currentTrackId,h=this.levels;if(!h.length||!h[r]||!h[r].details)return;var a=h[r].details,s=a.targetduration,d=this.config,o=this.media,u=O.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o.currentTime-s,d.maxBufferHole),v=u.end,S=u.len,L=this.getMaxBufferLength()+s;if(S>L)return;console.assert(a,"Subtitle track details are defined on idle subtitle stream controller tick");var P=a.fragments,F=P.length,_=a.edge,B,U=this.fragPrevious;if(v<_){var N=d.maxFragLookUpTolerance;B=Object(D.findFragmentByPTS)(U,P,Math.max(P[0].start,v),N),!B&&U&&U.start<P[0].start&&(B=P[0])}else B=P[F-1];if(B=this.mapToInitFragWhenRequired(B),!B||this.fragmentTracker.getState(B)!==I.FragmentState.NOT_LOADED)return;B.encrypted?this.loadKey(B,a):this.loadFragment(B,a,v)}},i.loadFragment=function(r,h,a){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):f.prototype.loadFragment.call(this,r,h,a)},T(c,[{key:"mediaBufferTimeRanges",get:function(){return new l(this.tracksBuffered[this.currentTrackId]||[])}}]),c}(A.default),l=function(c){this.buffered=void 0;var i=function(r,h,a){if(h=h>>>0,h>a-1)throw new DOMException("Failed to execute '"+r+"' on 'TimeRanges': The index provided ("+h+") is greater than the maximum bound ("+a+")");return c[h][r]};this.buffered={get length(){return c.length},end:function(r){return i("end",r,c.length)},start:function(r){return i("start",r,c.length)}}}},"./src/controller/subtitle-track-controller.ts":function(K,C,y){y.r(C);var M=y("./src/events.ts"),O=y("./src/utils/texttrack-utils.ts"),D=y("./src/controller/base-playlist-controller.ts"),b=y("./src/types/loader.ts");function R(T,m){for(var g=0;g<m.length;g++){var n=m[g];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(T,n.key,n)}}function I(T,m,g){return m&&R(T.prototype,m),g&&R(T,g),Object.defineProperty(T,"prototype",{writable:!1}),T}function A(T,m){T.prototype=Object.create(m.prototype),T.prototype.constructor=T,p(T,m)}function p(T,m){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},p(T,m)}var x=function(T){A(m,T);function m(n){var e;return e=T.call(this,n,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var g=m.prototype;return g.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,T.prototype.destroy.call(this)},g.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.Events.ERROR,this.onError,this)},g.onMediaAttached=function(e,l){this.media=l.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},g.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},g.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=E(this.media.textTracks);e.forEach(function(l){Object(O.clearCurrentCues)(l)}),this.subtitleTrack=-1,this.media=null}},g.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},g.onManifestParsed=function(e,l){this.tracks=l.subtitleTracks},g.onSubtitleTrackLoaded=function(e,l){var f=l.id,c=l.details,i=this.trackId,t=this.tracksInGroup[i];if(!t){this.warn("Invalid subtitle track id "+f);return}var r=t.details;t.details=l.details,this.log("subtitle track "+f+" loaded ["+c.startSN+"-"+c.endSN+"]"),f===this.trackId&&(this.retryCount=0,this.playlistLoaded(f,l,r))},g.onLevelLoading=function(e,l){this.switchLevel(l.level)},g.onLevelSwitching=function(e,l){this.switchLevel(l.level)},g.switchLevel=function(e){var l=this.hls.levels[e];if(!!(l!=null&&l.textGroupIds)){var f=l.textGroupIds[l.urlId];if(this.groupId!==f){var c=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(h){return!f||h.groupId===f});this.tracksInGroup=i;var t=this.findTrackId(c==null?void 0:c.name)||this.findTrackId();this.groupId=f;var r={subtitleTracks:i};this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+f+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,r),t!==-1&&this.setSubtitleTrack(t,c)}}},g.findTrackId=function(e){for(var l=this.tracksInGroup,f=0;f<l.length;f++){var c=l[f];if((!this.selectDefaultTrack||c.default)&&(!e||e===c.name))return c.id}return-1},g.onError=function(e,l){T.prototype.onError.call(this,e,l),!(l.fatal||!l.context)&&l.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&l.context.id===this.trackId&&l.context.groupId===this.groupId&&this.retryLoadingOrFail(l)},g.loadPlaylist=function(e){var l=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(l)){var f=l.id,c=l.groupId,i=l.url;if(e)try{i=e.addDirectives(i)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+f),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:i,id:f,groupId:c,deliveryDirectives:e||null})}},g.toggleTrackModes=function(e){var l=this,f=this.media,c=this.trackId;if(!!f){var i=E(f.textTracks),t=i.filter(function(a){return a.groupId===l.groupId});if(e===-1)[].slice.call(i).forEach(function(a){a.mode="disabled"});else{var r=t[c];r&&(r.mode="disabled")}var h=t[e];h&&(h.mode=this.subtitleDisplay?"showing":"hidden")}},g.setSubtitleTrack=function(e,l){var f,c=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(f=c[e])!==null&&f!==void 0&&f.details)||e<-1||e>=c.length)){this.clearTimer();var i=c[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,i){var t=i.id,r=i.groupId,h=r===void 0?"":r,a=i.name,s=i.type,d=i.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:t,groupId:h,name:a,type:s,url:d});var o=this.switchParams(i.url,l==null?void 0:l.details);this.loadPlaylist(o)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},g.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,l=E(this.media.textTracks),f=0;f<l.length;f++)if(l[f].mode==="hidden")e=f;else if(l[f].mode==="showing"){e=f;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},I(m,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var l=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,l)}}]),m}(D.default);function E(T){for(var m=[],g=0;g<T.length;g++){var n=T[g];n.kind==="subtitles"&&n.label&&m.push(T[g])}return m}C.default=x},"./src/controller/timeline-controller.ts":function(K,C,y){y.r(C),y.d(C,"TimelineController",function(){return T});var M=y("./src/polyfills/number.ts"),O=y("./src/events.ts"),D=y("./src/utils/cea-608-parser.ts"),b=y("./src/utils/output-filter.ts"),R=y("./src/utils/webvtt-parser.ts"),I=y("./src/utils/texttrack-utils.ts"),A=y("./src/utils/imsc1-ttml-parser.ts"),p=y("./src/utils/mp4-tools.ts"),x=y("./src/types/loader.ts"),E=y("./src/utils/logger.ts"),T=function(){function e(f){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=n(),this.captionsProperties=void 0,this.hls=f,this.config=f.config,this.Cues=f.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var c=new b.default(this,"textTrack1"),i=new b.default(this,"textTrack2"),t=new b.default(this,"textTrack3"),r=new b.default(this,"textTrack4");this.cea608Parser1=new D.default(1,c,i),this.cea608Parser2=new D.default(3,t,r)}f.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.on(O.Events.FRAG_LOADING,this.onFragLoading,this),f.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),f.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),f.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),f.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),f.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var l=e.prototype;return l.destroy=function(){var c=this.hls;c.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),c.off(O.Events.FRAG_LOADING,this.onFragLoading,this),c.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),c.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),c.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),c.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(c,i,t,r,h){for(var a=!1,s=h.length;s--;){var d=h[s],o=g(d[0],d[1],i,t);if(o>=0&&(d[0]=Math.min(d[0],i),d[1]=Math.max(d[1],t),a=!0,o/(t-i)>.5))return}if(a||h.push([i,t]),this.config.renderTextTracksNatively){var u=this.captionsTracks[c];this.Cues.newCue(u,i,t,r)}else{var v=this.Cues.newCue(null,i,t,r);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:v,track:c})}},l.onInitPtsFound=function(c,i){var t=this,r=i.frag,h=i.id,a=i.initPTS,s=i.timescale,d=this.unparsedVttFrags;h==="main"&&(this.initPTS[r.cc]=a,this.timescale[r.cc]=s),d.length&&(this.unparsedVttFrags=[],d.forEach(function(o){t.onFragLoaded(O.Events.FRAG_LOADED,o)}))},l.getExistingTrack=function(c){var i=this.media;if(i)for(var t=0;t<i.textTracks.length;t++){var r=i.textTracks[t];if(r[c])return r}return null},l.createCaptionsTrack=function(c){this.config.renderTextTracksNatively?this.createNativeTrack(c):this.createNonNativeTrack(c)},l.createNativeTrack=function(c){if(!this.captionsTracks[c]){var i=this.captionsProperties,t=this.captionsTracks,r=this.media,h=i[c],a=h.label,s=h.languageCode,d=this.getExistingTrack(c);if(d)t[c]=d,Object(I.clearCurrentCues)(t[c]),Object(I.sendAddTrackEvent)(t[c],r);else{var o=this.createTextTrack("captions",a,s);o&&(o[c]=!0,t[c]=o)}}},l.createNonNativeTrack=function(c){if(!this.nonNativeCaptionsTracks[c]){var i=this.captionsProperties[c];if(!!i){var t=i.label,r={_id:c,label:t,kind:"captions",default:i.media?!!i.media.default:!1,closedCaptions:i.media};this.nonNativeCaptionsTracks[c]=r,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},l.createTextTrack=function(c,i,t){var r=this.media;if(!!r)return r.addTextTrack(c,i,t)},l.onMediaAttaching=function(c,i){this.media=i.media,this._cleanTracks()},l.onMediaDetaching=function(){var c=this.captionsTracks;Object.keys(c).forEach(function(i){Object(I.clearCurrentCues)(c[i]),delete c[i]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=n(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var c=this.media;if(!!c){var i=c.textTracks;if(i)for(var t=0;t<i.length;t++)Object(I.clearCurrentCues)(i[t])}},l.onSubtitleTracksUpdated=function(c,i){var t=this;this.textTracks=[];var r=i.subtitleTracks||[],h=r.some(function(o){return o.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||h&&this.config.enableIMSC1){var a=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(o,u){var v;if(u<s.length){for(var S=null,L=0;L<s.length;L++)if(m(s[L],o)){S=s[L];break}S&&(v=S)}if(v)Object(I.clearCurrentCues)(v);else{var P=t._captionsOrSubtitlesFromCharacteristics(o);v=t.createTextTrack(P,o.name,o.lang),v&&(v.mode="disabled")}v&&(v.groupId=o.groupId,t.textTracks.push(v))})}else if(!a&&this.tracks&&this.tracks.length){var d=this.tracks.map(function(o){return{label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:d})}}},l._captionsOrSubtitlesFromCharacteristics=function(c){var i;if((i=c.attrs)!==null&&i!==void 0&&i.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(c.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(c.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"},l.onManifestLoaded=function(c,i){var t=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(r){var h=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!!h){var a="textTrack"+h[1],s=t.captionsProperties[a];!s||(s.label=r.name,r.lang&&(s.languageCode=r.lang),s.media=r)}})},l.closedCaptionsForLevel=function(c){var i=this.hls.levels[c.level];return i==null?void 0:i.attrs["CLOSED-CAPTIONS"]},l.onFragLoading=function(c,i){var t=this.cea608Parser1,r=this.cea608Parser2,h=this.lastSn,a=this.lastPartIndex;if(!(!this.enabled||!(t&&r))&&i.frag.type===x.PlaylistLevelType.MAIN){var s,d,o=i.frag.sn,u=(s=i==null||(d=i.part)===null||d===void 0?void 0:d.index)!=null?s:-1;o===h+1||o===h&&u===a+1||(t.reset(),r.reset()),this.lastSn=o,this.lastPartIndex=u}},l.onFragLoaded=function(c,i){var t=i.frag,r=i.payload,h=this.initPTS,a=this.unparsedVttFrags;if(t.type===x.PlaylistLevelType.SUBTITLE)if(r.byteLength){if(!Object(M.isFiniteNumber)(h[t.cc])){a.push(i),h.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")});return}var s=t.decryptdata,d="stats"in i;if(s==null||s.key==null||s.method!=="AES-128"||d){var o=this.tracks[t.level],u=this.vttCCs;u[t.cc]||(u[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),o&&o.textCodec===A.IMSC1_CODEC?this._parseIMSC1(t,r):this._parseVTTs(t,r,u)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},l._parseIMSC1=function(c,i){var t=this,r=this.hls;Object(A.parseIMSC1)(i,this.initPTS[c.cc],this.timescale[c.cc],function(h){t._appendCues(h,c.level),r.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:c})},function(h){E.logger.log("Failed to parse IMSC1: "+h),r.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:h})})},l._parseVTTs=function(c,i,t){var r,h=this,a=this.hls,s=(r=c.initSegment)!==null&&r!==void 0&&r.data?Object(p.appendUint8Array)(c.initSegment.data,new Uint8Array(i)):i;Object(R.parseWebVTT)(s,this.initPTS[c.cc],this.timescale[c.cc],t,c.cc,c.start,function(d){h._appendCues(d,c.level),a.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:c})},function(d){h._fallbackToIMSC1(c,i),E.logger.log("Failed to parse VTT cue: "+d),a.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:d})})},l._fallbackToIMSC1=function(c,i){var t=this,r=this.tracks[c.level];r.textCodec||Object(A.parseIMSC1)(i,this.initPTS[c.cc],this.timescale[c.cc],function(){r.textCodec=A.IMSC1_CODEC,t._parseIMSC1(c,i)},function(){r.textCodec="wvtt"})},l._appendCues=function(c,i){var t=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[i];if(!r||r.mode==="disabled")return;c.forEach(function(s){return Object(I.addCueToTrack)(r,s)})}else{var h=this.tracks[i];if(!h)return;var a=h.default?"default":"subtitles"+i;t.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:c,track:a})}},l.onFragDecrypted=function(c,i){var t=i.frag;if(t.type===x.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(i);return}this.onFragLoaded(O.Events.FRAG_LOADED,i)}},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(c,i){var t=this.cea608Parser1,r=this.cea608Parser2;if(!(!this.enabled||!(t&&r))){var h=i.frag,a=i.samples;if(!(h.type===x.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(h)==="NONE"))for(var s=0;s<a.length;s++){var d=a[s].bytes;if(d){var o=this.extractCea608Data(d);t.addData(a[s].pts,o[0]),r.addData(a[s].pts,o[1])}}}},l.onBufferFlushing=function(c,i){var t=i.startOffset,r=i.endOffset,h=i.endOffsetSubtitles,a=i.type,s=this.media;if(!(!s||s.currentTime<r)){if(!a||a==="video"){var d=this.captionsTracks;Object.keys(d).forEach(function(u){return Object(I.removeCuesInRange)(d[u],t,r)})}if(this.config.renderTextTracksNatively&&t===0&&h!==void 0){var o=this.textTracks;Object.keys(o).forEach(function(u){return Object(I.removeCuesInRange)(o[u],t,h)})}}},l.extractCea608Data=function(c){for(var i=[[],[]],t=c[0]&31,r=2,h=0;h<t;h++){var a=c[r++],s=127&c[r++],d=127&c[r++];if(!(s===0&&d===0)){var o=(4&a)!==0;if(o){var u=3&a;(u===0||u===1)&&(i[u].push(s),i[u].push(d))}}}return i},e}();function m(e,l){return e&&e.label===l.name&&!(e.textTrack1||e.textTrack2)}function g(e,l,f,c){return Math.min(l,c)-Math.max(e,f)}function n(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return M});var M=function(){function O(b,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=R}var D=O.prototype;return D.decrypt=function(R,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,R)},O}()},"./src/crypt/aes-decryptor.ts":function(K,C,y){y.r(C),y.d(C,"removePadding",function(){return O}),y.d(C,"default",function(){return D});var M=y("./src/utils/typed-array.ts");function O(b){var R=b.byteLength,I=R&&new DataView(b.buffer).getUint8(R-1);return I?Object(M.sliceUint8)(b,0,R-I):b}var D=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=b.prototype;return R.uint8ArrayToUint32Array_=function(A){for(var p=new DataView(A),x=new Uint32Array(4),E=0;E<4;E++)x[E]=p.getUint32(E*4);return x},R.initTable=function(){var A=this.sBox,p=this.invSBox,x=this.subMix,E=x[0],T=x[1],m=x[2],g=x[3],n=this.invSubMix,e=n[0],l=n[1],f=n[2],c=n[3],i=new Uint32Array(256),t=0,r=0,h=0;for(h=0;h<256;h++)h<128?i[h]=h<<1:i[h]=h<<1^283;for(h=0;h<256;h++){var a=r^r<<1^r<<2^r<<3^r<<4;a=a>>>8^a&255^99,A[t]=a,p[a]=t;var s=i[t],d=i[s],o=i[d],u=i[a]*257^a*16843008;E[t]=u<<24|u>>>8,T[t]=u<<16|u>>>16,m[t]=u<<8|u>>>24,g[t]=u,u=o*16843009^d*65537^s*257^t*16843008,e[a]=u<<24|u>>>8,l[a]=u<<16|u>>>16,f[a]=u<<8|u>>>24,c[a]=u,t?(t=s^i[i[i[o^s]]],r^=i[i[r]]):t=r=1}},R.expandKey=function(A){for(var p=this.uint8ArrayToUint32Array_(A),x=!0,E=0;E<p.length&&x;)x=p[E]===this.key[E],E++;if(!x){this.key=p;var T=this.keySize=p.length;if(T!==4&&T!==6&&T!==8)throw new Error("Invalid aes key size="+T);var m=this.ksRows=(T+6+1)*4,g,n,e=this.keySchedule=new Uint32Array(m),l=this.invKeySchedule=new Uint32Array(m),f=this.sBox,c=this.rcon,i=this.invSubMix,t=i[0],r=i[1],h=i[2],a=i[3],s,d;for(g=0;g<m;g++){if(g<T){s=e[g]=p[g];continue}d=s,g%T===0?(d=d<<8|d>>>24,d=f[d>>>24]<<24|f[d>>>16&255]<<16|f[d>>>8&255]<<8|f[d&255],d^=c[g/T|0]<<24):T>6&&g%T===4&&(d=f[d>>>24]<<24|f[d>>>16&255]<<16|f[d>>>8&255]<<8|f[d&255]),e[g]=s=(e[g-T]^d)>>>0}for(n=0;n<m;n++)g=m-n,n&3?d=e[g]:d=e[g-4],n<4||g<=4?l[n]=d:l[n]=t[f[d>>>24]]^r[f[d>>>16&255]]^h[f[d>>>8&255]]^a[f[d&255]],l[n]=l[n]>>>0}},R.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},R.decrypt=function(A,p,x){for(var E=this.keySize+6,T=this.invKeySchedule,m=this.invSBox,g=this.invSubMix,n=g[0],e=g[1],l=g[2],f=g[3],c=this.uint8ArrayToUint32Array_(x),i=c[0],t=c[1],r=c[2],h=c[3],a=new Int32Array(A),s=new Int32Array(a.length),d,o,u,v,S,L,P,F,_,B,U,N,k,w,W=this.networkToHostOrderSwap;p<a.length;){for(_=W(a[p]),B=W(a[p+1]),U=W(a[p+2]),N=W(a[p+3]),S=_^T[0],L=N^T[1],P=U^T[2],F=B^T[3],k=4,w=1;w<E;w++)d=n[S>>>24]^e[L>>16&255]^l[P>>8&255]^f[F&255]^T[k],o=n[L>>>24]^e[P>>16&255]^l[F>>8&255]^f[S&255]^T[k+1],u=n[P>>>24]^e[F>>16&255]^l[S>>8&255]^f[L&255]^T[k+2],v=n[F>>>24]^e[S>>16&255]^l[L>>8&255]^f[P&255]^T[k+3],S=d,L=o,P=u,F=v,k=k+4;d=m[S>>>24]<<24^m[L>>16&255]<<16^m[P>>8&255]<<8^m[F&255]^T[k],o=m[L>>>24]<<24^m[P>>16&255]<<16^m[F>>8&255]<<8^m[S&255]^T[k+1],u=m[P>>>24]<<24^m[F>>16&255]<<16^m[S>>8&255]<<8^m[L&255]^T[k+2],v=m[F>>>24]<<24^m[S>>16&255]<<16^m[L>>8&255]<<8^m[P&255]^T[k+3],s[p]=W(d^i),s[p+1]=W(v^t),s[p+2]=W(u^r),s[p+3]=W(o^h),i=_,t=B,r=U,h=N,p=p+4}return s.buffer},b}()},"./src/crypt/decrypter.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return p});var M=y("./src/crypt/aes-crypto.ts"),O=y("./src/crypt/fast-aes-key.ts"),D=y("./src/crypt/aes-decryptor.ts"),b=y("./src/utils/logger.ts"),R=y("./src/utils/mp4-tools.ts"),I=y("./src/utils/typed-array.ts"),A=16,p=function(){function x(T,m,g){var n=g===void 0?{}:g,e=n.removePKCS7Padding,l=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=T,this.config=m,this.removePKCS7Padding=l,l)try{var f=self.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var E=x.prototype;return E.destroy=function(){this.observer=null},E.isSync=function(){return this.config.enableSoftwareAES},E.flush=function(){var m=this.currentResult;if(!m){this.reset();return}var g=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?Object(D.removePadding)(g):g},E.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},E.decrypt=function(m,g,n,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(m),g,n);var l=this.flush();l&&e(l.buffer)}else this.webCryptoDecrypt(new Uint8Array(m),g,n).then(e)},E.softwareDecrypt=function(m,g,n){var e=this.currentIV,l=this.currentResult,f=this.remainderData;this.logOnce("JS AES decrypt"),f&&(m=Object(R.appendUint8Array)(f,m),this.remainderData=null);var c=this.getValidChunk(m);if(!c.length)return null;e&&(n=e);var i=this.softwareDecrypter;i||(i=this.softwareDecrypter=new D.default),i.expandKey(g);var t=l;return this.currentResult=i.decrypt(c.buffer,0,n),this.currentIV=Object(I.sliceUint8)(c,-16).buffer,t||null},E.webCryptoDecrypt=function(m,g,n){var e=this,l=this.subtle;return(this.key!==g||!this.fastAesKey)&&(this.key=g,this.fastAesKey=new O.default(l,g)),this.fastAesKey.expandKey().then(function(f){if(!l)return Promise.reject(new Error("web crypto not initialized"));var c=new M.default(l,n);return c.decrypt(m.buffer,f)}).catch(function(f){return e.onWebCryptoError(f,m,g,n)})},E.onWebCryptoError=function(m,g,n,e){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",m),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(g,n,e)},E.getValidChunk=function(m){var g=m,n=m.length-m.length%A;return n!==m.length&&(g=Object(I.sliceUint8)(m,0,n),this.remainderData=Object(I.sliceUint8)(m,n)),g},E.logOnce=function(m){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+m),this.logEnabled=!1)},x}()},"./src/crypt/fast-aes-key.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return M});var M=function(){function O(b,R){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=R}var D=O.prototype;return D.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(K,C,y){y.r(C);var M=y("./src/demux/base-audio-demuxer.ts"),O=y("./src/demux/adts.ts"),D=y("./src/utils/logger.ts"),b=y("./src/demux/id3.ts");function R(p,x){p.prototype=Object.create(x.prototype),p.prototype.constructor=p,I(p,x)}function I(p,x){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,m){return T.__proto__=m,T},I(p,x)}var A=function(p){R(x,p);function x(T,m){var g;return g=p.call(this)||this,g.observer=void 0,g.config=void 0,g.observer=T,g.config=m,g}var E=x.prototype;return E.resetInitSegment=function(m,g,n,e){p.prototype.resetInitSegment.call(this,m,g,n,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:g,duration:e,inputTimeScale:9e4,dropped:0}},x.probe=function(m){if(!m)return!1;for(var g=b.getID3Data(m,0)||[],n=g.length,e=m.length;n<e;n++)if(O.probe(m,n))return D.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(m,g){return O.canParse(m,g)},E.appendFrame=function(m,g,n){O.initTrackConfig(m,this.observer,g,n,m.manifestCodec);var e=O.appendFrame(m,g,n,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},x}(M.default);C.default=A},"./src/demux/adts.ts":function(K,C,y){y.r(C),y.d(C,"getAudioConfig",function(){return b}),y.d(C,"isHeaderPattern",function(){return R}),y.d(C,"getHeaderLength",function(){return I}),y.d(C,"getFullFrameLength",function(){return A}),y.d(C,"canGetFrameLength",function(){return p}),y.d(C,"isHeader",function(){return x}),y.d(C,"canParse",function(){return E}),y.d(C,"probe",function(){return T}),y.d(C,"initTrackConfig",function(){return m}),y.d(C,"getFrameDuration",function(){return g}),y.d(C,"parseFrameHeader",function(){return n}),y.d(C,"appendFrame",function(){return e});var M=y("./src/utils/logger.ts"),O=y("./src/errors.ts"),D=y("./src/events.ts");function b(l,f,c,i){var t,r,h,a,s=navigator.userAgent.toLowerCase(),d=i,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];t=((f[c+2]&192)>>>6)+1;var u=(f[c+2]&60)>>>2;if(u>o.length-1){l.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u});return}return h=(f[c+2]&1)<<2,h|=(f[c+3]&192)>>>6,M.logger.log("manifest codec:"+i+", ADTS type:"+t+", samplingIndex:"+u),/firefox/i.test(s)?u>=6?(t=5,a=new Array(4),r=u-3):(t=2,a=new Array(2),r=u):s.indexOf("android")!==-1?(t=2,a=new Array(2),r=u):(t=5,a=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&u>=6?r=u-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(u>=6&&h===1||/vivaldi/i.test(s))||!i&&h===1)&&(t=2,a=new Array(2)),r=u)),a[0]=t<<3,a[0]|=(u&14)>>1,a[1]|=(u&1)<<7,a[1]|=h<<3,t===5&&(a[1]|=(r&14)>>1,a[2]=(r&1)<<7,a[2]|=2<<2,a[3]=0),{config:a,samplerate:o[u],channelCount:h,codec:"mp4a.40."+t,manifestCodec:d}}function R(l,f){return l[f]===255&&(l[f+1]&246)===240}function I(l,f){return l[f+1]&1?7:9}function A(l,f){return(l[f+3]&3)<<11|l[f+4]<<3|(l[f+5]&224)>>>5}function p(l,f){return f+5<l.length}function x(l,f){return f+1<l.length&&R(l,f)}function E(l,f){return p(l,f)&&R(l,f)&&A(l,f)<=l.length-f}function T(l,f){if(x(l,f)){var c=I(l,f);if(f+c>=l.length)return!1;var i=A(l,f);if(i<=c)return!1;var t=f+i;return t===l.length||x(l,t)}return!1}function m(l,f,c,i,t){if(!l.samplerate){var r=b(f,c,i,t);if(!r)return;l.config=r.config,l.samplerate=r.samplerate,l.channelCount=r.channelCount,l.codec=r.codec,l.manifestCodec=r.manifestCodec,M.logger.log("parsed codec:"+l.codec+", rate:"+r.samplerate+", channels:"+r.channelCount)}}function g(l){return 1024*9e4/l}function n(l,f){var c=I(l,f);if(f+c<=l.length){var i=A(l,f)-c;if(i>0)return{headerLength:c,frameLength:i}}}function e(l,f,c,i,t){var r=g(l.samplerate),h=i+t*r,a=n(f,c),s;if(a){var d=a.frameLength,o=a.headerLength,u=o+d,v=Math.max(0,c+u-f.length);v?(s=new Uint8Array(u-o),s.set(f.subarray(c+o,f.length),0)):s=f.subarray(c+o,c+u);var S={unit:s,pts:h};return v||l.samples.push(S),{sample:S,length:u,missing:v}}var L=f.length-c;s=new Uint8Array(L),s.set(f.subarray(c,f.length),0);var P={unit:s,pts:h};return{sample:P,length:L,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(K,C,y){y.r(C),y.d(C,"initPTSFn",function(){return p});var M=y("./src/polyfills/number.ts"),O=y("./src/demux/id3.ts"),D=y("./src/types/demuxer.ts"),b=y("./src/demux/dummy-demuxed-track.ts"),R=y("./src/utils/mp4-tools.ts"),I=y("./src/utils/typed-array.ts"),A=function(){function x(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var E=x.prototype;return E.resetInitSegment=function(m,g,n,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},E.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},E.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},E.canParse=function(m,g){return!1},E.appendFrame=function(m,g,n){},E.demux=function(m,g){this.cachedData&&(m=Object(R.appendUint8Array)(this.cachedData,m),this.cachedData=null);var n=O.getID3Data(m,0),e=n?n.length:0,l,f,c=this._audioTrack,i=this._id3Track,t=n?O.getTimeStamp(n):void 0,r=m.length;for((this.basePTS===null||this.frameIndex===0&&Object(M.isFiniteNumber)(t))&&(this.basePTS=p(t,g,this.initPTS)),n&&n.length>0&&i.samples.push({pts:this.basePTS,dts:this.basePTS,data:n,type:D.MetadataSchema.audioId3}),f=this.basePTS;e<r;){if(this.canParse(m,e)){var h=this.appendFrame(c,m,e);h?(this.frameIndex++,f=h.sample.pts,e+=h.length,l=e):e=r}else O.canParse(m,e)?(n=O.getID3Data(m,e),i.samples.push({pts:f,dts:f,data:n,type:D.MetadataSchema.audioId3}),e+=n.length,l=e):e++;if(e===r&&l!==r){var a=Object(I.sliceUint8)(m,l);this.cachedData?this.cachedData=Object(R.appendUint8Array)(this.cachedData,a):this.cachedData=a}}return{audioTrack:c,videoTrack:Object(b.dummyTrack)(),id3Track:i,textTrack:Object(b.dummyTrack)()}},E.demuxSampleAes=function(m,g,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},E.flush=function(m){var g=this.cachedData;return g&&(this.cachedData=null,this.demux(g,0)),{audioTrack:this._audioTrack,videoTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},E.destroy=function(){},x}(),p=function(E,T,m){return Object(M.isFiniteNumber)(E)?E*90:T*9e4+(m||0)};C.default=A},"./src/demux/chunk-cache.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return M});var M=function(){function D(){this.chunks=[],this.dataLength=0}var b=D.prototype;return b.push=function(I){this.chunks.push(I),this.dataLength+=I.length},b.flush=function(){var I=this.chunks,A=this.dataLength,p;if(I.length)I.length===1?p=I[0]:p=O(I,A);else return new Uint8Array(0);return this.reset(),p},b.reset=function(){this.chunks.length=0,this.dataLength=0},D}();function O(D,b){for(var R=new Uint8Array(b),I=0,A=0;A<D.length;A++){var p=D[A];R.set(p,I),I+=p.length}return R}},"./src/demux/dummy-demuxed-track.ts":function(K,C,y){y.r(C),y.d(C,"dummyTrack",function(){return M});function M(O,D){return O===void 0&&(O=""),D===void 0&&(D=9e4),{type:O,id:-1,pid:-1,inputTimeScale:D,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(K,C,y){y.r(C);var M=y("./src/utils/logger.ts"),O=function(){function D(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var b=D.prototype;return b.loadWord=function(){var I=this.data,A=this.bytesAvailable,p=I.byteLength-A,x=new Uint8Array(4),E=Math.min(4,A);if(E===0)throw new Error("no bytes available");x.set(I.subarray(p,p+E)),this.word=new DataView(x.buffer).getUint32(0),this.bitsAvailable=E*8,this.bytesAvailable-=E},b.skipBits=function(I){var A;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,A=I>>3,I-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},b.readBits=function(I){var A=Math.min(this.bitsAvailable,I),p=this.word>>>32-A;return I>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=I-A,A>0&&this.bitsAvailable?p<<A|this.readBits(A):p},b.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!==0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},b.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(I){for(var A=8,p=8,x,E=0;E<I;E++)p!==0&&(x=this.readEG(),p=(A+x+256)%256),A=p===0?A:p},b.readSPS=function(){var I=0,A=0,p=0,x=0,E,T,m,g=this.readUByte.bind(this),n=this.readBits.bind(this),e=this.readUEG.bind(this),l=this.readBoolean.bind(this),f=this.skipBits.bind(this),c=this.skipEG.bind(this),i=this.skipUEG.bind(this),t=this.skipScalingList.bind(this);g();var r=g();if(n(5),f(3),g(),i(),r===100||r===110||r===122||r===244||r===44||r===83||r===86||r===118||r===128){var h=e();if(h===3&&f(1),i(),i(),f(1),l())for(T=h!==3?8:12,m=0;m<T;m++)l()&&(m<6?t(16):t(64))}i();var a=e();if(a===0)e();else if(a===1)for(f(1),c(),c(),E=e(),m=0;m<E;m++)c();i(),f(1);var s=e(),d=e(),o=n(1);o===0&&f(1),f(1),l()&&(I=e(),A=e(),p=e(),x=e());var u=[1,1];if(l()&&l()){var v=g();switch(v){case 1:u=[1,1];break;case 2:u=[12,11];break;case 3:u=[10,11];break;case 4:u=[16,11];break;case 5:u=[40,33];break;case 6:u=[24,11];break;case 7:u=[20,11];break;case 8:u=[32,11];break;case 9:u=[80,33];break;case 10:u=[18,11];break;case 11:u=[15,11];break;case 12:u=[64,33];break;case 13:u=[160,99];break;case 14:u=[4,3];break;case 15:u=[3,2];break;case 16:u=[2,1];break;case 255:{u=[g()<<8|g(),g()<<8|g()];break}}}return{width:Math.ceil((s+1)*16-I*2-A*2),height:(2-o)*(d+1)*16-(o?2:4)*(p+x),pixelRatio:u}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},D}();C.default=O},"./src/demux/id3.ts":function(K,C,y){y.r(C),y.d(C,"isHeader",function(){return M}),y.d(C,"isFooter",function(){return O}),y.d(C,"getID3Data",function(){return D}),y.d(C,"canParse",function(){return R}),y.d(C,"getTimeStamp",function(){return I}),y.d(C,"isTimeStampFrame",function(){return A}),y.d(C,"getID3Frames",function(){return x}),y.d(C,"decodeFrame",function(){return E}),y.d(C,"utf8ArrayToStr",function(){return e}),y.d(C,"testables",function(){return l});var M=function(t,r){return r+10<=t.length&&t[r]===73&&t[r+1]===68&&t[r+2]===51&&t[r+3]<255&&t[r+4]<255&&t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128},O=function(t,r){return r+10<=t.length&&t[r]===51&&t[r+1]===68&&t[r+2]===73&&t[r+3]<255&&t[r+4]<255&&t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128},D=function(t,r){for(var h=r,a=0;M(t,r);){a+=10;var s=b(t,r+6);a+=s,O(t,r+10)&&(a+=10),r+=a}if(a>0)return t.subarray(h,h+a)},b=function(t,r){var h=0;return h=(t[r]&127)<<21,h|=(t[r+1]&127)<<14,h|=(t[r+2]&127)<<7,h|=t[r+3]&127,h},R=function(t,r){return M(t,r)&&b(t,r+6)+10<=t.length-r},I=function(t){for(var r=x(t),h=0;h<r.length;h++){var a=r[h];if(A(a))return n(a)}},A=function(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"},p=function(t){var r=String.fromCharCode(t[0],t[1],t[2],t[3]),h=b(t,4),a=10;return{type:r,size:h,data:t.subarray(a,a+h)}},x=function(t){for(var r=0,h=[];M(t,r);){var a=b(t,r+6);r+=10;for(var s=r+a;r+8<s;){var d=p(t.subarray(r)),o=E(d);o&&h.push(o),r+=d.size+10}O(t,r)&&(r+=10)}return h},E=function(t){return t.type==="PRIV"?T(t):t.type[0]==="W"?g(t):m(t)},T=function(t){if(!(t.size<2)){var r=e(t.data,!0),h=new Uint8Array(t.data.subarray(r.length+1));return{key:t.type,info:r,data:h.buffer}}},m=function(t){if(!(t.size<2)){if(t.type==="TXXX"){var r=1,h=e(t.data.subarray(r),!0);r+=h.length+1;var a=e(t.data.subarray(r));return{key:t.type,info:h,data:a}}var s=e(t.data.subarray(1));return{key:t.type,data:s}}},g=function(t){if(t.type==="WXXX"){if(t.size<2)return;var r=1,h=e(t.data.subarray(r),!0);r+=h.length+1;var a=e(t.data.subarray(r));return{key:t.type,info:h,data:a}}var s=e(t.data);return{key:t.type,data:s}},n=function(t){if(t.data.byteLength===8){var r=new Uint8Array(t.data),h=r[3]&1,a=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return a/=45,h&&(a+=4772185884e-2),Math.round(a)}},e=function(t,r){r===void 0&&(r=!1);var h=c();if(h){var a=h.decode(t);if(r){var s=a.indexOf("\0");return s!==-1?a.substring(0,s):a}return a.replace(/\0/g,"")}for(var d=t.length,o,u,v,S="",L=0;L<d;){if(o=t[L++],o===0&&r)return S;if(o===0||o===3)continue;switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(o);break;case 12:case 13:u=t[L++],S+=String.fromCharCode((o&31)<<6|u&63);break;case 14:u=t[L++],v=t[L++],S+=String.fromCharCode((o&15)<<12|(u&63)<<6|(v&63)<<0);break}}return S},l={decodeTextFrame:m},f;function c(){return!f&&typeof self.TextDecoder<"u"&&(f=new self.TextDecoder("utf-8")),f}},"./src/demux/mp3demuxer.ts":function(K,C,y){y.r(C);var M=y("./src/demux/base-audio-demuxer.ts"),O=y("./src/demux/id3.ts"),D=y("./src/utils/logger.ts"),b=y("./src/demux/mpegaudio.ts");function R(p,x){p.prototype=Object.create(x.prototype),p.prototype.constructor=p,I(p,x)}function I(p,x){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,m){return T.__proto__=m,T},I(p,x)}var A=function(p){R(x,p);function x(){return p.apply(this,arguments)||this}var E=x.prototype;return E.resetInitSegment=function(m,g,n,e){p.prototype.resetInitSegment.call(this,m,g,n,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:g,duration:e,inputTimeScale:9e4,dropped:0}},x.probe=function(m){if(!m)return!1;for(var g=O.getID3Data(m,0)||[],n=g.length,e=m.length;n<e;n++)if(b.probe(m,n))return D.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(m,g){return b.canParse(m,g)},E.appendFrame=function(m,g,n){if(this.basePTS!==null)return b.appendFrame(m,g,n,this.basePTS,this.frameIndex)},x}(M.default);C.default=A},"./src/demux/mp4demuxer.ts":function(K,C,y){y.r(C);var M=y("./src/polyfills/number.ts"),O=y("./src/types/demuxer.ts"),D=y("./src/utils/mp4-tools.ts"),b=y("./src/demux/dummy-demuxed-track.ts"),R=/\/emsg[-/]ID3/i,I=function(){function A(x,E){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=E}var p=A.prototype;return p.resetTimeStamp=function(){},p.resetInitSegment=function(E,T,m,g){var n=Object(D.parseInitSegment)(E),e=this.videoTrack=Object(b.dummyTrack)("video",1),l=this.audioTrack=Object(b.dummyTrack)("audio",1),f=this.txtTrack=Object(b.dummyTrack)("text",1);if(this.id3Track=Object(b.dummyTrack)("id3",1),this.timeOffset=0,n.video){var c=n.video,i=c.id,t=c.timescale,r=c.codec;e.id=i,e.timescale=f.timescale=t,e.codec=r}if(n.audio){var h=n.audio,a=h.id,s=h.timescale,d=h.codec;l.id=a,l.timescale=s,l.codec=d}f.id=D.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=l.duration=g},p.resetContiguity=function(){},A.probe=function(E){return E=E.length>16384?E.subarray(0,16384):E,Object(D.findBox)(E,["moof"]).length>0},p.demux=function(E,T){this.timeOffset=T;var m=E,g=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=Object(D.appendUint8Array)(this.remainderData,E));var e=Object(D.segmentValidRange)(m);this.remainderData=e.remainder,g.samples=e.valid||new Uint8Array}else g.samples=m;var l=this.extractID3Track(g,T);return n.samples=Object(D.parseSamples)(T,g),{videoTrack:g,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},p.flush=function(){var E=this.timeOffset,T=this.videoTrack,m=this.txtTrack;T.samples=this.remainderData||new Uint8Array,this.remainderData=null;var g=this.extractID3Track(T,this.timeOffset);return m.samples=Object(D.parseSamples)(E,T),{videoTrack:T,audioTrack:Object(b.dummyTrack)(),id3Track:g,textTrack:Object(b.dummyTrack)()}},p.extractID3Track=function(E,T){var m=this.id3Track;if(E.samples.length){var g=Object(D.findBox)(E.samples,["emsg"]);g&&g.forEach(function(n){var e=Object(D.parseEmsg)(n);if(R.test(e.schemeIdUri)){var l=Object(M.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:T+e.presentationTimeDelta/e.timeScale,f=e.payload;m.samples.push({data:f,len:f.byteLength,dts:l,pts:l,type:O.MetadataSchema.emsg})}})}return m},p.demuxSampleAes=function(E,T,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},p.destroy=function(){},A}();C.default=I},"./src/demux/mpegaudio.ts":function(K,C,y){y.r(C),y.d(C,"appendFrame",function(){return I}),y.d(C,"parseHeader",function(){return A}),y.d(C,"isHeaderPattern",function(){return p}),y.d(C,"isHeader",function(){return x}),y.d(C,"canParse",function(){return E}),y.d(C,"probe",function(){return T});var M=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],D=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function I(m,g,n,e,l){if(!(n+24>g.length)){var f=A(g,n);if(f&&n+f.frameLength<=g.length){var c=f.samplesPerFrame*9e4/f.sampleRate,i=e+l*c,t={unit:g.subarray(n,n+f.frameLength),pts:i,dts:i};return m.config=[],m.channelCount=f.channelCount,m.samplerate=f.sampleRate,m.samples.push(t),{sample:t,length:f.frameLength,missing:0}}}}function A(m,g){var n=m[g+1]>>3&3,e=m[g+1]>>1&3,l=m[g+2]>>4&15,f=m[g+2]>>2&3;if(n!==1&&l!==0&&l!==15&&f!==3){var c=m[g+2]>>1&1,i=m[g+3]>>6,t=n===3?3-e:e===3?3:4,r=O[t*14+l-1]*1e3,h=n===3?0:n===2?1:2,a=D[h*3+f],s=i===3?1:2,d=b[n][e],o=R[e],u=d*8*o,v=Math.floor(d*r/a+c)*o;if(M===null){var S=navigator.userAgent||"",L=S.match(/Chrome\/(\d+)/i);M=L?parseInt(L[1]):0}var P=!!M&&M<=87;return P&&e===2&&r>=224e3&&i===0&&(m[g+3]=m[g+3]|128),{sampleRate:a,channelCount:s,frameLength:v,samplesPerFrame:u}}}function p(m,g){return m[g]===255&&(m[g+1]&224)===224&&(m[g+1]&6)!==0}function x(m,g){return g+1<m.length&&p(m,g)}function E(m,g){var n=4;return p(m,g)&&n<=m.length-g}function T(m,g){if(g+1<m.length&&p(m,g)){var n=4,e=A(m,g),l=n;e!=null&&e.frameLength&&(l=e.frameLength);var f=g+l;return f===m.length||x(m,f)}return!1}},"./src/demux/sample-aes.ts":function(K,C,y){y.r(C);var M=y("./src/crypt/decrypter.ts"),O=y("./src/demux/tsdemuxer.ts"),D=function(){function b(I,A,p){this.keyData=void 0,this.decrypter=void 0,this.keyData=p,this.decrypter=new M.default(I,A,{removePKCS7Padding:!1})}var R=b.prototype;return R.decryptBuffer=function(A,p){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,p)},R.decryptAacSample=function(A,p,x,E){var T=A[p].unit;if(!(T.length<=16)){var m=T.subarray(16,T.length-T.length%16),g=m.buffer.slice(m.byteOffset,m.byteOffset+m.length),n=this;this.decryptBuffer(g,function(e){var l=new Uint8Array(e);T.set(l,16),E||n.decryptAacSamples(A,p+1,x)})}},R.decryptAacSamples=function(A,p,x){for(;;p++){if(p>=A.length){x();return}if(!(A[p].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(A,p,x,E),!E)return}}},R.getAvcEncryptedData=function(A){for(var p=Math.floor((A.length-48)/160)*16+16,x=new Int8Array(p),E=0,T=32;T<A.length-16;T+=160,E+=16)x.set(A.subarray(T,T+16),E);return x},R.getAvcDecryptedUnit=function(A,p){for(var x=new Uint8Array(p),E=0,T=32;T<A.length-16;T+=160,E+=16)A.set(x.subarray(E,E+16),T);return A},R.decryptAvcSample=function(A,p,x,E,T,m){var g=Object(O.discardEPB)(T.data),n=this.getAvcEncryptedData(g),e=this;this.decryptBuffer(n.buffer,function(l){T.data=e.getAvcDecryptedUnit(g,l),m||e.decryptAvcSamples(A,p,x+1,E)})},R.decryptAvcSamples=function(A,p,x,E){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;p++,x=0){if(p>=A.length){E();return}for(var T=A[p].units;!(x>=T.length);x++){var m=T[x];if(!(m.data.length<=48||m.type!==1&&m.type!==5)){var g=this.decrypter.isSync();if(this.decryptAvcSample(A,p,x,E,m,g),!g)return}}}},b}();C.default=D},"./src/demux/transmuxer-interface.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return x});var M=y("./node_modules/webworkify-webpack/index.js"),O=y("./src/events.ts"),D=y("./src/demux/transmuxer.ts"),b=y("./src/utils/logger.ts"),R=y("./src/errors.ts"),I=y("./src/utils/mediasource-helper.ts"),A=y("./node_modules/eventemitter3/index.js"),p=Object(I.getMediaSource)()||{isTypeSupported:function(){return!1}},x=function(){function E(m,g,n,e){var l=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=m,this.id=g,this.onTransmuxComplete=n,this.onFlush=e;var f=m.config,c=function(a,s){s=s||{},s.frag=l.frag,s.id=l.id,m.trigger(a,s)};this.observer=new A.EventEmitter,this.observer.on(O.Events.FRAG_DECRYPTED,c),this.observer.on(O.Events.ERROR,c);var i={mp4:p.isTypeSupported("video/mp4"),mpeg:p.isTypeSupported("audio/mpeg"),mp3:p.isTypeSupported('audio/mp4; codecs="mp3"')},t=navigator.vendor;if(f.enableWorker&&typeof Worker<"u"){b.logger.log("demuxing in webworker");var r;try{r=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),r.addEventListener("message",this.onwmsg),r.onerror=function(h){m.trigger(O.Events.ERROR,{type:R.ErrorTypes.OTHER_ERROR,details:R.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(h.message+"  ("+h.filename+":"+h.lineno+")")})},r.postMessage({cmd:"init",typeSupported:i,vendor:t,id:g,config:JSON.stringify(f)})}catch(h){b.logger.warn("Error in worker:",h),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),r&&self.URL.revokeObjectURL(r.objectURL),this.transmuxer=new D.default(this.observer,i,f,t,g),this.worker=null}}else this.transmuxer=new D.default(this.observer,i,f,t,g)}var T=E.prototype;return T.destroy=function(){var g=this.worker;if(g)g.removeEventListener("message",this.onwmsg),g.terminate(),this.worker=null,this.onwmsg=void 0;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},T.push=function(g,n,e,l,f,c,i,t,r,h){var a,s,d=this;r.transmuxing.start=self.performance.now();var o=this.transmuxer,u=this.worker,v=c?c.start:f.start,S=f.decryptdata,L=this.frag,P=!(L&&f.cc===L.cc),F=!(L&&r.level===L.level),_=L?r.sn-L.sn:-1,B=this.part?r.part-this.part.index:-1,U=_===0&&r.id>1&&r.id===(L==null?void 0:L.stats.chunkCount),N=!F&&(_===1||_===0&&(B===1||U&&B<=0)),k=self.performance.now();(F||_||f.stats.parsing.start===0)&&(f.stats.parsing.start=k),c&&(B||!N)&&(c.stats.parsing.start=k);var w=!(L&&((a=f.initSegment)===null||a===void 0?void 0:a.url)===((s=L.initSegment)===null||s===void 0?void 0:s.url)),W=new D.TransmuxState(P,N,t,F,v,w);if(!N||P||w){b.logger.log("[transmuxer-interface, "+f.type+"]: Starting new transmux session for sn: "+r.sn+" p: "+r.part+" level: "+r.level+" id: "+r.id+`
        discontinuity: `+P+`
        trackSwitch: `+F+`
        contiguous: `+N+`
        accurateTimeOffset: `+t+`
        timeOffset: `+v+`
        initSegmentChange: `+w);var G=new D.TransmuxConfig(e,l,n,i,h);this.configureTransmuxer(G)}if(this.frag=f,this.part=c,u)u.postMessage({cmd:"demux",data:g,decryptdata:S,chunkMeta:r,state:W},g instanceof ArrayBuffer?[g]:[]);else if(o){var j=o.push(g,S,r,W);Object(D.isPromise)(j)?j.then(function(Y){d.handleTransmuxComplete(Y)}):this.handleTransmuxComplete(j)}},T.flush=function(g){var n=this;g.transmuxing.start=self.performance.now();var e=this.transmuxer,l=this.worker;if(l)l.postMessage({cmd:"flush",chunkMeta:g});else if(e){var f=e.flush(g);Object(D.isPromise)(f)?f.then(function(c){n.handleFlushResult(c,g)}):this.handleFlushResult(f,g)}},T.handleFlushResult=function(g,n){var e=this;g.forEach(function(l){e.handleTransmuxComplete(l)}),this.onFlush(n)},T.onWorkerMessage=function(g){var n=g.data,e=this.hls;switch(n.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(n.data);break}case"flush":{this.onFlush(n.data);break}case"workerLog":b.logger[n.data.logType]&&b.logger[n.data.logType](n.data.message);break;default:{n.data=n.data||{},n.data.frag=this.frag,n.data.id=this.id,e.trigger(n.event,n.data);break}}},T.configureTransmuxer=function(g){var n=this.worker,e=this.transmuxer;n?n.postMessage({cmd:"configure",config:g}):e&&e.configure(g)},T.handleTransmuxComplete=function(g){g.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(g)},E}()},"./src/demux/transmuxer-worker.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return R});var M=y("./src/demux/transmuxer.ts"),O=y("./src/events.ts"),D=y("./src/utils/logger.ts"),b=y("./node_modules/eventemitter3/index.js");function R(E){var T=new b.EventEmitter,m=function(e,l){E.postMessage({event:e,data:l})};T.on(O.Events.FRAG_DECRYPTED,m),T.on(O.Events.ERROR,m);var g=function(){var e=function(c){var i=function(r){m("workerLog",{logType:c,message:r})};D.logger[c]=i};for(var l in D.logger)e(l)};E.addEventListener("message",function(n){var e=n.data;switch(e.cmd){case"init":{var l=JSON.parse(e.config);E.transmuxer=new M.default(T,e.typeSupported,l,e.vendor,e.id),Object(D.enableLogs)(l.debug),g(),m("init",null);break}case"configure":{E.transmuxer.configure(e.config);break}case"demux":{var f=E.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(M.isPromise)(f)?f.then(function(t){I(E,t)}):I(E,f);break}case"flush":{var c=e.chunkMeta,i=E.transmuxer.flush(c);Object(M.isPromise)(i)?i.then(function(t){p(E,t,c)}):p(E,i,c);break}}})}function I(E,T){if(x(T.remuxResult))return!1;var m=[],g=T.remuxResult,n=g.audio,e=g.video;return n&&A(m,n),e&&A(m,e),E.postMessage({event:"transmuxComplete",data:T},m),!0}function A(E,T){T.data1&&E.push(T.data1.buffer),T.data2&&E.push(T.data2.buffer)}function p(E,T,m){var g=T.reduce(function(n,e){return I(E,e)||n},!1);g||E.postMessage({event:"transmuxComplete",data:T[0]}),E.postMessage({event:"flush",data:m})}function x(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return g}),y.d(C,"isPromise",function(){return l}),y.d(C,"TransmuxConfig",function(){return f}),y.d(C,"TransmuxState",function(){return c});var M=y("./src/events.ts"),O=y("./src/errors.ts"),D=y("./src/crypt/decrypter.ts"),b=y("./src/demux/aacdemuxer.ts"),R=y("./src/demux/mp4demuxer.ts"),I=y("./src/demux/tsdemuxer.ts"),A=y("./src/demux/mp3demuxer.ts"),p=y("./src/remux/mp4-remuxer.ts"),x=y("./src/remux/passthrough-remuxer.ts"),E=y("./src/utils/logger.ts"),T;try{T=self.performance.now.bind(self.performance)}catch{E.logger.debug("Unable to use Performance API on this environment"),T=self.Date.now}var m=[{demux:I.default,remux:p.default},{demux:R.default,remux:x.default},{demux:b.default,remux:p.default},{demux:A.default,remux:p.default}],g=function(){function i(r,h,a,s,d){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=r,this.typeSupported=h,this.config=a,this.vendor=s,this.id=d}var t=i.prototype;return t.configure=function(h){this.transmuxConfig=h,this.decrypter&&this.decrypter.reset()},t.push=function(h,a,s,d){var o=this,u=s.transmuxing;u.executeStart=T();var v=new Uint8Array(h),S=this.config,L=this.currentTransmuxState,P=this.transmuxConfig;d&&(this.currentTransmuxState=d);var F=d||L,_=F.contiguous,B=F.discontinuity,U=F.trackSwitch,N=F.accurateTimeOffset,k=F.timeOffset,w=F.initSegmentChange,W=P.audioCodec,G=P.videoCodec,j=P.defaultInitPts,Y=P.duration,J=P.initSegmentData;(B||U||w)&&this.resetInitSegment(J,W,G,Y),(B||w)&&this.resetInitialTimestamp(j),_||this.resetContiguity();var Z=n(v,a);if(Z&&Z.method==="AES-128"){var H=this.getDecrypter();if(S.enableSoftwareAES){var q=H.softwareDecrypt(v,Z.key.buffer,Z.iv.buffer);if(!q)return u.executeEnd=T(),e(s);v=new Uint8Array(q)}else return this.decryptionPromise=H.webCryptoDecrypt(v,Z.key.buffer,Z.iv.buffer).then(function(ne){var re=o.push(ne,null,s);return o.decryptionPromise=null,re}),this.decryptionPromise}this.needsProbing(v,B,U)&&this.configureTransmuxer(v,P);var Q=this.transmux(v,Z,k,N,s),$=this.currentTransmuxState;return $.contiguous=!0,$.discontinuity=!1,$.trackSwitch=!1,u.executeEnd=T(),Q},t.flush=function(h){var a=this,s=h.transmuxing;s.executeStart=T();var d=this.decrypter,o=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then(function(){return a.flush(h)});var v=[],S=o.timeOffset;if(d){var L=d.flush();L&&v.push(this.push(L,null,h))}var P=this.demuxer,F=this.remuxer;if(!P||!F)return this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=T(),[e(h)];var _=P.flush(S);return l(_)?_.then(function(B){return a.flushRemux(v,B,h),v}):(this.flushRemux(v,_,h),v)},t.flushRemux=function(h,a,s){var d=a.audioTrack,o=a.videoTrack,u=a.id3Track,v=a.textTrack,S=this.currentTransmuxState,L=S.accurateTimeOffset,P=S.timeOffset;E.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var F=this.remuxer.remux(d,o,u,v,P,L,!0,this.id);h.push({remuxResult:F,chunkMeta:s}),s.transmuxing.executeEnd=T()},t.resetInitialTimestamp=function(h){var a=this.demuxer,s=this.remuxer;!a||!s||(a.resetTimeStamp(h),s.resetTimeStamp(h))},t.resetContiguity=function(){var h=this.demuxer,a=this.remuxer;!h||!a||(h.resetContiguity(),a.resetNextTimestamp())},t.resetInitSegment=function(h,a,s,d){var o=this.demuxer,u=this.remuxer;!o||!u||(o.resetInitSegment(h,a,s,d),u.resetInitSegment(h,a,s))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(h,a,s,d,o){var u;return a&&a.method==="SAMPLE-AES"?u=this.transmuxSampleAes(h,a,s,d,o):u=this.transmuxUnencrypted(h,s,d,o),u},t.transmuxUnencrypted=function(h,a,s,d){var o=this.demuxer.demux(h,a,!1,!this.config.progressive),u=o.audioTrack,v=o.videoTrack,S=o.id3Track,L=o.textTrack,P=this.remuxer.remux(u,v,S,L,a,s,!1,this.id);return{remuxResult:P,chunkMeta:d}},t.transmuxSampleAes=function(h,a,s,d,o){var u=this;return this.demuxer.demuxSampleAes(h,a,s).then(function(v){var S=u.remuxer.remux(v.audioTrack,v.videoTrack,v.id3Track,v.textTrack,s,d,!1,u.id);return{remuxResult:S,chunkMeta:o}})},t.configureTransmuxer=function(h,a){for(var s=this.config,d=this.observer,o=this.typeSupported,u=this.vendor,v=a.audioCodec,S=a.defaultInitPts,L=a.duration,P=a.initSegmentData,F=a.videoCodec,_,B=0,U=m.length;B<U;B++)if(m[B].demux.probe(h)){_=m[B];break}_||(E.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),_={demux:R.default,remux:x.default});var N=this.demuxer,k=this.remuxer,w=_.remux,W=_.demux;(!k||!(k instanceof w))&&(this.remuxer=new w(d,s,o,u)),(!N||!(N instanceof W))&&(this.demuxer=new W(d,s,o),this.probe=W.probe),this.resetInitSegment(P,v,F,L),this.resetInitialTimestamp(S)},t.needsProbing=function(h,a,s){return!this.demuxer||!this.remuxer||a||s},t.getDecrypter=function(){var h=this.decrypter;return h||(h=this.decrypter=new D.default(this.observer,this.config)),h},i}();function n(i,t){var r=null;return i.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(r=t),r}var e=function(t){return{remuxResult:{},chunkMeta:t}};function l(i){return"then"in i&&i.then instanceof Function}var f=function(t,r,h,a,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=r,this.initSegmentData=h,this.duration=a,this.defaultInitPts=s},c=function(t,r,h,a,s,d){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=r,this.accurateTimeOffset=h,this.trackSwitch=a,this.timeOffset=s,this.initSegmentChange=d}},"./src/demux/tsdemuxer.ts":function(K,C,y){y.r(C),y.d(C,"discardEPB",function(){return f});var M=y("./src/demux/adts.ts"),O=y("./src/demux/mpegaudio.ts"),D=y("./src/demux/exp-golomb.ts"),b=y("./src/demux/sample-aes.ts"),R=y("./src/events.ts"),I=y("./src/utils/mp4-tools.ts"),A=y("./src/utils/logger.ts"),p=y("./src/errors.ts"),x=y("./src/types/demuxer.ts");function E(){return E=Object.assign?Object.assign.bind():function(c){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(c[r]=t[r])}return c},E.apply(this,arguments)}var T=function(){function c(t,r,h){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=r,this.typeSupported=h}c.probe=function(r){return r[0]===71&&r[188]===71},c.createTrack=function(r,h){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:I.RemuxerTrackIdConfig[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?h:void 0}};var i=c.prototype;return i.resetInitSegment=function(r,h,a,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=c.createTrack("video"),this._audioTrack=c.createTrack("audio",s),this._id3Track=c.createTrack("id3"),this._txtTrack=c.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=h,this.videoCodec=a,this._duration=s},i.resetTimeStamp=function(){},i.resetContiguity=function(){var r=this._audioTrack,h=this._avcTrack,a=this._id3Track;r&&(r.pesData=null),h&&(h.pesData=null),a&&(a.pesData=null),this.aacOverFlow=null},i.demux=function(r,h,a,s){a===void 0&&(a=!1),s===void 0&&(s=!1),a||(this.sampleAes=null);var d,o=this._avcTrack,u=this._audioTrack,v=this._id3Track,S=this._txtTrack,L=o.pid,P=o.pesData,F=u.pid,_=v.pid,B=u.pesData,U=v.pesData,N=null,k=this.pmtParsed,w=this._pmtId,W=r.length;if(this.remainderData&&(r=Object(I.appendUint8Array)(this.remainderData,r),W=r.length,this.remainderData=null),W<188&&!s)return this.remainderData=r,{audioTrack:u,videoTrack:o,id3Track:v,textTrack:S};W-=W%188,W<r.byteLength&&!s&&(this.remainderData=new Uint8Array(r.buffer,W,r.buffer.byteLength-W));for(var G=0,j=0;j<W;j+=188)if(r[j]===71){var Y=!!(r[j+1]&64),J=((r[j+1]&31)<<8)+r[j+2],Z=(r[j+3]&48)>>4,H=void 0;if(Z>1){if(H=j+5+r[j+4],H===j+188)continue}else H=j+4;switch(J){case L:Y&&(P&&(d=e(P))&&this.parseAVCPES(o,S,d,!1),P={data:[],size:0}),P&&(P.data.push(r.subarray(H,j+188)),P.size+=j+188-H);break;case F:if(Y){if(B&&(d=e(B)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,d);break;case"mp3":this.parseMPEGPES(u,d);break}B={data:[],size:0}}B&&(B.data.push(r.subarray(H,j+188)),B.size+=j+188-H);break;case _:Y&&(U&&(d=e(U))&&this.parseID3PES(v,d),U={data:[],size:0}),U&&(U.data.push(r.subarray(H,j+188)),U.size+=j+188-H);break;case 0:Y&&(H+=r[H]+1),w=this._pmtId=g(r,H);break;case w:{Y&&(H+=r[H]+1);var q=n(r,H,this.typeSupported,a);L=q.avc,L>0&&(o.pid=L),F=q.audio,F>0&&(u.pid=F,u.segmentCodec=q.segmentCodec),_=q.id3,_>0&&(v.pid=_),N!==null&&!k&&(A.logger.log("unknown PID '"+N+"' in TS found"),N=null),k=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=J;break}}else G++;G>0&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+G+" TS packet/s that do not start with 0x47"}),o.pesData=P,u.pesData=B,v.pesData=U;var Q={audioTrack:u,videoTrack:o,id3Track:v,textTrack:S};return s&&this.extractRemainingSamples(Q),Q},i.flush=function(){var r=this.remainderData;this.remainderData=null;var h;return r?h=this.demux(r,-1,!1,!0):h={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(h),this.sampleAes?this.decrypt(h,this.sampleAes):h},i.extractRemainingSamples=function(r){var h=r.audioTrack,a=r.videoTrack,s=r.id3Track,d=r.textTrack,o=a.pesData,u=h.pesData,v=s.pesData,S;if(o&&(S=e(o))?(this.parseAVCPES(a,d,S,!0),a.pesData=null):a.pesData=o,u&&(S=e(u))){switch(h.segmentCodec){case"aac":this.parseAACPES(h,S);break;case"mp3":this.parseMPEGPES(h,S);break}h.pesData=null}else u!=null&&u.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=u;v&&(S=e(v))?(this.parseID3PES(s,S),s.pesData=null):s.pesData=v},i.demuxSampleAes=function(r,h,a){var s=this.demux(r,a,!0,!this.config.progressive),d=this.sampleAes=new b.default(this.observer,this.config,h);return this.decrypt(s,d)},i.decrypt=function(r,h){return new Promise(function(a){var s=r.audioTrack,d=r.videoTrack;s.samples&&s.segmentCodec==="aac"?h.decryptAacSamples(s.samples,0,function(){d.samples?h.decryptAvcSamples(d.samples,0,0,function(){a(r)}):a(r)}):d.samples&&h.decryptAvcSamples(d.samples,0,0,function(){a(r)})})},i.destroy=function(){this._duration=0},i.parseAVCPES=function(r,h,a,s){var d=this,o=this.parseAVCNALu(r,a.data),u=this.avcSample,v,S=!1;a.data=null,u&&o.length&&!r.audFound&&(l(u,r),u=this.avcSample=m(!1,a.pts,a.dts,"")),o.forEach(function(L){switch(L.type){case 1:{v=!0,u||(u=d.avcSample=m(!0,a.pts,a.dts,"")),u.frame=!0;var P=L.data;if(S&&P.length>4){var F=new D.default(P).readSliceType();(F===2||F===4||F===7||F===9)&&(u.key=!0)}break}case 5:v=!0,u||(u=d.avcSample=m(!0,a.pts,a.dts,"")),u.key=!0,u.frame=!0;break;case 6:{v=!0,Object(I.parseSEIMessageFromNALu)(f(L.data),a.pts,h.samples);break}case 7:if(v=!0,S=!0,!r.sps){var _=new D.default(L.data),B=_.readSPS();r.width=B.width,r.height=B.height,r.pixelRatio=B.pixelRatio,r.sps=[L.data],r.duration=d._duration;for(var U=L.data.subarray(1,4),N="avc1.",k=0;k<3;k++){var w=U[k].toString(16);w.length<2&&(w="0"+w),N+=w}r.codec=N}break;case 8:v=!0,r.pps||(r.pps=[L.data]);break;case 9:v=!1,r.audFound=!0,u&&l(u,r),u=d.avcSample=m(!1,a.pts,a.dts,"");break;case 12:v=!0;break;default:v=!1,u&&(u.debug+="unknown NAL "+L.type+" ");break}if(u&&v){var W=u.units;W.push(L)}}),s&&u&&(l(u,r),this.avcSample=null)},i.getLastNalUnit=function(r){var h,a=this.avcSample,s;if((!a||a.units.length===0)&&(a=r[r.length-1]),(h=a)!==null&&h!==void 0&&h.units){var d=a.units;s=d[d.length-1]}return s},i.parseAVCNALu=function(r,h){var a=h.byteLength,s=r.naluState||0,d=s,o=[],u=0,v,S,L,P=-1,F=0;for(s===-1&&(P=0,F=h[0]&31,s=0,u=1);u<a;){if(v=h[u++],!s){s=v?0:1;continue}if(s===1){s=v?0:2;continue}if(!v)s=3;else if(v===1){if(P>=0){var _={data:h.subarray(P,u-s-1),type:F};o.push(_)}else{var B=this.getLastNalUnit(r.samples);if(B&&(d&&u<=4-d&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-d)),S=u-s-1,S>0)){var U=new Uint8Array(B.data.byteLength+S);U.set(B.data,0),U.set(h.subarray(0,S),B.data.byteLength),B.data=U,B.state=0}}u<a?(L=h[u]&31,P=u,F=L,s=0):s=-1}else s=0}if(P>=0&&s>=0){var N={data:h.subarray(P,a),type:F,state:s};o.push(N)}if(o.length===0){var k=this.getLastNalUnit(r.samples);if(k){var w=new Uint8Array(k.data.byteLength+h.byteLength);w.set(k.data,0),w.set(h,k.data.byteLength),k.data=w}}return r.naluState=s,o},i.parseAACPES=function(r,h){var a=0,s=this.aacOverFlow,d=h.data;if(s){this.aacOverFlow=null;var o=s.missing,u=s.sample.unit.byteLength;if(o===-1){var v=new Uint8Array(u+d.byteLength);v.set(s.sample.unit,0),v.set(d,u),d=v}else{var S=u-o;s.sample.unit.set(d.subarray(0,o),S),r.samples.push(s.sample),a=s.missing}}var L,P;for(L=a,P=d.length;L<P-1&&!M.isHeader(d,L);L++);if(L!==a){var F,_;if(L<P-1?(F="AAC PES did not start with ADTS header,offset:"+L,_=!1):(F="no ADTS header found in AAC PES",_=!0),A.logger.warn("parsing error:"+F),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:F}),_)return}M.initTrackConfig(r,this.observer,d,L,this.audioCodec);var B;if(h.pts!==void 0)B=h.pts;else if(s){var U=M.getFrameDuration(r.samplerate);B=s.sample.pts+U}else{A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,k;L<P;)if(k=M.appendFrame(r,d,L,B,N),L+=k.length,k.missing){this.aacOverFlow=k;break}else for(N++;L<P-1&&!M.isHeader(d,L);L++);},i.parseMPEGPES=function(r,h){var a=h.data,s=a.length,d=0,o=0,u=h.pts;if(u===void 0){A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(O.isHeader(a,o)){var v=O.appendFrame(r,a,o,u,d);if(v)o+=v.length,d++;else break}else o++},i.parseID3PES=function(r,h){if(h.pts===void 0){A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var a=E({},h,{type:this._avcTrack?x.MetadataSchema.emsg:x.MetadataSchema.audioId3});r.samples.push(a)},c}();function m(c,i,t,r){return{key:c,frame:!1,pts:i,dts:t,units:[],debug:r,length:0}}function g(c,i){return(c[i+10]&31)<<8|c[i+11]}function n(c,i,t,r){var h={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=(c[i+1]&15)<<8|c[i+2],s=i+3+a-4,d=(c[i+10]&15)<<8|c[i+11];for(i+=12+d;i<s;){var o=(c[i+1]&31)<<8|c[i+2];switch(c[i]){case 207:if(!r){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:h.audio===-1&&(h.audio=o);break;case 21:h.id3===-1&&(h.id3=o);break;case 219:if(!r){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:h.avc===-1&&(h.avc=o);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?A.logger.log("MPEG audio found, not supported in this browser"):h.audio===-1&&(h.audio=o,h.segmentCodec="mp3");break;case 36:A.logger.warn("Unsupported HEVC stream type found");break}i+=((c[i+3]&15)<<8|c[i+4])+5}return h}function e(c){var i=0,t,r,h,a,s,d=c.data;if(!c||c.size===0)return null;for(;d[0].length<19&&d.length>1;){var o=new Uint8Array(d[0].length+d[1].length);o.set(d[0]),o.set(d[1],d[0].length),d[0]=o,d.splice(1,1)}t=d[0];var u=(t[0]<<16)+(t[1]<<8)+t[2];if(u===1){if(r=(t[4]<<8)+t[5],r&&r>c.size-6)return null;var v=t[7];v&192&&(a=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,v&64?(s=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,a-s>60*9e4&&(A.logger.warn(Math.round((a-s)/9e4)+"s delta between PTS and DTS, align them"),a=s)):s=a),h=t[8];var S=h+9;if(c.size<=S)return null;c.size-=S;for(var L=new Uint8Array(c.size),P=0,F=d.length;P<F;P++){t=d[P];var _=t.byteLength;if(S)if(S>_){S-=_;continue}else t=t.subarray(S),_-=S,S=0;L.set(t,i),i+=_}return r&&(r-=h+3),{data:L,pts:a,dts:s,len:r}}return null}function l(c,i){if(c.units.length&&c.frame){if(c.pts===void 0){var t=i.samples,r=t.length;if(r){var h=t[r-1];c.pts=h.pts,c.dts=h.dts}else{i.dropped++;return}}i.samples.push(c)}c.debug.length&&A.logger.log(c.pts+"/"+c.dts+":"+c.debug)}function f(c){for(var i=c.byteLength,t=[],r=1;r<i-2;)c[r]===0&&c[r+1]===0&&c[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return c;var h=i-t.length,a=new Uint8Array(h),s=0;for(r=0;r<h;s++,r++)s===t[0]&&(s++,t.shift()),a[r]=c[s];return a}C.default=T},"./src/errors.ts":function(K,C,y){y.r(C),y.d(C,"ErrorTypes",function(){return M}),y.d(C,"ErrorDetails",function(){return O});var M;(function(D){D.NETWORK_ERROR="networkError",D.MEDIA_ERROR="mediaError",D.KEY_SYSTEM_ERROR="keySystemError",D.MUX_ERROR="muxError",D.OTHER_ERROR="otherError"})(M||(M={}));var O;(function(D){D.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",D.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",D.KEY_SYSTEM_NO_SESSION="keySystemNoSession",D.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",D.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",D.MANIFEST_LOAD_ERROR="manifestLoadError",D.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",D.MANIFEST_PARSING_ERROR="manifestParsingError",D.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",D.LEVEL_EMPTY_ERROR="levelEmptyError",D.LEVEL_LOAD_ERROR="levelLoadError",D.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",D.LEVEL_SWITCH_ERROR="levelSwitchError",D.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",D.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",D.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",D.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",D.FRAG_LOAD_ERROR="fragLoadError",D.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",D.FRAG_DECRYPT_ERROR="fragDecryptError",D.FRAG_PARSING_ERROR="fragParsingError",D.REMUX_ALLOC_ERROR="remuxAllocError",D.KEY_LOAD_ERROR="keyLoadError",D.KEY_LOAD_TIMEOUT="keyLoadTimeOut",D.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",D.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",D.BUFFER_APPEND_ERROR="bufferAppendError",D.BUFFER_APPENDING_ERROR="bufferAppendingError",D.BUFFER_STALLED_ERROR="bufferStalledError",D.BUFFER_FULL_ERROR="bufferFullError",D.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",D.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",D.INTERNAL_EXCEPTION="internalException",D.INTERNAL_ABORTED="aborted",D.UNKNOWN="unknown"})(O||(O={}))},"./src/events.ts":function(K,C,y){y.r(C),y.d(C,"Events",function(){return M});var M;(function(O){O.MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return f});var M=y("./node_modules/url-toolkit/src/url-toolkit.js"),O=y("./src/loader/playlist-loader.ts"),D=y("./src/loader/key-loader.ts"),b=y("./src/controller/id3-track-controller.ts"),R=y("./src/controller/latency-controller.ts"),I=y("./src/controller/level-controller.ts"),A=y("./src/controller/fragment-tracker.ts"),p=y("./src/controller/stream-controller.ts"),x=y("./src/is-supported.ts"),E=y("./src/utils/logger.ts"),T=y("./src/config.ts"),m=y("./node_modules/eventemitter3/index.js"),g=y("./src/events.ts"),n=y("./src/errors.ts");function e(c,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(c,r.key,r)}}function l(c,i,t){return i&&e(c.prototype,i),t&&e(c,t),Object.defineProperty(c,"prototype",{writable:!1}),c}var f=function(){c.isSupported=function(){return Object(x.isSupported)()};function c(t){t===void 0&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(T.mergeConfig)(c.DefaultConfig,t);this.userConfig=t,Object(E.enableLogs)(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(T.enableStreamingMode)(r);var h=r.abrController,a=r.bufferController,s=r.capLevelController,d=r.fpsController,o=this.abrController=new h(this),u=this.bufferController=new a(this),v=this.capLevelController=new s(this),S=new d(this),L=new O.default(this),P=new D.default(this),F=new b.default(this),_=this.levelController=new I.default(this),B=new A.FragmentTracker(this),U=this.streamController=new p.default(this,B);v.setStreamController(U),S.setStreamController(U);var N=[L,P,_,U];this.networkControllers=N;var k=[o,u,v,S,F,B];this.audioTrackController=this.createController(r.audioTrackController,null,N),this.createController(r.audioStreamController,B,N),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,N),this.createController(r.subtitleStreamController,B,N),this.createController(r.timelineController,null,k),this.emeController=this.createController(r.emeController,null,k),this.cmcdController=this.createController(r.cmcdController,null,k),this.latencyController=this.createController(R.default,null,k),this.coreComponents=k}var i=c.prototype;return i.createController=function(r,h,a){if(r){var s=h?new r(this,h):new r(this);return a&&a.push(s),s}return null},i.on=function(r,h,a){a===void 0&&(a=this),this._emitter.on(r,h,a)},i.once=function(r,h,a){a===void 0&&(a=this),this._emitter.once(r,h,a)},i.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},i.off=function(r,h,a,s){a===void 0&&(a=this),this._emitter.off(r,h,a,s)},i.listeners=function(r){return this._emitter.listeners(r)},i.emit=function(r,h,a){return this._emitter.emit(r,h,a)},i.trigger=function(r,h){if(this.config.debug)return this.emit(r,r,h);try{return this.emit(r,r,h)}catch(a){E.logger.error("An internal error happened while handling event "+r+'. Error message: "'+a.message+'". Here is a stacktrace:',a),this.trigger(g.Events.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,error:a})}return!1},i.listenerCount=function(r){return this._emitter.listenerCount(r)},i.destroy=function(){E.logger.log("destroy"),this.trigger(g.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(r){return r.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(r){return r.destroy()}),this.coreComponents.length=0},i.attachMedia=function(r){E.logger.log("attachMedia"),this._media=r,this.trigger(g.Events.MEDIA_ATTACHING,{media:r})},i.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(g.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(r){this.stopLoad();var h=this.media,a=this.url,s=this.url=M.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});E.logger.log("loadSource:"+s),h&&a&&a!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(h)),this.trigger(g.Events.MANIFEST_LOADING,{url:r})},i.startLoad=function(r){r===void 0&&(r=-1),E.logger.log("startLoad("+r+")"),this.networkControllers.forEach(function(h){h.startLoad(r)})},i.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},i.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){E.logger.log("recoverMediaError");var r=this._media;this.detachMedia(),r&&this.attachMedia(r)},i.removeLevel=function(r,h){h===void 0&&(h=0),this.levelController.removeLevel(r,h)},l(c,[{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){E.logger.log("set currentLevel:"+r),this.loadLevel=r,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){E.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){E.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){E.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){E.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var h=!!r;h!==this.config.capLevelToPlayerSize&&(h?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=h)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(E.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r)}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,h=this.config.minAutoBitrate;if(!r)return 0;for(var a=r.length,s=0;s<a;s++)if(r[s].maxBitrate>=h)return s;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,h=this.autoLevelCapping,a;return h===-1&&r&&r.length?a=r.length-1:a=h,a}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var h=this.audioTrackController;h&&(h.audioTrack=r)}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var h=this.subtitleTrackController;h&&(h.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var h=this.subtitleTrackController;h&&(h.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.4"}},{key:"Events",get:function(){return g.Events}},{key:"ErrorTypes",get:function(){return n.ErrorTypes}},{key:"ErrorDetails",get:function(){return n.ErrorDetails}},{key:"DefaultConfig",get:function(){return c.defaultConfig?c.defaultConfig:T.hlsDefaultConfig},set:function(r){c.defaultConfig=r}}]),c}();f.defaultConfig=void 0},"./src/is-supported.ts":function(K,C,y){y.r(C),y.d(C,"isSupported",function(){return D}),y.d(C,"changeTypeSupported",function(){return b});var M=y("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function D(){var R=Object(M.getMediaSource)();if(!R)return!1;var I=O(),A=R&&typeof R.isTypeSupported=="function"&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),p=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!A&&!!p}function b(){var R,I=O();return typeof(I==null||(R=I.prototype)===null||R===void 0?void 0:R.changeType)=="function"}},"./src/loader/date-range.ts":function(K,C,y){y.r(C),y.d(C,"DateRangeAttribute",function(){return A}),y.d(C,"DateRange",function(){return p});var M=y("./src/polyfills/number.ts"),O=y("./src/utils/attr-list.ts"),D=y("./src/utils/logger.ts");function b(){return b=Object.assign?Object.assign.bind():function(x){for(var E=1;E<arguments.length;E++){var T=arguments[E];for(var m in T)Object.prototype.hasOwnProperty.call(T,m)&&(x[m]=T[m])}return x},b.apply(this,arguments)}function R(x,E){for(var T=0;T<E.length;T++){var m=E[T];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(x,m.key,m)}}function I(x,E,T){return E&&R(x.prototype,E),T&&R(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}var A;(function(x){x.ID="ID",x.CLASS="CLASS",x.START_DATE="START-DATE",x.DURATION="DURATION",x.END_DATE="END-DATE",x.END_ON_NEXT="END-ON-NEXT",x.PLANNED_DURATION="PLANNED-DURATION",x.SCTE35_OUT="SCTE35-OUT",x.SCTE35_IN="SCTE35-IN"})(A||(A={}));var p=function(){function x(E,T){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,T){var m=T.attr;for(var g in m)if(Object.prototype.hasOwnProperty.call(E,g)&&E[g]!==m[g]){D.logger.warn('DATERANGE tag attribute: "'+g+'" does not match for tags with ID: "'+E.ID+'"'),this._badValueForSameId=g;break}E=b(new O.AttrList({}),m,E)}if(this.attr=E,this._startDate=new Date(E[A.START_DATE]),A.END_DATE in this.attr){var n=new Date(this.attr[A.END_DATE]);Object(M.isFiniteNumber)(n.getTime())&&(this._endDate=n)}}return I(x,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var T=this.duration;return T!==null?new Date(this._startDate.getTime()+T*1e3):null}},{key:"duration",get:function(){if(A.DURATION in this.attr){var T=this.attr.decimalFloatingPoint(A.DURATION);if(Object(M.isFiniteNumber)(T))return T}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return A.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(A.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(A.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(M.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),x}()},"./src/loader/fragment-loader.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return T}),y.d(C,"LoadError",function(){return g});var M=y("./src/polyfills/number.ts"),O=y("./src/errors.ts");function D(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,p(n,e)}function b(n){var e=typeof Map=="function"?new Map:void 0;return b=function(f){if(f===null||!A(f))return f;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(f))return e.get(f);e.set(f,c)}function c(){return R(f,arguments,x(this).constructor)}return c.prototype=Object.create(f.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),p(c,f)},b(n)}function R(n,e,l){return I()?R=Reflect.construct.bind():R=function(c,i,t){var r=[null];r.push.apply(r,i);var h=Function.bind.apply(c,r),a=new h;return t&&p(a,t.prototype),a},R.apply(null,arguments)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function p(n,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,c){return f.__proto__=c,f},p(n,e)}function x(n){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},x(n)}var E=Math.pow(2,17),T=function(){function n(l){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=l}var e=n.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(f,c){var i=this,t=f.url;if(!t)return Promise.reject(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var r=this.config,h=r.fLoader,a=r.loader;return new Promise(function(s,d){i.loader&&i.loader.destroy();var o=i.loader=f.loader=h?new h(r):new a(r),u=m(f),v={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:f.sn==="initSegment"?1/0:E};f.stats=o.stats,o.load(u,v,{onSuccess:function(L,P,F,_){i.resetLoader(f,o),s({frag:f,part:null,payload:L.data,networkDetails:_})},onError:function(L,P,F){i.resetLoader(f,o),d(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,response:L,networkDetails:F}))},onAbort:function(L,P,F){i.resetLoader(f,o),d(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:f,networkDetails:F}))},onTimeout:function(L,P,F){i.resetLoader(f,o),d(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,networkDetails:F}))},onProgress:function(L,P,F,_){c&&c({frag:f,part:null,payload:F,networkDetails:_})}})})},e.loadPart=function(f,c,i){var t=this;this.abort();var r=this.config,h=r.fLoader,a=r.loader;return new Promise(function(s,d){t.loader&&t.loader.destroy();var o=t.loader=f.loader=h?new h(r):new a(r),u=m(f,c),v={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:E};c.stats=o.stats,o.load(u,v,{onSuccess:function(L,P,F,_){t.resetLoader(f,o),t.updateStatsFromPart(f,c);var B={frag:f,part:c,payload:L.data,networkDetails:_};i(B),s(B)},onError:function(L,P,F){t.resetLoader(f,o),d(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,part:c,response:L,networkDetails:F}))},onAbort:function(L,P,F){f.stats.aborted=c.stats.aborted,t.resetLoader(f,o),d(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:f,part:c,networkDetails:F}))},onTimeout:function(L,P,F){t.resetLoader(f,o),d(new g({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,part:c,networkDetails:F}))}})})},e.updateStatsFromPart=function(f,c){var i=f.stats,t=c.stats,r=t.total;if(i.loaded+=t.loaded,r){var h=Math.round(f.duration/c.duration),a=Math.min(Math.round(i.loaded/r),h),s=h-a,d=s*Math.round(i.loaded/a);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);var o=i.loading,u=t.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end},e.resetLoader=function(f,c){f.loader=null,this.loader===c&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),c.destroy()},n}();function m(n,e){e===void 0&&(e=null);var l=e||n,f={frag:n,part:e,responseType:"arraybuffer",url:l.url,headers:{},rangeStart:0,rangeEnd:0},c=l.byteRangeStartOffset,i=l.byteRangeEndOffset;return Object(M.isFiniteNumber)(c)&&Object(M.isFiniteNumber)(i)&&(f.rangeStart=c,f.rangeEnd=i),f}var g=function(n){D(e,n);function e(l){for(var f,c=arguments.length,i=new Array(c>1?c-1:0),t=1;t<c;t++)i[t-1]=arguments[t];return f=n.call.apply(n,[this].concat(i))||this,f.data=void 0,f.data=l,f}return e}(b(Error))},"./src/loader/fragment.ts":function(K,C,y){y.r(C),y.d(C,"ElementaryStreamTypes",function(){return E}),y.d(C,"BaseSegment",function(){return T}),y.d(C,"Fragment",function(){return m}),y.d(C,"Part",function(){return g});var M=y("./src/polyfills/number.ts"),O=y("./node_modules/url-toolkit/src/url-toolkit.js"),D=y("./src/utils/logger.ts"),b=y("./src/loader/level-key.ts"),R=y("./src/loader/load-stats.ts");function I(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,A(n,e)}function A(n,e){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,c){return f.__proto__=c,f},A(n,e)}function p(n,e){for(var l=0;l<e.length;l++){var f=e[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(n,f.key,f)}}function x(n,e,l){return e&&p(n.prototype,e),l&&p(n,l),Object.defineProperty(n,"prototype",{writable:!1}),n}var E;(function(n){n.AUDIO="audio",n.VIDEO="video",n.AUDIOVIDEO="audiovideo"})(E||(E={}));var T=function(){function n(l){var f;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(f={},f[E.AUDIO]=null,f[E.VIDEO]=null,f[E.AUDIOVIDEO]=null,f),this.baseurl=l}var e=n.prototype;return e.setByteRange=function(f,c){var i=f.split("@",2),t=[];i.length===1?t[0]=c?c.byteRangeEndOffset:0:t[0]=parseInt(i[1]),t[1]=parseInt(i[0])+t[0],this._byteRange=t},x(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(f){this._url=f}}]),n}(),m=function(n){I(e,n);function e(f,c){var i;return i=n.call(this,c)||this,i._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkey=void 0,i.type=void 0,i.loader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new R.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.type=f,i}var l=e.prototype;return l.createInitializationVector=function(c){for(var i=new Uint8Array(16),t=12;t<16;t++)i[t]=c>>8*(15-t)&255;return i},l.setDecryptDataFromLevelKey=function(c,i){var t=c;return(c==null?void 0:c.method)==="AES-128"&&c.uri&&!c.iv&&(t=b.LevelKey.fromURI(c.uri),t.method=c.method,t.iv=this.createInitializationVector(i),t.keyFormat="identity"),t},l.setElementaryStreamInfo=function(c,i,t,r,h,a){a===void 0&&(a=!1);var s=this.elementaryStreams,d=s[c];if(!d){s[c]={startPTS:i,endPTS:t,startDTS:r,endDTS:h,partial:a};return}d.startPTS=Math.min(d.startPTS,i),d.endPTS=Math.max(d.endPTS,t),d.startDTS=Math.min(d.startDTS,r),d.endDTS=Math.max(d.endDTS,h)},l.clearElementaryStreamInfo=function(){var c=this.elementaryStreams;c[E.AUDIO]=null,c[E.VIDEO]=null,c[E.AUDIOVIDEO]=null},x(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var c=this.sn;typeof c!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&D.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),c=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,c)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var c=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+c*1e3}},{key:"encrypted",get:function(){var c;return!!((c=this.decryptdata)!==null&&c!==void 0&&c.keyFormat&&this.decryptdata.uri)}}]),e}(T),g=function(n){I(e,n);function e(l,f,c,i,t){var r;r=n.call(this,c)||this,r.fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new R.LoadStats,r.duration=l.decimalFloatingPoint("DURATION"),r.gap=l.bool("GAP"),r.independent=l.bool("INDEPENDENT"),r.relurl=l.enumeratedString("URI"),r.fragment=f,r.index=i;var h=l.enumeratedString("BYTERANGE");return h&&r.setByteRange(h,t),t&&(r.fragOffset=t.fragOffset+t.duration),r}return x(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var f=this.elementaryStreams;return!!(f.audio||f.video||f.audiovideo)}}]),e}(T)},"./src/loader/key-loader.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return b});var M=y("./src/events.ts"),O=y("./src/errors.ts"),D=y("./src/utils/logger.ts"),b=function(){function R(A){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=A,this.registerListeners()}var I=R.prototype;return I.startLoad=function(p){},I.stopLoad=function(){this.destroyInternalLoaders()},I.registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},I.unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},I.destroyInternalLoaders=function(){for(var p in this.loaders){var x=this.loaders[p];x&&x.destroy()}this.loaders={}},I.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},I.onKeyLoading=function(p,x){var E=x.frag,T=E.type,m=this.loaders[T];if(!E.decryptdata){D.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var g=E.decryptdata.uri;if(g!==this.decrypturl||this.decryptkey===null){var n=this.hls.config;if(m&&(D.logger.warn("abort previous key loader for type:"+T),m.abort()),!g){D.logger.warn("key uri is falsy");return}var e=n.loader,l=E.loader=this.loaders[T]=new e(n);this.decrypturl=g,this.decryptkey=null;var f={url:g,frag:E,responseType:"arraybuffer"},c={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(f,c,i)}else this.decryptkey&&(E.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:E}))},I.loadsuccess=function(p,x,E){var T=E.frag;if(!T.decryptdata){D.logger.error("after key load, decryptdata unset");return}this.decryptkey=T.decryptdata.key=new Uint8Array(p.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:T})},I.loaderror=function(p,x){var E=x.frag,T=E.loader;T&&T.abort(),delete this.loaders[E.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:E,response:p})},I.loadtimeout=function(p,x){var E=x.frag,T=E.loader;T&&T.abort(),delete this.loaders[E.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:E})},R}()},"./src/loader/level-details.ts":function(K,C,y){y.r(C),y.d(C,"LevelDetails",function(){return R});var M=y("./src/polyfills/number.ts");function O(I,A){for(var p=0;p<A.length;p++){var x=A[p];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(I,x.key,x)}}function D(I,A,p){return A&&O(I.prototype,A),p&&O(I,p),Object.defineProperty(I,"prototype",{writable:!1}),I}var b=10,R=function(){function I(p){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=p}var A=I.prototype;return A.reloaded=function(x){if(!x){this.advanced=!0,this.updated=!0;return}var E=this.lastPartSn-x.lastPartSn,T=this.lastPartIndex-x.lastPartIndex;this.updated=this.endSN!==x.endSN||!!T||!!E,this.advanced=this.endSN>x.endSN||E>0||E===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(x.misses*.6):this.misses=x.misses+1,this.availabilityDelay=x.availabilityDelay},D(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var x=this.driftEndTime-this.driftStartTime;if(x>0){var E=this.driftEnd-this.driftStart;return E*1e3/x}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var x;return(x=this.fragments)!==null&&x!==void 0&&x.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(K,C,y){y.r(C),y.d(C,"LevelKey",function(){return b});var M=y("./node_modules/url-toolkit/src/url-toolkit.js");function O(R,I){for(var A=0;A<I.length;A++){var p=I[A];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(R,p.key,p)}}function D(R,I,A){return I&&O(R.prototype,I),A&&O(R,A),Object.defineProperty(R,"prototype",{writable:!1}),R}var b=function(){R.fromURL=function(A,p){return new R(A,p)},R.fromURI=function(A){return new R(A)};function R(I,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,A?this._uri=Object(M.buildAbsoluteURL)(I,A,{alwaysNormalize:!0}):this._uri=I}return D(R,[{key:"uri",get:function(){return this._uri}}]),R}()},"./src/loader/load-stats.ts":function(K,C,y){y.r(C),y.d(C,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return l});var M=y("./src/polyfills/number.ts"),O=y("./node_modules/url-toolkit/src/url-toolkit.js"),D=y("./src/loader/date-range.ts"),b=y("./src/loader/fragment.ts"),R=y("./src/loader/level-details.ts"),I=y("./src/loader/level-key.ts"),A=y("./src/utils/attr-list.ts"),p=y("./src/utils/logger.ts"),x=y("./src/utils/codecs.ts"),E=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,T=/#EXT-X-MEDIA:(.*)/g,m=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),g=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),n=/\.(mp4|m4s|m4v|m4a)$/i;function e(h){var a,s;return n.test((a=(s=O.parseURL(h))===null||s===void 0?void 0:s.path)!=null?a:"")}var l=function(){function h(){}return h.findGroup=function(s,d){for(var o=0;o<s.length;o++){var u=s[o];if(u.id===d)return u}},h.convertAVC1ToAVCOTI=function(s){var d=s.split(".");if(d.length>2){var o=d.shift()+".";return o+=parseInt(d.shift()).toString(16),o+=("000"+parseInt(d.shift()).toString(16)).slice(-4),o}return s},h.resolve=function(s,d){return O.buildAbsoluteURL(d,s,{alwaysNormalize:!0})},h.parseMasterPlaylist=function(s,d){var o=[],u=[],v={},S=!1;E.lastIndex=0;for(var L;(L=E.exec(s))!=null;)if(L[1]){var P,F=new A.AttrList(L[1]),_={attrs:F,bitrate:F.decimalInteger("AVERAGE-BANDWIDTH")||F.decimalInteger("BANDWIDTH"),name:F.NAME,url:h.resolve(L[2],d)},B=F.decimalResolution("RESOLUTION");B&&(_.width=B.width,_.height=B.height),f((F.CODECS||"").split(/[ ,]+/).filter(function(k){return k}),_),_.videoCodec&&_.videoCodec.indexOf("avc1")!==-1&&(_.videoCodec=h.convertAVC1ToAVCOTI(_.videoCodec)),(P=_.unknownCodecs)!==null&&P!==void 0&&P.length||u.push(_),o.push(_)}else if(L[3]){var U=new A.AttrList(L[3]);U["DATA-ID"]&&(S=!0,v[U["DATA-ID"]]=U)}var N=u.length>0&&u.length<o.length;return{levels:N?u:o,sessionData:S?v:null}},h.parseMasterPlaylistMedia=function(s,d,o,u){u===void 0&&(u=[]);var v,S=[],L=0;for(T.lastIndex=0;(v=T.exec(s))!==null;){var P=new A.AttrList(v[1]);if(P.TYPE===o){var F={attrs:P,bitrate:0,id:L++,groupId:P["GROUP-ID"],instreamId:P["INSTREAM-ID"],name:P.NAME||P.LANGUAGE||"",type:o,default:P.bool("DEFAULT"),autoselect:P.bool("AUTOSELECT"),forced:P.bool("FORCED"),lang:P.LANGUAGE,url:P.URI?h.resolve(P.URI,d):""};if(u.length){var _=h.findGroup(u,F.groupId)||u[0];c(F,_,"audioCodec"),c(F,_,"textCodec")}S.push(F)}}return S},h.parseLevelPlaylist=function(s,d,o,u,v){var S=new R.LevelDetails(d),L=S.fragments,P=null,F=0,_=0,B=0,U=0,N=null,k=new b.Fragment(u,d),w,W,G,j=-1,Y=!1;for(m.lastIndex=0,S.m3u8=s;(w=m.exec(s))!==null;){Y&&(Y=!1,k=new b.Fragment(u,d),k.start=B,k.sn=F,k.cc=U,k.level=o,P&&(k.initSegment=P,k.rawProgramDateTime=P.rawProgramDateTime,P.rawProgramDateTime=null));var J=w[1];if(J){k.duration=parseFloat(J);var Z=(" "+w[2]).slice(1);k.title=Z||null,k.tagList.push(Z?["INF",J,Z]:["INF",J])}else if(w[3])Object(M.isFiniteNumber)(k.duration)&&(k.start=B,G&&(k.levelkey=G),k.sn=F,k.level=o,k.cc=U,k.urlId=v,L.push(k),k.relurl=(" "+w[3]).slice(1),t(k,N),N=k,B+=k.duration,F++,_=0,Y=!0);else if(w[4]){var H=(" "+w[4]).slice(1);N?k.setByteRange(H,N):k.setByteRange(H)}else if(w[5])k.rawProgramDateTime=(" "+w[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),j===-1&&(j=L.length);else{if(w=w[0].match(g),!w){p.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<w.length&&!(typeof w[W]<"u");W++);var q=(" "+w[W]).slice(1),Q=(" "+w[W+1]).slice(1),$=w[W+2]?(" "+w[W+2]).slice(1):"";switch(q){case"PLAYLIST-TYPE":S.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":F=S.startSN=parseInt(Q);break;case"SKIP":{var ne=new A.AttrList(Q),re=ne.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(re)){S.skippedSegments=re;for(var ae=re;ae--;)L.unshift(null);F+=re}var le=ne.enumeratedString("RECENTLY-REMOVED-DATERANGES");le&&(S.recentlyRemovedDateranges=le.split("	"));break}case"TARGETDURATION":S.targetduration=parseFloat(Q);break;case"VERSION":S.version=parseInt(Q);break;case"EXTM3U":break;case"ENDLIST":S.live=!1;break;case"#":(Q||$)&&k.tagList.push($?[Q,$]:[Q]);break;case"DISCONTINUITY":U++,k.tagList.push(["DIS"]);break;case"GAP":k.tagList.push([q]);break;case"BITRATE":k.tagList.push([q,Q]);break;case"DATERANGE":{var se=new A.AttrList(Q),ge=new D.DateRange(se,S.dateRanges[se.ID]);ge.isValid||S.skippedSegments?S.dateRanges[ge.id]=ge:p.logger.warn('Ignoring invalid DATERANGE tag: "'+Q+'"'),k.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DISCONTINUITY-SEQUENCE":U=parseInt(Q);break;case"KEY":{var ue,me=new A.AttrList(Q),Te=me.enumeratedString("METHOD"),xe=me.URI,Oe=me.hexadecimalInteger("IV"),Se=me.enumeratedString("KEYFORMATVERSIONS"),ye=me.enumeratedString("KEYID"),Ie=(ue=me.enumeratedString("KEYFORMAT"))!=null?ue:"identity",Le=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Le.indexOf(Ie)>-1){p.logger.warn("Keyformat "+Ie+" is not supported from the manifest");continue}else if(Ie!=="identity")continue;Te&&(G=I.LevelKey.fromURL(d,xe),xe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Te)>=0&&(G.method=Te,G.keyFormat=Ie,ye&&(G.keyID=ye),Se&&(G.keyFormatVersions=Se),G.iv=Oe));break}case"START":{var _e=new A.AttrList(Q),fe=_e.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(fe)&&(S.startTimeOffset=fe);break}case"MAP":{var Ee=new A.AttrList(Q);if(k.duration){var Re=new b.Fragment(u,d);r(Re,Ee,o,G),P=Re,k.initSegment=P,P.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=P.rawProgramDateTime)}else r(k,Ee,o,G),P=k,Y=!0;break}case"SERVER-CONTROL":{var oe=new A.AttrList(Q);S.canBlockReload=oe.bool("CAN-BLOCK-RELOAD"),S.canSkipUntil=oe.optionalFloat("CAN-SKIP-UNTIL",0),S.canSkipDateRanges=S.canSkipUntil>0&&oe.bool("CAN-SKIP-DATERANGES"),S.partHoldBack=oe.optionalFloat("PART-HOLD-BACK",0),S.holdBack=oe.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var pe=new A.AttrList(Q);S.partTarget=pe.decimalFloatingPoint("PART-TARGET");break}case"PART":{var De=S.partList;De||(De=S.partList=[]);var Fe=_>0?De[De.length-1]:void 0,ke=_++,Ge=new b.Part(new A.AttrList(Q),k,d,ke,Fe);De.push(Ge),k.duration+=Ge.duration;break}case"PRELOAD-HINT":{var Ce=new A.AttrList(Q);S.preloadHint=Ce;break}case"RENDITION-REPORT":{var it=new A.AttrList(Q);S.renditionReports=S.renditionReports||[],S.renditionReports.push(it);break}default:p.logger.warn("line parsed but not handled: "+w);break}}}N&&!N.relurl?(L.pop(),B-=N.duration,S.partList&&(S.fragmentHint=N)):S.partList&&(t(k,N),k.cc=U,S.fragmentHint=k);var we=L.length,Be=L[0],je=L[we-1];if(B+=S.skippedSegments*S.targetduration,B>0&&we&&je){S.averagetargetduration=B/we;var Ke=je.sn;S.endSN=Ke!=="initSegment"?Ke:0,Be&&(S.startCC=Be.cc,Be.initSegment||S.fragments.every(function(Ze){return Ze.relurl&&e(Ze.relurl)})&&(p.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),k=new b.Fragment(u,d),k.relurl=je.relurl,k.level=o,k.sn="initSegment",Be.initSegment=k,S.needSidxRanges=!0))}else S.endSN=0,S.startCC=0;return S.fragmentHint&&(B+=S.fragmentHint.duration),S.totalduration=B,S.endCC=U,j>0&&i(L,j),S},h}();function f(h,a){["video","audio","text"].forEach(function(s){var d=h.filter(function(u){return Object(x.isCodecType)(u,s)});if(d.length){var o=d.filter(function(u){return u.lastIndexOf("avc1",0)===0||u.lastIndexOf("mp4a",0)===0});a[s+"Codec"]=o.length>0?o[0]:d[0],h=h.filter(function(u){return d.indexOf(u)===-1})}}),a.unknownCodecs=h}function c(h,a,s){var d=a[s];d&&(h[s]=d)}function i(h,a){for(var s=h[a],d=a;d--;){var o=h[d];if(!o)return;o.programDateTime=s.programDateTime-o.duration*1e3,s=o}}function t(h,a){h.rawProgramDateTime?h.programDateTime=Date.parse(h.rawProgramDateTime):a!=null&&a.programDateTime&&(h.programDateTime=a.endProgramDateTime),Object(M.isFiniteNumber)(h.programDateTime)||(h.programDateTime=null,h.rawProgramDateTime=null)}function r(h,a,s,d){h.relurl=a.URI,a.BYTERANGE&&h.setByteRange(a.BYTERANGE),h.level=s,h.sn="initSegment",d&&(h.levelkey=d),h.initSegment=null}},"./src/loader/playlist-loader.ts":function(K,C,y){y.r(C);var M=y("./src/polyfills/number.ts"),O=y("./src/events.ts"),D=y("./src/errors.ts"),b=y("./src/utils/logger.ts"),R=y("./src/utils/mp4-tools.ts"),I=y("./src/loader/m3u8-parser.ts"),A=y("./src/types/loader.ts"),p=y("./src/utils/attr-list.ts");function x(m){var g=m.type;switch(g){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function E(m,g){var n=m.url;return(n===void 0||n.indexOf("data:")===0)&&(n=g.url),n}var T=function(){function m(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var g=m.prototype;return g.startLoad=function(e){},g.stopLoad=function(){this.destroyInternalLoaders()},g.registerListeners=function(){var e=this.hls;e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},g.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},g.createInternalLoader=function(e){var l=this.hls.config,f=l.pLoader,c=l.loader,i=f||c,t=new i(l);return e.loader=t,this.loaders[e.type]=t,t},g.getInternalLoader=function(e){return this.loaders[e.type]},g.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},g.destroyInternalLoaders=function(){for(var e in this.loaders){var l=this.loaders[e];l&&l.destroy(),this.resetInternalLoader(e)}},g.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},g.onManifestLoading=function(e,l){var f=l.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:f,deliveryDirectives:null})},g.onLevelLoading=function(e,l){var f=l.id,c=l.level,i=l.url,t=l.deliveryDirectives;this.load({id:f,groupId:null,level:c,responseType:"text",type:A.PlaylistContextType.LEVEL,url:i,deliveryDirectives:t})},g.onAudioTrackLoading=function(e,l){var f=l.id,c=l.groupId,i=l.url,t=l.deliveryDirectives;this.load({id:f,groupId:c,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:t})},g.onSubtitleTrackLoading=function(e,l){var f=l.id,c=l.groupId,i=l.url,t=l.deliveryDirectives;this.load({id:f,groupId:c,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:t})},g.load=function(e){var l,f=this.hls.config,c=this.getInternalLoader(e);if(c){var i=c.context;if(i&&i.url===e.url){b.logger.trace("[playlist-loader]: playlist request ongoing");return}b.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),c.abort()}var t,r,h,a;switch(e.type){case A.PlaylistContextType.MANIFEST:t=f.manifestLoadingMaxRetry,r=f.manifestLoadingTimeOut,h=f.manifestLoadingRetryDelay,a=f.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:t=0,r=f.levelLoadingTimeOut;break;default:t=f.levelLoadingMaxRetry,r=f.levelLoadingTimeOut,h=f.levelLoadingRetryDelay,a=f.levelLoadingMaxRetryTimeout;break}if(c=this.createInternalLoader(e),(l=e.deliveryDirectives)!==null&&l!==void 0&&l.part){var s;if(e.type===A.PlaylistContextType.LEVEL&&e.level!==null?s=this.hls.levels[e.level].details:e.type===A.PlaylistContextType.AUDIO_TRACK&&e.id!==null?s=this.hls.audioTracks[e.id].details:e.type===A.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(s=this.hls.subtitleTracks[e.id].details),s){var d=s.partTarget,o=s.targetduration;d&&o&&(r=Math.min(Math.max(d*3,o*.8)*1e3,r))}}var u={timeout:r,maxRetry:t,retryDelay:h,maxRetryDelay:a,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(e,u,v)},g.loadsuccess=function(e,l,f,c){if(c===void 0&&(c=null),f.isSidxRequest){this.handleSidxRequest(e,f),this.handlePlaylistLoaded(e,l,f,c);return}this.resetInternalLoader(f.type);var i=e.data;if(i.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,f,"no EXTM3U delimiter",c);return}l.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,l,f,c):this.handleMasterPlaylist(e,l,f,c)},g.loaderror=function(e,l,f){f===void 0&&(f=null),this.handleNetworkError(l,f,!1,e)},g.loadtimeout=function(e,l,f){f===void 0&&(f=null),this.handleNetworkError(l,f,!0)},g.handleMasterPlaylist=function(e,l,f,c){var i=this.hls,t=e.data,r=E(e,f),h=I.default.parseMasterPlaylist(t,r),a=h.levels,s=h.sessionData;if(!a.length){this.handleManifestParsingError(e,f,"no level found in manifest",c);return}var d=a.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),o=a.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),u=I.default.parseMasterPlaylistMedia(t,r,"AUDIO",d),v=I.default.parseMasterPlaylistMedia(t,r,"SUBTITLES",o),S=I.default.parseMasterPlaylistMedia(t,r,"CLOSED-CAPTIONS");if(u.length){var L=u.some(function(P){return!P.url});!L&&a[0].audioCodec&&!a[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new p.AttrList({}),bitrate:0,url:""}))}i.trigger(O.Events.MANIFEST_LOADED,{levels:a,audioTracks:u,subtitles:v,captions:S,url:r,stats:l,networkDetails:c,sessionData:s})},g.handleTrackOrLevelPlaylist=function(e,l,f,c){var i=this.hls,t=f.id,r=f.level,h=f.type,a=E(e,f),s=Object(M.isFiniteNumber)(t)?t:0,d=Object(M.isFiniteNumber)(r)?r:s,o=x(f),u=I.default.parseLevelPlaylist(e.data,a,d,o,s);if(!u.fragments.length){i.trigger(O.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:a,reason:"no fragments found in level",level:typeof f.level=="number"?f.level:void 0});return}if(h===A.PlaylistContextType.MANIFEST){var v={attrs:new p.AttrList({}),bitrate:0,details:u,name:"",url:a};i.trigger(O.Events.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:a,stats:l,networkDetails:c,sessionData:null})}if(l.parsing.end=performance.now(),u.needSidxRanges){var S,L=(S=u.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:L,isSidxRequest:!0,type:h,level:r,levelDetails:u,id:t,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}f.levelDetails=u,this.handlePlaylistLoaded(e,l,f,c)},g.handleSidxRequest=function(e,l){var f=new Uint8Array(e.data),c=Object(R.findBox)(f,["sidx"])[0];if(!!c){var i=Object(R.parseSegmentIndex)(c);if(!!i){var t=i.references,r=l.levelDetails;t.forEach(function(h,a){var s=h.info,d=r.fragments[a];if(d.byteRange.length===0&&d.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),d.initSegment){var o=Object(R.findBox)(f,["moov"])[0],u=o?o.length:null;d.initSegment.setByteRange(String(u)+"@0")}})}}},g.handleManifestParsingError=function(e,l,f,c){this.hls.trigger(O.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:l.type===A.PlaylistContextType.MANIFEST,url:e.url,reason:f,response:e,context:l,networkDetails:c})},g.handleNetworkError=function(e,l,f,c){f===void 0&&(f=!1),b.logger.warn("[playlist-loader]: A network "+(f?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var i=D.ErrorDetails.UNKNOWN,t=!1,r=this.getInternalLoader(e);switch(e.type){case A.PlaylistContextType.MANIFEST:i=f?D.ErrorDetails.MANIFEST_LOAD_TIMEOUT:D.ErrorDetails.MANIFEST_LOAD_ERROR,t=!0;break;case A.PlaylistContextType.LEVEL:i=f?D.ErrorDetails.LEVEL_LOAD_TIMEOUT:D.ErrorDetails.LEVEL_LOAD_ERROR,t=!1;break;case A.PlaylistContextType.AUDIO_TRACK:i=f?D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,t=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:i=f?D.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:D.ErrorDetails.SUBTITLE_LOAD_ERROR,t=!1;break}r&&this.resetInternalLoader(e.type);var h={type:D.ErrorTypes.NETWORK_ERROR,details:i,fatal:t,url:e.url,loader:r,context:e,networkDetails:l};c&&(h.response=c),this.hls.trigger(O.Events.ERROR,h)},g.handlePlaylistLoaded=function(e,l,f,c){var i=f.type,t=f.level,r=f.id,h=f.groupId,a=f.loader,s=f.levelDetails,d=f.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(e,f,"invalid target duration",c);return}if(!!a)switch(s.live&&(a.getCacheAge&&(s.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),i){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:s,level:t||0,id:r||0,stats:l,networkDetails:c,deliveryDirectives:d});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:s,id:r||0,groupId:h||"",stats:l,networkDetails:c,deliveryDirectives:d});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:s,id:r||0,groupId:h||"",stats:l,networkDetails:c,deliveryDirectives:d});break}},m}();C.default=T},"./src/polyfills/number.ts":function(K,C,y){y.r(C),y.d(C,"isFiniteNumber",function(){return M}),y.d(C,"MAX_SAFE_INTEGER",function(){return O});var M=Number.isFinite||function(D){return typeof D=="number"&&isFinite(D)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(K,C,y){y.r(C);var M=function(){function O(){}return O.getSilentFrame=function(b,R){switch(b){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();C.default=M},"./src/remux/mp4-generator.ts":function(K,C,y){y.r(C);var M=Math.pow(2,32)-1,O=function(){function D(){}return D.init=function(){D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var R;for(R in D.types)D.types.hasOwnProperty(R)&&(D.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:I,audio:A};var p=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=x,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var E=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,E,m,E,T),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,p))},D.box=function(R){for(var I=8,A=arguments.length,p=new Array(A>1?A-1:0),x=1;x<A;x++)p[x-1]=arguments[x];for(var E=p.length,T=E;E--;)I+=p[E].byteLength;var m=new Uint8Array(I);for(m[0]=I>>24&255,m[1]=I>>16&255,m[2]=I>>8&255,m[3]=I&255,m.set(R,4),E=0,I=8;E<T;E++)m.set(p[E],I),I+=p[E].byteLength;return m},D.hdlr=function(R){return D.box(D.types.hdlr,D.HDLR_TYPES[R])},D.mdat=function(R){return D.box(D.types.mdat,R)},D.mdhd=function(R,I){I*=R;var A=Math.floor(I/(M+1)),p=Math.floor(I%(M+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,p>>24,p>>16&255,p>>8&255,p&255,85,196,0,0]))},D.mdia=function(R){return D.box(D.types.mdia,D.mdhd(R.timescale,R.duration),D.hdlr(R.type),D.minf(R))},D.mfhd=function(R){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255]))},D.minf=function(R){return R.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(R)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(R))},D.moof=function(R,I,A){return D.box(D.types.moof,D.mfhd(R),D.traf(A,I))},D.moov=function(R){for(var I=R.length,A=[];I--;)A[I]=D.trak(R[I]);return D.box.apply(null,[D.types.moov,D.mvhd(R[0].timescale,R[0].duration)].concat(A).concat(D.mvex(R)))},D.mvex=function(R){for(var I=R.length,A=[];I--;)A[I]=D.trex(R[I]);return D.box.apply(null,[D.types.mvex].concat(A))},D.mvhd=function(R,I){I*=R;var A=Math.floor(I/(M+1)),p=Math.floor(I%(M+1)),x=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,p>>24,p>>16&255,p>>8&255,p&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,x)},D.sdtp=function(R){var I=R.samples||[],A=new Uint8Array(4+I.length),p,x;for(p=0;p<I.length;p++)x=I[p].flags,A[p+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return D.box(D.types.sdtp,A)},D.stbl=function(R){return D.box(D.types.stbl,D.stsd(R),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))},D.avc1=function(R){var I=[],A=[],p,x,E;for(p=0;p<R.sps.length;p++)x=R.sps[p],E=x.byteLength,I.push(E>>>8&255),I.push(E&255),I=I.concat(Array.prototype.slice.call(x));for(p=0;p<R.pps.length;p++)x=R.pps[p],E=x.byteLength,A.push(E>>>8&255),A.push(E&255),A=A.concat(Array.prototype.slice.call(x));var T=D.box(D.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|R.sps.length].concat(I).concat([R.pps.length]).concat(A))),m=R.width,g=R.height,n=R.pixelRatio[0],e=R.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255])))},D.esds=function(R){var I=R.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(R.config).concat([6,1,2]))},D.mp4a=function(R){var I=R.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),D.box(D.types.esds,D.esds(R)))},D.mp3=function(R){var I=R.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},D.stsd=function(R){return R.type==="audio"?R.segmentCodec==="mp3"&&R.codec==="mp3"?D.box(D.types.stsd,D.STSD,D.mp3(R)):D.box(D.types.stsd,D.STSD,D.mp4a(R)):D.box(D.types.stsd,D.STSD,D.avc1(R))},D.tkhd=function(R){var I=R.id,A=R.duration*R.timescale,p=R.width,x=R.height,E=Math.floor(A/(M+1)),T=Math.floor(A%(M+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,T>>24,T>>16&255,T>>8&255,T&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,p>>8&255,p&255,0,0,x>>8&255,x&255,0,0]))},D.traf=function(R,I){var A=D.sdtp(R),p=R.id,x=Math.floor(I/(M+1)),E=Math.floor(I%(M+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,p>>24,p>>16&255,p>>8&255,p&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,x>>24,x>>16&255,x>>8&255,x&255,E>>24,E>>16&255,E>>8&255,E&255])),D.trun(R,A.length+16+20+8+16+8+8),A)},D.trak=function(R){return R.duration=R.duration||4294967295,D.box(D.types.trak,D.tkhd(R),D.mdia(R))},D.trex=function(R){var I=R.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},D.trun=function(R,I){var A=R.samples||[],p=A.length,x=12+16*p,E=new Uint8Array(x),T,m,g,n,e,l;for(I+=8+x,E.set([R.type==="video"?1:0,0,15,1,p>>>24&255,p>>>16&255,p>>>8&255,p&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),T=0;T<p;T++)m=A[T],g=m.duration,n=m.size,e=m.flags,l=m.cts,E.set([g>>>24&255,g>>>16&255,g>>>8&255,g&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,l>>>24&255,l>>>16&255,l>>>8&255,l&255],12+16*T);return D.box(D.types.trun,E)},D.initSegment=function(R){D.types||D.init();var I=D.moov(R),A=new Uint8Array(D.FTYP.byteLength+I.byteLength);return A.set(D.FTYP),A.set(I,D.FTYP.byteLength),A},D}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,C.default=O},"./src/remux/mp4-remuxer.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return e}),y.d(C,"normalizePts",function(){return l}),y.d(C,"flushTextTrackMetadataCueSamples",function(){return c}),y.d(C,"flushTextTrackUserdataCueSamples",function(){return i});var M=y("./src/polyfills/number.ts"),O=y("./src/remux/aac-helper.ts"),D=y("./src/remux/mp4-generator.ts"),b=y("./src/events.ts"),R=y("./src/errors.ts"),I=y("./src/utils/logger.ts"),A=y("./src/types/loader.ts"),p=y("./src/utils/timescale-conversion.ts");function x(){return x=Object.assign?Object.assign.bind():function(h){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(h[d]=s[d])}return h},x.apply(this,arguments)}var E=10*1e3,T=1024,m=1152,g=null,n=null,e=function(){function h(s,d,o,u){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=s,this.config=d,this.typeSupported=o,this.ISGenerated=!1,g===null){var v=navigator.userAgent||"",S=v.match(/Chrome\/(\d+)/i);g=S?parseInt(S[1]):0}if(n===null){var L=navigator.userAgent.match(/Safari\/(\d+)/i);n=L?parseInt(L[1]):0}}var a=h.prototype;return a.destroy=function(){},a.resetTimeStamp=function(d){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=d},a.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},a.getVideoStartPts=function(d){var o=!1,u=d.reduce(function(v,S){var L=S.pts-v;return L<-4294967296?(o=!0,l(v,S.pts)):L>0?v:S.pts},d[0].pts);return o&&I.logger.debug("PTS rollover detected"),u},a.remux=function(d,o,u,v,S,L,P,F){var _,B,U,N,k,w,W=S,G=S,j=d.pid>-1,Y=o.pid>-1,J=o.samples.length,Z=d.samples.length>0,H=P&&J>0||J>1,q=(!j||Z)&&(!Y||H)||this.ISGenerated||P;if(q){this.ISGenerated||(U=this.generateIS(d,o,S));var Q=this.isVideoContiguous,$=-1,ne;if(H&&($=f(o.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(w=!0,$>0){I.logger.warn("[mp4-remuxer]: Dropped "+$+" out of "+J+" video samples due to a missing keyframe");var re=this.getVideoStartPts(o.samples);o.samples=o.samples.slice($),o.dropped+=$,G+=(o.samples[0].pts-re)/o.inputTimeScale,ne=G}else $===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+J+" video samples"),w=!1);if(this.ISGenerated){if(Z&&H){var ae=this.getVideoStartPts(o.samples),le=l(d.samples[0].pts,ae)-ae,se=le/o.inputTimeScale;W+=Math.max(0,se),G+=Math.max(0,-se)}if(Z){if(d.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(d,o,S)),B=this.remuxAudio(d,W,this.isAudioContiguous,L,Y||H||F===A.PlaylistLevelType.AUDIO?G:void 0),H){var ge=B?B.endPTS-B.startPTS:0;o.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(d,o,S)),_=this.remuxVideo(o,G,Q,ge)}}else H&&(_=this.remuxVideo(o,G,Q,0));_&&(_.firstKeyFrame=$,_.independent=$!==-1,_.firstKeyFramePTS=ne)}}return this.ISGenerated&&(u.samples.length&&(k=c(u,S,this._initPTS,this._initDTS)),v.samples.length&&(N=i(v,S,this._initPTS))),{audio:B,video:_,initSegment:U,independent:w,text:N,id3:k}},a.generateIS=function(d,o,u){var v=d.samples,S=o.samples,L=this.typeSupported,P={},F=!Object(M.isFiniteNumber)(this._initPTS),_="audio/mp4",B,U,N;if(F&&(B=U=1/0),d.config&&v.length){switch(d.timescale=d.samplerate,d.segmentCodec){case"mp3":L.mpeg?(_="audio/mpeg",d.codec=""):L.mp3&&(d.codec="mp3");break}P.audio={id:"audio",container:_,codec:d.codec,initSegment:d.segmentCodec==="mp3"&&L.mpeg?new Uint8Array(0):D.default.initSegment([d]),metadata:{channelCount:d.channelCount}},F&&(N=d.inputTimeScale,B=U=v[0].pts-Math.round(N*u))}if(o.sps&&o.pps&&S.length&&(o.timescale=o.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:o.codec,initSegment:D.default.initSegment([o]),metadata:{width:o.width,height:o.height}},F)){N=o.inputTimeScale;var k=this.getVideoStartPts(S),w=Math.round(N*u);U=Math.min(U,l(S[0].dts,k)-w),B=Math.min(B,k-w)}if(Object.keys(P).length)return this.ISGenerated=!0,F&&(this._initPTS=B,this._initDTS=U),{tracks:P,initPTS:B,timescale:N}},a.remuxVideo=function(d,o,u,v){var S=d.inputTimeScale,L=d.samples,P=[],F=L.length,_=this._initPTS,B=this.nextAvcDts,U=8,N=this.videoSampleDuration,k,w,W=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,j=!1;if(!u||B===null){var Y=o*S,J=L[0].pts-l(L[0].dts,L[0].pts);B=Y-J}for(var Z=0;Z<F;Z++){var H=L[Z];H.pts=l(H.pts-_,B),H.dts=l(H.dts-_,B),H.dts<L[Z>0?Z-1:Z].dts&&(j=!0)}j&&L.sort(function(st,gt){var Mt=st.dts-gt.dts,bt=st.pts-gt.pts;return Mt||bt}),k=L[0].dts,w=L[L.length-1].dts;var q=w-k,Q=q?Math.round(q/(F-1)):N||d.inputTimeScale/30;if(u){var $=k-B,ne=$>Q,re=$<-1;if(ne||re){ne?I.logger.warn("AVC: "+Object(p.toMsFromMpegTsClock)($,!0)+" ms ("+$+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+Object(p.toMsFromMpegTsClock)(-$,!0)+" ms ("+$+"dts) overlapping between fragments detected"),k=B;var ae=L[0].pts-$;L[0].dts=k,L[0].pts=ae,I.logger.log("Video: First PTS/DTS adjusted: "+Object(p.toMsFromMpegTsClock)(ae,!0)+"/"+Object(p.toMsFromMpegTsClock)(k,!0)+", delta: "+Object(p.toMsFromMpegTsClock)($,!0)+" ms")}}k=Math.max(0,k);for(var le=0,se=0,ge=0;ge<F;ge++){for(var ue=L[ge],me=ue.units,Te=me.length,xe=0,Oe=0;Oe<Te;Oe++)xe+=me[Oe].data.length;se+=xe,le+=Te,ue.length=xe,ue.dts=Math.max(ue.dts,k),W=Math.min(ue.pts,W),G=Math.max(ue.pts,G)}w=L[F-1].dts;var Se=se+4*le+8,ye;try{ye=new Uint8Array(Se)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Se,reason:"fail allocating video mdat "+Se});return}var Ie=new DataView(ye.buffer);Ie.setUint32(0,Se),ye.set(D.default.types.mdat,4);for(var Le=!1,_e=Number.POSITIVE_INFINITY,fe=Number.POSITIVE_INFINITY,Ee=Number.NEGATIVE_INFINITY,Re=Number.NEGATIVE_INFINITY,oe=0;oe<F;oe++){for(var pe=L[oe],De=pe.units,Fe=0,ke=0,Ge=De.length;ke<Ge;ke++){var Ce=De[ke],it=Ce.data,we=Ce.data.byteLength;Ie.setUint32(U,we),U+=4,ye.set(it,U),U+=we,Fe+=4+we}var Be=void 0;if(oe<F-1)N=L[oe+1].dts-pe.dts,Be=L[oe+1].pts-pe.pts;else{var je=this.config,Ke=oe>0?pe.dts-L[oe-1].dts:Q;if(Be=oe>0?pe.pts-L[oe-1].pts:Q,je.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ze=Math.floor(je.maxBufferHole*S),nt=(v?W+v*S:this.nextAudioPts)-pe.pts;nt>Ze?(N=nt-Ke,N<0?N=Ke:Le=!0,I.logger.log("[mp4-remuxer]: It is approximately "+nt/90+" ms to the next segment; using duration "+N/90+" ms for the last video frame.")):N=Ke}else N=Ke}var At=Math.round(pe.pts-pe.dts);_e=Math.min(_e,N),Ee=Math.max(Ee,N),fe=Math.min(fe,Be),Re=Math.max(Re,Be),P.push(new t(pe.key,N,Fe,At))}if(P.length){if(g){if(g<70){var ht=P[0].flags;ht.dependsOn=2,ht.isNonSync=0}}else if(n&&Re-fe<Ee-_e&&Q/Ee<.025&&P[0].cts===0){I.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var at=k,Pe=0,ct=P.length;Pe<ct;Pe++){var vt=at+P[Pe].duration,Ot=at+P[Pe].cts;if(Pe<ct-1){var It=vt+P[Pe+1].cts;P[Pe].duration=It-Ot}else P[Pe].duration=Pe?P[Pe-1].duration:Q;P[Pe].cts=0,at=vt}}}console.assert(N!==null,"mp4SampleDuration must be computed"),N=Le||!N?Q:N,this.nextAvcDts=B=w+N,this.videoSampleDuration=N,this.isVideoContiguous=!0;var Rt=D.default.moof(d.sequenceNumber++,k,x({},d,{samples:P})),Pt="video",Ct={data1:Rt,data2:ye,startPTS:W/S,endPTS:(G+N)/S,startDTS:k/S,endDTS:B/S,type:Pt,hasAudio:!1,hasVideo:!0,nb:P.length,dropped:d.dropped};return d.samples=[],d.dropped=0,console.assert(ye.length,"MDAT length must not be zero"),Ct},a.remuxAudio=function(d,o,u,v,S){var L=d.inputTimeScale,P=d.samplerate?d.samplerate:L,F=L/P,_=d.segmentCodec==="aac"?T:m,B=_*F,U=this._initPTS,N=d.segmentCodec==="mp3"&&this.typeSupported.mpeg,k=[],w=S!==void 0,W=d.samples,G=N?0:8,j=this.nextAudioPts||-1,Y=o*L;if(this.isAudioContiguous=u=u||W.length&&j>0&&(v&&Math.abs(Y-j)<9e3||Math.abs(l(W[0].pts-U,Y)-j)<20*B),W.forEach(function(Ce){Ce.pts=l(Ce.pts-U,Y)}),!u||j<0){if(W=W.filter(function(Ce){return Ce.pts>=0}),!W.length)return;S===0?j=0:v&&!w?j=Math.max(0,Y):j=W[0].pts}if(d.segmentCodec==="aac")for(var J=this.config.maxAudioFramesDrift,Z=0,H=j;Z<W.length;Z++){var q=W[Z],Q=q.pts,$=Q-H,ne=Math.abs(1e3*$/L);if($<=-J*B&&w)Z===0&&(I.logger.warn("Audio frame @ "+(Q/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*$/L)+" ms."),this.nextAudioPts=j=H=Q);else if($>=J*B&&ne<E&&w){var re=Math.round($/B);H=Q-re*B,H<0&&(re--,H+=B),Z===0&&(this.nextAudioPts=j=H),I.logger.warn("[mp4-remuxer]: Injecting "+re+" audio frame @ "+(H/L).toFixed(3)+"s due to "+Math.round(1e3*$/L)+" ms gap.");for(var ae=0;ae<re;ae++){var le=Math.max(H,0),se=O.default.getSilentFrame(d.manifestCodec||d.codec,d.channelCount);se||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),se=q.unit.subarray()),W.splice(Z,0,{unit:se,pts:le}),H+=B,Z++}}q.pts=H,H+=B}for(var ge=null,ue=null,me,Te=0,xe=W.length;xe--;)Te+=W[xe].unit.byteLength;for(var Oe=0,Se=W.length;Oe<Se;Oe++){var ye=W[Oe],Ie=ye.unit,Le=ye.pts;if(ue!==null){var _e=k[Oe-1];_e.duration=Math.round((Le-ue)/F)}else if(u&&d.segmentCodec==="aac"&&(Le=j),ge=Le,Te>0){Te+=G;try{me=new Uint8Array(Te)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Te,reason:"fail allocating audio mdat "+Te});return}if(!N){var fe=new DataView(me.buffer);fe.setUint32(0,Te),me.set(D.default.types.mdat,4)}}else return;me.set(Ie,G);var Ee=Ie.byteLength;G+=Ee,k.push(new t(!0,_,Ee,0)),ue=Le}var Re=k.length;if(!!Re){var oe=k[k.length-1];this.nextAudioPts=j=ue+F*oe.duration;var pe=N?new Uint8Array(0):D.default.moof(d.sequenceNumber++,ge/F,x({},d,{samples:k}));d.samples=[];var De=ge/L,Fe=j/L,ke="audio",Ge={data1:pe,data2:me,startPTS:De,endPTS:Fe,startDTS:De,endDTS:Fe,type:ke,hasAudio:!0,hasVideo:!1,nb:Re};return this.isAudioContiguous=!0,console.assert(me.length,"MDAT length must not be zero"),Ge}},a.remuxEmptyAudio=function(d,o,u,v){var S=d.inputTimeScale,L=d.samplerate?d.samplerate:S,P=S/L,F=this.nextAudioPts,_=(F!==null?F:v.startDTS*S)+this._initDTS,B=v.endDTS*S+this._initDTS,U=P*T,N=Math.ceil((B-_)/U),k=O.default.getSilentFrame(d.manifestCodec||d.codec,d.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!k){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var w=[],W=0;W<N;W++){var G=_+W*U;w.push({unit:k,pts:G,dts:G})}return d.samples=w,this.remuxAudio(d,o,u,!1)},h}();function l(h,a){var s;if(a===null)return h;for(a<h?s=-8589934592:s=8589934592;Math.abs(h-a)>4294967296;)h+=s;return h}function f(h){for(var a=0;a<h.length;a++)if(h[a].key)return a;return-1}function c(h,a,s,d){var o=h.samples.length;if(!!o){for(var u=h.inputTimeScale,v=0;v<o;v++){var S=h.samples[v];S.pts=l(S.pts-s,a*u)/u,S.dts=l(S.dts-d,a*u)/u}var L=h.samples;return h.samples=[],{samples:L}}}function i(h,a,s){var d=h.samples.length;if(!!d){for(var o=h.inputTimeScale,u=0;u<d;u++){var v=h.samples[u];v.pts=l(v.pts-s,a*o)/o}h.samples.sort(function(L,P){return L.pts-P.pts});var S=h.samples;return h.samples=[],{samples:S}}}var t=function(a,s,d,o){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=s,this.size=d,this.cts=o,this.flags=new r(a)},r=function(a){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=a?2:1,this.isNonSync=a?0:1}},"./src/remux/passthrough-remuxer.ts":function(K,C,y){y.r(C);var M=y("./src/polyfills/number.ts"),O=y("./src/remux/mp4-remuxer.ts"),D=y("./src/utils/mp4-tools.ts"),b=y("./src/loader/fragment.ts"),R=y("./src/utils/logger.ts"),I=function(){function p(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var x=p.prototype;return x.destroy=function(){},x.resetTimeStamp=function(T){this.initPTS=T,this.lastEndTime=null},x.resetNextTimestamp=function(){this.lastEndTime=null},x.resetInitSegment=function(T,m,g){this.audioCodec=m,this.videoCodec=g,this.generateInitSegment(T),this.emitInitSegment=!0},x.generateInitSegment=function(T){var m=this.audioCodec,g=this.videoCodec;if(!T||!T.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=Object(D.parseInitSegment)(T);m||(m=A(n.audio,b.ElementaryStreamTypes.AUDIO)),g||(g=A(n.video,b.ElementaryStreamTypes.VIDEO));var e={};n.audio&&n.video?e.audiovideo={container:"video/mp4",codec:m+","+g,initSegment:T,id:"main"}:n.audio?e.audio={container:"audio/mp4",codec:m,initSegment:T,id:"audio"}:n.video?e.video={container:"video/mp4",codec:g,initSegment:T,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},x.remux=function(T,m,g,n,e){var l,f=this.initPTS,c=this.lastEndTime,i={audio:void 0,video:void 0,text:n,id3:g,initSegment:void 0};Object(M.isFiniteNumber)(c)||(c=this.lastEndTime=e||0);var t=m.samples;if(!t||!t.length)return i;var r={initPTS:void 0,timescale:1},h=this.initData;if((!h||!h.length)&&(this.generateInitSegment(t),h=this.initData),!h||!h.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(r.tracks=this.initTracks,this.emitInitSegment=!1);var a=Object(D.getStartDTS)(h,t);Object(M.isFiniteNumber)(f)||(this.initPTS=r.initPTS=f=a-e);var s=Object(D.getDuration)(t,h),d=T?a-f:c,o=d+s;Object(D.offsetStartDTS)(h,t,f),s>0?this.lastEndTime=o:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var u=!!h.audio,v=!!h.video,S="";u&&(S+="audio"),v&&(S+="video");var L={data1:t,startPTS:d,startDTS:d,endPTS:o,endDTS:o,type:S,hasAudio:u,hasVideo:v,nb:1,dropped:0};i.audio=L.type==="audio"?L:void 0,i.video=L.type!=="audio"?L:void 0,i.initSegment=r;var P=(l=this.initPTS)!=null?l:0;return i.id3=Object(O.flushTextTrackMetadataCueSamples)(g,e,P,P),n.samples.length&&(i.text=Object(O.flushTextTrackUserdataCueSamples)(n,e,P)),i},p}();function A(p,x){var E=p==null?void 0:p.codec;return E&&E.length>4?E:E==="hvc1"||E==="hev1"?"hvc1.1.c.L120.90":E==="av01"?"av01.0.04M.08":E==="avc1"||x===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=I},"./src/task-loop.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return M});var M=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var D=O.prototype;return D.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},D.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},D.onHandlerDestroyed=function(){},D.hasInterval=function(){return!!this._tickInterval},D.hasNextTick=function(){return!!this._tickTimer},D.setInterval=function(R){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,R),!0)},D.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},D.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},D.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},D.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},D.doTick=function(){},O}()},"./src/types/cmcd.ts":function(K,C,y){y.r(C),y.d(C,"CMCDVersion",function(){return M}),y.d(C,"CMCDObjectType",function(){return O}),y.d(C,"CMCDStreamingFormat",function(){return D}),y.d(C,"CMCDStreamType",function(){return b});var M=1,O;(function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"})(O||(O={}));var D;(function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"})(D||(D={}));var b;(function(R){R.VOD="v",R.LIVE="l"})(b||(b={}))},"./src/types/demuxer.ts":function(K,C,y){y.r(C),y.d(C,"MetadataSchema",function(){return M});var M;(function(O){O.audioId3="org.id3",O.dateRange="com.apple.quicktime.HLS",O.emsg="https://aomedia.org/emsg/ID3"})(M||(M={}))},"./src/types/level.ts":function(K,C,y){y.r(C),y.d(C,"HlsSkip",function(){return D}),y.d(C,"getSkipValue",function(){return b}),y.d(C,"HlsUrlParameters",function(){return R}),y.d(C,"Level",function(){return I});function M(A,p){for(var x=0;x<p.length;x++){var E=p[x];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(A,E.key,E)}}function O(A,p,x){return p&&M(A.prototype,p),x&&M(A,x),Object.defineProperty(A,"prototype",{writable:!1}),A}var D;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(D||(D={}));function b(A,p){var x=A.canSkipUntil,E=A.canSkipDateRanges,T=A.endSN,m=p!==void 0?p-T:0;return x&&m<x?E?D.v2:D.Yes:D.No}var R=function(){function A(x,E,T){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=x,this.part=E,this.skip=T}var p=A.prototype;return p.addDirectives=function(E){var T=new self.URL(E);return this.msn!==void 0&&T.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},A}(),I=function(){function A(p){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[p.url],this.attrs=p.attrs,this.bitrate=p.bitrate,p.details&&(this.details=p.details),this.id=p.id||0,this.name=p.name,this.width=p.width||0,this.height=p.height||0,this.audioCodec=p.audioCodec,this.videoCodec=p.videoCodec,this.unknownCodecs=p.unknownCodecs,this.codecSet=[p.videoCodec,p.audioCodec].filter(function(x){return x}).join(",").replace(/\.[^.,]+/g,"")}return O(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(x){var E=x%this.url.length;this._urlId!==E&&(this.details=void 0,this._urlId=E)}}]),A}()},"./src/types/loader.ts":function(K,C,y){y.r(C),y.d(C,"PlaylistContextType",function(){return M}),y.d(C,"PlaylistLevelType",function(){return O});var M;(function(D){D.MANIFEST="manifest",D.LEVEL="level",D.AUDIO_TRACK="audioTrack",D.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var O;(function(D){D.MAIN="main",D.AUDIO="audio",D.SUBTITLE="subtitle"})(O||(O={}))},"./src/types/transmuxer.ts":function(K,C,y){y.r(C),y.d(C,"ChunkMetadata",function(){return M});var M=function(b,R,I,A,p,x){A===void 0&&(A=0),p===void 0&&(p=-1),x===void 0&&(x=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=O(),this.buffering={audio:O(),video:O(),audiovideo:O()},this.level=b,this.sn=R,this.id=I,this.size=A,this.part=p,this.partial=x};function O(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(K,C,y){y.r(C),y.d(C,"AttrList",function(){return D});var M=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,D=function(){function b(I){typeof I=="string"&&(I=b.parseAttrList(I));for(var A in I)I.hasOwnProperty(A)&&(this[A]=I[A])}var R=b.prototype;return R.decimalInteger=function(A){var p=parseInt(this[A],10);return p>Number.MAX_SAFE_INTEGER?1/0:p},R.hexadecimalInteger=function(A){if(this[A]){var p=(this[A]||"0x").slice(2);p=(p.length&1?"0":"")+p;for(var x=new Uint8Array(p.length/2),E=0;E<p.length/2;E++)x[E]=parseInt(p.slice(E*2,E*2+2),16);return x}else return null},R.hexadecimalIntegerAsNumber=function(A){var p=parseInt(this[A],16);return p>Number.MAX_SAFE_INTEGER?1/0:p},R.decimalFloatingPoint=function(A){return parseFloat(this[A])},R.optionalFloat=function(A,p){var x=this[A];return x?parseFloat(x):p},R.enumeratedString=function(A){return this[A]},R.bool=function(A){return this[A]==="YES"},R.decimalResolution=function(A){var p=M.exec(this[A]);if(p!==null)return{width:parseInt(p[1],10),height:parseInt(p[2],10)}},b.parseAttrList=function(A){var p,x={},E='"';for(O.lastIndex=0;(p=O.exec(A))!==null;){var T=p[2];T.indexOf(E)===0&&T.lastIndexOf(E)===T.length-1&&(T=T.slice(1,-1)),x[p[1]]=T}return x},b}()},"./src/utils/binary-search.ts":function(K,C,y){y.r(C);var M={search:function(D,b){for(var R=0,I=D.length-1,A=null,p=null;R<=I;){A=(R+I)/2|0,p=D[A];var x=b(p);if(x>0)R=A+1;else if(x<0)I=A-1;else return p}return null}};C.default=M},"./src/utils/buffer-helper.ts":function(K,C,y){y.r(C),y.d(C,"BufferHelper",function(){return D});var M=y("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},D=function(){function b(){}return b.isBuffered=function(I,A){try{if(I){for(var p=b.getBuffered(I),x=0;x<p.length;x++)if(A>=p.start(x)&&A<=p.end(x))return!0}}catch{}return!1},b.bufferInfo=function(I,A,p){try{if(I){var x=b.getBuffered(I),E=[],T;for(T=0;T<x.length;T++)E.push({start:x.start(T),end:x.end(T)});return this.bufferedInfo(E,A,p)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},b.bufferedInfo=function(I,A,p){A=Math.max(0,A),I.sort(function(t,r){var h=t.start-r.start;return h||r.end-t.end});var x=[];if(p)for(var E=0;E<I.length;E++){var T=x.length;if(T){var m=x[T-1].end;I[E].start-m<p?I[E].end>m&&(x[T-1].end=I[E].end):x.push(I[E])}else x.push(I[E])}else x=I;for(var g=0,n,e=A,l=A,f=0;f<x.length;f++){var c=x[f].start,i=x[f].end;if(A+p>=c&&A<i)e=c,l=i,g=l-A;else if(A+p<c){n=c;break}}return{len:g,start:e||0,end:l||0,nextStart:n}},b.getBuffered=function(I){try{return I.buffered}catch(A){return M.logger.log("failed to get media.buffered",A),O}},b}()},"./src/utils/cea-608-parser.ts":function(K,C,y){y.r(C),y.d(C,"Row",function(){return l}),y.d(C,"CaptionScreen",function(){return f});var M=y("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},D=function(s){var d=s;return O.hasOwnProperty(s)&&(d=O[s]),String.fromCharCode(d)},b=15,R=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},p={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},x={25:2,26:4,29:6,30:8,31:10,27:13,28:15},E=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],T;(function(a){a[a.ERROR=0]="ERROR",a[a.TEXT=1]="TEXT",a[a.WARNING=2]="WARNING",a[a.INFO=2]="INFO",a[a.DEBUG=3]="DEBUG",a[a.DATA=3]="DATA"})(T||(T={}));var m=function(){function a(){this.time=null,this.verboseLevel=T.ERROR}var s=a.prototype;return s.log=function(o,u){this.verboseLevel>=o&&M.logger.log(this.time+" ["+o+"] "+u)},a}(),g=function(s){for(var d=[],o=0;o<s.length;o++)d.push(s[o].toString(16));return d},n=function(){function a(d,o,u,v,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=d||"white",this.underline=o||!1,this.italics=u||!1,this.background=v||"black",this.flash=S||!1}var s=a.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(o){for(var u=["foreground","underline","italics","background","flash"],v=0;v<u.length;v++){var S=u[v];o.hasOwnProperty(S)&&(this[S]=o[S])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(o){return this.foreground===o.foreground&&this.underline===o.underline&&this.italics===o.italics&&this.background===o.background&&this.flash===o.flash},s.copy=function(o){this.foreground=o.foreground,this.underline=o.underline,this.italics=o.italics,this.background=o.background,this.flash=o.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),e=function(){function a(d,o,u,v,S,L){this.uchar=void 0,this.penState=void 0,this.uchar=d||" ",this.penState=new n(o,u,v,S,L)}var s=a.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(o,u){this.uchar=o,this.penState.copy(u)},s.setPenState=function(o){this.penState.copy(o)},s.equals=function(o){return this.uchar===o.uchar&&this.penState.equals(o.penState)},s.copy=function(o){this.uchar=o.uchar,this.penState.copy(o.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},a}(),l=function(){function a(d){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var o=0;o<R;o++)this.chars.push(new e);this.logger=d,this.pos=0,this.currPenState=new n}var s=a.prototype;return s.equals=function(o){for(var u=!0,v=0;v<R;v++)if(!this.chars[v].equals(o.chars[v])){u=!1;break}return u},s.copy=function(o){for(var u=0;u<R;u++)this.chars[u].copy(o.chars[u])},s.isEmpty=function(){for(var o=!0,u=0;u<R;u++)if(!this.chars[u].isEmpty()){o=!1;break}return o},s.setCursor=function(o){this.pos!==o&&(this.pos=o),this.pos<0?(this.logger.log(T.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(T.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},s.moveCursor=function(o){var u=this.pos+o;if(o>1)for(var v=this.pos+1;v<u+1;v++)this.chars[v].setPenState(this.currPenState);this.setCursor(u)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(o){o>=144&&this.backSpace();var u=D(o);if(this.pos>=R){this.logger.log(T.ERROR,"Cannot insert "+o.toString(16)+" ("+u+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(u,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(o){var u;for(u=o;u<R;u++)this.chars[u].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var o=[],u=!0,v=0;v<R;v++){var S=this.chars[v].uchar;S!==" "&&(u=!1),o.push(S)}return u?"":o.join("")},s.setPenStyles=function(o){this.currPenState.setStyles(o);var u=this.chars[this.pos];u.setPenState(this.currPenState)},a}(),f=function(){function a(d){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var o=0;o<b;o++)this.rows.push(new l(d));this.logger=d,this.currRow=b-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=a.prototype;return s.reset=function(){for(var o=0;o<b;o++)this.rows[o].clear();this.currRow=b-1},s.equals=function(o){for(var u=!0,v=0;v<b;v++)if(!this.rows[v].equals(o.rows[v])){u=!1;break}return u},s.copy=function(o){for(var u=0;u<b;u++)this.rows[u].copy(o.rows[u])},s.isEmpty=function(){for(var o=!0,u=0;u<b;u++)if(!this.rows[u].isEmpty()){o=!1;break}return o},s.backSpace=function(){var o=this.rows[this.currRow];o.backSpace()},s.clearToEndOfRow=function(){var o=this.rows[this.currRow];o.clearToEndOfRow()},s.insertChar=function(o){var u=this.rows[this.currRow];u.insertChar(o)},s.setPen=function(o){var u=this.rows[this.currRow];u.setPenStyles(o)},s.moveCursor=function(o){var u=this.rows[this.currRow];u.moveCursor(o)},s.setCursor=function(o){this.logger.log(T.INFO,"setCursor: "+o);var u=this.rows[this.currRow];u.setCursor(o)},s.setPAC=function(o){this.logger.log(T.INFO,"pacData = "+JSON.stringify(o));var u=o.row-1;if(this.nrRollUpRows&&u<this.nrRollUpRows-1&&(u=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==u){for(var v=0;v<b;v++)this.rows[v].clear();var S=this.currRow+1-this.nrRollUpRows,L=this.lastOutputScreen;if(L){var P=L.rows[S].cueStartTime,F=this.logger.time;if(P&&F!==null&&P<F)for(var _=0;_<this.nrRollUpRows;_++)this.rows[u-this.nrRollUpRows+_+1].copy(L.rows[S+_])}}this.currRow=u;var B=this.rows[this.currRow];if(o.indent!==null){var U=o.indent,N=Math.max(U-1,0);B.setCursor(o.indent),o.color=B.chars[N].penState.foreground}var k={foreground:o.color,underline:o.underline,italics:o.italics,background:"black",flash:!1};this.setPen(k)},s.setBkgData=function(o){this.logger.log(T.INFO,"bkgData = "+JSON.stringify(o)),this.backSpace(),this.setPen(o),this.insertChar(32)},s.setRollUpRows=function(o){this.nrRollUpRows=o},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(T.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(T.TEXT,this.getDisplayText());var o=this.currRow+1-this.nrRollUpRows,u=this.rows.splice(o,1)[0];u.clear(),this.rows.splice(this.currRow,0,u),this.logger.log(T.INFO,"Rolling up")},s.getDisplayText=function(o){o=o||!1;for(var u=[],v="",S=-1,L=0;L<b;L++){var P=this.rows[L].getTextString();P&&(S=L+1,o?u.push("Row "+S+": '"+P+"'"):u.push(P.trim()))}return u.length>0&&(o?v="["+u.join(" | ")+"]":v=u.join(`
`)),v},s.getTextAndFormat=function(){return this.rows},a}(),c=function(){function a(d,o,u){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=d,this.outputFilter=o,this.mode=null,this.verbose=0,this.displayedMemory=new f(u),this.nonDisplayedMemory=new f(u),this.lastOutputScreen=new f(u),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=u}var s=a.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(o){this.outputFilter=o},s.setPAC=function(o){this.writeScreen.setPAC(o)},s.setBkgData=function(o){this.writeScreen.setBkgData(o)},s.setMode=function(o){o!==this.mode&&(this.mode=o,this.logger.log(T.INFO,"MODE="+o),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=o)},s.insertChars=function(o){for(var u=0;u<o.length;u++)this.writeScreen.insertChar(o[u]);var v=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(T.INFO,v+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(T.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(T.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(T.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(T.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(o){this.logger.log(T.INFO,"RU("+o+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(o)},s.ccFON=function(){this.logger.log(T.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(T.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(T.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(T.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(T.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(T.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(T.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(T.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var o=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=o,this.writeScreen=this.nonDisplayedMemory,this.logger.log(T.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(o){this.logger.log(T.INFO,"TO("+o+") - Tab Offset"),this.writeScreen.moveCursor(o)},s.ccMIDROW=function(o){var u={flash:!1};if(u.underline=o%2===1,u.italics=o>=46,u.italics)u.foreground="white";else{var v=Math.floor(o/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];u.foreground=S[v]}this.logger.log(T.INFO,"MIDROW: "+JSON.stringify(u)),this.writeScreen.setPen(u)},s.outputDataUpdate=function(o){o===void 0&&(o=!1);var u=this.logger.time;u!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=u:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,u,this.lastOutputScreen),o&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:u),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(o){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,o,this.displayedMemory),this.cueStartTime=o))},a}(),i=function(){function a(d,o,u){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var v=new m;this.channels=[null,new c(d,o,v),new c(d+1,u,v)],this.cmdHistory=h(),this.logger=v}var s=a.prototype;return s.getHandler=function(o){return this.channels[o].getHandler()},s.setHandler=function(o,u){this.channels[o].setHandler(u)},s.addData=function(o,u){var v,S,L,P=!1;this.logger.time=o;for(var F=0;F<u.length;F+=2)if(S=u[F]&127,L=u[F+1]&127,!(S===0&&L===0)){if(this.logger.log(T.DATA,"["+g([u[F],u[F+1]])+"] -> ("+g([S,L])+")"),v=this.parseCmd(S,L),v||(v=this.parseMidrow(S,L)),v||(v=this.parsePAC(S,L)),v||(v=this.parseBackgroundAttributes(S,L)),!v&&(P=this.parseChars(S,L),P)){var _=this.currentChannel;if(_&&_>0){var B=this.channels[_];B.insertChars(P)}else this.logger.log(T.WARNING,"No channel found yet. TEXT-MODE?")}!v&&!P&&this.logger.log(T.WARNING,"Couldn't parse cleaned data "+g([S,L])+" orig: "+g([u[F],u[F+1]]))}},s.parseCmd=function(o,u){var v=this.cmdHistory,S=(o===20||o===28||o===21||o===29)&&u>=32&&u<=47,L=(o===23||o===31)&&u>=33&&u<=35;if(!(S||L))return!1;if(r(o,u,v))return t(null,null,v),this.logger.log(T.DEBUG,"Repeated command ("+g([o,u])+") is dropped"),!0;var P=o===20||o===21||o===23?1:2,F=this.channels[P];return o===20||o===21||o===28||o===29?u===32?F.ccRCL():u===33?F.ccBS():u===34?F.ccAOF():u===35?F.ccAON():u===36?F.ccDER():u===37?F.ccRU(2):u===38?F.ccRU(3):u===39?F.ccRU(4):u===40?F.ccFON():u===41?F.ccRDC():u===42?F.ccTR():u===43?F.ccRTD():u===44?F.ccEDM():u===45?F.ccCR():u===46?F.ccENM():u===47&&F.ccEOC():F.ccTO(u-32),t(o,u,v),this.currentChannel=P,!0},s.parseMidrow=function(o,u){var v=0;if((o===17||o===25)&&u>=32&&u<=47){if(o===17?v=1:v=2,v!==this.currentChannel)return this.logger.log(T.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[v];return S?(S.ccMIDROW(u),this.logger.log(T.DEBUG,"MIDROW ("+g([o,u])+")"),!0):!1}return!1},s.parsePAC=function(o,u){var v,S=this.cmdHistory,L=(o>=17&&o<=23||o>=25&&o<=31)&&u>=64&&u<=127,P=(o===16||o===24)&&u>=64&&u<=95;if(!(L||P))return!1;if(r(o,u,S))return t(null,null,S),!0;var F=o<=23?1:2;u>=64&&u<=95?v=F===1?I[o]:p[o]:v=F===1?A[o]:x[o];var _=this.channels[F];return _?(_.setPAC(this.interpretPAC(v,u)),t(o,u,S),this.currentChannel=F,!0):!1},s.interpretPAC=function(o,u){var v,S={color:null,italics:!1,indent:null,underline:!1,row:o};return u>95?v=u-96:v=u-64,S.underline=(v&1)===1,v<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(v/2)]:v<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((v-16)/2)*4,S},s.parseChars=function(o,u){var v,S=null,L=null;if(o>=25?(v=2,L=o-8):(v=1,L=o),L>=17&&L<=19){var P;L===17?P=u+80:L===18?P=u+112:P=u+144,this.logger.log(T.INFO,"Special char '"+D(P)+"' in channel "+v),S=[P]}else o>=32&&o<=127&&(S=u===0?[o]:[o,u]);if(S){var F=g(S);this.logger.log(T.DEBUG,"Char codes =  "+F.join(",")),t(o,u,this.cmdHistory)}return S},s.parseBackgroundAttributes=function(o,u){var v=(o===16||o===24)&&u>=32&&u<=47,S=(o===23||o===31)&&u>=45&&u<=47;if(!(v||S))return!1;var L,P={};o===16||o===24?(L=Math.floor((u-32)/2),P.background=E[L],u%2===1&&(P.background=P.background+"_semi")):u===45?P.background="transparent":(P.foreground="black",u===47&&(P.underline=!0));var F=o<=23?1:2,_=this.channels[F];return _.setBkgData(P),t(o,u,this.cmdHistory),!0},s.reset=function(){for(var o=0;o<Object.keys(this.channels).length;o++){var u=this.channels[o];u&&u.reset()}this.cmdHistory=h()},s.cueSplitAtTime=function(o){for(var u=0;u<this.channels.length;u++){var v=this.channels[u];v&&v.cueSplitAtTime(o)}},a}();function t(a,s,d){d.a=a,d.b=s}function r(a,s,d){return d.a===a&&d.b===s}function h(){return{a:null,b:null}}C.default=i},"./src/utils/codecs.ts":function(K,C,y){y.r(C),y.d(C,"isCodecType",function(){return O}),y.d(C,"isCodecSupportedInMp4",function(){return D});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(b,R){var I=M[R];return!!I&&I[b.slice(0,4)]===!0}function D(b,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(K,C,y){y.r(C);var M=y("./src/utils/vttparser.ts"),O=y("./src/utils/webvtt-parser.ts"),D=y("./src/utils/texttrack-utils.ts"),b=/\s/,R={newCue:function(A,p,x,E){for(var T=[],m,g,n,e,l,f=self.VTTCue||self.TextTrackCue,c=0;c<E.rows.length;c++)if(m=E.rows[c],n=!0,e=0,l="",!m.isEmpty()){for(var i=0;i<m.chars.length;i++)b.test(m.chars[i].uchar)&&n?e++:(l+=m.chars[i].uchar,n=!1);m.cueStartTime=p,p===x&&(x+=1e-4),e>=16?e--:e++;var t=Object(M.fixLineBreaks)(l.trim()),r=Object(O.generateCueId)(p,x,t);(!A||!A.cues||!A.cues.getCueById(r))&&(g=new f(p,x,t),g.id=r,g.line=c+1,g.align="left",g.position=10+Math.min(80,Math.floor(e*8/32)*10),T.push(g))}return A&&T.length&&(T.sort(function(h,a){return h.line==="auto"||a.line==="auto"?0:h.line>8&&a.line>8?a.line-h.line:h.line-a.line}),T.forEach(function(h){return Object(D.addCueToTrack)(A,h)})),T}};C.default=R},"./src/utils/discontinuities.ts":function(K,C,y){y.r(C),y.d(C,"findFirstFragWithCC",function(){return b}),y.d(C,"shouldAlignOnDiscontinuities",function(){return R}),y.d(C,"findDiscontinuousReferenceFrag",function(){return I}),y.d(C,"adjustSlidingStart",function(){return p}),y.d(C,"alignStream",function(){return x}),y.d(C,"alignPDT",function(){return T}),y.d(C,"alignFragmentByPDTDelta",function(){return m}),y.d(C,"alignMediaPlaylistByPDT",function(){return g});var M=y("./src/polyfills/number.ts"),O=y("./src/utils/logger.ts"),D=y("./src/controller/level-helper.ts");function b(n,e){for(var l=null,f=0,c=n.length;f<c;f++){var i=n[f];if(i&&i.cc===e){l=i;break}}return l}function R(n,e,l){return!!(e.details&&(l.endCC>l.startCC||n&&n.cc<l.startCC))}function I(n,e){var l=n.fragments,f=e.fragments;if(!f.length||!l.length){O.logger.log("No fragments to align");return}var c=b(l,f[0].cc);if(!c||c&&!c.startPTS){O.logger.log("No frag in previous level to align on");return}return c}function A(n,e){if(n){var l=n.start+e;n.start=n.startPTS=l,n.endPTS=l+n.duration}}function p(n,e){for(var l=e.fragments,f=0,c=l.length;f<c;f++)A(l[f],n);e.fragmentHint&&A(e.fragmentHint,n),e.alignedSliding=!0}function x(n,e,l){!e||(E(n,l,e),!l.alignedSliding&&e.details&&T(l,e.details),!l.alignedSliding&&e.details&&!l.skippedSegments&&Object(D.adjustSliding)(e.details,l))}function E(n,e,l){if(R(n,l,e)){var f=I(l.details,e);f&&Object(M.isFiniteNumber)(f.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),p(f.start,e))}}function T(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var l=e.fragments[0].programDateTime,f=n.fragments[0].programDateTime,c=(f-l)/1e3+e.fragments[0].start;c&&Object(M.isFiniteNumber)(c)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(f-l)+"ms, sliding:"+c.toFixed(3)+" "+n.url+" "),p(c,n))}}function m(n,e){var l=n.programDateTime;if(!!l){var f=(l-e)/1e3;n.start=n.startPTS=f,n.endPTS=f+n.duration}}function g(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var l=e.fragments[0].programDateTime,f=e.fragments[0].start,c=l-f*1e3;n.fragments.forEach(function(i){m(i,c)}),n.fragmentHint&&m(n.fragmentHint,c),n.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(K,C,y){y.r(C);var M=y("./src/utils/ewma.ts"),O=function(){function D(R,I,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(R),this.fast_=new M.default(I)}var b=D.prototype;return b.update=function(I,A){var p=this.slow_,x=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new M.default(I,p.getEstimate(),p.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new M.default(A,x.getEstimate(),x.getTotalWeight()))},b.sample=function(I,A){I=Math.max(I,this.minDelayMs_);var p=8*A,x=I/1e3,E=p/x;this.fast_.sample(x,E),this.slow_.sample(x,E)},b.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},D}();C.default=O},"./src/utils/ewma.ts":function(K,C,y){y.r(C);var M=function(){function O(b,R,I){R===void 0&&(R=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=R,this.totalWeight_=I}var D=O.prototype;return D.sample=function(R,I){var A=Math.pow(this.alpha_,R);this.estimate_=I*(1-A)+A*this.estimate_,this.totalWeight_+=R},D.getTotalWeight=function(){return this.totalWeight_},D.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},O}();C.default=M},"./src/utils/fetch-loader.ts":function(K,C,y){y.r(C),y.d(C,"fetchSupported",function(){return m});var M=y("./src/polyfills/number.ts"),O=y("./src/loader/load-stats.ts"),D=y("./src/demux/chunk-cache.ts");function b(f,c){f.prototype=Object.create(c.prototype),f.prototype.constructor=f,x(f,c)}function R(f){var c=typeof Map=="function"?new Map:void 0;return R=function(t){if(t===null||!p(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof c<"u"){if(c.has(t))return c.get(t);c.set(t,r)}function r(){return I(t,arguments,E(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),x(r,t)},R(f)}function I(f,c,i){return A()?I=Reflect.construct.bind():I=function(r,h,a){var s=[null];s.push.apply(s,h);var d=Function.bind.apply(r,s),o=new d;return a&&x(o,a.prototype),o},I.apply(null,arguments)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function p(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function x(f,c){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},x(f,c)}function E(f){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},E(f)}function T(){return T=Object.assign?Object.assign.bind():function(f){for(var c=1;c<arguments.length;c++){var i=arguments[c];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(f[t]=i[t])}return f},T.apply(this,arguments)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var g=function(){function f(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||e,this.controller=new self.AbortController,this.stats=new O.LoadStats}var c=f.prototype;return c.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},c.abortInternal=function(){var t=this.response;(!t||!t.ok)&&(this.stats.aborted=!0,this.controller.abort())},c.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!==null&&t!==void 0&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},c.load=function(t,r,h){var a=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var d=n(t,this.controller.signal),o=h.onProgress,u=t.responseType==="arraybuffer",v=u?"byteLength":"length";this.context=t,this.config=r,this.callbacks=h,this.request=this.fetchSetup(t,d),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){a.abortInternal(),h.onTimeout(s,t,a.response)},r.timeout),self.fetch(this.request).then(function(S){if(a.response=a.loader=S,!S.ok){var L=S.status,P=S.statusText;throw new l(P||"fetch, bad network response",L,S)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(S.headers.get("Content-Length")||"0"),o&&Object(M.isFiniteNumber)(r.highWaterMark)?a.loadProgressively(S,s,t,r.highWaterMark,o):u?S.arrayBuffer():S.text()}).then(function(S){var L=a.response;self.clearTimeout(a.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=S[v];var P={url:L.url,data:S};o&&!Object(M.isFiniteNumber)(r.highWaterMark)&&o(s,t,S,L),h.onSuccess(P,s,t,L)}).catch(function(S){if(self.clearTimeout(a.requestTimeout),!s.aborted){var L=S&&S.code||0,P=S?S.message:null;h.onError({code:L,text:P},t,S?S.details:null)}})},c.getCacheAge=function(){var t=null;if(this.response){var r=this.response.headers.get("age");t=r?parseFloat(r):null}return t},c.loadProgressively=function(t,r,h,a,s){a===void 0&&(a=0);var d=new D.default,o=t.body.getReader(),u=function v(){return o.read().then(function(S){if(S.done)return d.dataLength&&s(r,h,d.flush(),t),Promise.resolve(new ArrayBuffer(0));var L=S.value,P=L.length;return r.loaded+=P,P<a||d.dataLength?(d.push(L),d.dataLength>=a&&s(r,h,d.flush(),t)):s(r,h,L,t),v()}).catch(function(){return Promise.reject()})};return u()},f}();function n(f,c){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:c,headers:new self.Headers(T({},f.headers))};return f.rangeEnd&&i.headers.set("Range","bytes="+f.rangeStart+"-"+String(f.rangeEnd-1)),i}function e(f,c){return new self.Request(f.url,c)}var l=function(f){b(c,f);function c(i,t,r){var h;return h=f.call(this,i)||this,h.code=void 0,h.details=void 0,h.code=t,h.details=r,h}return c}(R(Error));C.default=g},"./src/utils/imsc1-ttml-parser.ts":function(K,C,y){y.r(C),y.d(C,"IMSC1_CODEC",function(){return p}),y.d(C,"parseIMSC1",function(){return m});var M=y("./src/utils/mp4-tools.ts"),O=y("./src/utils/vttparser.ts"),D=y("./src/utils/vttcue.ts"),b=y("./src/demux/id3.ts"),R=y("./src/utils/timescale-conversion.ts"),I=y("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(a[o]=d[o])}return a},A.apply(this,arguments)}var p="stpp.ttml.im1t",x=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,E=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(a,s,d,o,u){var v=Object(M.findBox)(new Uint8Array(a),["mdat"]);if(v.length===0){u(new Error("Could not parse IMSC1 mdat"));return}var S=v.map(function(P){return Object(b.utf8ArrayToStr)(P)}),L=Object(R.toTimescaleFromScale)(s,1,d);try{S.forEach(function(P){return o(g(P,L))})}catch(P){u(P)}}function g(a,s){var d=new DOMParser,o=d.parseFromString(a,"text/xml"),u=o.getElementsByTagName("tt")[0];if(!u)throw new Error("Invalid ttml");var v={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},S=Object.keys(v).reduce(function(B,U){return B[U]=u.getAttribute("ttp:"+U)||v[U],B},{}),L=u.getAttribute("xml:space")!=="preserve",P=e(n(u,"styling","style")),F=e(n(u,"layout","region")),_=n(u,"body","[begin]");return[].map.call(_,function(B){var U=l(B,L);if(!U||!B.hasAttribute("begin"))return null;var N=t(B.getAttribute("begin"),S),k=t(B.getAttribute("dur"),S),w=t(B.getAttribute("end"),S);if(N===null)throw i(B);if(w===null){if(k===null)throw i(B);w=N+k}var W=new D.default(N-s,w-s,U);W.id=Object(I.generateCueId)(W.startTime,W.endTime,W.text);var G=F[B.getAttribute("region")],j=P[B.getAttribute("style")];W.position=10,W.size=80;var Y=f(G,j,P),J=Y.textAlign;if(J){var Z=T[J];Z&&(W.lineAlign=Z),W.align=J}return A(W,Y),W}).filter(function(B){return B!==null})}function n(a,s,d){var o=a.getElementsByTagName(s)[0];return o?[].slice.call(o.querySelectorAll(d)):[]}function e(a){return a.reduce(function(s,d){var o=d.getAttribute("xml:id");return o&&(s[o]=d),s},{})}function l(a,s){return[].slice.call(a.childNodes).reduce(function(d,o,u){var v;return o.nodeName==="br"&&u?d+`
`:(v=o.childNodes)!==null&&v!==void 0&&v.length?l(o,s):s?d+o.textContent.trim().replace(/\s+/g," "):d+o.textContent},"")}function f(a,s,d){var o="http://www.w3.org/ns/ttml#styling",u=null,v=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],S=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return S&&d.hasOwnProperty(S)&&(u=d[S]),v.reduce(function(L,P){var F=c(s,o,P)||c(a,o,P)||c(u,o,P);return F&&(L[P]=F),L},{})}function c(a,s,d){return a&&a.hasAttributeNS(s,d)?a.getAttributeNS(s,d):null}function i(a){return new Error("Could not parse ttml timestamp "+a)}function t(a,s){if(!a)return null;var d=Object(O.parseTimeStamp)(a);return d===null&&(x.test(a)?d=r(a,s):E.test(a)&&(d=h(a,s))),d}function r(a,s){var d=x.exec(a),o=(d[4]|0)+(d[5]|0)/s.subFrameRate;return(d[1]|0)*3600+(d[2]|0)*60+(d[3]|0)+o/s.frameRate}function h(a,s){var d=E.exec(a),o=Number(d[1]),u=d[2];switch(u){case"h":return o*3600;case"m":return o*60;case"ms":return o*1e3;case"f":return o/s.frameRate;case"t":return o/s.tickRate}return o}},"./src/utils/logger.ts":function(K,C,y){y.r(C),y.d(C,"enableLogs",function(){return I}),y.d(C,"logger",function(){return A});var M=function(){},O={trace:M,debug:M,log:M,warn:M,info:M,error:M},D=O;function b(p){var x=self.console[p];return x?x.bind(self.console,"["+p+"] >"):M}function R(p){for(var x=arguments.length,E=new Array(x>1?x-1:0),T=1;T<x;T++)E[T-1]=arguments[T];E.forEach(function(m){D[m]=p[m]?p[m].bind(p):b(m)})}function I(p){if(self.console&&p===!0||typeof p=="object"){R(p,"debug","log","info","warn","error");try{D.log()}catch{D=O}}else D=O}var A=D},"./src/utils/mediakeys-helper.ts":function(K,C,y){y.r(C),y.d(C,"KeySystems",function(){return M}),y.d(C,"requestMediaKeySystemAccess",function(){return O});var M;(function(D){D.WIDEVINE="com.widevine.alpha",D.PLAYREADY="com.microsoft.playready"})(M||(M={}));var O=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(K,C,y){y.r(C),y.d(C,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(K,C,y){y.r(C),y.d(C,"RemuxerTrackIdConfig",function(){return I}),y.d(C,"bin2str",function(){return A}),y.d(C,"readUint16",function(){return p}),y.d(C,"readUint32",function(){return x}),y.d(C,"readSint32",function(){return E}),y.d(C,"writeUint32",function(){return T}),y.d(C,"findBox",function(){return m}),y.d(C,"parseSegmentIndex",function(){return g}),y.d(C,"parseInitSegment",function(){return n}),y.d(C,"getStartDTS",function(){return e}),y.d(C,"getDuration",function(){return l}),y.d(C,"computeRawDurationFromSamples",function(){return f}),y.d(C,"offsetStartDTS",function(){return c}),y.d(C,"segmentValidRange",function(){return i}),y.d(C,"appendUint8Array",function(){return t}),y.d(C,"parseSamples",function(){return r}),y.d(C,"parseSEIMessageFromNALu",function(){return s}),y.d(C,"parseEmsg",function(){return o});var M=y("./src/utils/typed-array.ts"),O=y("./src/loader/fragment.ts"),D=y("./src/demux/id3.ts"),b=Math.pow(2,32)-1,R=[].push,I={video:1,audio:2,id3:3,text:4};function A(u){return String.fromCharCode.apply(null,u)}function p(u,v){var S=u[v]<<8|u[v+1];return S<0?65536+S:S}function x(u,v){var S=E(u,v);return S<0?4294967296+S:S}function E(u,v){return u[v]<<24|u[v+1]<<16|u[v+2]<<8|u[v+3]}function T(u,v,S){u[v]=S>>24,u[v+1]=S>>16&255,u[v+2]=S>>8&255,u[v+3]=S&255}function m(u,v){var S=[];if(!v.length)return S;for(var L=u.byteLength,P=0;P<L;){var F=x(u,P),_=A(u.subarray(P+4,P+8)),B=F>1?P+F:L;if(_===v[0])if(v.length===1)S.push(u.subarray(P+8,B));else{var U=m(u.subarray(P+8,B),v.slice(1));U.length&&R.apply(S,U)}P=B}return S}function g(u){var v=[],S=u[0],L=8,P=x(u,L);L+=4;var F=0,_=0;S===0?L+=8:L+=16,L+=2;var B=u.length+_,U=p(u,L);L+=2;for(var N=0;N<U;N++){var k=L,w=x(u,k);k+=4;var W=w&2147483647,G=(w&2147483648)>>>31;if(G===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var j=x(u,k);k+=4,v.push({referenceSize:W,subsegmentDuration:j,info:{duration:j/P,start:B,end:B+W-1}}),B+=W,k+=4,L=k}return{earliestPresentationTime:F,timescale:P,version:S,referencesCount:U,references:v}}function n(u){for(var v=[],S=m(u,["moov","trak"]),L=0;L<S.length;L++){var P=S[L],F=m(P,["tkhd"])[0];if(F){var _=F[0],B=_===0?12:20,U=x(F,B),N=m(P,["mdia","mdhd"])[0];if(N){_=N[0],B=_===0?12:20;var k=x(N,B),w=m(P,["mdia","hdlr"])[0];if(w){var W=A(w.subarray(8,12)),G={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[W];if(G){var j=m(P,["mdia","minf","stbl","stsd"])[0],Y=void 0;j&&(Y=A(j.subarray(12,16))),v[U]={timescale:k,type:G},v[G]={timescale:k,id:U,codec:Y}}}}}}var J=m(u,["moov","mvex","trex"]);return J.forEach(function(Z){var H=x(Z,4),q=v[H];q&&(q.default={duration:x(Z,12),flags:x(Z,20)})}),v}function e(u,v){return m(v,["moof","traf"]).reduce(function(S,L){var P=m(L,["tfdt"])[0],F=P[0],_=m(L,["tfhd"]).reduce(function(B,U){var N=x(U,4),k=u[N];if(k){var w=x(P,4);F===1&&(w*=Math.pow(2,32),w+=x(P,8));var W=k.timescale||9e4,G=w/W;if(isFinite(G)&&(B===null||G<B))return G}return B},null);return _!==null&&isFinite(_)&&(S===null||_<S)?_:S},null)||0}function l(u,v){for(var S=0,L=0,P=0,F=m(u,["moof","traf"]),_=0;_<F.length;_++){var B=F[_],U=m(B,["tfhd"])[0],N=x(U,4),k=v[N];if(!!k){var w=k.default,W=x(U,0)|(w==null?void 0:w.flags),G=w==null?void 0:w.duration;W&8&&(W&2?G=x(U,12):G=x(U,8));for(var j=k.timescale||9e4,Y=m(B,["trun"]),J=0;J<Y.length;J++){if(S=f(Y[J]),!S&&G){var Z=x(Y[J],4);S=G*Z}k.type===O.ElementaryStreamTypes.VIDEO?L+=S/j:k.type===O.ElementaryStreamTypes.AUDIO&&(P+=S/j)}}}if(L===0&&P===0){for(var H=0,q=m(u,["sidx"]),Q=0;Q<q.length;Q++){var $=g(q[Q]);$!=null&&$.references&&(H+=$.references.reduce(function(ne,re){return ne+re.info.duration||0},0))}return H}return L||P}function f(u){var v=x(u,0),S=8;v&1&&(S+=4),v&4&&(S+=4);for(var L=0,P=x(u,4),F=0;F<P;F++){if(v&256){var _=x(u,S);L+=_,S+=4}v&512&&(S+=4),v&1024&&(S+=4),v&2048&&(S+=4)}return L}function c(u,v,S){m(v,["moof","traf"]).forEach(function(L){m(L,["tfhd"]).forEach(function(P){var F=x(P,4),_=u[F];if(!!_){var B=_.timescale||9e4;m(L,["tfdt"]).forEach(function(U){var N=U[0],k=x(U,4);if(N===0)k-=S*B,k=Math.max(k,0),T(U,4,k);else{k*=Math.pow(2,32),k+=x(U,8),k-=S*B,k=Math.max(k,0);var w=Math.floor(k/(b+1)),W=Math.floor(k%(b+1));T(U,4,w),T(U,8,W)}})}})})}function i(u){var v={valid:null,remainder:null},S=m(u,["moof"]);if(S){if(S.length<2)return v.remainder=u,v}else return v;var L=S[S.length-1];return v.valid=Object(M.sliceUint8)(u,0,L.byteOffset-8),v.remainder=Object(M.sliceUint8)(u,L.byteOffset-8),v}function t(u,v){var S=new Uint8Array(u.length+v.length);return S.set(u),S.set(v,u.length),S}function r(u,v){var S=[],L=v.samples,P=v.timescale,F=v.id,_=!1,B=m(L,["moof"]);return B.map(function(U){var N=U.byteOffset-8,k=m(U,["traf"]);k.map(function(w){var W=m(w,["tfdt"]).map(function(G){var j=G[0],Y=x(G,4);return j===1&&(Y*=Math.pow(2,32),Y+=x(G,8)),Y/P})[0];return W!==void 0&&(u=W),m(w,["tfhd"]).map(function(G){var j=x(G,4),Y=x(G,0)&16777215,J=(Y&1)!==0,Z=(Y&2)!==0,H=(Y&8)!==0,q=0,Q=(Y&16)!==0,$=0,ne=(Y&32)!==0,re=8;j===F&&(J&&(re+=8),Z&&(re+=4),H&&(q=x(G,re),re+=4),Q&&($=x(G,re),re+=4),ne&&(re+=4),v.type==="video"&&(_=h(v.codec)),m(w,["trun"]).map(function(ae){var le=ae[0],se=x(ae,0)&16777215,ge=(se&1)!==0,ue=0,me=(se&4)!==0,Te=(se&256)!==0,xe=0,Oe=(se&512)!==0,Se=0,ye=(se&1024)!==0,Ie=(se&2048)!==0,Le=0,_e=x(ae,4),fe=8;ge&&(ue=x(ae,fe),fe+=4),me&&(fe+=4);for(var Ee=ue+N,Re=0;Re<_e;Re++){if(Te?(xe=x(ae,fe),fe+=4):xe=q,Oe?(Se=x(ae,fe),fe+=4):Se=$,ye&&(fe+=4),Ie&&(le===0?Le=x(ae,fe):Le=E(ae,fe),fe+=4),v.type===O.ElementaryStreamTypes.VIDEO)for(var oe=0;oe<Se;){var pe=x(L,Ee);Ee+=4;var De=L[Ee]&31;if(a(_,De)){var Fe=L.subarray(Ee,Ee+pe);s(Fe,u+Le/P,S)}Ee+=pe,oe+=pe+4}u+=xe/P}}))})})}),S}function h(u){if(!u)return!1;var v=u.indexOf("."),S=v<0?u:u.substring(0,v);return S==="hvc1"||S==="hev1"||S==="dvh1"||S==="dvhe"}function a(u,v){return u?v===39||v===40:v===6}function s(u,v,S){var L=d(u),P=0;P++;for(var F=0,_=0,B=!1,U=0;P<L.length;){F=0;do{if(P>=L.length)break;U=L[P++],F+=U}while(U===255);_=0;do{if(P>=L.length)break;U=L[P++],_+=U}while(U===255);var N=L.length-P;if(!B&&F===4&&P<L.length){B=!0;var k=L[P++];if(k===181){var w=p(L,P);if(P+=2,w===49){var W=x(L,P);if(P+=4,W===1195456820){var G=L[P++];if(G===3){var j=L[P++],Y=31&j,J=64&j,Z=J?2+Y*3:0,H=new Uint8Array(Z);if(J){H[0]=j;for(var q=1;q<Z;q++)H[q]=L[P++]}S.push({type:G,payloadType:F,pts:v,bytes:H})}}}}}else if(F===5&&_<N){if(B=!0,_>16){for(var Q=[],$=0;$<16;$++){var ne=L[P++].toString(16);Q.push(ne.length==1?"0"+ne:ne),($===3||$===5||$===7||$===9)&&Q.push("-")}for(var re=_-16,ae=new Uint8Array(re),le=0;le<re;le++)ae[le]=L[P++];S.push({payloadType:F,pts:v,uuid:Q.join(""),userData:Object(D.utf8ArrayToStr)(ae),userDataBytes:ae})}}else if(_<N)P+=_;else if(_>N)break}}function d(u){for(var v=u.byteLength,S=[],L=1;L<v-2;)u[L]===0&&u[L+1]===0&&u[L+2]===3?(S.push(L+2),L+=2):L++;if(S.length===0)return u;var P=v-S.length,F=new Uint8Array(P),_=0;for(L=0;L<P;_++,L++)_===S[0]&&(_++,S.shift()),F[L]=u[_];return F}function o(u){var v=u[0],S="",L="",P=0,F=0,_=0,B=0,U=0,N=0;if(v===0){for(;A(u.subarray(N,N+1))!=="\0";)S+=A(u.subarray(N,N+1)),N+=1;for(S+=A(u.subarray(N,N+1)),N+=1;A(u.subarray(N,N+1))!=="\0";)L+=A(u.subarray(N,N+1)),N+=1;L+=A(u.subarray(N,N+1)),N+=1,P=x(u,12),F=x(u,16),B=x(u,20),U=x(u,24),N=28}else if(v===1){N+=4,P=x(u,N),N+=4;var k=x(u,N);N+=4;var w=x(u,N);for(N+=4,_=Math.pow(2,32)*k+w,Number.isSafeInteger(_)||(_=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),B=x(u,N),N+=4,U=x(u,N),N+=4;A(u.subarray(N,N+1))!=="\0";)S+=A(u.subarray(N,N+1)),N+=1;for(S+=A(u.subarray(N,N+1)),N+=1;A(u.subarray(N,N+1))!=="\0";)L+=A(u.subarray(N,N+1)),N+=1;L+=A(u.subarray(N,N+1)),N+=1}var W=u.subarray(N,u.byteLength);return{schemeIdUri:S,value:L,timeScale:P,presentationTime:_,presentationTimeDelta:F,eventDuration:B,id:U,payload:W}}},"./src/utils/output-filter.ts":function(K,C,y){y.r(C),y.d(C,"default",function(){return M});var M=function(){function O(b,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=R}var D=O.prototype;return D.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},D.newCue=function(R,I,A){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=I,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},D.reset=function(){this.cueRanges=[],this.startTime=null},O}()},"./src/utils/texttrack-utils.ts":function(K,C,y){y.r(C),y.d(C,"sendAddTrackEvent",function(){return O}),y.d(C,"addCueToTrack",function(){return D}),y.d(C,"clearCurrentCues",function(){return b}),y.d(C,"removeCuesInRange",function(){return R}),y.d(C,"getCuesInRange",function(){return A});var M=y("./src/utils/logger.ts");function O(p,x){var E;try{E=new Event("addtrack")}catch{E=document.createEvent("Event"),E.initEvent("addtrack",!1,!1)}E.track=p,x.dispatchEvent(E)}function D(p,x){var E=p.mode;if(E==="disabled"&&(p.mode="hidden"),p.cues&&!p.cues.getCueById(x.id))try{if(p.addCue(x),!p.cues.getCueById(x.id))throw new Error("addCue is failed for: "+x)}catch(m){M.logger.debug("[texttrack-utils]: "+m);var T=new self.TextTrackCue(x.startTime,x.endTime,x.text);T.id=x.id,p.addCue(T)}E==="disabled"&&(p.mode=E)}function b(p){var x=p.mode;if(x==="disabled"&&(p.mode="hidden"),p.cues)for(var E=p.cues.length;E--;)p.removeCue(p.cues[E]);x==="disabled"&&(p.mode=x)}function R(p,x,E,T){var m=p.mode;if(m==="disabled"&&(p.mode="hidden"),p.cues&&p.cues.length>0)for(var g=A(p.cues,x,E),n=0;n<g.length;n++)(!T||T(g[n]))&&p.removeCue(g[n]);m==="disabled"&&(p.mode=m)}function I(p,x){if(x<p[0].startTime)return 0;var E=p.length-1;if(x>p[E].endTime)return-1;for(var T=0,m=E;T<=m;){var g=Math.floor((m+T)/2);if(x<p[g].startTime)m=g-1;else if(x>p[g].startTime&&T<E)T=g+1;else return g}return p[T].startTime-x<x-p[m].startTime?T:m}function A(p,x,E){var T=[],m=I(p,x);if(m>-1)for(var g=m,n=p.length;g<n;g++){var e=p[g];if(e.startTime>=x&&e.endTime<=E)T.push(e);else if(e.startTime>E)return T}return T}},"./src/utils/time-ranges.ts":function(K,C,y){y.r(C);var M={toString:function(D){for(var b="",R=D.length,I=0;I<R;I++)b+="["+D.start(I).toFixed(3)+","+D.end(I).toFixed(3)+"]";return b}};C.default=M},"./src/utils/timescale-conversion.ts":function(K,C,y){y.r(C),y.d(C,"toTimescaleFromBase",function(){return O}),y.d(C,"toTimescaleFromScale",function(){return D}),y.d(C,"toMsFromMpegTsClock",function(){return b}),y.d(C,"toMpegTsClockFromTimescale",function(){return R});var M=9e4;function O(I,A,p,x){p===void 0&&(p=1),x===void 0&&(x=!1);var E=I*A*p;return x?Math.round(E):E}function D(I,A,p,x){return p===void 0&&(p=1),x===void 0&&(x=!1),O(I,A,1/p,x)}function b(I,A){return A===void 0&&(A=!1),O(I,1e3,1/M,A)}function R(I,A){return A===void 0&&(A=1),O(I,M,1/A)}},"./src/utils/typed-array.ts":function(K,C,y){y.r(C),y.d(C,"sliceUint8",function(){return M});function M(O,D,b){return Uint8Array.prototype.slice?O.slice(D,b):new Uint8Array(Array.prototype.slice.call(O,D,b))}},"./src/utils/vttcue.ts":function(K,C,y){y.r(C),C.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],O=["start","middle","end","left","right"];function D(p,x){if(typeof x!="string"||!Array.isArray(p))return!1;var E=x.toLowerCase();return~p.indexOf(E)?E:!1}function b(p){return D(M,p)}function R(p){return D(O,p)}function I(p){for(var x=arguments.length,E=new Array(x>1?x-1:0),T=1;T<x;T++)E[T-1]=arguments[T];for(var m=1;m<arguments.length;m++){var g=arguments[m];for(var n in g)p[n]=g[n]}return p}function A(p,x,E){var T=this,m={enumerable:!0};T.hasBeenReset=!1;var g="",n=!1,e=p,l=x,f=E,c=null,i="",t=!0,r="auto",h="start",a=50,s="middle",d=50,o="middle";Object.defineProperty(T,"id",I({},m,{get:function(){return g},set:function(v){g=""+v}})),Object.defineProperty(T,"pauseOnExit",I({},m,{get:function(){return n},set:function(v){n=!!v}})),Object.defineProperty(T,"startTime",I({},m,{get:function(){return e},set:function(v){if(typeof v!="number")throw new TypeError("Start time must be set to a number.");e=v,this.hasBeenReset=!0}})),Object.defineProperty(T,"endTime",I({},m,{get:function(){return l},set:function(v){if(typeof v!="number")throw new TypeError("End time must be set to a number.");l=v,this.hasBeenReset=!0}})),Object.defineProperty(T,"text",I({},m,{get:function(){return f},set:function(v){f=""+v,this.hasBeenReset=!0}})),Object.defineProperty(T,"region",I({},m,{get:function(){return c},set:function(v){c=v,this.hasBeenReset=!0}})),Object.defineProperty(T,"vertical",I({},m,{get:function(){return i},set:function(v){var S=b(v);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");i=S,this.hasBeenReset=!0}})),Object.defineProperty(T,"snapToLines",I({},m,{get:function(){return t},set:function(v){t=!!v,this.hasBeenReset=!0}})),Object.defineProperty(T,"line",I({},m,{get:function(){return r},set:function(v){if(typeof v!="number"&&v!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");r=v,this.hasBeenReset=!0}})),Object.defineProperty(T,"lineAlign",I({},m,{get:function(){return h},set:function(v){var S=R(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");h=S,this.hasBeenReset=!0}})),Object.defineProperty(T,"position",I({},m,{get:function(){return a},set:function(v){if(v<0||v>100)throw new Error("Position must be between 0 and 100.");a=v,this.hasBeenReset=!0}})),Object.defineProperty(T,"positionAlign",I({},m,{get:function(){return s},set:function(v){var S=R(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");s=S,this.hasBeenReset=!0}})),Object.defineProperty(T,"size",I({},m,{get:function(){return d},set:function(v){if(v<0||v>100)throw new Error("Size must be between 0 and 100.");d=v,this.hasBeenReset=!0}})),Object.defineProperty(T,"align",I({},m,{get:function(){return o},set:function(v){var S=R(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");o=S,this.hasBeenReset=!0}})),T.displayState=void 0}return A.prototype.getCueAsHTML=function(){var p=self.WebVTT;return p.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":function(K,C,y){y.r(C),y.d(C,"parseTimeStamp",function(){return D}),y.d(C,"fixLineBreaks",function(){return x}),y.d(C,"VTTParser",function(){return E});var M=y("./src/utils/vttcue.ts"),O=function(){function T(){}var m=T.prototype;return m.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},T}();function D(T){function m(n,e,l,f){return(n|0)*3600+(e|0)*60+(l|0)+parseFloat(f||0)}var g=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return g?parseFloat(g[2])>59?m(g[2],g[3],0,g[4]):m(g[1],g[2],g[3],g[4]):null}var b=function(){function T(){this.values=Object.create(null)}var m=T.prototype;return m.set=function(n,e){!this.get(n)&&e!==""&&(this.values[n]=e)},m.get=function(n,e,l){return l?this.has(n)?this.values[n]:e[l]:this.has(n)?this.values[n]:e},m.has=function(n){return n in this.values},m.alt=function(n,e,l){for(var f=0;f<l.length;++f)if(e===l[f]){this.set(n,e);break}},m.integer=function(n,e){/^-?\d+$/.test(e)&&this.set(n,parseInt(e,10))},m.percent=function(n,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var l=parseFloat(e);if(l>=0&&l<=100)return this.set(n,l),!0}return!1},T}();function R(T,m,g,n){var e=n?T.split(n):[T];for(var l in e)if(typeof e[l]=="string"){var f=e[l].split(g);if(f.length===2){var c=f[0],i=f[1];m(c,i)}}}var I=new M.default(0,0,""),A=I.align==="middle"?"middle":"center";function p(T,m,g){var n=T;function e(){var c=D(T);if(c===null)throw new Error("Malformed timestamp: "+n);return T=T.replace(/^[^\sa-zA-Z-]+/,""),c}function l(c,i){var t=new b;R(c,function(a,s){var d;switch(a){case"region":for(var o=g.length-1;o>=0;o--)if(g[o].id===s){t.set(a,g[o].region);break}break;case"vertical":t.alt(a,s,["rl","lr"]);break;case"line":d=s.split(","),t.integer(a,d[0]),t.percent(a,d[0])&&t.set("snapToLines",!1),t.alt(a,d[0],["auto"]),d.length===2&&t.alt("lineAlign",d[1],["start",A,"end"]);break;case"position":d=s.split(","),t.percent(a,d[0]),d.length===2&&t.alt("positionAlign",d[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":t.percent(a,s);break;case"align":t.alt(a,s,["start",A,"end","left","right"]);break}},/:/,/\s/),i.region=t.get("region",null),i.vertical=t.get("vertical","");var r=t.get("line","auto");r==="auto"&&I.line===-1&&(r=-1),i.line=r,i.lineAlign=t.get("lineAlign","start"),i.snapToLines=t.get("snapToLines",!0),i.size=t.get("size",100),i.align=t.get("align",A);var h=t.get("position","auto");h==="auto"&&I.position===50&&(h=i.align==="start"||i.align==="left"?0:i.align==="end"||i.align==="right"?100:50),i.position=h}function f(){T=T.replace(/^\s+/,"")}if(f(),m.startTime=e(),f(),T.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);T=T.slice(3),f(),m.endTime=e(),f(),l(T,m)}function x(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var E=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=T.prototype;return m.parse=function(n){var e=this;n&&(e.buffer+=e.decoder.decode(n,{stream:!0}));function l(){var h=e.buffer,a=0;for(h=x(h);a<h.length&&h[a]!=="\r"&&h[a]!==`
`;)++a;var s=h.slice(0,a);return h[a]==="\r"&&++a,h[a]===`
`&&++a,e.buffer=h.slice(a),s}function f(h){R(h,function(a,s){},/:/)}try{var c="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;c=l();var i=c.match(/^()?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var t=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(t?t=!1:c=l(),e.state){case"HEADER":/:/.test(c)?f(c):c||(e.state="ID");continue;case"NOTE":c||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(c)){e.state="NOTE";break}if(!c)continue;if(e.cue=new M.default(0,0,""),e.state="CUE",c.indexOf("-->")===-1){e.cue.id=c;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{p(c,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var r=c.indexOf("-->")!==-1;if(!c||r&&(t=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=c}continue;case"BADCUE":c||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){n.onparsingerror&&n.onparsingerror(e)}return n.onflush&&n.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(K,C,y){y.r(C),y.d(C,"generateCueId",function(){return E}),y.d(C,"parseWebVTT",function(){return m});var M=y("./src/polyfills/number.ts"),O=y("./src/utils/vttparser.ts"),D=y("./src/demux/id3.ts"),b=y("./src/utils/timescale-conversion.ts"),R=y("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,A=function(n,e,l){return l===void 0&&(l=0),n.slice(l,l+e.length)===e},p=function(n){var e=parseInt(n.slice(-3)),l=parseInt(n.slice(-6,-4)),f=parseInt(n.slice(-9,-7)),c=n.length>9?parseInt(n.substring(0,n.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(e)||!Object(M.isFiniteNumber)(l)||!Object(M.isFiniteNumber)(f)||!Object(M.isFiniteNumber)(c))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return e+=1e3*l,e+=60*1e3*f,e+=60*60*1e3*c,e},x=function(n){for(var e=5381,l=n.length;l;)e=e*33^n.charCodeAt(--l);return(e>>>0).toString()};function E(g,n,e){return x(g.toString())+x(n.toString())+x(e)}var T=function(n,e,l){var f=n[e],c=n[f.prevCC];if(!c||!c.new&&f.new){n.ccOffset=n.presentationOffset=f.start,f.new=!1;return}for(;(i=c)!==null&&i!==void 0&&i.new;){var i;n.ccOffset+=f.start-c.start,f.new=!1,f=c,c=n[f.prevCC]}n.presentationOffset=l};function m(g,n,e,l,f,c,i,t){var r=new O.VTTParser,h=Object(D.utf8ArrayToStr)(new Uint8Array(g)).trim().replace(I,`
`).split(`
`),a=[],s=Object(b.toMpegTsClockFromTimescale)(n,e),d="00:00.000",o=0,u=0,v,S=!0;r.oncue=function(L){var P=l[f],F=l.ccOffset,_=(o-s)/9e4;P!=null&&P.new&&(u!==void 0?F=l.ccOffset=P.start:T(l,f,_)),_&&(F=_-l.presentationOffset);var B=L.endTime-L.startTime,U=Object(R.normalizePts)((L.startTime+F-u)*9e4,c*9e4)/9e4;L.startTime=Math.max(U,0),L.endTime=Math.max(U+B,0);var N=L.text.trim();L.text=decodeURIComponent(encodeURIComponent(N)),L.id||(L.id=E(L.startTime,L.endTime,N)),L.endTime>0&&a.push(L)},r.onparsingerror=function(L){v=L},r.onflush=function(){if(v){t(v);return}i(a)},h.forEach(function(L){if(S)if(A(L,"X-TIMESTAMP-MAP=")){S=!1,L.slice(16).split(",").forEach(function(P){A(P,"LOCAL:")?d=P.slice(6):A(P,"MPEGTS:")&&(o=parseInt(P.slice(7)))});try{u=p(d)/1e3}catch(P){v=P}return}else L===""&&(S=!1);r.parse(L+`
`)}),r.flush()}},"./src/utils/xhr-loader.ts":function(K,C,y){y.r(C);var M=y("./src/utils/logger.ts"),O=y("./src/loader/load-stats.ts"),D=/^age:\s*[\d.]+\s*$/m,b=function(){function R(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var I=R.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var p=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),p&&(p.onreadystatechange=null,p.onprogress=null,p.readyState!==4&&(this.stats.aborted=!0,p.abort()))},I.abort=function(){var p;this.abortInternal(),(p=this.callbacks)!==null&&p!==void 0&&p.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(p,x,E){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=p,this.config=x,this.callbacks=E,this.retryDelay=x.retryDelay,this.loadInternal()},I.loadInternal=function(){var p=this.config,x=this.context;if(!!p){var E=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var m=this.xhrSetup;try{if(m)try{m(E,x.url)}catch{E.open("GET",x.url,!0),m(E,x.url)}E.readyState||E.open("GET",x.url,!0);var g=this.context.headers;if(g)for(var n in g)E.setRequestHeader(n,g[n])}catch(e){this.callbacks.onError({code:E.status,text:e.message},x,E);return}x.rangeEnd&&E.setRequestHeader("Range","bytes="+x.rangeStart+"-"+(x.rangeEnd-1)),E.onreadystatechange=this.readystatechange.bind(this),E.onprogress=this.loadprogress.bind(this),E.responseType=x.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout),E.send()}},I.readystatechange=function(){var p=this.context,x=this.loader,E=this.stats;if(!(!p||!x)){var T=x.readyState,m=this.config;if(!E.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),E.loading.first===0&&(E.loading.first=Math.max(self.performance.now(),E.loading.start)),T===4){x.onreadystatechange=null,x.onprogress=null;var g=x.status;if(g>=200&&g<300){E.loading.end=Math.max(self.performance.now(),E.loading.first);var n,e;if(p.responseType==="arraybuffer"?(n=x.response,e=n.byteLength):(n=x.responseText,e=n.length),E.loaded=E.total=e,!this.callbacks)return;var l=this.callbacks.onProgress;if(l&&l(E,p,n,x),!this.callbacks)return;var f={url:x.responseURL,data:n};this.callbacks.onSuccess(f,E,p,x)}else E.retry>=m.maxRetry||g>=400&&g<499?(M.logger.error(g+" while loading "+p.url),this.callbacks.onError({code:g,text:x.statusText},p,x)):(M.logger.warn(g+" while loading "+p.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),E.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},I.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var p=this.callbacks;p&&(this.abortInternal(),p.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(p){var x=this.stats;x.loaded=p.loaded,p.lengthComputable&&(x.total=p.total)},I.getCacheAge=function(){var p=null;if(this.loader&&D.test(this.loader.getAllResponseHeaders())){var x=this.loader.getResponseHeader("age");p=x?parseFloat(x):null}return p},R}();C.default=b}}).default})})(Dt);const ft=Gt(Dt.exports);function Vt(z){let V,K,C,y,M,O,D,b,R,I;return{c(){V=ce("svg"),K=ce("g"),C=ce("path"),y=ce("defs"),M=ce("linearGradient"),O=ce("stop"),D=ce("stop"),b=ce("stop"),this.h()},l(A){V=ve(A,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var p=ie(V);K=ve(p,"g",{opacity:!0});var x=ie(K);C=ve(x,"path",{d:!0,stroke:!0,"stroke-linejoin":!0}),ie(C).forEach(te),x.forEach(te),y=ve(p,"defs",{});var E=ie(y);M=ve(E,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var T=ie(M);O=ve(T,"stop",{"stop-color":!0}),ie(O).forEach(te),D=ve(T,"stop",{offset:!0,"stop-color":!0}),ie(D).forEach(te),b=ve(T,"stop",{offset:!0,"stop-color":!0}),ie(b).forEach(te),T.forEach(te),E.forEach(te),p.forEach(te),this.h()},h(){X(C,"d","M35 68L67 48L35 28L35 68Z"),X(C,"stroke","url(#paint0_linear_1567_29087)"),X(C,"stroke-linejoin","bevel"),X(K,"opacity","0.8"),X(O,"stop-color","#FFEDAC"),X(D,"offset","0.510417"),X(D,"stop-color","#EAC48B"),X(b,"offset","1"),X(b,"stop-color","#FFF3CA"),X(M,"id","paint0_linear_1567_29087"),X(M,"x1","58.9873"),X(M,"y1","39.3333"),X(M,"x2","39.7211"),X(M,"y2","45.9343"),X(M,"gradientUnits","userSpaceOnUse"),X(V,"width","96"),X(V,"height","96"),X(V,"viewBox","0 0 96 96"),X(V,"fill","none"),X(V,"xmlns","http://www.w3.org/2000/svg"),X(V,"class","svelte-1tz6r36")},m(A,p){Qe(A,V,p),ee(V,K),ee(K,C),ee(V,y),ee(y,M),ee(M,O),ee(M,D),ee(M,b),R||(I=[Ae(V,"click",z[0]),Ae(V,"keypress",z[1])],R=!0)},p:He,i:He,o:He,d(A){A&&te(V),R=!1,dt(I)}}}function Yt(z){function V(C){$e.call(this,z,C)}function K(C){$e.call(this,z,C)}return[V,K]}class Xt extends et{constructor(V){super(),tt(this,V,Yt,Vt,rt,{})}}function zt(z){let V,K,C,y,M,O,D,b,R,I,A,p,x,E,T;return{c(){V=de("div"),K=ce("svg"),C=ce("g"),y=ce("path"),M=ce("defs"),O=ce("linearGradient"),D=ce("stop"),b=ce("stop"),R=ce("stop"),I=Me(),A=ce("svg"),p=ce("g"),x=ce("path"),this.h()},l(m){V=he(m,"DIV",{class:!0});var g=ie(V);K=ve(g,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var n=ie(K);C=ve(n,"g",{opacity:!0});var e=ie(C);y=ve(e,"path",{d:!0,stroke:!0,"stroke-linejoin":!0}),ie(y).forEach(te),e.forEach(te),M=ve(n,"defs",{});var l=ie(M);O=ve(l,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var f=ie(O);D=ve(f,"stop",{"stop-color":!0}),ie(D).forEach(te),b=ve(f,"stop",{offset:!0,"stop-color":!0}),ie(b).forEach(te),R=ve(f,"stop",{offset:!0,"stop-color":!0}),ie(R).forEach(te),f.forEach(te),l.forEach(te),n.forEach(te),I=be(g),A=ve(g,"svg",{class:!0,width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var c=ie(A);p=ve(c,"g",{opacity:!0});var i=ie(p);x=ve(i,"path",{"fill-rule":!0,"clip-rule":!0,d:!0,fill:!0}),ie(x).forEach(te),i.forEach(te),c.forEach(te),g.forEach(te),this.h()},h(){X(y,"d","M40 62.1836L62 48.1836L40 34.1836L40 62.1836Z"),X(y,"stroke","url(#paint0_linear_1567_29088)"),X(y,"stroke-linejoin","bevel"),X(C,"opacity","0.8"),X(D,"stop-color","#FFEDAC"),X(b,"offset","0.510417"),X(b,"stop-color","#EAC48B"),X(R,"offset","1"),X(R,"stop-color","#FFF3CA"),X(O,"id","paint0_linear_1567_29088"),X(O,"x1","56.4913"),X(O,"y1","42.1169"),X(O,"x2","43.1963"),X(O,"y2","46.5907"),X(O,"gradientUnits","userSpaceOnUse"),X(K,"width","96"),X(K,"height","96"),X(K,"viewBox","0 0 96 96"),X(K,"fill","none"),X(K,"xmlns","http://www.w3.org/2000/svg"),X(K,"class","svelte-1m5mqa4"),X(x,"fill-rule","evenodd"),X(x,"clip-rule","evenodd"),X(x,"d","M66.7881 28.102L65.3766 21.9014L66.3516 21.6794L68.0852 29.2948L67.6189 29.9053L59.8157 30.2373L59.7733 29.2382L66.2435 28.9629C55.8613 19.099 39.4472 19.2598 29.2617 29.4453C18.9128 39.7942 18.9128 56.5731 29.2617 66.922C39.6106 77.2709 56.3894 77.2709 66.7383 66.922L67.4454 67.6291C56.706 78.3685 39.294 78.3685 28.5546 67.6291C17.8152 56.8897 17.8152 39.4776 28.5546 28.7382C39.0775 18.2152 56.0069 18.0032 66.7881 28.102Z"),X(x,"fill","#FFF5C3"),X(p,"opacity","0.8"),X(A,"class","arrow svelte-1m5mqa4"),X(A,"width","96"),X(A,"height","96"),X(A,"viewBox","0 0 96 96"),X(A,"fill","none"),X(A,"xmlns","http://www.w3.org/2000/svg"),X(V,"class","replay layout:overlay svelte-1m5mqa4")},m(m,g){Qe(m,V,g),ee(V,K),ee(K,C),ee(C,y),ee(K,M),ee(M,O),ee(O,D),ee(O,b),ee(O,R),ee(V,I),ee(V,A),ee(A,p),ee(p,x),E||(T=[Ae(V,"click",z[0]),Ae(V,"keypress",z[1])],E=!0)},p:He,i:He,o:He,d(m){m&&te(V),E=!1,dt(T)}}}function Qt(z){function V(C){$e.call(this,z,C)}function K(C){$e.call(this,z,C)}return[V,K]}class $t extends et{constructor(V){super(),tt(this,V,Qt,zt,rt,{})}}const{isNaN:Zt}=Bt;function Jt(z){let V,K,C,y=!1,M,O=!0,D,b,R,I,A,p,x,E,T,m,g,n,e,l,f,c=qe(z[1])+"",i,t,r,h,a,s,d=qe(z[4])+"",o,u,v,S,L,P,F,_,B,U,N,k;function w(){cancelAnimationFrame(M),C.paused||(M=Ut(w),y=!0),z[17].call(C)}return T=new $t({}),T.$on("click",z[12]),n=new Xt({}),n.$on("click",z[13]),L=new jt({}),L.$on("click",z[10]),_=new Ht({props:{muted:z[8]}}),_.$on("click",z[11]),{c(){V=de("div"),K=de("div"),C=de("video"),D=Me(),b=de("div"),R=de("p"),I=Me(),A=de("div"),p=de("div"),x=de("div"),E=de("div"),Ve(T.$$.fragment),m=Me(),g=de("div"),Ve(n.$$.fragment),e=Me(),l=de("div"),f=de("span"),i=ot(c),t=Me(),r=de("span"),h=ot("/"),a=Me(),s=de("span"),o=ot(d),u=Me(),v=de("div"),S=de("div"),Ve(L.$$.fragment),P=Me(),F=de("div"),Ve(_.$$.fragment),this.h()},l(W){V=he(W,"DIV",{class:!0});var G=ie(V);K=he(G,"DIV",{class:!0});var j=ie(K);C=he(j,"VIDEO",{poster:!0,class:!0}),ie(C).forEach(te),j.forEach(te),D=be(G),b=he(G,"DIV",{class:!0});var Y=ie(b);R=he(Y,"P",{class:!0});var J=ie(R);J.forEach(te),Y.forEach(te),I=be(G),A=he(G,"DIV",{class:!0});var Z=ie(A);p=he(Z,"DIV",{class:!0});var H=ie(p);x=he(H,"DIV",{class:!0});var q=ie(x);E=he(q,"DIV",{class:!0});var Q=ie(E);Ye(T.$$.fragment,Q),Q.forEach(te),m=be(q),g=he(q,"DIV",{class:!0});var $=ie(g);Ye(n.$$.fragment,$),$.forEach(te),q.forEach(te),e=be(H),l=he(H,"DIV",{class:!0});var ne=ie(l);f=he(ne,"SPAN",{class:!0});var re=ie(f);i=lt(re,c),re.forEach(te),t=be(ne),r=he(ne,"SPAN",{class:!0});var ae=ie(r);h=lt(ae,"/"),ae.forEach(te),a=be(ne),s=he(ne,"SPAN",{class:!0});var le=ie(s);o=lt(le,d),le.forEach(te),ne.forEach(te),H.forEach(te),Z.forEach(te),u=be(G),v=he(G,"DIV",{class:!0});var se=ie(v);S=he(se,"DIV",{class:!0});var ge=ie(S);Ye(L.$$.fragment,ge),ge.forEach(te),P=be(se),F=he(se,"DIV",{class:!0});var ue=ie(F);Ye(_.$$.fragment,ue),ue.forEach(te),se.forEach(te),G.forEach(te),this.h()},h(){X(C,"poster","/images/video-poster.jpg"),C.playsInline=!0,X(C,"class","svelte-nqp3to"),(z[1]===void 0||z[5]===void 0)&&Je(w),z[5]===void 0&&Je(()=>z[19].call(C)),z[4]===void 0&&Je(()=>z[20].call(C)),X(K,"class","player__video svelte-nqp3to"),X(R,"class","svelte-nqp3to"),Ue(R,"cueVisible",z[2]),X(b,"class","player__subs svelte-nqp3to"),X(E,"class","btn btn--replay fade svelte-nqp3to"),Ue(E,"show",z[5]),X(g,"class","btn btn--play fade svelte-nqp3to"),Ue(g,"show",z[6]&&!z[5]),X(x,"class","icons layout:overlay svelte-nqp3to"),X(f,"class","current"),X(r,"class","split"),X(s,"class","length"),X(l,"class","time type:l1 svelte-nqp3to"),X(p,"class","center"),X(A,"class","player__overlay fade svelte-nqp3to"),Ue(A,"show",(z[6]||z[5])&&z[7]),X(S,"class","close svelte-nqp3to"),X(F,"class","audio svelte-nqp3to"),X(v,"class","player__ui svelte-nqp3to"),X(V,"class","player layout:overlay svelte-nqp3to")},m(W,G){Qe(W,V,G),ee(V,K),ee(K,C),z[16](C),C.muted=z[8],ee(V,D),ee(V,b),ee(b,R),R.innerHTML=z[3],ee(V,I),ee(V,A),ee(A,p),ee(p,x),ee(x,E),Xe(T,E,null),ee(x,m),ee(x,g),Xe(n,g,null),ee(p,e),ee(p,l),ee(l,f),ee(f,i),ee(l,t),ee(l,r),ee(r,h),ee(l,a),ee(l,s),ee(s,o),ee(V,u),ee(V,v),ee(v,S),Xe(L,S,null),ee(v,P),ee(v,F),Xe(_,F,null),U=!0,N||(k=[Ae(C,"timeupdate",w),Ae(C,"play",z[18]),Ae(C,"pause",z[18]),Ae(C,"ended",z[19]),Ae(C,"durationchange",z[20]),Ae(C,"volumechange",z[21]),Ae(K,"click",z[9]),Ae(K,"keypress",z[15])],N=!0)},p(W,[G]){!y&&G&2&&!Zt(W[1])&&(C.currentTime=W[1]),y=!1,G&64&&O!==(O=W[6])&&C[O?"pause":"play"](),G&256&&(C.muted=W[8]),(!U||G&8)&&(R.innerHTML=W[3]),(!U||G&4)&&Ue(R,"cueVisible",W[2]),(!U||G&32)&&Ue(E,"show",W[5]),(!U||G&96)&&Ue(g,"show",W[6]&&!W[5]),(!U||G&2)&&c!==(c=qe(W[1])+"")&&mt(i,c),(!U||G&16)&&d!==(d=qe(W[4])+"")&&mt(o,d),(!U||G&224)&&Ue(A,"show",(W[6]||W[5])&&W[7]);const j={};G&256&&(j.muted=W[8]),_.$set(j)},i(W){U||(Ne(T.$$.fragment,W),Ne(n.$$.fragment,W),Ne(L.$$.fragment,W),Ne(_.$$.fragment,W),Je(()=>{B||(B=Et(V,pt,{},!0)),B.run(1)}),U=!0)},o(W){We(T.$$.fragment,W),We(n.$$.fragment,W),We(L.$$.fragment,W),We(_.$$.fragment,W),B||(B=Et(V,pt,{},!1)),B.run(0),U=!1},d(W){W&&te(V),z[16](null),ze(T),ze(n),ze(L),ze(_),W&&B&&B.end(),N=!1,dt(k)}}}function qe(z=0){return isNaN(z)?"00:00":new Date(z*1e3).toISOString().slice(14,19)}function qt(z,V,K){let C;St(z,ut,v=>K(8,C=v));let{src:y}=V,M,O,D,b=0,R=!1,I="",A=0,p,x=!0,E=yt();const T=_t();Ft(async()=>(M.textTracks.addEventListener("addtrack",n),await m(M,y),K(6,x=yt()),K(7,E=!0),()=>{O.removeEventListener("cuechange",e),M.textTracks.removeEventListener("addtrack",n)}));function m(v,S){return new Promise(L=>{ft.isSupported()?(D=new ft,D.subtitleTrack=0,D.loadSource(S),D.attachMedia(v),D.on(ft.Events.SUBTITLE_TRACK_LOADED,()=>{g(),L()})):v.canPlayType("application/vnd.apple.mpegurl")&&(v.src=S)})}function g(){for(let v=0;v<M.textTracks.length;v++)K(0,M.textTracks[v].mode="hidden",M)}function n(v){!v.track||(O=v.track,O.mode="hidden",O.addEventListener("cuechange",e))}async function e(){var L;if(!M.textTracks)return;const v=(L=M.textTracks[0])==null?void 0:L.activeCues;if(!v||v.length===0)return K(2,R=!1);const S=v[0].text;K(3,I=S),K(2,R=!0)}function l(){K(6,x=!x)}function f(){T("close")}function c(){Lt(ut,C=!C,C)}function i(){K(1,b=0),K(5,p=!1),K(6,x=!1)}function t(){K(6,x=!1)}function r(v){$e.call(this,z,v)}function h(v){Nt[v?"unshift":"push"](()=>{M=v,K(0,M)})}function a(){b=this.currentTime,p=this.ended,K(1,b),K(5,p)}function s(){x=this.paused,K(6,x)}function d(){p=this.ended,K(5,p)}function o(){A=this.duration,K(4,A)}function u(){C=this.muted,ut.set(C)}return z.$$set=v=>{"src"in v&&K(14,y=v.src)},[M,b,R,I,A,p,x,E,C,l,f,c,i,t,y,r,h,a,s,d,o,u]}class er extends et{constructor(V){super(),tt(this,V,qt,Jt,rt,{src:14})}}function xt(z){let V,K;return V=new er({props:{src:z[0].video}}),V.$on("close",z[2]),{c(){Ve(V.$$.fragment)},l(C){Ye(V.$$.fragment,C)},m(C,y){Xe(V,C,y),K=!0},p(C,y){const M={};y&1&&(M.src=C[0].video),V.$set(M)},i(C){K||(Ne(V.$$.fragment,C),K=!0)},o(C){We(V.$$.fragment,C),K=!1},d(C){ze(V,C)}}}function tr(z){let V,K,C,y,M,O;document.title=V=z[0].title;let D=z[1]&&xt(z);return{c(){K=Me(),C=de("section"),D&&D.c(),this.h()},l(b){kt("svelte-8oibt4",document.head).forEach(te),K=be(b),C=he(b,"SECTION",{class:!0});var I=ie(C);D&&D.l(I),I.forEach(te),this.h()},h(){X(C,"class","layout:main:page layout:overlay")},m(b,R){Qe(b,K,R),Qe(b,C,R),D&&D.m(C,null),y=!0,M||(O=Ae(window,"keydown",z[3]),M=!0)},p(b,[R]){(!y||R&1)&&V!==(V=b[0].title)&&(document.title=V),b[1]?D?(D.p(b,R),R&2&&Ne(D,1)):(D=xt(b),D.c(),Ne(D,1),D.m(C,null)):D&&(Kt(),We(D,1,1,()=>{D=null}),wt())},i(b){y||(Ne(D),y=!0)},o(b){We(D),y=!1},d(b){b&&te(K),b&&te(C),D&&D.d(),M=!1,O()}}}function rr(z,V,K){let C;St(z,Tt,D=>K(1,C=D));let{data:y}=V;function M(){Lt(Tt,C=!1,C)}function O(D){D.key==="Escape"&&M()}return z.$$set=D=>{"data"in D&&K(0,y=D.data)},[y,C,M,O]}class lr extends et{constructor(V){super(),tt(this,V,rr,tr,rt,{data:0})}}export{lr as default};
